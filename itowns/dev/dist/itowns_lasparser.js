!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("itowns_lasparser",[],t):"object"==typeof exports?exports.itowns_lasparser=t():e.itowns_lasparser=t()}(self,(()=>(()=>{var e,t,r={78963:()=>{},62701:(e,t,r)=>{"use strict";var n=r(79103),o=r(42622),a=r(37830);function i(e){return 1===e.majorVersion&&e.minorVersion<=2?8:16}const s=new class{constructor(){this._wasmPath="https://cdn.jsdelivr.net/npm/laz-perf@0.0.6/lib",this._wasmPromise=null}_initDecoder(){return this._wasmPromise||(this._wasmPromise=o.LazPerf.create({locateFile:e=>`${this._wasmPath}/${e}`})),this._wasmPromise}_parseView(e,t){const r=t.colorDepth??16,n=["X","Y","Z"].map(e.getter),o=e.getter("Intensity"),a=e.getter("ReturnNumber"),i=e.getter("NumberOfReturns"),s=e.getter("Classification"),p=e.getter("PointSourceId"),c=e.dimensions.Red?["Red","Green","Blue"].map(e.getter):void 0,u=e.getter("ScanAngle"),l=new Float32Array(3*e.pointCount),f=new Uint16Array(e.pointCount),h=new Uint8Array(e.pointCount),w=new Uint8Array(e.pointCount),m=new Uint8Array(e.pointCount),d=new Uint16Array(e.pointCount),y=c?new Uint8Array(4*e.pointCount):void 0,b=new Float32Array(e.pointCount),g=n.map((e=>e(0))).map((e=>Math.floor(e)));for(let t=0;t<e.pointCount;t++){const[e,v,P]=n.map((e=>e(t)));if(l[3*t]=e-g[0],l[3*t+1]=v-g[1],l[3*t+2]=P-g[2],f[t]=o(t),h[t]=a(t),w[t]=i(t),c){let[e,n,o]=c.map((e=>e(t)));16===r&&(e/=256,n/=256,o/=256),y[4*t]=e,y[4*t+1]=n,y[4*t+2]=o,y[4*t+3]=255}m[t]=s(t),d[t]=p(t),b[t]=u(t)}return{position:l,intensity:f,returnNumber:h,numberOfReturns:w,classification:m,pointSourceID:d,color:y,scanAngle:b,origin:g}}set lazPerf(e){this._wasmPath=e,this._wasmPromise=null}async parseChunk(e,t){const{header:r,eb:n,pointCount:o}=t,{pointDataRecordFormat:s,pointDataRecordLength:p}=r,c=t.colorDepth??i(r),u=new Uint8Array(e),l=await a.Las.PointData.decompressChunk(u,{pointCount:o,pointDataRecordFormat:s,pointDataRecordLength:p},this._initDecoder()),f=a.Las.View.create(l,r,n);return{attributes:this._parseView(f,{colorDepth:c})}}async parseFile(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=new Uint8Array(e),n=await a.Las.PointData.decompressFile(r,this._initDecoder()),o=a.Las.Header.parse(r),s=t.colorDepth??i(o),p=async(e,t)=>r.slice(e,t),c=await a.Las.Vlr.walk(p,o),u=a.Las.Vlr.find(c,"LASF_Spec",4),l=u&&a.Las.ExtraBytes.parse(await a.Las.Vlr.fetch(p,u)),f=a.Las.View.create(n,o,l);return{header:o,attributes:this._parseView(f,{colorDepth:s})}}};function p(e){return Object.values(e).filter(ArrayBuffer.isView).map((e=>e.buffer))}(0,n.Jj)({lazPerf(e){s.lazPerf=e},async parseChunk(e,t){const r=await s.parseChunk(e,t);return(0,n.FE)(r,p(r.attributes))},async parseFile(e,t){const r=await s.parseFile(e,t);return(0,n.FE)(r,p(r.attributes))}})}},n={};function o(e){var t=n[e];if(void 0!==t)return t.exports;var a=n[e]={exports:{}};return r[e].call(a.exports,a,a.exports,o),a.exports}return o.m=r,o.x=()=>{var e=o.O(void 0,[558],(()=>o(62701)));return o.O(e)},e=[],o.O=(t,r,n,a)=>{if(!r){var i=1/0;for(u=0;u<e.length;u++){for(var[r,n,a]=e[u],s=!0,p=0;p<r.length;p++)(!1&a||i>=a)&&Object.keys(o.O).every((e=>o.O[e](r[p])))?r.splice(p--,1):(s=!1,a<i&&(i=a));if(s){e.splice(u--,1);var c=n();void 0!==c&&(t=c)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[r,n,a]},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,r)=>(o.f[r](e,t),t)),[])),o.u=e=>e+".js",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;o.g.importScripts&&(e=o.g.location+"");var t=o.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&!e;)e=r[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=e})(),(()=>{var e={841:1};o.f.i=(t,r)=>{e[t]||importScripts(o.p+o.u(t))};var t=self.webpackChunkitowns=self.webpackChunkitowns||[],r=t.push.bind(t);t.push=t=>{var[n,a,i]=t;for(var s in a)o.o(a,s)&&(o.m[s]=a[s]);for(i&&i(o);n.length;)e[n.pop()]=1;r(t)}})(),t=o.x,o.x=()=>o.e(558).then(t),o.x()})()));
//# sourceMappingURL=itowns_lasparser.js.map