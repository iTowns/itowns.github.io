import*as e from"three";var t={122:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(91955),o=r(79306),a=r(22812),l=r(79039),c=r(43724);n({global:!0,enumerable:!0,dontCallGetSet:!0,forced:l((function(){return c&&1!==Object.getOwnPropertyDescriptor(i,"queueMicrotask").value.length}))},{queueMicrotask:function(e){a(arguments.length,1),s(o(e))}})},162:(e,t,r)=>{var n=r(69565),i=r(79306),s=r(94901),o=r(28551),a=TypeError;e.exports=function(e,t){var r,l=o(this),c=i(l.get),h=i(l.has),u=i(l.set),d=arguments.length>2?arguments[2]:void 0;if(!s(t)&&!s(d))throw new a("At least one callback required");return n(h,l,e)?(r=n(c,l,e),s(t)&&(r=t(r),n(u,l,e,r))):s(d)&&(r=d(),n(u,l,e,r)),r}},221:(e,t,r)=>{var n=r(46518),i=r(79039),s=r(20034),o=r(22195),a=r(15652),l=Object.isSealed;n({target:"Object",stat:!0,forced:a||i((function(){l(1)}))},{isSealed:function(e){return!s(e)||!(!a||"ArrayBuffer"!==o(e))||!!l&&l(e)}})},373:(e,t,r)=>{var n=r(44576),i=r(27476),s=r(79039),o=r(79306),a=r(74488),l=r(94644),c=r(13709),h=r(13763),u=r(39519),d=r(3607),p=l.aTypedArray,f=l.exportTypedArrayMethod,g=n.Uint16Array,A=g&&i(g.prototype.sort),m=!(!A||s((function(){A(new g(2),null)}))&&s((function(){A(new g(2),{})}))),y=!!A&&!s((function(){if(u)return u<74;if(c)return c<67;if(h)return!0;if(d)return d<602;var e,t,r=new g(516),n=Array(516);for(e=0;e<516;e++)t=e%4,r[e]=515-e,n[e]=e-2*t+3;for(A(r,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(r[e]!==n[e])return!0}));f("sort",(function(e){return void 0!==e&&o(e),y?A(this,e):a(p(this),function(e){return function(t,r){return void 0!==e?+e(t,r)||0:r!=r?-1:t!=t?1:0===t&&0===r?1/t>0&&1/r<0?1:-1:t>r}}(e))}),!y||m)},616:(e,t,r)=>{var n=r(79504),i=r(39297),s=SyntaxError,o=parseInt,a=String.fromCharCode,l=n("".charAt),c=n("".slice),h=n(/./.exec),u={'\\"':'"',"\\\\":"\\","\\/":"/","\\b":"\b","\\f":"\f","\\n":"\n","\\r":"\r","\\t":"\t"},d=/^[\da-f]{4}$/i,p=/^[\u0000-\u001F]$/;e.exports=function(e,t){for(var r=!0,n="";t<e.length;){var f=l(e,t);if("\\"===f){var g=c(e,t,t+2);if(i(u,g))n+=u[g],t+=2;else{if("\\u"!==g)throw new s('Unknown escape sequence: "'+g+'"');var A=c(e,t+=2,t+4);if(!h(d,A))throw new s("Bad Unicode escape at: "+t);n+=a(o(A,16)),t+=4}}else{if('"'===f){r=!1,t++;break}if(h(p,f))throw new s("Bad control character in string literal at: "+t);n+=f,t++}}if(r)throw new s("Unterminated string at: "+t);return{value:n,end:t}}},655:(e,t,r)=>{var n=r(36955),i=String;e.exports=function(e){if("Symbol"===n(e))throw new TypeError("Cannot convert a Symbol value to a string");return i(e)}},876:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.Step=t.Scale=t.Key=t.Getter=t.Dimension=t.Bounds=t.Binary=void 0,i(r(16882),t);var s=r(33359);Object.defineProperty(t,"Binary",{enumerable:!0,get:function(){return s.Binary}});var o=r(19459);Object.defineProperty(t,"Bounds",{enumerable:!0,get:function(){return o.Bounds}});var a=r(44324);Object.defineProperty(t,"Dimension",{enumerable:!0,get:function(){return a.Dimension}});var l=r(27201);Object.defineProperty(t,"Getter",{enumerable:!0,get:function(){return l.Getter}});var c=r(54623);Object.defineProperty(t,"Key",{enumerable:!0,get:function(){return c.Key}});var h=r(66838);Object.defineProperty(t,"Scale",{enumerable:!0,get:function(){return h.Scale}});var u=r(95192);Object.defineProperty(t,"Step",{enumerable:!0,get:function(){return u.Step}})},944:e=>{var t=TypeError;e.exports=function(e){var r=e&&e.alphabet;if(void 0===r||"base64"===r||"base64url"===r)return r||"base64";throw new t("Incorrect `alphabet` option")}},1103:e=>{e.exports=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}}},1469:(e,t,r)=>{var n=r(87433);e.exports=function(e,t){return new(n(e))(0===t?0:t)}},1480:(e,t,r)=>{var n=r(46518),i=r(79039),s=r(10298).f;n({target:"Object",stat:!0,forced:i((function(){return!Object.getOwnPropertyNames(1)}))},{getOwnPropertyNames:s})},1548:(e,t,r)=>{var n=r(44576),i=r(79039),s=r(39519),o=r(84215),a=n.structuredClone;e.exports=!!a&&!i((function(){if("DENO"===o&&s>92||"NODE"===o&&s>94||"BROWSER"===o&&s>97)return!1;var e=new ArrayBuffer(8),t=a(e,{transfer:[e]});return 0!==e.byteLength||8!==t.byteLength}))},1625:(e,t,r)=>{var n=r(79504);e.exports=n({}.isPrototypeOf)},1688:(e,t,r)=>{var n=r(46518),i=r(70380);n({target:"Date",proto:!0,forced:Date.prototype.toISOString!==i},{toISOString:i})},1767:e=>{e.exports=function(e){return{iterator:e,next:e.next,done:!1}}},1886:(e,t,r)=>{var n=r(69565),i=r(24074),s=r(28551),o=r(70081),a=r(1767),l=r(55966),c=r(78227)("asyncIterator");e.exports=function(e,t){var r=arguments.length<2?l(e,c):t;return r?s(n(r,e)):new i(a(o(e)))}},1951:(e,t,r)=>{var n=r(78227);t.f=n},2008:(e,t,r)=>{var n=r(46518),i=r(59213).filter;n({target:"Array",proto:!0,forced:!r(70597)("filter")},{filter:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},2087:(e,t,r)=>{var n=r(20034),i=Math.floor;e.exports=Number.isInteger||function(e){return!n(e)&&isFinite(e)&&i(e)===e}},2222:(e,t,r)=>{var n=r(46518),i=r(97751),s=r(79039),o=r(22812),a=r(655),l=r(67416),c=i("URL"),h=l&&s((function(){c.canParse()})),u=s((function(){return 1!==c.canParse.length}));n({target:"URL",stat:!0,forced:!h||u},{canParse:function(e){var t=o(arguments.length,1),r=a(e),n=t<2||void 0===arguments[1]?void 0:a(arguments[1]);try{return!!new c(r,n)}catch(e){return!1}}})},2259:(e,t,r)=>{r(70511)("iterator")},2293:(e,t,r)=>{var n=r(28551),i=r(35548),s=r(64117),o=r(78227)("species");e.exports=function(e,t){var r,a=n(e).constructor;return void 0===a||s(r=n(a)[o])?t:i(r)}},2360:(e,t,r)=>{var n,i=r(28551),s=r(96801),o=r(88727),a=r(30421),l=r(20397),c=r(4055),h=r(66119),u="prototype",d="script",p=h("IE_PROTO"),f=function(){},g=function(e){return"<"+d+">"+e+"</"+d+">"},A=function(e){e.write(g("")),e.close();var t=e.parentWindow.Object;return e=null,t},m=function(){try{n=new ActiveXObject("htmlfile")}catch(e){}var e,t,r;m="undefined"!=typeof document?document.domain&&n?A(n):(t=c("iframe"),r="java"+d+":",t.style.display="none",l.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(g("document.F=Object")),e.close(),e.F):A(n);for(var i=o.length;i--;)delete m[u][o[i]];return m()};a[p]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(f[u]=i(e),r=new f,f[u]=null,r[p]=e):r=m(),void 0===t?r:s.f(r,t)}},2478:(e,t,r)=>{var n=r(79504),i=r(48981),s=Math.floor,o=n("".charAt),a=n("".replace),l=n("".slice),c=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,h=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,r,n,u,d){var p=r+e.length,f=n.length,g=h;return void 0!==u&&(u=i(u),g=c),a(d,g,(function(i,a){var c;switch(o(a,0)){case"$":return"$";case"&":return e;case"`":return l(t,0,r);case"'":return l(t,p);case"<":c=u[l(a,1,-1)];break;default:var h=+a;if(0===h)return i;if(h>f){var d=s(h/10);return 0===d?i:d<=f?void 0===n[d-1]?o(a,1):n[d-1]+o(a,1):i}c=n[h-1]}return void 0===c?"":c}))}},2848:(e,t,r)=>{r(46518)({target:"Math",stat:!0,nonConfigurable:!0,nonWritable:!0},{RAD_PER_DEG:180/Math.PI})},2892:(e,t,r)=>{var n=r(46518),i=r(96395),s=r(43724),o=r(44576),a=r(19167),l=r(79504),c=r(92796),h=r(39297),u=r(23167),d=r(1625),p=r(10757),f=r(72777),g=r(79039),A=r(38480).f,m=r(77347).f,y=r(24913).f,v=r(31240),w=r(43802).trim,b="Number",E=o[b],x=a[b],C=E.prototype,_=o.TypeError,I=l("".slice),S=l("".charCodeAt),M=c(b,!E(" 0o1")||!E("0b1")||E("+0x1")),T=function(e){var t,r=arguments.length<1?0:E(function(e){var t=f(e,"number");return"bigint"==typeof t?t:function(e){var t,r,n,i,s,o,a,l,c=f(e,"number");if(p(c))throw new _("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=w(c),43===(t=S(c,0))||45===t){if(88===(r=S(c,2))||120===r)return NaN}else if(48===t){switch(S(c,1)){case 66:case 98:n=2,i=49;break;case 79:case 111:n=8,i=55;break;default:return+c}for(o=(s=I(c,2)).length,a=0;a<o;a++)if((l=S(s,a))<48||l>i)return NaN;return parseInt(s,n)}return+c}(t)}(e));return d(C,t=this)&&g((function(){v(t)}))?u(Object(r),this,T):r};T.prototype=C,M&&!i&&(C.constructor=T),n({global:!0,constructor:!0,wrap:!0,forced:M},{Number:T});var B=function(e,t){for(var r,n=s?A(t):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),i=0;n.length>i;i++)h(t,r=n[i])&&!h(e,r)&&y(e,r,m(t,r))};i&&x&&B(a[b],x),(M||i)&&B(a[b],E)},2917:(e,t,r)=>{r(15239),r(9035),r(78662)},2945:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(97751),o=r(79504),a=r(69565),l=r(79039),c=r(655),h=r(22812),u=r(92804).c2i,d=/[^\d+/a-z]/i,p=/[\t\n\f\r ]+/g,f=/[=]{1,2}$/,g=s("atob"),A=String.fromCharCode,m=o("".charAt),y=o("".replace),v=o(d.exec),w=!!g&&!l((function(){return"hi"!==g("aGk=")})),b=w&&l((function(){return""!==g(" ")})),E=w&&!l((function(){g("a")})),x=w&&!l((function(){g()})),C=w&&1!==g.length;n({global:!0,bind:!0,enumerable:!0,forced:!w||b||E||x||C},{atob:function(e){if(h(arguments.length,1),w&&!b&&!E)return a(g,i,e);var t,r,n,o=y(c(e),p,""),l="",x=0,C=0;if(o.length%4==0&&(o=y(o,f,"")),(t=o.length)%4==1||v(d,o))throw new(s("DOMException"))("The string is not correctly encoded","InvalidCharacterError");for(;x<t;)r=m(o,x++),n=C%4?64*n+u[r]:u[r],C++%4&&(l+=A(255&n>>(-2*C&6)));return l}})},2952:(e,t,r)=>{var n=r(76080),i=r(79504),s=r(47055),o=r(48981),a=r(26198),l=r(72248),c=l.Map,h=l.get,u=l.has,d=l.set,p=i([].push);e.exports=function(e){for(var t,r,i=o(this),l=s(i),f=n(e,arguments.length>1?arguments[1]:void 0),g=new c,A=a(l),m=0;A>m;m++)t=f(r=l[m],m,i),u(g,t)?p(h(g,t),r):d(g,t,[r]);return g}},3064:(e,t,r)=>{var n=r(46518),i=r(36639).find;n({target:"AsyncIterator",proto:!0,real:!0},{find:function(e){return i(this,e)}})},3238:(e,t,r)=>{var n=r(44576),i=r(77811),s=r(67394),o=n.DataView;e.exports=function(e){if(!i||0!==s(e))return!1;try{return new o(e),!1}catch(e){return!0}}},3296:(e,t,r)=>{r(45806)},3362:(e,t,r)=>{r(10436),r(16499),r(82003),r(7743),r(51481),r(40280)},3451:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(30421),o=r(20034),a=r(39297),l=r(24913).f,c=r(38480),h=r(10298),u=r(34124),d=r(33392),p=r(92744),f=!1,g=d("meta"),A=0,m=function(e){l(e,g,{value:{objectID:"O"+A++,weakData:{}}})},y=e.exports={enable:function(){y.enable=function(){},f=!0;var e=c.f,t=i([].splice),r={};r[g]=1,e(r).length&&(c.f=function(r){for(var n=e(r),i=0,s=n.length;i<s;i++)if(n[i]===g){t(n,i,1);break}return n},n({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:h.f}))},fastKey:function(e,t){if(!o(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!a(e,g)){if(!u(e))return"F";if(!t)return"E";m(e)}return e[g].objectID},getWeakData:function(e,t){if(!a(e,g)){if(!u(e))return!0;if(!t)return!1;m(e)}return e[g].weakData},onFreeze:function(e){return p&&f&&u(e)&&!a(e,g)&&m(e),e}};s[g]=!0},3470:e=>{e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},3607:(e,t,r)=>{var n=r(82839).match(/AppleWebKit\/(\d+)\./);e.exports=!!n&&+n[1]},3690:(e,t,r)=>{r(15823)("Uint16",(function(e){return function(t,r,n){return e(this,t,r,n)}}))},3717:(e,t,r)=>{var n=r(79504),i=2147483647,s=/[^\0-\u007E]/,o=/[.\u3002\uFF0E\uFF61]/g,a="Overflow: input needs wider integers to process",l=RangeError,c=n(o.exec),h=Math.floor,u=String.fromCharCode,d=n("".charCodeAt),p=n([].join),f=n([].push),g=n("".replace),A=n("".split),m=n("".toLowerCase),y=function(e){return e+22+75*(e<26)},v=function(e,t,r){var n=0;for(e=r?h(e/700):e>>1,e+=h(e/t);e>455;)e=h(e/35),n+=36;return h(n+36*e/(e+38))},w=function(e){var t=[];e=function(e){for(var t=[],r=0,n=e.length;r<n;){var i=d(e,r++);if(i>=55296&&i<=56319&&r<n){var s=d(e,r++);56320==(64512&s)?f(t,((1023&i)<<10)+(1023&s)+65536):(f(t,i),r--)}else f(t,i)}return t}(e);var r,n,s=e.length,o=128,c=0,g=72;for(r=0;r<e.length;r++)(n=e[r])<128&&f(t,u(n));var A=t.length,m=A;for(A&&f(t,"-");m<s;){var w=i;for(r=0;r<e.length;r++)(n=e[r])>=o&&n<w&&(w=n);var b=m+1;if(w-o>h((i-c)/b))throw new l(a);for(c+=(w-o)*b,o=w,r=0;r<e.length;r++){if((n=e[r])<o&&++c>i)throw new l(a);if(n===o){for(var E=c,x=36;;){var C=x<=g?1:x>=g+26?26:x-g;if(E<C)break;var _=E-C,I=36-C;f(t,u(y(C+_%I))),E=h(_/I),x+=36}f(t,u(y(E))),g=v(c,b,m===A),c=0,m++}}c++,o++}return p(t,"")};e.exports=function(e){var t,r,n=[],i=A(g(m(e),o,"."),".");for(t=0;t<i.length;t++)r=i[t],f(n,c(s,r)?"xn--"+w(r):r);return p(n,".")}},3949:(e,t,r)=>{r(7588)},3995:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(24194),o=r(57696),a=r(67787),l=r(53602),c=Math.pow,h=1024,u=i(DataView.prototype.setUint16);n({target:"DataView",proto:!0},{setFloat16:function(e,t){s(this);var r=o(e),n=function(e){if(e!=e)return 32256;if(0===e)return(1/e==-1/0)<<15;var t=e<0;if(t&&(e=-e),e>=65520)return t<<15|31744;if(e<61005353927612305e-21)return t<<15|l(16777216*e);var r=0|a(e);if(-15===r)return t<<15|h;var n=l((e*c(2,-r)-1)*h);return n===h?t<<15|r+16<<10:t<<15|r+15<<10|n}(+t);return u(this,r,n,arguments.length>2&&arguments[2])}})},4055:(e,t,r)=>{var n=r(44576),i=r(20034),s=n.document,o=i(s)&&i(s.createElement);e.exports=function(e){return o?s.createElement(e):{}}},4235:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(72652),o=RangeError,a=TypeError,l=1/0,c=Math.abs,h=Math.pow,u=i([].push),d=h(2,1023),p=h(2,53)-1,f=Number.MAX_VALUE,g=h(2,971),A={},m={},y={},v={},w={},b=function(e,t){var r=e+t;return{hi:r,lo:t-(r-e)}};n({target:"Math",stat:!0},{sumPrecise:function(e){var t=[],r=0,n=v;switch(s(e,(function(e){if(++r>=p)throw new o("Maximum allowed index exceeded");if("number"!=typeof e)throw new a("Value is not a number");n!==A&&(e!=e?n=A:e===l?n=n===m?A:y:e===-1/0?n=n===y?A:m:0===e&&1/e!==l||n!==v&&n!==w||(n=w,u(t,e)))})),n){case A:return NaN;case m:return-1/0;case y:return l;case v:return-0}for(var i,h,E,x,C,_,I=[],S=0,M=0;M<t.length;M++){i=t[M];for(var T=0,B=0;B<I.length;B++){if(h=I[B],c(i)<c(h)&&(_=i,i=h,h=_),x=(E=b(i,h)).hi,C=E.lo,c(x)===l){var P=x===l?1:-1;S+=P,c(i=i-P*d-P*d)<c(h)&&(_=i,i=h,h=_),x=(E=b(i,h)).hi,C=E.lo}0!==C&&(I[T++]=C),i=x}I.length=T,0!==i&&u(I,i)}var R=I.length-1;if(x=0,C=0,0!==S){var D=R>=0?I[R]:0;if(R--,c(S)>1||S>0&&D>0||S<0&&D<0)return S>0?l:-1/0;if(x=(E=b(S*d,D/2)).hi,C=E.lo,C*=2,c(2*x)===l)return x>0?x===d&&C===-g/2&&R>=0&&I[R]<0?f:l:x===-d&&C===g/2&&R>=0&&I[R]>0?-f:-1/0;0!==C&&(I[++R]=C,C=0),x*=2}for(;R>=0&&(x=(E=b(x,I[R--])).hi,0===(C=E.lo)););return R>=0&&(C<0&&I[R]<0||C>0&&I[R]>0)&&(h=2*C)==(i=x+h)-x&&(x=i),x}})},4294:(e,t,r)=>{var n=r(46518),i=r(97751),s=r(18745),o=r(79039),a=r(14601),l="AggregateError",c=i(l),h=!o((function(){return 1!==c([1]).errors[0]}))&&o((function(){return 7!==c([1],l,{cause:7}).cause}));n({global:!0,constructor:!0,arity:2,forced:h},{AggregateError:a(l,(function(e){return function(t,r){return s(e,this,arguments)}}),h,!0)})},4360:(e,t,r)=>{var n=r(46518),i=r(33164);n({target:"Math",stat:!0},{f16round:function(e){return i(e,.0009765625,65504,6103515625e-14)}})},4495:(e,t,r)=>{var n=r(39519),i=r(79039),s=r(44576).String;e.exports=!!Object.getOwnPropertySymbols&&!i((function(){var e=Symbol("symbol detection");return!s(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},4731:(e,t,r)=>{var n=r(44576);r(10687)(n.JSON,"JSON",!0)},5240:(e,t,r)=>{r(16468)("WeakSet",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),r(91625))},5247:(e,t,r)=>{r.d(t,{M:()=>g});var n=r(43070),i=r(52219);const s=Math.PI,o=s/2,a=new n.Vector3,l=new n.Vector3,c=new n.Vector3,h=new n.Matrix4;let u=0;const d=[];function p(e=!1){return e?(d[u]||(d[u]=new n.Vector3),u++,d[u-1]):new n.Vector3}function f(){u=0}class g extends i.C1{constructor(e,t,r,n=-o,i=o,a=0,l=2*s,c=0,h=0){super(e,t,r),this.latStart=n,this.latEnd=i,this.lonStart=a,this.lonEnd=l,this.heightStart=c,this.heightEnd=h}_getPoints(e=!1){const{latStart:t,latEnd:r,lonStart:i,lonEnd:a,heightStart:l,heightEnd:c}=this,h=n.MathUtils.mapLinear(.5,0,1,t,r),u=n.MathUtils.mapLinear(.5,0,1,i,a),d=Math.floor(i/o)*o,f=[[-s/2,0],[s/2,0],[0,d],[0,d+s/2],[0,d+s],[0,d+3*s/2],[t,a],[r,a],[t,i],[r,i],[0,i],[0,a],[h,u],[t,u],[r,u],[h,i],[h,a]],g=[],A=f.length;for(let s=0;s<=1;s++){const o=n.MathUtils.mapLinear(s,0,1,l,c);for(let n=0,s=A;n<s;n++){const[s,l]=f[n];if(s>=t&&s<=r&&l>=i&&l<=a){const t=p(e);g.push(t),this.getCartographicToPosition(s,l,o,t)}}}return g}getBoundingBox(e,t){f();const{latStart:r,latEnd:i,lonStart:o,lonEnd:u}=this;if(i-r<s/2){const e=n.MathUtils.mapLinear(.5,0,1,r,i),s=n.MathUtils.mapLinear(.5,0,1,o,u);this.getCartographicToNormal(e,s,c),l.set(0,0,1),a.crossVectors(l,c),l.crossVectors(a,c),t.makeBasis(a,l,c)}else a.set(1,0,0),l.set(0,1,0),c.set(0,0,1),t.makeBasis(a,l,c);h.copy(t).invert();const d=this._getPoints(!0);for(let e=0,t=d.length;e<t;e++)d[e].applyMatrix4(h);e.makeEmpty(),e.setFromPoints(d)}getBoundingSphere(e,t){f();const r=this._getPoints(!0);e.makeEmpty(),e.setFromPoints(r,t)}}},5506:(e,t,r)=>{var n=r(46518),i=r(32357).entries;n({target:"Object",stat:!0},{entries:function(e){return i(e)}})},5745:(e,t,r)=>{var n=r(46518),i=r(77240);n({target:"String",proto:!0,forced:r(23061)("bold")},{bold:function(){return i(this,"b","","")}})},5746:(e,t,r)=>{var n=r(69565),i=r(89228),s=r(28551),o=r(64117),a=r(67750),l=r(3470),c=r(655),h=r(55966),u=r(56682);i("search",(function(e,t,r){return[function(t){var r=a(this),i=o(t)?void 0:h(t,e);return i?n(i,t,r):new RegExp(t)[e](c(r))},function(e){var n=s(this),i=c(e),o=r(t,n,i);if(o.done)return o.value;var a=n.lastIndex;l(a,0)||(n.lastIndex=0);var h=u(n,i);return l(n.lastIndex,a)||(n.lastIndex=a),null===h?-1:h.index}]}))},5914:(e,t,r)=>{r(46518)({target:"Math",stat:!0},{sign:r(77782)})},6469:(e,t,r)=>{var n=r(78227),i=r(2360),s=r(24913).f,o=n("unscopables"),a=Array.prototype;void 0===a[o]&&s(a,o,{configurable:!0,value:i(null)}),e.exports=function(e){a[o][e]=!0}},6580:()=>{},6585:e=>{var t=1e3,r=60*t,n=60*r,i=24*n,s=7*i;function o(e,t,r,n){var i=t>=1.5*r;return Math.round(e/r)+" "+n+(i?"s":"")}e.exports=function(e,a){a=a||{};var l,c,h=typeof e;if("string"===h&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(o){var a=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*a;case"weeks":case"week":case"w":return a*s;case"days":case"day":case"d":return a*i;case"hours":case"hour":case"hrs":case"hr":case"h":return a*n;case"minutes":case"minute":case"mins":case"min":case"m":return a*r;case"seconds":case"second":case"secs":case"sec":case"s":return a*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}(e);if("number"===h&&isFinite(e))return a.long?(l=e,(c=Math.abs(l))>=i?o(l,c,i,"day"):c>=n?o(l,c,n,"hour"):c>=r?o(l,c,r,"minute"):c>=t?o(l,c,t,"second"):l+" ms"):function(e){var s=Math.abs(e);return s>=i?Math.round(e/i)+"d":s>=n?Math.round(e/n)+"h":s>=r?Math.round(e/r)+"m":s>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},6660:(e,t,r)=>{r(46518)({target:"Math",stat:!0,forced:!0},{signbit:function(e){var t=+e;return t==t&&0===t?1/t==-1/0:t<0}})},6761:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(69565),o=r(79504),a=r(96395),l=r(43724),c=r(4495),h=r(79039),u=r(39297),d=r(1625),p=r(28551),f=r(25397),g=r(56969),A=r(655),m=r(6980),y=r(2360),v=r(71072),w=r(38480),b=r(10298),E=r(33717),x=r(77347),C=r(24913),_=r(96801),I=r(48773),S=r(36840),M=r(62106),T=r(25745),B=r(66119),P=r(30421),R=r(33392),D=r(78227),L=r(1951),k=r(70511),O=r(58242),F=r(10687),N=r(91181),U=r(59213).forEach,Q=B("hidden"),G="Symbol",z="prototype",j=N.set,V=N.getterFor(G),q=Object[z],H=i.Symbol,W=H&&H[z],$=i.RangeError,Y=i.TypeError,K=i.QObject,J=x.f,X=C.f,Z=b.f,ee=I.f,te=o([].push),re=T("symbols"),ne=T("op-symbols"),ie=T("wks"),se=!K||!K[z]||!K[z].findChild,oe=function(e,t,r){var n=J(q,t);n&&delete q[t],X(e,t,r),n&&e!==q&&X(q,t,n)},ae=l&&h((function(){return 7!==y(X({},"a",{get:function(){return X(this,"a",{value:7}).a}})).a}))?oe:X,le=function(e,t){var r=re[e]=y(W);return j(r,{type:G,tag:e,description:t}),l||(r.description=t),r},ce=function(e,t,r){e===q&&ce(ne,t,r),p(e);var n=g(t);return p(r),u(re,n)?(r.enumerable?(u(e,Q)&&e[Q][n]&&(e[Q][n]=!1),r=y(r,{enumerable:m(0,!1)})):(u(e,Q)||X(e,Q,m(1,y(null))),e[Q][n]=!0),ae(e,n,r)):X(e,n,r)},he=function(e,t){p(e);var r=f(t),n=v(r).concat(fe(r));return U(n,(function(t){l&&!s(ue,r,t)||ce(e,t,r[t])})),e},ue=function(e){var t=g(e),r=s(ee,this,t);return!(this===q&&u(re,t)&&!u(ne,t))&&(!(r||!u(this,t)||!u(re,t)||u(this,Q)&&this[Q][t])||r)},de=function(e,t){var r=f(e),n=g(t);if(r!==q||!u(re,n)||u(ne,n)){var i=J(r,n);return!i||!u(re,n)||u(r,Q)&&r[Q][n]||(i.enumerable=!0),i}},pe=function(e){var t=Z(f(e)),r=[];return U(t,(function(e){u(re,e)||u(P,e)||te(r,e)})),r},fe=function(e){var t=e===q,r=Z(t?ne:f(e)),n=[];return U(r,(function(e){!u(re,e)||t&&!u(q,e)||te(n,re[e])})),n};c||(S(W=(H=function(){if(d(W,this))throw new Y("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?A(arguments[0]):void 0,t=R(e),r=function(e){var n=void 0===this?i:this;n===q&&s(r,ne,e),u(n,Q)&&u(n[Q],t)&&(n[Q][t]=!1);var o=m(1,e);try{ae(n,t,o)}catch(e){if(!(e instanceof $))throw e;oe(n,t,o)}};return l&&se&&ae(q,t,{configurable:!0,set:r}),le(t,e)})[z],"toString",(function(){return V(this).tag})),S(H,"withoutSetter",(function(e){return le(R(e),e)})),I.f=ue,C.f=ce,_.f=he,x.f=de,w.f=b.f=pe,E.f=fe,L.f=function(e){return le(D(e),e)},l&&(M(W,"description",{configurable:!0,get:function(){return V(this).description}}),a||S(q,"propertyIsEnumerable",ue,{unsafe:!0}))),n({global:!0,constructor:!0,wrap:!0,forced:!c,sham:!c},{Symbol:H}),U(v(ie),(function(e){k(e)})),n({target:G,stat:!0,forced:!c},{useSetter:function(){se=!0},useSimple:function(){se=!1}}),n({target:"Object",stat:!0,forced:!c,sham:!l},{create:function(e,t){return void 0===t?y(e):he(y(e),t)},defineProperty:ce,defineProperties:he,getOwnPropertyDescriptor:de}),n({target:"Object",stat:!0,forced:!c},{getOwnPropertyNames:pe}),O(),F(H,G),P[Q]=!0},6980:e=>{e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},6986:(e,t,r)=>{var n=r(46518),i=r(77957),s=r(34598),o=r(6469);n({target:"Array",proto:!0,forced:!s("groupBy")},{groupBy:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o("groupBy")},7036:(e,t,r)=>{var n=r(46518),i=r(79306),s=r(36194),o=r(72248),a=o.get,l=o.has,c=o.set;n({target:"Map",proto:!0,real:!0,forced:!0},{getOrInsertComputed:function(e,t){if(s(this),i(t),l(this,e))return a(this,e);0===e&&1/e==-1/0&&(e=0);var r=t(e);return c(this,e,r),r}})},7040:(e,t,r)=>{var n=r(4495);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},7467:(e,t,r)=>{var n=r(46518),i=r(18745),s=r(59323),o=r(97751),a=r(2360),l=Object,c=function(){var e=o("Object","freeze");return e?e(a(null)):a(null)};n({global:!0,forced:!0},{compositeKey:function(){return i(s,l,arguments).get("object",c)}})},7588:(e,t,r)=>{var n=r(46518),i=r(72652),s=r(79306),o=r(28551),a=r(1767);n({target:"Iterator",proto:!0,real:!0},{forEach:function(e){o(this),s(e);var t=a(this),r=0;i(t,(function(t){e(t,r++)}),{IS_RECORD:!0})}})},7709:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.allSettled=void 0,t.allSettled=function(e){return Promise.all(e.map((e=>{const t=e=>({status:"fulfilled",value:e}),r=e=>({status:"rejected",reason:e}),n=Promise.resolve(e);try{return n.then(t,r)}catch(e){return Promise.reject(e)}})))}},7740:e=>{var t=Math.log;e.exports=Math.log1p||function(e){var r=+e;return r>-1e-8&&r<1e-8?r-r*r/2:t(1+r)}},7743:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(79306),o=r(36043),a=r(1103),l=r(72652);n({target:"Promise",stat:!0,forced:r(90537)},{race:function(e){var t=this,r=o.f(t),n=r.reject,c=a((function(){var o=s(t.resolve);l(e,(function(e){i(o,t,e).then(r.resolve,n)}))}));return c.error&&n(c.value),r.promise}})},7860:(e,t,r)=>{var n=r(82839);e.exports=/web0s(?!.*chrome)/i.test(n)},7904:(e,t,r)=>{var n=r(46518),i=r(43724),s=r(42551),o=r(48981),a=r(56969),l=r(42787),c=r(77347).f;i&&n({target:"Object",proto:!0,forced:s},{__lookupSetter__:function(e){var t,r=o(this),n=a(e);do{if(t=c(r,n))return t.set}while(r=l(r))}})},8045:(e,t,r)=>{var n=r(76080),i=r(79504),s=r(48981),o=r(33517),a=r(1886),l=r(70081),c=r(1767),h=r(50851),u=r(55966),d=r(97751),p=r(44124),f=r(78227),g=r(24074),A=r(36639).toArray,m=f("asyncIterator"),y=i(p("Array","values")),v=i(y([]).next),w=function(){return new b(this)},b=function(e){this.iterator=y(e)};b.prototype.next=function(){return v(this.iterator)},e.exports=function(e){var t=this,r=arguments.length,i=r>1?arguments[1]:void 0,p=r>2?arguments[2]:void 0;return new(d("Promise"))((function(r){var d=s(e);void 0!==i&&(i=n(i,p));var f=u(d,m),y=f?void 0:h(d)||w,v=o(t)?new t:[],b=f?a(d,f):new g(c(l(d,y)));r(A(b,i,v))}))}},8085:(e,t,r)=>{var n=r(46518),i=Math.floor,s=Math.log,o=Math.LOG2E;n({target:"Math",stat:!0},{clz32:function(e){var t=e>>>0;return t?31-i(s(t+.5)*o):32}})},8159:(e,t,r)=>{var n=r(46518),i=r(36639).some;n({target:"AsyncIterator",proto:!0,real:!0},{some:function(e){return i(this,e)}})},8288:(e,t,r)=>{var n=r(46518),i=r(18449),s=r(28551),o=i.toKey,a=i.set;n({target:"Reflect",stat:!0},{metadata:function(e,t){return function(r,n){a(e,t,s(r),o(n))}}})},8379:(e,t,r)=>{var n=r(18745),i=r(25397),s=r(91291),o=r(26198),a=r(34598),l=Math.min,c=[].lastIndexOf,h=!!c&&1/[1].lastIndexOf(1,-0)<0,u=a("lastIndexOf"),d=h||!u;e.exports=d?function(e){if(h)return n(c,this,arguments)||0;var t=i(this),r=o(t);if(0===r)return-1;var a=r-1;for(arguments.length>1&&(a=l(a,s(arguments[1]))),a<0&&(a=r+a);a>=0;a--)if(a in t&&t[a]===e)return a||0;return-1}:c},8872:(e,t,r)=>{r(18237)},8921:(e,t,r)=>{var n=r(46518),i=r(8379);n({target:"Array",proto:!0,forced:i!==[].lastIndexOf},{lastIndexOf:i})},8995:(e,t,r)=>{var n=r(94644),i=r(59213).map,s=n.aTypedArray,o=n.getTypedArrayConstructor;(0,n.exportTypedArrayMethod)("map",(function(e){return i(s(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(o(e))(t)}))}))},9035:(e,t,r)=>{var n=r(46518),i=r(97751),s=r(69565),o=r(28551),a=r(33517),l=r(70081),c=r(55966),h=r(72652),u=r(78227)("observable");n({target:"Observable",stat:!0,forced:!0},{from:function(e){var t=a(this)?this:i("Observable"),r=c(o(e),u);if(r){var n=o(s(r,e));return n.constructor===t?n:new t((function(e){return n.subscribe(e)}))}var d=l(e);return new t((function(e){h(d,(function(t,r){if(e.next(t),e.closed)return r()}),{IS_ITERATOR:!0,INTERRUPTED:!0}),e.complete()}))}})},9065:(e,t,r)=>{var n=r(46518),i=r(43724),s=r(28551),o=r(77347);n({target:"Reflect",stat:!0,sham:!i},{getOwnPropertyDescriptor:function(e,t){return o.f(s(e),t)}})},9156:(e,t,r)=>{var n=r(46518),i=r(91354);n({target:"Object",stat:!0,forced:!0},{iterateKeys:function(e){return new i(e,"keys")}})},9220:(e,t,r)=>{var n=r(46518),i=r(43724),s=r(42551),o=r(48981),a=r(56969),l=r(42787),c=r(77347).f;i&&n({target:"Object",proto:!0,forced:s},{__lookupGetter__:function(e){var t,r=o(this),n=a(e);do{if(t=c(r,n))return t.get}while(r=l(r))}})},9391:(e,t,r)=>{var n=r(46518),i=r(96395),s=r(80550),o=r(79039),a=r(97751),l=r(94901),c=r(2293),h=r(93438),u=r(36840),d=s&&s.prototype;if(n({target:"Promise",proto:!0,real:!0,forced:!!s&&o((function(){d.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=c(this,a("Promise")),r=l(e);return this.then(r?function(r){return h(t,e()).then((function(){return r}))}:e,r?function(r){return h(t,e()).then((function(){throw r}))}:e)}}),!i&&l(s)){var p=a("Promise").prototype.finally;d.finally!==p&&u(d,"finally",p,{unsafe:!0})}},9539:(e,t,r)=>{var n=r(69565),i=r(28551),s=r(55966);e.exports=function(e,t,r){var o,a;i(e);try{if(!(o=s(e,"return"))){if("throw"===t)throw r;return r}o=n(o,e)}catch(e){a=!0,o=e}if("throw"===t)throw r;if(a)throw o;return i(o),r}},9678:(e,t,r)=>{var n=r(46518),i=r(37628),s=r(25397),o=r(6469),a=Array;n({target:"Array",proto:!0},{toReversed:function(){return i(s(this),a)}}),o("toReversed")},9730:(e,t,r)=>{r(3995)},9868:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(91291),o=r(31240),a=r(72333),l=r(79039),c=RangeError,h=String,u=Math.floor,d=i(a),p=i("".slice),f=i(1..toFixed),g=function(e,t,r){return 0===t?r:t%2==1?g(e,t-1,r*e):g(e*e,t/2,r)},A=function(e,t,r){for(var n=-1,i=r;++n<6;)i+=t*e[n],e[n]=i%1e7,i=u(i/1e7)},m=function(e,t){for(var r=6,n=0;--r>=0;)n+=e[r],e[r]=u(n/t),n=n%t*1e7},y=function(e){for(var t=6,r="";--t>=0;)if(""!==r||0===t||0!==e[t]){var n=h(e[t]);r=""===r?n:r+d("0",7-n.length)+n}return r};n({target:"Number",proto:!0,forced:l((function(){return"0.000"!==f(8e-5,3)||"1"!==f(.9,0)||"1.25"!==f(1.255,2)||"1000000000000000128"!==f(0xde0b6b3a7640080,0)}))||!l((function(){f({})}))},{toFixed:function(e){var t,r,n,i,a=o(this),l=s(e),u=[0,0,0,0,0,0],f="",v="0";if(l<0||l>20)throw new c("Incorrect fraction digits");if(a!=a)return"NaN";if(a<=-1e21||a>=1e21)return h(a);if(a<0&&(f="-",a=-a),a>1e-21)if(r=(t=function(e){for(var t=0,r=e;r>=4096;)t+=12,r/=4096;for(;r>=2;)t+=1,r/=2;return t}(a*g(2,69,1))-69)<0?a*g(2,-t,1):a/g(2,t,1),r*=4503599627370496,(t=52-t)>0){for(A(u,0,r),n=l;n>=7;)A(u,1e7,0),n-=7;for(A(u,g(10,n,1),0),n=t-1;n>=23;)m(u,1<<23),n-=23;m(u,1<<n),A(u,1,1),m(u,2),v=y(u)}else A(u,0,r),A(u,1<<-t,0),v=y(u)+d("0",l);return l>0?f+((i=v.length)<=l?"0."+d("0",l-i)+v:p(v,0,i-l)+"."+p(v,i-l)):f+v}})},9920:(e,t,r)=>{var n=r(46518),i=r(36639).forEach;n({target:"AsyncIterator",proto:!0,real:!0},{forEach:function(e){return i(this,e)}})},10149:(e,t,r)=>{r(44732)},10255:(e,t,r)=>{var n=r(46518),i=r(79504),s=Math.pow,o=s(2,-24),a=.0009765625,l=i(DataView.prototype.getUint16);n({target:"DataView",proto:!0},{getFloat16:function(e){var t,r,n,i;return r=(t=l(this,e,arguments.length>1&&arguments[1]))>>>15,i=1023&t,31==(n=t>>>10&31)?0===i?0===r?1/0:-1/0:NaN:0===n?i*(0===r?o:-o):s(2,n-15)*(0===r?1+i*a:-1-i*a)}})},10287:(e,t,r)=>{r(46518)({target:"Object",stat:!0},{setPrototypeOf:r(52967)})},10298:(e,t,r)=>{var n=r(22195),i=r(25397),s=r(38480).f,o=r(67680),a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"Window"===n(e)?function(e){try{return s(e)}catch(e){return o(a)}}(e):s(i(e))}},10350:(e,t,r)=>{var n=r(43724),i=r(39297),s=Function.prototype,o=n&&Object.getOwnPropertyDescriptor,a=i(s,"name"),l=a&&"something"===function(){}.name,c=a&&(!n||n&&o(s,"name").configurable);e.exports={EXISTS:a,PROPER:l,CONFIGURABLE:c}},10436:(e,t,r)=>{var n,i,s,o=r(46518),a=r(96395),l=r(38574),c=r(44576),h=r(69565),u=r(36840),d=r(52967),p=r(10687),f=r(87633),g=r(79306),A=r(94901),m=r(20034),y=r(90679),v=r(2293),w=r(59225).set,b=r(91955),E=r(90757),x=r(1103),C=r(18265),_=r(91181),I=r(80550),S=r(10916),M=r(36043),T="Promise",B=S.CONSTRUCTOR,P=S.REJECTION_EVENT,R=S.SUBCLASSING,D=_.getterFor(T),L=_.set,k=I&&I.prototype,O=I,F=k,N=c.TypeError,U=c.document,Q=c.process,G=M.f,z=G,j=!!(U&&U.createEvent&&c.dispatchEvent),V="unhandledrejection",q=function(e){var t;return!(!m(e)||!A(t=e.then))&&t},H=function(e,t){var r,n,i,s=t.value,o=1===t.state,a=o?e.ok:e.fail,l=e.resolve,c=e.reject,u=e.domain;try{a?(o||(2===t.rejection&&J(t),t.rejection=1),!0===a?r=s:(u&&u.enter(),r=a(s),u&&(u.exit(),i=!0)),r===e.promise?c(new N("Promise-chain cycle")):(n=q(r))?h(n,r,l,c):l(r)):c(s)}catch(e){u&&!i&&u.exit(),c(e)}},W=function(e,t){e.notified||(e.notified=!0,b((function(){for(var r,n=e.reactions;r=n.get();)H(r,e);e.notified=!1,t&&!e.rejection&&Y(e)})))},$=function(e,t,r){var n,i;j?((n=U.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),c.dispatchEvent(n)):n={promise:t,reason:r},!P&&(i=c["on"+e])?i(n):e===V&&E("Unhandled promise rejection",r)},Y=function(e){h(w,c,(function(){var t,r=e.facade,n=e.value;if(K(e)&&(t=x((function(){l?Q.emit("unhandledRejection",n,r):$(V,r,n)})),e.rejection=l||K(e)?2:1,t.error))throw t.value}))},K=function(e){return 1!==e.rejection&&!e.parent},J=function(e){h(w,c,(function(){var t=e.facade;l?Q.emit("rejectionHandled",t):$("rejectionhandled",t,e.value)}))},X=function(e,t,r){return function(n){e(t,n,r)}},Z=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,W(e,!0))},ee=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw new N("Promise can't be resolved itself");var n=q(t);n?b((function(){var r={done:!1};try{h(n,t,X(ee,r,e),X(Z,r,e))}catch(t){Z(r,t,e)}})):(e.value=t,e.state=1,W(e,!1))}catch(t){Z({done:!1},t,e)}}};if(B&&(F=(O=function(e){y(this,F),g(e),h(n,this);var t=D(this);try{e(X(ee,t),X(Z,t))}catch(e){Z(t,e)}}).prototype,(n=function(e){L(this,{type:T,done:!1,notified:!1,parent:!1,reactions:new C,rejection:!1,state:0,value:null})}).prototype=u(F,"then",(function(e,t){var r=D(this),n=G(v(this,O));return r.parent=!0,n.ok=!A(e)||e,n.fail=A(t)&&t,n.domain=l?Q.domain:void 0,0===r.state?r.reactions.add(n):b((function(){H(n,r)})),n.promise})),i=function(){var e=new n,t=D(e);this.promise=e,this.resolve=X(ee,t),this.reject=X(Z,t)},M.f=G=function(e){return e===O||void 0===e?new i(e):z(e)},!a&&A(I)&&k!==Object.prototype)){s=k.then,R||u(k,"then",(function(e,t){var r=this;return new O((function(e,t){h(s,r,e,t)})).then(e,t)}),{unsafe:!0});try{delete k.constructor}catch(e){}d&&d(k,F)}o({global:!0,constructor:!0,wrap:!0,forced:B},{Promise:O}),p(O,T,!1,!0),f(T)},10539:()=>{},10586:(e,t,r)=>{var n=r(46518),i=r(59323),s=r(97751),o=r(18745);n({global:!0,forced:!0},{compositeSymbol:function(){return 1===arguments.length&&"string"==typeof arguments[0]?s("Symbol").for(arguments[0]):o(i,null,arguments).get("symbol",s("Symbol"))}})},10687:(e,t,r)=>{var n=r(24913).f,i=r(39297),s=r(78227)("toStringTag");e.exports=function(e,t,r){e&&!r&&(e=e.prototype),e&&!i(e,s)&&n(e,s,{configurable:!0,value:t})}},10757:(e,t,r)=>{var n=r(97751),i=r(94901),s=r(1625),o=r(7040),a=Object;e.exports=o?function(e){return"symbol"==typeof e}:function(e){var t=n("Symbol");return i(t)&&s(t.prototype,a(e))}},10838:(e,t,r)=>{var n=r(46518),i=r(43839).findLast,s=r(6469);n({target:"Array",proto:!0},{findLast:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),s("findLast")},10916:(e,t,r)=>{var n=r(44576),i=r(80550),s=r(94901),o=r(92796),a=r(33706),l=r(78227),c=r(84215),h=r(96395),u=r(39519),d=i&&i.prototype,p=l("species"),f=!1,g=s(n.PromiseRejectionEvent),A=o("Promise",(function(){var e=a(i),t=e!==String(i);if(!t&&66===u)return!0;if(h&&(!d.catch||!d.finally))return!0;if(!u||u<51||!/native code/.test(e)){var r=new i((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};if((r.constructor={})[p]=n,!(f=r.then((function(){}))instanceof n))return!0}return!(t||"BROWSER"!==c&&"DENO"!==c||g)}));e.exports={CONSTRUCTOR:A,REJECTION_EVENT:g,SUBCLASSING:f}},11025:(e,t,r)=>{r(52675),r(89463),r(66412),r(60193),r(92168),r(2259),r(86964),r(83142),r(83237),r(61833),r(67947),r(31073),r(45700),r(78125),r(20326),r(16280),r(76918),r(30067),r(4294),r(18107),r(28706),r(26835),r(88431),r(33771),r(2008),r(50113),r(48980),r(10838),r(13451),r(46449),r(78350),r(51629),r(23418),r(74423),r(25276),r(64346),r(23792),r(48598),r(8921),r(62062),r(31051),r(44114),r(72712),r(18863),r(94490),r(34782),r(15086),r(26910),r(87478),r(54554),r(9678),r(57145),r(71658),r(93514),r(30237),r(13609),r(11558),r(54743),r(46761),r(11745),r(38309),r(10255),r(3995),r(16573),r(78100),r(77936),r(61699),r(59089),r(91191),r(93515),r(1688),r(60739),r(89572),r(23288),r(36456),r(94170),r(48957),r(62010),r(55081),r(18111),r(29314),r(81148),r(22489),r(20116),r(30531),r(7588),r(49603),r(61701),r(18237),r(13579),r(54972),r(61806),r(33110),r(4731),r(36033),r(47072),r(93153),r(82326),r(36389),r(64444),r(8085),r(77762),r(65070),r(60605),r(4360),r(39469),r(72152),r(75376),r(56624),r(11367),r(5914),r(78553),r(98690),r(60479),r(70761),r(2892),r(45374),r(25428),r(32637),r(40150),r(59149),r(64601),r(44435),r(87220),r(25843),r(62337),r(9868),r(80630),r(69085),r(59904),r(17427),r(67945),r(84185),r(87607),r(5506),r(52811),r(53921),r(83851),r(81278),r(1480),r(40875),r(77691),r(78347),r(29908),r(94052),r(94003),r(221),r(79432),r(9220),r(7904),r(93967),r(63548),r(93941),r(10287),r(26099),r(16034),r(78459),r(58940),r(3362),r(96167),r(93518),r(9391),r(31689),r(14628),r(39796),r(60825),r(87411),r(21211),r(40888),r(9065),r(86565),r(32812),r(84634),r(71137),r(30985),r(34268),r(34873),r(15472),r(84864),r(96069),r(57465),r(27495),r(69479),r(87745),r(90906),r(38781),r(31415),r(17642),r(58004),r(33853),r(45876),r(32475),r(15024),r(31698),r(67357),r(23860),r(99449),r(27337),r(21699),r(42043),r(47764),r(71761),r(28543),r(35701),r(68156),r(85906),r(42781),r(25440),r(79978),r(5746),r(90744),r(11392),r(50375),r(67438),r(42762),r(39202),r(43359),r(89907),r(11898),r(35490),r(5745),r(94298),r(60268),r(69546),r(20781),r(50778),r(89195),r(46276),r(48718),r(16308),r(34594),r(29833),r(46594),r(72107),r(95477),r(21489),r(22134),r(3690),r(61740),r(48140),r(81630),r(72170),r(75044),r(69539),r(31694),r(89955),r(21903),r(91134),r(33206),r(48345),r(44496),r(66651),r(12887),r(19369),r(66812),r(8995),r(52568),r(31575),r(36072),r(88747),r(28845),r(29423),r(57301),r(373),r(86614),r(41405),r(37467),r(44732),r(33684),r(79577),r(88267),r(73772),r(30958),r(49806),r(39687),r(26148),r(34504),r(87370),r(31659),r(95115),r(17978),r(46058),r(6986),r(88177),r(80081),r(45490),r(17656),r(55105),r(54151),r(72400),r(73677),r(61938),r(85901),r(26280),r(27913),r(47801),r(82750),r(33811),r(84847),r(74147),r(29150),r(74648),r(17333),r(3064),r(32679),r(9920),r(46967),r(45182),r(41393),r(14905),r(8159),r(39320),r(86994),r(24964),r(7467),r(10586),r(47390),r(81332),r(9730),r(56192),r(66557),r(26615),r(83354),r(98225),r(37998),r(16401),r(18640),r(62480),r(98992),r(51098),r(81218),r(16037),r(64743),r(23215),r(54520),r(72577),r(30670),r(3949),r(45882),r(76913),r(81454),r(75289),r(8872),r(37550),r(27413),r(41795),r(81730),r(67296),r(58335),r(33981),r(71517),r(11379),r(93777),r(14190),r(12359),r(86097),r(39172),r(27254),r(7036),r(57019),r(17273),r(81723),r(27415),r(19929),r(37583),r(55122),r(16385),r(20230),r(57268),r(79733),r(19717),r(52231),r(58179),r(30456),r(74017),r(79310),r(16453),r(83062),r(96369),r(15637),r(2848),r(24842),r(24746),r(33454),r(6660),r(4235),r(15941),r(82101),r(79926),r(84208),r(91550),r(9156),r(48918),r(66090),r(2917),r(35874),r(47575),r(47628),r(43799),r(65186),r(42978),r(72527),r(79852),r(42376),r(40617),r(73067),r(66820),r(8288),r(37108),r(25509),r(65223),r(43375),r(60321),r(41927),r(11632),r(64377),r(49522),r(39225),r(66771),r(13972),r(12516),r(99209),r(68931),r(25714),r(52514),r(35694),r(52774),r(23283),r(49536),r(21926),r(17561),r(16864),r(66197),r(16215),r(78898),r(84114),r(74176),r(66337),r(44590),r(38344),r(12041),r(51755),r(81202),r(49604),r(43275),r(13070),r(87153),r(53032),r(53803),r(13976),r(30465),r(18999),r(42793),r(77208),r(73440),r(13195),r(51839),r(14037),r(47350),r(91706),r(96847),r(23241),r(43250),r(10149),r(67302),r(55871),r(24082),r(57051),r(27650),r(41549),r(49797),r(49631),r(35623),r(67348),r(26957),r(79732),r(35644),r(80805),r(73525),r(49634),r(83742),r(56422),r(82451),r(46270),r(2945),r(42207),r(23500),r(62953),r(55815),r(64979),r(79739),r(59848),r(122),r(13611),r(71678),r(76031),r(3296),r(2222),r(45781),r(27208),r(48408),r(14603),r(47566),r(98721),r(19167)},11029:(e,t)=>{let r;function n(e){return(""+e).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\/\/.+)?\/[^/]+(?:\?.*)?$/,"$1")+"/"}Object.defineProperty(t,"__esModule",{value:!0}),t.getBundleURL=t.getBaseURL=void 0,t.getBundleURL=function(){return r||(r=function(){try{throw new Error}catch(e){const t=(""+e.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\/\/[^)\n]+/g);if(t)return n(t[0])}return"/"}()),r},t.getBaseURL=n},11056:(e,t,r)=>{var n=r(24913).f;e.exports=function(e,t,r){r in e||n(e,r,{configurable:!0,get:function(){return t[r]},set:function(e){t[r]=e}})}},11367:(e,t,r)=>{r(46518)({target:"Math",stat:!0},{log2:r(67787)})},11379:(e,t,r)=>{var n=r(46518),i=r(36194),s=r(72248),o=s.get,a=s.has,l=s.set;n({target:"Map",proto:!0,real:!0,forced:!0},{emplace:function(e,t){var r,n,s=i(this);return a(s,e)?(r=o(s,e),"update"in t&&(r=t.update(r,e,s),l(s,e,r)),r):(n=t.insert(e,s),l(s,e,n),n)}})},11392:(e,t,r)=>{var n,i=r(46518),s=r(27476),o=r(77347).f,a=r(18014),l=r(655),c=r(60511),h=r(67750),u=r(41436),d=r(96395),p=s("".slice),f=Math.min,g=u("startsWith");i({target:"String",proto:!0,forced:!(!d&&!g&&(n=o(String.prototype,"startsWith"),n&&!n.writable)||g)},{startsWith:function(e){var t=l(h(this));c(e);var r=a(f(arguments.length>1?arguments[1]:void 0,t.length)),n=l(e);return p(t,r,r+n.length)===n}})},11558:(e,t,r)=>{var n=r(46518),i=r(39928),s=r(25397),o=Array;n({target:"Array",proto:!0},{with:function(e,t){return i(s(this),o,e,t)}})},11632:(e,t,r)=>{var n=r(46518),i=r(76080),s=r(97080),o=r(94402),a=r(38469),l=o.Set,c=o.add;n({target:"Set",proto:!0,real:!0,forced:!0},{filter:function(e){var t=s(this),r=i(e,arguments.length>1?arguments[1]:void 0),n=new l;return a(t,(function(e){r(e,e,t)&&c(n,e)})),n}})},11677:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Extractor=void 0;const n=r(876);function i(e){const{scale:t,offset:r}=e,i=a(e);function s(e,t){return e.getUint8(i(t)+14)}function o(e,t){return e.getUint8(i(t)+15)}function l(e,t){return 31&o(e,t)}return{X:(e,s)=>n.Scale.unapply(e.getInt32(i(s),!0),t[0],r[0]),Y:(e,s)=>n.Scale.unapply(e.getInt32(i(s)+4,!0),t[1],r[1]),Z:(e,s)=>n.Scale.unapply(e.getInt32(i(s)+8,!0),t[2],r[2]),Intensity:(e,t)=>e.getUint16(i(t)+12,!0),ReturnNumber:(e,t)=>7&s(e,t),NumberOfReturns:(e,t)=>(56&s(e,t))>>3,ScanDirectionFlag:(e,t)=>(64&s(e,t))>>6,EdgeOfFlightLine:(e,t)=>(128&s(e,t))>>7,Classification:(e,t)=>{const r=l(e,t);return 12===r?0:r},Synthetic:(e,t)=>(32&o(e,t))>>5,KeyPoint:(e,t)=>(64&o(e,t))>>6,Withheld:(e,t)=>(128&o(e,t))>>7,Overlap:(e,t)=>12===l(e,t)?1:0,ScanAngle:(e,t)=>e.getInt8(i(t)+16),UserData:(e,t)=>e.getUint8(i(t)+17),PointSourceId:(e,t)=>e.getUint16(i(t)+18,!0)}}function s(e){const{scale:t,offset:r}=e,i=a(e);function s(e,t){return e.getUint8(i(t)+15)}return{X:(e,s)=>n.Scale.unapply(e.getInt32(i(s),!0),t[0],r[0]),Y:(e,s)=>n.Scale.unapply(e.getInt32(i(s)+4,!0),t[1],r[1]),Z:(e,s)=>n.Scale.unapply(e.getInt32(i(s)+8,!0),t[2],r[2]),Intensity:(e,t)=>e.getUint16(i(t)+12,!0),ReturnNumber:(e,t)=>15&e.getUint16(i(t)+14,!0),NumberOfReturns:(e,t)=>(240&e.getUint16(i(t)+14,!0))>>4,Synthetic:(e,t)=>1&s(e,t),KeyPoint:(e,t)=>(2&s(e,t))>>1,Withheld:(e,t)=>(4&s(e,t))>>2,Overlap:(e,t)=>(8&s(e,t))>>3,ScannerChannel:(e,t)=>(48&s(e,t))>>4,ScanDirectionFlag:(e,t)=>(64&s(e,t))>>6,EdgeOfFlightLine:(e,t)=>(128&s(e,t))>>7,Classification:(e,t)=>e.getUint8(i(t)+16),UserData:(e,t)=>e.getUint8(i(t)+17),ScanAngle:(e,t)=>.006*e.getInt16(i(t)+18,!0),PointSourceId:(e,t)=>e.getUint16(i(t)+20,!0),GpsTime:(e,t)=>e.getFloat64(i(t)+22,!0)}}function o(e){const t=a(e);return{...s(e),Red:(e,r)=>e.getUint16(t(r)+30,!0),Green:(e,r)=>e.getUint16(t(r)+32,!0),Blue:(e,r)=>e.getUint16(t(r)+34,!0)}}function a(e){const{pointDataRecordLength:t}=e;return function(e){return e*t}}t.Extractor={create:function(e,t=[]){const r=function(e,t){let r=function(e){switch(e){case 0:return 20;case 1:return 28;case 2:return 26;case 3:return 34;case 6:return 30;case 7:return 36;case 8:return 38;default:throw new Error(`Unsupported point data record format: ${e}`)}}(e.pointDataRecordFormat);return t.reduce(((t,i)=>{const s=r;r+=i.length;const o=function(e,t,{type:r,length:i}){const s=a(e);switch(r){case"signed":switch(i){case 1:return(e,r)=>e.getInt8(s(r)+t);case 2:return(e,r)=>e.getInt16(s(r)+t,!0);case 4:return(e,r)=>e.getInt32(s(r)+t,!0);case 8:return(e,r)=>(0,n.parseBigInt)(e.getBigInt64(s(r)+t,!0))}case"unsigned":switch(i){case 1:return(e,r)=>e.getUint8(s(r)+t);case 2:return(e,r)=>e.getUint16(s(r)+t,!0);case 4:return(e,r)=>e.getUint32(s(r)+t,!0);case 8:return(e,r)=>(0,n.parseBigInt)((0,n.getBigUint64)(e,s(r)+t,!0))}case"float":switch(i){case 4:return(e,r)=>e.getFloat32(s(r)+t,!0);case 8:return(e,r)=>e.getFloat64(s(r)+t,!0)}}}(e,s,i);if(!o)return t;return{...t,[i.name]:(e,t)=>n.Scale.unapply(o(e,t),i.scale,i.offset)}}),{})}(e,t);return{...(()=>{const{pointDataRecordFormat:t}=e;switch(t){case 0:return i(e);case 1:return function(e){const t=a(e);return{...i(e),GpsTime:(e,r)=>e.getFloat64(t(r)+20,!0)}}(e);case 2:return function(e){const t=a(e);return{...i(e),Red:(e,r)=>e.getUint16(t(r)+20,!0),Green:(e,r)=>e.getUint16(t(r)+22,!0),Blue:(e,r)=>e.getUint16(t(r)+24,!0)}}(e);case 3:return function(e){const t=a(e);return{...i(e),GpsTime:(e,r)=>e.getFloat64(t(r)+20,!0),Red:(e,r)=>e.getUint16(t(r)+28,!0),Green:(e,r)=>e.getUint16(t(r)+30,!0),Blue:(e,r)=>e.getUint16(t(r)+32,!0)}}(e);case 6:return s(e);case 7:return o(e);case 8:return function(e){const t=a(e);return{...o(e),Infrared:(e,r)=>e.getUint16(t(r)+36,!0)}}(e);default:throw new Error(`Unsupported point data record format: ${t}`)}})(),...r}}}},11745:(e,t,r)=>{var n=r(46518),i=r(27476),s=r(79039),o=r(66346),a=r(28551),l=r(35610),c=r(18014),h=o.ArrayBuffer,u=o.DataView,d=u.prototype,p=i(h.prototype.slice),f=i(d.getUint8),g=i(d.setUint8);n({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:s((function(){return!new h(2).slice(1,void 0).byteLength}))},{slice:function(e,t){if(p&&void 0===t)return p(a(this),e);for(var r=a(this).byteLength,n=l(e,r),i=l(void 0===t?r:t,r),s=new h(c(i-n)),o=new u(this),d=new u(s),A=0;n<i;)g(d,A++,f(o,n++));return s}})},11854:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}l((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.expose=t.isWorkerRuntime=t.Transfer=t.registerSerializer=void 0;const s=i(r(95409)),o=r(99278),a=r(66712),l=r(12781),c=i(r(64304));var h=r(99278);Object.defineProperty(t,"registerSerializer",{enumerable:!0,get:function(){return h.registerSerializer}});var u=r(66712);Object.defineProperty(t,"Transfer",{enumerable:!0,get:function(){return u.Transfer}}),t.isWorkerRuntime=c.default.isWorkerRuntime;let d=!1;const p=new Map,f=e=>e&&e.type===l.MasterMessageType.run,g=e=>s.default(e)||function(e){return e&&"object"==typeof e&&"function"==typeof e.subscribe}(e);function A(e){return a.isTransferDescriptor(e)?{payload:e.send,transferables:e.transferables}:{payload:e,transferables:void 0}}function m(e,t){const{payload:r,transferables:n}=A(t),i={type:l.WorkerMessageType.error,uid:e,error:o.serialize(r)};c.default.postMessageToMaster(i,n)}function y(e,t,r){const{payload:n,transferables:i}=A(r),s={type:l.WorkerMessageType.result,uid:e,complete:!!t||void 0,payload:n};c.default.postMessageToMaster(s,i)}function v(e){try{const t={type:l.WorkerMessageType.uncaughtError,error:o.serialize(e)};c.default.postMessageToMaster(t)}catch(t){console.error("Not reporting uncaught error back to master thread as it occured while reporting an uncaught error already.\nLatest error:",t,"\nOriginal error:",e)}}function w(e,t,r){return n(this,void 0,void 0,(function*(){let n;try{n=t(...r)}catch(t){return m(e,t)}const i=g(n)?"observable":"promise";if(function(e,t){const r={type:l.WorkerMessageType.running,uid:e,resultType:t};c.default.postMessageToMaster(r)}(e,i),g(n)){const t=n.subscribe((t=>y(e,!1,o.serialize(t))),(t=>{m(e,o.serialize(t)),p.delete(e)}),(()=>{y(e,!0),p.delete(e)}));p.set(e,t)}else try{const t=yield n;y(e,!0,o.serialize(t))}catch(t){m(e,o.serialize(t))}}))}t.expose=function(e){if(!c.default.isWorkerRuntime())throw Error("expose() called in the master thread.");if(d)throw Error("expose() called more than once. This is not possible. Pass an object to expose() if you want to expose multiple functions.");if(d=!0,"function"==typeof e)c.default.subscribeToMasterMessages((t=>{f(t)&&!t.method&&w(t.uid,e,t.args.map(o.deserialize))})),function(){const e={type:l.WorkerMessageType.init,exposed:{type:"function"}};c.default.postMessageToMaster(e)}();else{if("object"!=typeof e||!e)throw Error(`Invalid argument passed to expose(). Expected a function or an object, got: ${e}`);c.default.subscribeToMasterMessages((t=>{f(t)&&t.method&&w(t.uid,e[t.method],t.args.map(o.deserialize))})),function(e){const t={type:l.WorkerMessageType.init,exposed:{type:"module",methods:e}};c.default.postMessageToMaster(t)}(Object.keys(e).filter((t=>"function"==typeof e[t])))}c.default.subscribeToMasterMessages((e=>{if((t=e)&&t.type===l.MasterMessageType.cancel){const t=e.uid,r=p.get(t);r&&(r.unsubscribe(),p.delete(t))}var t}))},"undefined"!=typeof self&&"function"==typeof self.addEventListener&&c.default.isWorkerRuntime()&&(self.addEventListener("error",(e=>{setTimeout((()=>v(e.error||e)),250)})),self.addEventListener("unhandledrejection",(e=>{const t=e.reason;t&&"string"==typeof t.message&&setTimeout((()=>v(t)),250)}))),"undefined"!=typeof process&&"function"==typeof process.on&&c.default.isWorkerRuntime()&&(process.on("uncaughtException",(e=>{setTimeout((()=>v(e)),250)})),process.on("unhandledRejection",(e=>{e&&"string"==typeof e.message&&setTimeout((()=>v(e)),250)})))},11898:(e,t,r)=>{var n=r(46518),i=r(77240);n({target:"String",proto:!0,forced:r(23061)("big")},{big:function(){return i(this,"big","","")}})},12041:(e,t,r)=>{r(79978)},12211:(e,t,r)=>{var n=r(79039);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},12359:(e,t,r)=>{var n=r(46518),i=r(76080),s=r(36194),o=r(26223);n({target:"Map",proto:!0,real:!0,forced:!0},{find:function(e){var t=s(this),r=i(e,arguments.length>1?arguments[1]:void 0),n=o(t,(function(e,n){if(r(e,n,t))return{value:e}}),!0);return n&&n.value}})},12516:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(47650),o=r(64449);n({target:"Set",proto:!0,real:!0,forced:!0},{isDisjointFrom:function(e){return i(o,this,s(e))}})},12586:(e,t,r)=>{var n=r(97751),i=r(79504),s=n("Symbol"),o=s.keyFor,a=i(s.prototype.valueOf);e.exports=s.isRegisteredSymbol||function(e){try{return void 0!==o(a(e))}catch(e){return!1}}},12781:(e,t)=>{var r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerMessageType=t.MasterMessageType=void 0,(n=t.MasterMessageType||(t.MasterMessageType={})).cancel="cancel",n.run="run",(r=t.WorkerMessageType||(t.WorkerMessageType={})).error="error",r.init="init",r.result="result",r.running="running",r.uncaughtError="uncaughtError"},12865:(e,t,r)=>{var n=r(79504),i=r(79306);e.exports=function(){return n(i(this))}},12887:(e,t,r)=>{var n=r(44576),i=r(79039),s=r(79504),o=r(94644),a=r(23792),l=r(78227)("iterator"),c=n.Uint8Array,h=s(a.values),u=s(a.keys),d=s(a.entries),p=o.aTypedArray,f=o.exportTypedArrayMethod,g=c&&c.prototype,A=!i((function(){g[l].call([1])})),m=!!g&&g.values&&g[l]===g.values&&"values"===g.values.name,y=function(){return h(p(this))};f("entries",(function(){return d(p(this))}),A),f("keys",(function(){return u(p(this))}),A),f("values",y,A||!m,{name:"values"}),f(l,y,A||!m,{name:"values"})},13070:(e,t,r)=>{r(46518)({target:"Symbol",stat:!0},{isRegisteredSymbol:r(12586)})},13195:(e,t,r)=>{var n=r(97751),i=r(35548),s=r(8045),o=r(94644),a=r(35370),l=o.aTypedArrayConstructor;(0,o.exportTypedArrayStaticMethod)("fromAsync",(function(e){var t=this,r=arguments.length,o=r>1?arguments[1]:void 0,c=r>2?arguments[2]:void 0;return new(n("Promise"))((function(r){i(t),r(s(e,o,c))})).then((function(e){return a(l(t),e)}))}),!0)},13451:(e,t,r)=>{var n=r(46518),i=r(43839).findLastIndex,s=r(6469);n({target:"Array",proto:!0},{findLastIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),s("findLastIndex")},13579:(e,t,r)=>{var n=r(46518),i=r(72652),s=r(79306),o=r(28551),a=r(1767);n({target:"Iterator",proto:!0,real:!0},{some:function(e){o(this),s(e);var t=a(this),r=0;return i(t,(function(t,n){if(e(t,r++))return n()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},13609:(e,t,r)=>{var n=r(46518),i=r(48981),s=r(26198),o=r(34527),a=r(84606),l=r(96837);n({target:"Array",proto:!0,arity:1,forced:1!==[].unshift(0)||!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}}()},{unshift:function(e){var t=i(this),r=s(t),n=arguments.length;if(n){l(r+n);for(var c=r;c--;){var h=c+n;c in t?t[h]=t[c]:a(t,h)}for(var u=0;u<n;u++)t[u]=arguments[u]}return o(t,r+n)}})},13611:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(62106),o=r(43724),a=TypeError,l=Object.defineProperty,c=i.self!==i;try{if(o){var h=Object.getOwnPropertyDescriptor(i,"self");!c&&h&&h.get&&h.enumerable||s(i,"self",{get:function(){return i},set:function(e){if(this!==i)throw new a("Illegal invocation");l(i,"self",{value:e,writable:!0,configurable:!0,enumerable:!0})},configurable:!0,enumerable:!0})}else n({global:!0,simple:!0,forced:c},{self:i})}catch(e){}},13709:(e,t,r)=>{var n=r(82839).match(/firefox\/(\d+)/i);e.exports=!!n&&+n[1]},13763:(e,t,r)=>{var n=r(82839);e.exports=/MSIE|Trident/.test(n)},13925:(e,t,r)=>{var n=r(20034);e.exports=function(e){return n(e)||null===e}},13972:(e,t,r)=>{r(33853)},13976:(e,t,r)=>{r(70511)("matcher")},14037:(e,t,r)=>{var n=r(94644),i=r(59213).filterReject,s=r(29948),o=n.aTypedArray;(0,n.exportTypedArrayMethod)("filterOut",(function(e){var t=i(o(this),e,arguments.length>1?arguments[1]:void 0);return s(this,t)}),!0)},14190:(e,t,r)=>{var n=r(46518),i=r(76080),s=r(36194),o=r(72248),a=r(26223),l=o.Map,c=o.set;n({target:"Map",proto:!0,real:!0,forced:!0},{filter:function(e){var t=s(this),r=i(e,arguments.length>1?arguments[1]:void 0),n=new l;return a(t,(function(e,i){r(e,i,t)&&c(n,i,e)})),n}})},14468:(e,t,r)=>{var n=r(91181),i=r(33994),s=r(62529),o=r(64117),a=r(20034),l=r(62106),c=r(43724),h="Incorrect Iterator.range arguments",u="NumericRangeIterator",d=n.set,p=n.getterFor(u),f=RangeError,g=TypeError,A=i((function(e,t,r,n,i,s){if(typeof e!=n||t!==1/0&&t!==-1/0&&typeof t!=n)throw new g(h);if(e===1/0||e===-1/0)throw new f(h);var l,p=t>e,A=!1;if(void 0===r)l=void 0;else if(a(r))l=r.step,A=!!r.inclusive;else{if(typeof r!=n)throw new g(h);l=r}if(o(l)&&(l=p?s:-s),typeof l!=n)throw new g(h);if(l===1/0||l===-1/0||l===i&&e!==t)throw new f(h);d(this,{type:u,start:e,end:t,step:l,inclusive:A,hitsEnd:e!=e||t!=t||l!=l||t>e!=l>i,currentCount:i,zero:i}),c||(this.start=e,this.end=t,this.step=l,this.inclusive=A)}),u,(function(){var e=p(this);if(e.hitsEnd)return s(void 0,!0);var t=e.start,r=e.end,n=t+e.step*e.currentCount++;n===r&&(e.hitsEnd=!0);var i=e.inclusive;return(r>t?i?n>r:n>=r:i?r>n:r>=n)?(e.hitsEnd=!0,s(void 0,!0)):s(n,!1)})),m=function(e){l(A.prototype,e,{get:function(){return p(this)[e]},set:function(){},configurable:!0,enumerable:!1})};c&&(m("start"),m("end"),m("inclusive"),m("step")),e.exports=A},14528:(e,t,r)=>{r.d(t,{A:()=>mr});var n=6378137,i=.0066943799901413165,s=484813681109536e-20,o=Math.PI/2,a=1e-10,l=.017453292519943295,c=57.29577951308232,h=Math.PI/4,u=2*Math.PI,d=3.14159265359;const p={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},f={mm:{to_meter:.001},cm:{to_meter:.01},ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937},fath:{to_meter:1.8288},kmi:{to_meter:1852},"us-ch":{to_meter:20.1168402336805},"us-mi":{to_meter:1609.34721869444},km:{to_meter:1e3},"ind-ft":{to_meter:.30479841},"ind-yd":{to_meter:.91439523},mi:{to_meter:1609.344},yd:{to_meter:.9144},ch:{to_meter:20.1168},link:{to_meter:.201168},dm:{to_meter:.1},in:{to_meter:.0254},"ind-ch":{to_meter:20.11669506},"us-in":{to_meter:.025400050800101},"us-yd":{to_meter:.914401828803658}};var g=/[\s_\-\/\(\)]/g;function A(e,t){if(e[t])return e[t];for(var r,n=Object.keys(e),i=t.toLowerCase().replace(g,""),s=-1;++s<n.length;)if((r=n[s]).toLowerCase().replace(g,"")===i)return e[r]}function m(e){var t,r,n,i={},s=e.split("+").map((function(e){return e.trim()})).filter((function(e){return e})).reduce((function(e,t){var r=t.split("=");return r.push(!0),e[r[0].toLowerCase()]=r[1],e}),{}),o={proj:"projName",datum:"datumCode",rf:function(e){i.rf=parseFloat(e)},lat_0:function(e){i.lat0=e*l},lat_1:function(e){i.lat1=e*l},lat_2:function(e){i.lat2=e*l},lat_ts:function(e){i.lat_ts=e*l},lon_0:function(e){i.long0=e*l},lon_1:function(e){i.long1=e*l},lon_2:function(e){i.long2=e*l},alpha:function(e){i.alpha=parseFloat(e)*l},gamma:function(e){i.rectified_grid_angle=parseFloat(e)*l},lonc:function(e){i.longc=e*l},x_0:function(e){i.x0=parseFloat(e)},y_0:function(e){i.y0=parseFloat(e)},k_0:function(e){i.k0=parseFloat(e)},k:function(e){i.k0=parseFloat(e)},a:function(e){i.a=parseFloat(e)},b:function(e){i.b=parseFloat(e)},r:function(e){i.a=i.b=parseFloat(e)},r_a:function(){i.R_A=!0},zone:function(e){i.zone=parseInt(e,10)},south:function(){i.utmSouth=!0},towgs84:function(e){i.datum_params=e.split(",").map((function(e){return parseFloat(e)}))},to_meter:function(e){i.to_meter=parseFloat(e)},units:function(e){i.units=e;var t=A(f,e);t&&(i.to_meter=t.to_meter)},from_greenwich:function(e){i.from_greenwich=e*l},pm:function(e){var t=A(p,e);i.from_greenwich=(t||parseFloat(e))*l},nadgrids:function(e){"@null"===e?i.datumCode="none":i.nadgrids=e},axis:function(e){var t="ewnsud";3===e.length&&-1!==t.indexOf(e.substr(0,1))&&-1!==t.indexOf(e.substr(1,1))&&-1!==t.indexOf(e.substr(2,1))&&(i.axis=e)},approx:function(){i.approx=!0}};for(t in s)r=s[t],t in o?"function"==typeof(n=o[t])?n(r):i[n]=r:i[t]=r;return"string"==typeof i.datumCode&&"WGS84"!==i.datumCode&&(i.datumCode=i.datumCode.toLowerCase()),i}const y=class{static getId(e){const t=e.find((e=>Array.isArray(e)&&"ID"===e[0]));return t&&t.length>=3?{authority:t[1],code:parseInt(t[2],10)}:null}static convertUnit(e,t="unit"){if(!e||e.length<3)return{type:t,name:"unknown",conversion_factor:null};const r=e[1],n=parseFloat(e[2])||null,i=e.find((e=>Array.isArray(e)&&"ID"===e[0]));return{type:t,name:r,conversion_factor:n,id:i?{authority:i[1],code:parseInt(i[2],10)}:null}}static convertAxis(e){const t=e[1]||"Unknown";let r;const n=t.match(/^\((.)\)$/);if(n){const e=n[1].toUpperCase();if("E"===e)r="east";else if("N"===e)r="north";else{if("U"!==e)throw new Error(`Unknown axis abbreviation: ${e}`);r="up"}}else r=e[2]?e[2].toLowerCase():"unknown";const i=e.find((e=>Array.isArray(e)&&"ORDER"===e[0])),s=i?parseInt(i[1],10):null,o=e.find((e=>Array.isArray(e)&&("LENGTHUNIT"===e[0]||"ANGLEUNIT"===e[0]||"SCALEUNIT"===e[0])));return{name:t,direction:r,unit:this.convertUnit(o),order:s}}static extractAxes(e){return e.filter((e=>Array.isArray(e)&&"AXIS"===e[0])).map((e=>this.convertAxis(e))).sort(((e,t)=>(e.order||0)-(t.order||0)))}static convert(e,t={}){switch(e[0]){case"PROJCRS":t.type="ProjectedCRS",t.name=e[1],t.base_crs=e.find((e=>Array.isArray(e)&&"BASEGEOGCRS"===e[0]))?this.convert(e.find((e=>Array.isArray(e)&&"BASEGEOGCRS"===e[0]))):null,t.conversion=e.find((e=>Array.isArray(e)&&"CONVERSION"===e[0]))?this.convert(e.find((e=>Array.isArray(e)&&"CONVERSION"===e[0]))):null;const r=e.find((e=>Array.isArray(e)&&"CS"===e[0]));r&&(t.coordinate_system={type:r[1],axis:this.extractAxes(e)});const n=e.find((e=>Array.isArray(e)&&"LENGTHUNIT"===e[0]));if(n){const e=this.convertUnit(n);t.coordinate_system.unit=e}t.id=this.getId(e);break;case"BASEGEOGCRS":case"GEOGCRS":t.type="GeographicCRS",t.name=e[1];const i=e.find((e=>Array.isArray(e)&&("DATUM"===e[0]||"ENSEMBLE"===e[0])));if(i){const r=this.convert(i);"ENSEMBLE"===i[0]?t.datum_ensemble=r:t.datum=r;const n=e.find((e=>Array.isArray(e)&&"PRIMEM"===e[0]));n&&"Greenwich"!==n[1]&&(r.prime_meridian={name:n[1],longitude:parseFloat(n[2])})}t.coordinate_system={type:"ellipsoidal",axis:this.extractAxes(e)},t.id=this.getId(e);break;case"DATUM":t.type="GeodeticReferenceFrame",t.name=e[1],t.ellipsoid=e.find((e=>Array.isArray(e)&&"ELLIPSOID"===e[0]))?this.convert(e.find((e=>Array.isArray(e)&&"ELLIPSOID"===e[0]))):null;break;case"ENSEMBLE":t.type="DatumEnsemble",t.name=e[1],t.members=e.filter((e=>Array.isArray(e)&&"MEMBER"===e[0])).map((e=>({type:"DatumEnsembleMember",name:e[1],id:this.getId(e)})));const s=e.find((e=>Array.isArray(e)&&"ENSEMBLEACCURACY"===e[0]));s&&(t.accuracy=parseFloat(s[1]));const o=e.find((e=>Array.isArray(e)&&"ELLIPSOID"===e[0]));o&&(t.ellipsoid=this.convert(o)),t.id=this.getId(e);break;case"ELLIPSOID":t.type="Ellipsoid",t.name=e[1],t.semi_major_axis=parseFloat(e[2]),t.inverse_flattening=parseFloat(e[3]),e.find((e=>Array.isArray(e)&&"LENGTHUNIT"===e[0]))&&this.convert(e.find((e=>Array.isArray(e)&&"LENGTHUNIT"===e[0])),t);break;case"CONVERSION":t.type="Conversion",t.name=e[1],t.method=e.find((e=>Array.isArray(e)&&"METHOD"===e[0]))?this.convert(e.find((e=>Array.isArray(e)&&"METHOD"===e[0]))):null,t.parameters=e.filter((e=>Array.isArray(e)&&"PARAMETER"===e[0])).map((e=>this.convert(e)));break;case"METHOD":t.type="Method",t.name=e[1],t.id=this.getId(e);break;case"PARAMETER":t.type="Parameter",t.name=e[1],t.value=parseFloat(e[2]),t.unit=this.convertUnit(e.find((e=>Array.isArray(e)&&("LENGTHUNIT"===e[0]||"ANGLEUNIT"===e[0]||"SCALEUNIT"===e[0])))),t.id=this.getId(e);break;case"BOUNDCRS":t.type="BoundCRS";const a=e.find((e=>Array.isArray(e)&&"SOURCECRS"===e[0]));if(a){const e=a.find((e=>Array.isArray(e)));t.source_crs=e?this.convert(e):null}const l=e.find((e=>Array.isArray(e)&&"TARGETCRS"===e[0]));if(l){const e=l.find((e=>Array.isArray(e)));t.target_crs=e?this.convert(e):null}const c=e.find((e=>Array.isArray(e)&&"ABRIDGEDTRANSFORMATION"===e[0]));t.transformation=c?this.convert(c):null;break;case"ABRIDGEDTRANSFORMATION":if(t.type="Transformation",t.name=e[1],t.method=e.find((e=>Array.isArray(e)&&"METHOD"===e[0]))?this.convert(e.find((e=>Array.isArray(e)&&"METHOD"===e[0]))):null,t.parameters=e.filter((e=>Array.isArray(e)&&("PARAMETER"===e[0]||"PARAMETERFILE"===e[0]))).map((e=>"PARAMETER"===e[0]?this.convert(e):"PARAMETERFILE"===e[0]?{name:e[1],value:e[2],id:{authority:"EPSG",code:8656}}:void 0)),7===t.parameters.length){const e=t.parameters[6];"Scale difference"===e.name&&(e.value=Math.round(1e12*(e.value-1))/1e6)}t.id=this.getId(e);break;case"AXIS":t.coordinate_system||(t.coordinate_system={type:"unspecified",axis:[]}),t.coordinate_system.axis.push(this.convertAxis(e));break;case"LENGTHUNIT":const h=this.convertUnit(e,"LinearUnit");t.coordinate_system&&t.coordinate_system.axis&&t.coordinate_system.axis.forEach((e=>{e.unit||(e.unit=h)})),h.conversion_factor&&1!==h.conversion_factor&&t.semi_major_axis&&(t.semi_major_axis={value:t.semi_major_axis,unit:h});break;default:t.keyword=e[0]}return t}},v=class extends y{static convert(e,t={}){return super.convert(e,t),t.coordinate_system&&"Cartesian"===t.coordinate_system.subtype&&delete t.coordinate_system,t.usage&&delete t.usage,t}},w=class extends y{static convert(e,t={}){super.convert(e,t);const r=e.find((e=>Array.isArray(e)&&"CS"===e[0]));r&&(t.coordinate_system={subtype:r[1],axis:this.extractAxes(e)});const n=e.find((e=>Array.isArray(e)&&"USAGE"===e[0]));if(n){const e=n.find((e=>Array.isArray(e)&&"SCOPE"===e[0])),r=n.find((e=>Array.isArray(e)&&"AREA"===e[0])),i=n.find((e=>Array.isArray(e)&&"BBOX"===e[0]));t.usage={},e&&(t.usage.scope=e[1]),r&&(t.usage.area=r[1]),i&&(t.usage.bbox=i.slice(1))}return t}};var b=1,E=/\s/,x=/[A-Za-z]/,C=/[A-Za-z84_]/,_=/[,\]]/,I=/[\d\.E\-\+]/;function S(e){if("string"!=typeof e)throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=b}function M(e,t,r){Array.isArray(t)&&(r.unshift(t),t=null);var n=t?{}:e,i=r.reduce((function(e,t){return T(t,e),e}),n);t&&(e[t]=i)}function T(e,t){if(Array.isArray(e)){var r=e.shift();if("PARAMETER"===r&&(r=e.shift()),1===e.length)return Array.isArray(e[0])?(t[r]={},void T(e[0],t[r])):void(t[r]=e[0]);if(e.length)if("TOWGS84"!==r){if("AXIS"===r)return r in t||(t[r]=[]),void t[r].push(e);var n;switch(Array.isArray(r)||(t[r]={}),r){case"UNIT":case"PRIMEM":case"VERT_DATUM":return t[r]={name:e[0].toLowerCase(),convert:e[1]},void(3===e.length&&T(e[2],t[r]));case"SPHEROID":case"ELLIPSOID":return t[r]={name:e[0],a:e[1],rf:e[2]},void(4===e.length&&T(e[3],t[r]));case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":return e[0]=["name",e[0]],void M(t,r,e);case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":return e[0]=["name",e[0]],M(t,r,e),void(t[r].type=r);default:for(n=-1;++n<e.length;)if(!Array.isArray(e[n]))return T(e,t[r]);return M(t,r,e)}}else t[r]=e;else t[r]=!0}else t[e]=!0}function B(e){return.017453292519943295*e}function P(e){const t=(e.projName||"").toLowerCase().replace(/_/g," ");e.long0||!e.longc||"albers conic equal area"!==t&&"lambert azimuthal equal area"!==t||(e.long0=e.longc),e.lat_ts||!e.lat1||"stereographic south pole"!==t&&"polar stereographic (variant b)"!==t?e.lat_ts||!e.lat0||"polar stereographic"!==t&&"polar stereographic (variant a)"!==t||(e.lat_ts=e.lat0,e.lat0=B(e.lat0>0?90:-90),delete e.lat1):(e.lat0=B(e.lat1>0?90:-90),e.lat_ts=e.lat1,delete e.lat1)}function R(e){let t={units:null,to_meter:void 0};return"string"==typeof e?(t.units=e.toLowerCase(),"metre"===t.units&&(t.units="meter"),"meter"===t.units&&(t.to_meter=1)):e&&e.name&&(t.units=e.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.to_meter=e.conversion_factor),t}function D(e){return"object"==typeof e?e.value*e.unit.conversion_factor:e}function L(e,t){e.ellipsoid.radius?(t.a=e.ellipsoid.radius,t.rf=0):(t.a=D(e.ellipsoid.semi_major_axis),void 0!==e.ellipsoid.inverse_flattening?t.rf=e.ellipsoid.inverse_flattening:void 0!==e.ellipsoid.semi_major_axis&&void 0!==e.ellipsoid.semi_minor_axis&&(t.rf=t.a/(t.a-D(e.ellipsoid.semi_minor_axis))))}function k(e,t={}){return e&&"object"==typeof e?"BoundCRS"===e.type?(k(e.source_crs,t),e.transformation&&(e.transformation.method&&"NTv2"===e.transformation.method.name?t.nadgrids=e.transformation.parameters[0].value:t.datum_params=e.transformation.parameters.map((e=>e.value))),t):(Object.keys(e).forEach((r=>{const n=e[r];if(null!==n)switch(r){case"name":if(t.srsCode)break;t.name=n,t.srsCode=n;break;case"type":"GeographicCRS"===n?t.projName="longlat":"ProjectedCRS"===n&&e.conversion&&e.conversion.method&&(t.projName=e.conversion.method.name);break;case"datum":case"datum_ensemble":n.ellipsoid&&(t.ellps=n.ellipsoid.name,L(n,t)),n.prime_meridian&&(t.from_greenwich=n.prime_meridian.longitude*Math.PI/180);break;case"ellipsoid":t.ellps=n.name,L(n,t);break;case"prime_meridian":t.long0=(n.longitude||0)*Math.PI/180;break;case"coordinate_system":if(n.axis)if(t.axis=n.axis.map((e=>{const t=e.direction;if("east"===t)return"e";if("north"===t)return"n";if("west"===t)return"w";if("south"===t)return"s";throw new Error(`Unknown axis direction: ${t}`)})).join("")+"u",n.unit){const{units:e,to_meter:r}=R(n.unit);t.units=e,t.to_meter=r}else if(n.axis[0]&&n.axis[0].unit){const{units:e,to_meter:r}=R(n.axis[0].unit);t.units=e,t.to_meter=r}break;case"id":n.authority&&n.code&&(t.title=n.authority+":"+n.code);break;case"conversion":n.method&&n.method.name&&(t.projName=n.method.name),n.parameters&&n.parameters.forEach((e=>{const r=e.name.toLowerCase().replace(/\s+/g,"_"),n=e.value;e.unit&&e.unit.conversion_factor?t[r]=n*e.unit.conversion_factor:"degree"===e.unit?t[r]=n*Math.PI/180:t[r]=n}));break;case"unit":n.name&&(t.units=n.name.toLowerCase(),"metre"===t.units&&(t.units="meter")),n.conversion_factor&&(t.to_meter=n.conversion_factor);break;case"base_crs":k(n,t),t.datumCode=n.id?n.id.authority+"_"+n.id.code:n.name}})),void 0!==t.latitude_of_false_origin&&(t.lat0=t.latitude_of_false_origin),void 0!==t.longitude_of_false_origin&&(t.long0=t.longitude_of_false_origin),void 0!==t.latitude_of_standard_parallel&&(t.lat0=t.latitude_of_standard_parallel,t.lat1=t.latitude_of_standard_parallel),void 0!==t.latitude_of_1st_standard_parallel&&(t.lat1=t.latitude_of_1st_standard_parallel),void 0!==t.latitude_of_2nd_standard_parallel&&(t.lat2=t.latitude_of_2nd_standard_parallel),void 0!==t.latitude_of_projection_centre&&(t.lat0=t.latitude_of_projection_centre),void 0!==t.longitude_of_projection_centre&&(t.longc=t.longitude_of_projection_centre),void 0!==t.easting_at_false_origin&&(t.x0=t.easting_at_false_origin),void 0!==t.northing_at_false_origin&&(t.y0=t.northing_at_false_origin),void 0!==t.latitude_of_natural_origin&&(t.lat0=t.latitude_of_natural_origin),void 0!==t.longitude_of_natural_origin&&(t.long0=t.longitude_of_natural_origin),void 0!==t.longitude_of_origin&&(t.long0=t.longitude_of_origin),void 0!==t.false_easting&&(t.x0=t.false_easting),t.easting_at_projection_centre&&(t.x0=t.easting_at_projection_centre),void 0!==t.false_northing&&(t.y0=t.false_northing),t.northing_at_projection_centre&&(t.y0=t.northing_at_projection_centre),void 0!==t.standard_parallel_1&&(t.lat1=t.standard_parallel_1),void 0!==t.standard_parallel_2&&(t.lat2=t.standard_parallel_2),void 0!==t.scale_factor_at_natural_origin&&(t.k0=t.scale_factor_at_natural_origin),void 0!==t.scale_factor_at_projection_centre&&(t.k0=t.scale_factor_at_projection_centre),void 0!==t.scale_factor_on_pseudo_standard_parallel&&(t.k0=t.scale_factor_on_pseudo_standard_parallel),void 0!==t.azimuth&&(t.alpha=t.azimuth),void 0!==t.azimuth_at_projection_centre&&(t.alpha=t.azimuth_at_projection_centre),t.angle_from_rectified_to_skew_grid&&(t.rectified_grid_angle=t.angle_from_rectified_to_skew_grid),P(t),t):e}S.prototype.readCharicter=function(){var e=this.text[this.place++];if(4!==this.state)for(;E.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case b:return this.neutral(e);case 2:return this.keyword(e);case 4:return this.quoted(e);case 5:return this.afterquote(e);case 3:return this.number(e);case-1:return}},S.prototype.afterquote=function(e){if('"'===e)return this.word+='"',void(this.state=4);if(_.test(e))return this.word=this.word.trim(),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in afterquote yet, index '+this.place)},S.prototype.afterItem=function(e){return","===e?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=b)):"]"===e?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=b,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},S.prototype.number=function(e){if(!I.test(e)){if(_.test(e))return this.word=parseFloat(this.word),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in number yet, index '+this.place)}this.word+=e},S.prototype.quoted=function(e){'"'!==e?this.word+=e:this.state=5},S.prototype.keyword=function(e){if(C.test(e))this.word+=e;else{if("["===e){var t=[];return t.push(this.word),this.level++,null===this.root?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,void(this.state=b)}if(!_.test(e))throw new Error("havn't handled \""+e+'" in keyword yet, index '+this.place);this.afterItem(e)}},S.prototype.neutral=function(e){if(x.test(e))return this.word=e,void(this.state=2);if('"'===e)return this.word="",void(this.state=4);if(I.test(e))return this.word=e,void(this.state=3);if(!_.test(e))throw new Error("havn't handled \""+e+'" in neutral yet, index '+this.place);this.afterItem(e)},S.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var O=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function F(e){for(var t=Object.keys(e),r=0,n=t.length;r<n;++r){var i=t[r];-1!==O.indexOf(i)&&N(e[i]),"object"==typeof e[i]&&F(e[i])}}function N(e){if(e.AUTHORITY){var t=Object.keys(e.AUTHORITY)[0];t&&t in e.AUTHORITY&&(e.title=t+":"+e.AUTHORITY[t])}if("GEOGCS"===e.type?e.projName="longlat":"LOCAL_CS"===e.type?(e.projName="identity",e.local=!0):"object"==typeof e.PROJECTION?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.AXIS){for(var r="",n=0,i=e.AXIS.length;n<i;++n){var s=[e.AXIS[n][0].toLowerCase(),e.AXIS[n][1].toLowerCase()];-1!==s[0].indexOf("north")||("y"===s[0]||"lat"===s[0])&&"north"===s[1]?r+="n":-1!==s[0].indexOf("south")||("y"===s[0]||"lat"===s[0])&&"south"===s[1]?r+="s":-1!==s[0].indexOf("east")||("x"===s[0]||"lon"===s[0])&&"east"===s[1]?r+="e":-1===s[0].indexOf("west")&&("x"!==s[0]&&"lon"!==s[0]||"west"!==s[1])||(r+="w")}2===r.length&&(r+="u"),3===r.length&&(e.axis=r)}e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),"metre"===e.units&&(e.units="meter"),e.UNIT.convert&&("GEOGCS"===e.type?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=e.UNIT.convert*e.DATUM.SPHEROID.a):e.to_meter=e.UNIT.convert));var o=e.GEOGCS;function a(t){return t*(e.to_meter||1)}"GEOGCS"===e.type&&(o=e),o&&(o.DATUM?e.datumCode=o.DATUM.name.toLowerCase():e.datumCode=o.name.toLowerCase(),"d_"===e.datumCode.slice(0,2)&&(e.datumCode=e.datumCode.slice(2)),"new_zealand_1949"===e.datumCode&&(e.datumCode="nzgd49"),"wgs_1984"!==e.datumCode&&"world_geodetic_system_1984"!==e.datumCode||("Mercator_Auxiliary_Sphere"===e.PROJECTION&&(e.sphere=!0),e.datumCode="wgs84"),"belge_1972"===e.datumCode&&(e.datumCode="rnb72"),o.DATUM&&o.DATUM.SPHEROID&&(e.ellps=o.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===e.ellps.toLowerCase().slice(0,13)&&(e.ellps="intl"),e.a=o.DATUM.SPHEROID.a,e.rf=parseFloat(o.DATUM.SPHEROID.rf,10)),o.DATUM&&o.DATUM.TOWGS84&&(e.datum_params=o.DATUM.TOWGS84),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36"),~e.datumCode.indexOf("osni_1952")&&(e.datumCode="osni52"),(~e.datumCode.indexOf("tm65")||~e.datumCode.indexOf("geodetic_datum_of_1965"))&&(e.datumCode="ire65"),"ch1903+"===e.datumCode&&(e.datumCode="ch1903"),~e.datumCode.indexOf("israel")&&(e.datumCode="isr93")),e.b&&!isFinite(e.b)&&(e.b=e.a),e.rectified_grid_angle&&(e.rectified_grid_angle=B(e.rectified_grid_angle)),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",B],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",B],["x0","false_easting",a],["y0","false_northing",a],["long0","central_meridian",B],["lat0","latitude_of_origin",B],["lat0","standard_parallel_1",B],["lat1","standard_parallel_1",B],["lat2","standard_parallel_2",B],["azimuth","Azimuth"],["alpha","azimuth",B],["srsCode","name"]].forEach((function(t){return function(e,t){var r=t[0],n=t[1];!(r in e)&&n in e&&(e[r]=e[n],3===t.length&&(e[r]=t[2](e[r])))}(e,t)})),P(e)}function U(e){if("object"==typeof e)return k(e);const t=function(e){const t=e.toUpperCase();return t.includes("PROJCRS")||t.includes("GEOGCRS")||t.includes("BOUNDCRS")||t.includes("VERTCRS")||t.includes("LENGTHUNIT")||t.includes("ANGLEUNIT")||t.includes("SCALEUNIT")?"WKT2":(t.includes("PROJCS")||t.includes("GEOGCS")||t.includes("LOCAL_CS")||t.includes("VERT_CS")||t.includes("UNIT"),"WKT1")}(e);var r=new S(e).output();if("WKT2"===t)return k(function(e){const t=function(e){return e.find((e=>Array.isArray(e)&&"USAGE"===e[0]))?"2019":(e.find((e=>Array.isArray(e)&&"CS"===e[0]))||"BOUNDCRS"===e[0]||"PROJCRS"===e[0]||e[0],"2015")}(e);return("2019"===t?w:v).convert(e)}(r));var n=r[0],i={};return T(r,i),F(i),i[n]}function Q(e){var t=this;if(2===arguments.length){var r=arguments[1];"string"==typeof r?"+"===r.charAt(0)?Q[e]=m(arguments[1]):Q[e]=U(arguments[1]):Q[e]=r}else if(1===arguments.length){if(Array.isArray(e))return e.map((function(e){return Array.isArray(e)?Q.apply(t,e):Q(e)}));if("string"==typeof e){if(e in Q)return Q[e]}else"EPSG"in e?Q["EPSG:"+e.EPSG]=e:"ESRI"in e?Q["ESRI:"+e.ESRI]=e:"IAU2000"in e?Q["IAU2000:"+e.IAU2000]=e:console.log(e);return}}!function(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");for(var t=1;t<=60;++t)e("EPSG:"+(32600+t),"+proj=utm +zone="+t+" +datum=WGS84 +units=m"),e("EPSG:"+(32700+t),"+proj=utm +zone="+t+" +south +datum=WGS84 +units=m");e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}(Q);const G=Q;var z=["3857","900913","3785","102113"];function j(e,t){var r,n;if(e=e||{},!t)return e;for(n in t)void 0!==(r=t[n])&&(e[n]=r);return e}function V(e,t,r){var n=e*t;return r/Math.sqrt(1-n*n)}function q(e){return e<0?-1:1}function H(e){return Math.abs(e)<=d?e:e-q(e)*u}function W(e,t,r){var n=e*r,i=.5*e;return n=Math.pow((1-n)/(1+n),i),Math.tan(.5*(o-t))/n}function $(e,t){for(var r,n,i=.5*e,s=o-2*Math.atan(t),a=0;a<=15;a++)if(r=e*Math.sin(s),s+=n=o-2*Math.atan(t*Math.pow((1-r)/(1+r),i))-s,Math.abs(n)<=1e-10)return s;return-9999}function Y(e){return e}var K=[{init:function(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=V(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(e){var t,r,n=e.x,i=e.y;if(i*c>90&&i*c<-90&&n*c>180&&n*c<-180)return null;if(Math.abs(Math.abs(i)-o)<=a)return null;if(this.sphere)t=this.x0+this.a*this.k0*H(n-this.long0),r=this.y0+this.a*this.k0*Math.log(Math.tan(h+.5*i));else{var s=Math.sin(i),l=W(this.e,i,s);t=this.x0+this.a*this.k0*H(n-this.long0),r=this.y0-this.a*this.k0*Math.log(l)}return e.x=t,e.y=r,e},inverse:function(e){var t,r,n=e.x-this.x0,i=e.y-this.y0;if(this.sphere)r=o-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var s=Math.exp(-i/(this.a*this.k0));if(-9999===(r=$(this.e,s)))return null}return t=H(this.long0+n/(this.a*this.k0)),e.x=t,e.y=r,e},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","Mercator_Variant_A","merc"]},{init:function(){},forward:Y,inverse:Y,names:["longlat","identity"]}],J={},X=[];function Z(e,t){var r=X.length;return e.names?(X[r]=e,e.names.forEach((function(e){J[e.toLowerCase()]=r})),this):(console.log(t),!0)}function ee(e){return e.replace(/[-\(\)\s]+/g," ").trim().replace(/ /g,"_")}const te={start:function(){K.forEach(Z)},add:Z,get:function(e){if(!e)return!1;var t=e.toLowerCase();return void 0!==J[t]&&X[J[t]]||(t=ee(t))in J&&X[J[t]]?X[J[t]]:void 0}},re={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:6378249.2,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}},ne=re.WGS84;var ie={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},mgi:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Ordnance Survey of Great Britain 1936"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"},EPSG_5451:{towgs84:"6.41,-49.05,-11.28,1.5657,0.5242,6.9718,-5.7649"},IGNF_LURESG:{towgs84:"-192.986,13.673,-39.309,-0.4099,-2.9332,2.6881,0.43"},EPSG_4614:{towgs84:"-119.4248,-303.65872,-11.00061,1.164298,0.174458,1.096259,3.657065"},EPSG_4615:{towgs84:"-494.088,-312.129,279.877,-1.423,-1.013,1.59,-0.748"},ESRI_37241:{towgs84:"-76.822,257.457,-12.817,2.136,-0.033,-2.392,-0.031"},ESRI_37249:{towgs84:"-440.296,58.548,296.265,1.128,10.202,4.559,-0.438"},ESRI_37245:{towgs84:"-511.151,-181.269,139.609,1.05,2.703,1.798,3.071"},EPSG_4178:{towgs84:"24.9,-126.4,-93.2,-0.063,-0.247,-0.041,1.01"},EPSG_4622:{towgs84:"-472.29,-5.63,-304.12,0.4362,-0.8374,0.2563,1.8984"},EPSG_4625:{towgs84:"126.93,547.94,130.41,-2.7867,5.1612,-0.8584,13.8227"},EPSG_5252:{towgs84:"0.023,0.036,-0.068,0.00176,0.00912,-0.01136,0.00439"},EPSG_4314:{towgs84:"597.1,71.4,412.1,0.894,0.068,-1.563,7.58"},EPSG_4282:{towgs84:"-178.3,-316.7,-131.5,5.278,6.077,10.979,19.166"},EPSG_4231:{towgs84:"-83.11,-97.38,-117.22,0.0276,-0.2167,0.2147,0.1218"},EPSG_4274:{towgs84:"-230.994,102.591,25.199,0.633,-0.239,0.9,1.95"},EPSG_4134:{towgs84:"-180.624,-225.516,173.919,-0.81,-1.898,8.336,16.71006"},EPSG_4254:{towgs84:"18.38,192.45,96.82,0.056,-0.142,-0.2,-0.0013"},EPSG_4159:{towgs84:"-194.513,-63.978,-25.759,-3.4027,3.756,-3.352,-0.9175"},EPSG_4687:{towgs84:"0.072,-0.507,-0.245,0.0183,-0.0003,0.007,-0.0093"},EPSG_4227:{towgs84:"-83.58,-397.54,458.78,-17.595,-2.847,4.256,3.225"},EPSG_4746:{towgs84:"599.4,72.4,419.2,-0.062,-0.022,-2.723,6.46"},EPSG_4745:{towgs84:"612.4,77,440.2,-0.054,0.057,-2.797,2.55"},EPSG_6311:{towgs84:"8.846,-4.394,-1.122,-0.00237,-0.146528,0.130428,0.783926"},EPSG_4289:{towgs84:"565.7381,50.4018,465.2904,-1.91514,1.60363,-9.09546,4.07244"},EPSG_4230:{towgs84:"-68.863,-134.888,-111.49,-0.53,-0.14,0.57,-3.4"},EPSG_4154:{towgs84:"-123.02,-158.95,-168.47"},EPSG_4156:{towgs84:"570.8,85.7,462.8,4.998,1.587,5.261,3.56"},EPSG_4299:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4179:{towgs84:"33.4,-146.6,-76.3,-0.359,-0.053,0.844,-0.84"},EPSG_4313:{towgs84:"-106.8686,52.2978,-103.7239,0.3366,-0.457,1.8422,-1.2747"},EPSG_4194:{towgs84:"163.511,127.533,-159.789"},EPSG_4195:{towgs84:"105,326,-102.5"},EPSG_4196:{towgs84:"-45,417,-3.5"},EPSG_4611:{towgs84:"-162.619,-276.959,-161.764,0.067753,-2.243649,-1.158827,-1.094246"},EPSG_4633:{towgs84:"137.092,131.66,91.475,-1.9436,-11.5993,-4.3321,-7.4824"},EPSG_4641:{towgs84:"-408.809,366.856,-412.987,1.8842,-0.5308,2.1655,-121.0993"},EPSG_4643:{towgs84:"-480.26,-438.32,-643.429,16.3119,20.1721,-4.0349,-111.7002"},EPSG_4300:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4188:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4660:{towgs84:"982.6087,552.753,-540.873,32.39344,-153.25684,-96.2266,16.805"},EPSG_4662:{towgs84:"97.295,-263.247,310.882,-1.5999,0.8386,3.1409,13.3259"},EPSG_3906:{towgs84:"577.88891,165.22205,391.18289,4.9145,-0.94729,-13.05098,7.78664"},EPSG_4307:{towgs84:"-209.3622,-87.8162,404.6198,0.0046,3.4784,0.5805,-1.4547"},EPSG_6892:{towgs84:"-76.269,-16.683,68.562,-6.275,10.536,-4.286,-13.686"},EPSG_4690:{towgs84:"221.597,152.441,176.523,2.403,1.3893,0.884,11.4648"},EPSG_4691:{towgs84:"218.769,150.75,176.75,3.5231,2.0037,1.288,10.9817"},EPSG_4629:{towgs84:"72.51,345.411,79.241,-1.5862,-0.8826,-0.5495,1.3653"},EPSG_4630:{towgs84:"165.804,216.213,180.26,-0.6251,-0.4515,-0.0721,7.4111"},EPSG_4692:{towgs84:"217.109,86.452,23.711,0.0183,-0.0003,0.007,-0.0093"},EPSG_9333:{towgs84:"0,0,0,-8.393,0.749,-10.276,0"},EPSG_9059:{towgs84:"0,0,0"},EPSG_4312:{towgs84:"601.705,84.263,485.227,4.7354,1.3145,5.393,-2.3887"},EPSG_4123:{towgs84:"-96.062,-82.428,-121.753,4.801,0.345,-1.376,1.496"},EPSG_4309:{towgs84:"-124.45,183.74,44.64,-0.4384,0.5446,-0.9706,-2.1365"},ESRI_104106:{towgs84:"-283.088,-70.693,117.445,-1.157,0.059,-0.652,-4.058"},EPSG_4281:{towgs84:"-219.247,-73.802,269.529"},EPSG_4322:{towgs84:"0,0,4.5"},EPSG_4324:{towgs84:"0,0,1.9"},EPSG_4284:{towgs84:"43.822,-108.842,-119.585,1.455,-0.761,0.737,0.549"},EPSG_4277:{towgs84:"446.448,-125.157,542.06,0.15,0.247,0.842,-20.489"},EPSG_4207:{towgs84:"-282.1,-72.2,120,-1.529,0.145,-0.89,-4.46"},EPSG_4688:{towgs84:"347.175,1077.618,2623.677,33.9058,-70.6776,9.4013,186.0647"},EPSG_4689:{towgs84:"410.793,54.542,80.501,-2.5596,-2.3517,-0.6594,17.3218"},EPSG_4720:{towgs84:"0,0,4.5"},EPSG_4273:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},EPSG_4240:{towgs84:"204.64,834.74,293.8"},EPSG_4817:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},ESRI_104131:{towgs84:"426.62,142.62,460.09,4.98,4.49,-12.42,-17.1"},EPSG_4265:{towgs84:"-104.1,-49.1,-9.9,0.971,-2.917,0.714,-11.68"},EPSG_4263:{towgs84:"-111.92,-87.85,114.5,1.875,0.202,0.219,0.032"},EPSG_4298:{towgs84:"-689.5937,623.84046,-65.93566,-0.02331,1.17094,-0.80054,5.88536"},EPSG_4270:{towgs84:"-253.4392,-148.452,386.5267,0.15605,0.43,-0.1013,-0.0424"},EPSG_4229:{towgs84:"-121.8,98.1,-10.7"},EPSG_4220:{towgs84:"-55.5,-348,-229.2"},EPSG_4214:{towgs84:"12.646,-155.176,-80.863"},EPSG_4232:{towgs84:"-345,3,223"},EPSG_4238:{towgs84:"-1.977,-13.06,-9.993,0.364,0.254,0.689,-1.037"},EPSG_4168:{towgs84:"-170,33,326"},EPSG_4131:{towgs84:"199,931,318.9"},EPSG_4152:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_5228:{towgs84:"572.213,85.334,461.94,4.9732,1.529,5.2484,3.5378"},EPSG_8351:{towgs84:"485.021,169.465,483.839,7.786342,4.397554,4.102655,0"},EPSG_4683:{towgs84:"-127.62,-67.24,-47.04,-3.068,4.903,1.578,-1.06"},EPSG_4133:{towgs84:"0,0,0"},EPSG_7373:{towgs84:"0.819,-0.5762,-1.6446,-0.00378,-0.03317,0.00318,0.0693"},EPSG_9075:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9072:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9294:{towgs84:"1.16835,-1.42001,-2.24431,-0.00822,-0.05508,0.01818,0.23388"},EPSG_4212:{towgs84:"-267.434,173.496,181.814,-13.4704,8.7154,7.3926,14.7492"},EPSG_4191:{towgs84:"-44.183,-0.58,-38.489,2.3867,2.7072,-3.5196,-8.2703"},EPSG_4237:{towgs84:"52.684,-71.194,-13.975,-0.312,-0.1063,-0.3729,1.0191"},EPSG_4740:{towgs84:"-1.08,-0.27,-0.9"},EPSG_4124:{towgs84:"419.3836,99.3335,591.3451,0.850389,1.817277,-7.862238,-0.99496"},EPSG_5681:{towgs84:"584.9636,107.7175,413.8067,1.1155,0.2824,-3.1384,7.9922"},EPSG_4141:{towgs84:"23.772,17.49,17.859,-0.3132,-1.85274,1.67299,-5.4262"},EPSG_4204:{towgs84:"-85.645,-273.077,-79.708,2.289,-1.421,2.532,3.194"},EPSG_4319:{towgs84:"226.702,-193.337,-35.371,-2.229,-4.391,9.238,0.9798"},EPSG_4200:{towgs84:"24.82,-131.21,-82.66"},EPSG_4130:{towgs84:"0,0,0"},EPSG_4127:{towgs84:"-82.875,-57.097,-156.768,-2.158,1.524,-0.982,-0.359"},EPSG_4149:{towgs84:"674.374,15.056,405.346"},EPSG_4617:{towgs84:"-0.991,1.9072,0.5129,1.25033e-7,4.6785e-8,5.6529e-8,0"},EPSG_4663:{towgs84:"-210.502,-66.902,-48.476,2.094,-15.067,-5.817,0.485"},EPSG_4664:{towgs84:"-211.939,137.626,58.3,-0.089,0.251,0.079,0.384"},EPSG_4665:{towgs84:"-105.854,165.589,-38.312,-0.003,-0.026,0.024,-0.048"},EPSG_4666:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},EPSG_4756:{towgs84:"-192.873,-39.382,-111.202,-0.00205,-0.0005,0.00335,0.0188"},EPSG_4723:{towgs84:"-179.483,-69.379,-27.584,-7.862,8.163,6.042,-13.925"},EPSG_4726:{towgs84:"8.853,-52.644,180.304,-0.393,-2.323,2.96,-24.081"},EPSG_4267:{towgs84:"-8.0,160.0,176.0"},EPSG_5365:{towgs84:"-0.16959,0.35312,0.51846,0.03385,-0.16325,0.03446,0.03693"},EPSG_4218:{towgs84:"304.5,306.5,-318.1"},EPSG_4242:{towgs84:"-33.722,153.789,94.959,-8.581,-4.478,4.54,8.95"},EPSG_4216:{towgs84:"-292.295,248.758,429.447,4.9971,2.99,6.6906,1.0289"},ESRI_104105:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},ESRI_104129:{towgs84:"0,0,0"},EPSG_4673:{towgs84:"174.05,-25.49,112.57"},EPSG_4202:{towgs84:"-124,-60,154"},EPSG_4203:{towgs84:"-117.763,-51.51,139.061,0.292,0.443,0.277,-0.191"},EPSG_3819:{towgs84:"595.48,121.69,515.35,4.115,-2.9383,0.853,-3.408"},EPSG_8694:{towgs84:"-93.799,-132.737,-219.073,-1.844,0.648,-6.37,-0.169"},EPSG_4145:{towgs84:"275.57,676.78,229.6"},EPSG_4283:{towgs84:"61.55,-10.87,-40.19,39.4924,32.7221,32.8979,-9.994"},EPSG_4317:{towgs84:"2.3287,-147.0425,-92.0802,-0.3092483,0.32482185,0.49729934,5.68906266"},EPSG_4272:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993"},EPSG_4248:{towgs84:"-307.7,265.3,-363.5"},EPSG_5561:{towgs84:"24,-121,-76"},EPSG_5233:{towgs84:"-0.293,766.95,87.713,0.195704,1.695068,3.473016,-0.039338"},ESRI_104130:{towgs84:"-86,-98,-119"},ESRI_104102:{towgs84:"682,-203,480"},ESRI_37207:{towgs84:"7,-10,-26"},EPSG_4675:{towgs84:"59.935,118.4,-10.871"},ESRI_104109:{towgs84:"-89.121,-348.182,260.871"},ESRI_104112:{towgs84:"-185.583,-230.096,281.361"},ESRI_104113:{towgs84:"25.1,-275.6,222.6"},IGNF_WGS72G:{towgs84:"0,12,6"},IGNF_NTFG:{towgs84:"-168,-60,320"},IGNF_EFATE57G:{towgs84:"-127,-769,472"},IGNF_PGP50G:{towgs84:"324.8,153.6,172.1"},IGNF_REUN47G:{towgs84:"94,-948,-1262"},IGNF_CSG67G:{towgs84:"-186,230,110"},IGNF_GUAD48G:{towgs84:"-467,-16,-300"},IGNF_TAHI51G:{towgs84:"162,117,154"},IGNF_TAHAAG:{towgs84:"65,342,77"},IGNF_NUKU72G:{towgs84:"84,274,65"},IGNF_PETRELS72G:{towgs84:"365,194,166"},IGNF_WALL78G:{towgs84:"253,-133,-127"},IGNF_MAYO50G:{towgs84:"-382,-59,-262"},IGNF_TANNAG:{towgs84:"-139,-967,436"},IGNF_IGN72G:{towgs84:"-13,-348,292"},IGNF_ATIGG:{towgs84:"1118,23,66"},IGNF_FANGA84G:{towgs84:"150.57,158.33,118.32"},IGNF_RUSAT84G:{towgs84:"202.13,174.6,-15.74"},IGNF_KAUE70G:{towgs84:"126.74,300.1,-75.49"},IGNF_MOP90G:{towgs84:"-10.8,-1.8,12.77"},IGNF_MHPF67G:{towgs84:"338.08,212.58,-296.17"},IGNF_TAHI79G:{towgs84:"160.61,116.05,153.69"},IGNF_ANAA92G:{towgs84:"1.5,3.84,4.81"},IGNF_MARQUI72G:{towgs84:"330.91,-13.92,58.56"},IGNF_APAT86G:{towgs84:"143.6,197.82,74.05"},IGNF_TUBU69G:{towgs84:"237.17,171.61,-77.84"},IGNF_STPM50G:{towgs84:"11.363,424.148,373.13"},EPSG_4150:{towgs84:"674.374,15.056,405.346"},EPSG_4754:{towgs84:"-208.4058,-109.8777,-2.5764"},ESRI_104101:{towgs84:"374,150,588"},EPSG_4693:{towgs84:"0,-0.15,0.68"},EPSG_6207:{towgs84:"293.17,726.18,245.36"},EPSG_4153:{towgs84:"-133.63,-157.5,-158.62"},EPSG_4132:{towgs84:"-241.54,-163.64,396.06"},EPSG_4221:{towgs84:"-154.5,150.7,100.4"},EPSG_4266:{towgs84:"-80.7,-132.5,41.1"},EPSG_4193:{towgs84:"-70.9,-151.8,-41.4"},EPSG_5340:{towgs84:"-0.41,0.46,-0.35"},EPSG_4246:{towgs84:"-294.7,-200.1,525.5"},EPSG_4318:{towgs84:"-3.2,-5.7,2.8"},EPSG_4121:{towgs84:"-199.87,74.79,246.62"},EPSG_4223:{towgs84:"-260.1,5.5,432.2"},EPSG_4158:{towgs84:"-0.465,372.095,171.736"},EPSG_4285:{towgs84:"-128.16,-282.42,21.93"},EPSG_4613:{towgs84:"-404.78,685.68,45.47"},EPSG_4607:{towgs84:"195.671,332.517,274.607"},EPSG_4475:{towgs84:"-381.788,-57.501,-256.673"},EPSG_4208:{towgs84:"-157.84,308.54,-146.6"},EPSG_4743:{towgs84:"70.995,-335.916,262.898"},EPSG_4710:{towgs84:"-323.65,551.39,-491.22"},EPSG_7881:{towgs84:"-0.077,0.079,0.086"},EPSG_4682:{towgs84:"283.729,735.942,261.143"},EPSG_4739:{towgs84:"-156,-271,-189"},EPSG_4679:{towgs84:"-80.01,253.26,291.19"},EPSG_4750:{towgs84:"-56.263,16.136,-22.856"},EPSG_4644:{towgs84:"-10.18,-350.43,291.37"},EPSG_4695:{towgs84:"-103.746,-9.614,-255.95"},EPSG_4292:{towgs84:"-355,21,72"},EPSG_4302:{towgs84:"-61.702,284.488,472.052"},EPSG_4143:{towgs84:"-124.76,53,466.79"},EPSG_4606:{towgs84:"-153,153,307"},EPSG_4699:{towgs84:"-770.1,158.4,-498.2"},EPSG_4247:{towgs84:"-273.5,110.6,-357.9"},EPSG_4160:{towgs84:"8.88,184.86,106.69"},EPSG_4161:{towgs84:"-233.43,6.65,173.64"},EPSG_9251:{towgs84:"-9.5,122.9,138.2"},EPSG_9253:{towgs84:"-78.1,101.6,133.3"},EPSG_4297:{towgs84:"-198.383,-240.517,-107.909"},EPSG_4269:{towgs84:"0,0,0"},EPSG_4301:{towgs84:"-147,506,687"},EPSG_4618:{towgs84:"-59,-11,-52"},EPSG_4612:{towgs84:"0,0,0"},EPSG_4678:{towgs84:"44.585,-131.212,-39.544"},EPSG_4250:{towgs84:"-130,29,364"},EPSG_4144:{towgs84:"214,804,268"},EPSG_4147:{towgs84:"-17.51,-108.32,-62.39"},EPSG_4259:{towgs84:"-254.1,-5.36,-100.29"},EPSG_4164:{towgs84:"-76,-138,67"},EPSG_4211:{towgs84:"-378.873,676.002,-46.255"},EPSG_4182:{towgs84:"-422.651,-172.995,84.02"},EPSG_4224:{towgs84:"-143.87,243.37,-33.52"},EPSG_4225:{towgs84:"-205.57,168.77,-4.12"},EPSG_5527:{towgs84:"-67.35,3.88,-38.22"},EPSG_4752:{towgs84:"98,390,-22"},EPSG_4310:{towgs84:"-30,190,89"},EPSG_9248:{towgs84:"-192.26,65.72,132.08"},EPSG_4680:{towgs84:"124.5,-63.5,-281"},EPSG_4701:{towgs84:"-79.9,-158,-168.9"},EPSG_4706:{towgs84:"-146.21,112.63,4.05"},EPSG_4805:{towgs84:"682,-203,480"},EPSG_4201:{towgs84:"-165,-11,206"},EPSG_4210:{towgs84:"-157,-2,-299"},EPSG_4183:{towgs84:"-104,167,-38"},EPSG_4139:{towgs84:"11,72,-101"},EPSG_4668:{towgs84:"-86,-98,-119"},EPSG_4717:{towgs84:"-2,151,181"},EPSG_4732:{towgs84:"102,52,-38"},EPSG_4280:{towgs84:"-377,681,-50"},EPSG_4209:{towgs84:"-138,-105,-289"},EPSG_4261:{towgs84:"31,146,47"},EPSG_4658:{towgs84:"-73,46,-86"},EPSG_4721:{towgs84:"265.025,384.929,-194.046"},EPSG_4222:{towgs84:"-136,-108,-292"},EPSG_4601:{towgs84:"-255,-15,71"},EPSG_4602:{towgs84:"725,685,536"},EPSG_4603:{towgs84:"72,213.7,93"},EPSG_4605:{towgs84:"9,183,236"},EPSG_4621:{towgs84:"137,248,-430"},EPSG_4657:{towgs84:"-28,199,5"},EPSG_4316:{towgs84:"103.25,-100.4,-307.19"},EPSG_4642:{towgs84:"-13,-348,292"},EPSG_4698:{towgs84:"145,-187,103"},EPSG_4192:{towgs84:"-206.1,-174.7,-87.7"},EPSG_4311:{towgs84:"-265,120,-358"},EPSG_4135:{towgs84:"58,-283,-182"},ESRI_104138:{towgs84:"198,-226,-347"},EPSG_4245:{towgs84:"-11,851,5"},EPSG_4142:{towgs84:"-125,53,467"},EPSG_4213:{towgs84:"-106,-87,188"},EPSG_4253:{towgs84:"-133,-77,-51"},EPSG_4129:{towgs84:"-132,-110,-335"},EPSG_4713:{towgs84:"-77,-128,142"},EPSG_4239:{towgs84:"217,823,299"},EPSG_4146:{towgs84:"295,736,257"},EPSG_4155:{towgs84:"-83,37,124"},EPSG_4165:{towgs84:"-173,253,27"},EPSG_4672:{towgs84:"175,-38,113"},EPSG_4236:{towgs84:"-637,-549,-203"},EPSG_4251:{towgs84:"-90,40,88"},EPSG_4271:{towgs84:"-2,374,172"},EPSG_4175:{towgs84:"-88,4,101"},EPSG_4716:{towgs84:"298,-304,-375"},EPSG_4315:{towgs84:"-23,259,-9"},EPSG_4744:{towgs84:"-242.2,-144.9,370.3"},EPSG_4244:{towgs84:"-97,787,86"},EPSG_4293:{towgs84:"616,97,-251"},EPSG_4714:{towgs84:"-127,-769,472"},EPSG_4736:{towgs84:"260,12,-147"},EPSG_6883:{towgs84:"-235,-110,393"},EPSG_6894:{towgs84:"-63,176,185"},EPSG_4205:{towgs84:"-43,-163,45"},EPSG_4256:{towgs84:"41,-220,-134"},EPSG_4262:{towgs84:"639,405,60"},EPSG_4604:{towgs84:"174,359,365"},EPSG_4169:{towgs84:"-115,118,426"},EPSG_4620:{towgs84:"-106,-129,165"},EPSG_4184:{towgs84:"-203,141,53"},EPSG_4616:{towgs84:"-289,-124,60"},EPSG_9403:{towgs84:"-307,-92,127"},EPSG_4684:{towgs84:"-133,-321,50"},EPSG_4708:{towgs84:"-491,-22,435"},EPSG_4707:{towgs84:"114,-116,-333"},EPSG_4709:{towgs84:"145,75,-272"},EPSG_4712:{towgs84:"-205,107,53"},EPSG_4711:{towgs84:"124,-234,-25"},EPSG_4718:{towgs84:"230,-199,-752"},EPSG_4719:{towgs84:"211,147,111"},EPSG_4724:{towgs84:"208,-435,-229"},EPSG_4725:{towgs84:"189,-79,-202"},EPSG_4735:{towgs84:"647,1777,-1124"},EPSG_4722:{towgs84:"-794,119,-298"},EPSG_4728:{towgs84:"-307,-92,127"},EPSG_4734:{towgs84:"-632,438,-609"},EPSG_4727:{towgs84:"912,-58,1227"},EPSG_4729:{towgs84:"185,165,42"},EPSG_4730:{towgs84:"170,42,84"},EPSG_4733:{towgs84:"276,-57,149"},ESRI_37218:{towgs84:"230,-199,-752"},ESRI_37240:{towgs84:"-7,215,225"},ESRI_37221:{towgs84:"252,-209,-751"},ESRI_4305:{towgs84:"-123,-206,219"},ESRI_104139:{towgs84:"-73,-247,227"},EPSG_4748:{towgs84:"51,391,-36"},EPSG_4219:{towgs84:"-384,664,-48"},EPSG_4255:{towgs84:"-333,-222,114"},EPSG_4257:{towgs84:"-587.8,519.75,145.76"},EPSG_4646:{towgs84:"-963,510,-359"},EPSG_6881:{towgs84:"-24,-203,268"},EPSG_6882:{towgs84:"-183,-15,273"},EPSG_4715:{towgs84:"-104,-129,239"},IGNF_RGF93GDD:{towgs84:"0,0,0"},IGNF_RGM04GDD:{towgs84:"0,0,0"},IGNF_RGSPM06GDD:{towgs84:"0,0,0"},IGNF_RGTAAF07GDD:{towgs84:"0,0,0"},IGNF_RGFG95GDD:{towgs84:"0,0,0"},IGNF_RGNCG:{towgs84:"0,0,0"},IGNF_RGPFGDD:{towgs84:"0,0,0"},IGNF_ETRS89G:{towgs84:"0,0,0"},IGNF_RGR92GDD:{towgs84:"0,0,0"},EPSG_4173:{towgs84:"0,0,0"},EPSG_4180:{towgs84:"0,0,0"},EPSG_4619:{towgs84:"0,0,0"},EPSG_4667:{towgs84:"0,0,0"},EPSG_4075:{towgs84:"0,0,0"},EPSG_6706:{towgs84:"0,0,0"},EPSG_7798:{towgs84:"0,0,0"},EPSG_4661:{towgs84:"0,0,0"},EPSG_4669:{towgs84:"0,0,0"},EPSG_8685:{towgs84:"0,0,0"},EPSG_4151:{towgs84:"0,0,0"},EPSG_9702:{towgs84:"0,0,0"},EPSG_4758:{towgs84:"0,0,0"},EPSG_4761:{towgs84:"0,0,0"},EPSG_4765:{towgs84:"0,0,0"},EPSG_8997:{towgs84:"0,0,0"},EPSG_4023:{towgs84:"0,0,0"},EPSG_4670:{towgs84:"0,0,0"},EPSG_4694:{towgs84:"0,0,0"},EPSG_4148:{towgs84:"0,0,0"},EPSG_4163:{towgs84:"0,0,0"},EPSG_4167:{towgs84:"0,0,0"},EPSG_4189:{towgs84:"0,0,0"},EPSG_4190:{towgs84:"0,0,0"},EPSG_4176:{towgs84:"0,0,0"},EPSG_4659:{towgs84:"0,0,0"},EPSG_3824:{towgs84:"0,0,0"},EPSG_3889:{towgs84:"0,0,0"},EPSG_4046:{towgs84:"0,0,0"},EPSG_4081:{towgs84:"0,0,0"},EPSG_4558:{towgs84:"0,0,0"},EPSG_4483:{towgs84:"0,0,0"},EPSG_5013:{towgs84:"0,0,0"},EPSG_5264:{towgs84:"0,0,0"},EPSG_5324:{towgs84:"0,0,0"},EPSG_5354:{towgs84:"0,0,0"},EPSG_5371:{towgs84:"0,0,0"},EPSG_5373:{towgs84:"0,0,0"},EPSG_5381:{towgs84:"0,0,0"},EPSG_5393:{towgs84:"0,0,0"},EPSG_5489:{towgs84:"0,0,0"},EPSG_5593:{towgs84:"0,0,0"},EPSG_6135:{towgs84:"0,0,0"},EPSG_6365:{towgs84:"0,0,0"},EPSG_5246:{towgs84:"0,0,0"},EPSG_7886:{towgs84:"0,0,0"},EPSG_8431:{towgs84:"0,0,0"},EPSG_8427:{towgs84:"0,0,0"},EPSG_8699:{towgs84:"0,0,0"},EPSG_8818:{towgs84:"0,0,0"},EPSG_4757:{towgs84:"0,0,0"},EPSG_9140:{towgs84:"0,0,0"},EPSG_8086:{towgs84:"0,0,0"},EPSG_4686:{towgs84:"0,0,0"},EPSG_4737:{towgs84:"0,0,0"},EPSG_4702:{towgs84:"0,0,0"},EPSG_4747:{towgs84:"0,0,0"},EPSG_4749:{towgs84:"0,0,0"},EPSG_4674:{towgs84:"0,0,0"},EPSG_4755:{towgs84:"0,0,0"},EPSG_4759:{towgs84:"0,0,0"},EPSG_4762:{towgs84:"0,0,0"},EPSG_4763:{towgs84:"0,0,0"},EPSG_4764:{towgs84:"0,0,0"},EPSG_4166:{towgs84:"0,0,0"},EPSG_4170:{towgs84:"0,0,0"},EPSG_5546:{towgs84:"0,0,0"},EPSG_7844:{towgs84:"0,0,0"},EPSG_4818:{towgs84:"589,76,480"}};for(var se in ie){var oe=ie[se];oe.datumName&&(ie[oe.datumName]=oe)}const ae=ie;var le={};async function ce(e,t){for(var r=[],n=await t.getImageCount(),i=n-1;i>=0;i--){var s=await t.getImage(i),o=await s.readRasters(),a=[s.getWidth(),s.getHeight()],l=s.getBoundingBox().map(ue),c=[s.fileDirectory.ModelPixelScale[0],s.fileDirectory.ModelPixelScale[1]].map(ue),h=l[0]+(a[0]-1)*c[0],u=l[3]-(a[1]-1)*c[1],d=o[0],p=o[1],f=[];for(let e=a[1]-1;e>=0;e--)for(let t=a[0]-1;t>=0;t--){var g=e*a[0]+t;f.push([-de(p[g]),de(d[g])])}r.push({del:c,lim:a,ll:[-h,u],cvs:f})}var A={header:{nSubgrids:n},subgrids:r};return le[e]=A,A}function he(e){if(0===e.length)return null;var t="@"===e[0];return t&&(e=e.slice(1)),"null"===e?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:e,mandatory:!t,grid:le[e]||null,isNull:!1}}function ue(e){return e*Math.PI/180}function de(e){return e/3600*Math.PI/180}function pe(e,t,r){return String.fromCharCode.apply(null,new Uint8Array(e.buffer.slice(t,r)))}function fe(e){return e.map((function(e){return[de(e.longitudeShift),de(e.latitudeShift)]}))}function ge(e,t,r){return{name:pe(e,t+8,t+16).trim(),parent:pe(e,t+24,t+24+8).trim(),lowerLatitude:e.getFloat64(t+72,r),upperLatitude:e.getFloat64(t+88,r),lowerLongitude:e.getFloat64(t+104,r),upperLongitude:e.getFloat64(t+120,r),latitudeInterval:e.getFloat64(t+136,r),longitudeInterval:e.getFloat64(t+152,r),gridNodeCount:e.getInt32(t+168,r)}}function Ae(e,t,r,n,i){var s=t+176,o=16;!1===i&&(o=8);for(var a=[],l=0;l<r.gridNodeCount;l++){var c={latitudeShift:e.getFloat32(s+l*o,n),longitudeShift:e.getFloat32(s+l*o+4,n)};!1!==i&&(c.latitudeAccuracy=e.getFloat32(s+l*o+8,n),c.longitudeAccuracy=e.getFloat32(s+l*o+12,n)),a.push(c)}return a}function me(e,t){if(!(this instanceof me))return new me(e);this.forward=null,this.inverse=null,this.init=null,this.name,this.names=null,this.title,t=t||function(e){if(e)throw e};var r=function(e){if(!function(e){return"string"==typeof e}(e))return"projName"in e?e:U(e);if(function(e){return e in G}(e))return G[e];if(function(e){return 0!==e.indexOf("+")&&-1!==e.indexOf("[")||"object"==typeof e&&!("srsCode"in e)}(e)){var t=U(e);if(function(e){var t=A(e,"authority");if(t){var r=A(t,"epsg");return r&&z.indexOf(r)>-1}}(t))return G["EPSG:3857"];var r=function(e){var t=A(e,"extension");if(t)return A(t,"proj4")}(t);return r?m(r):t}return function(e){return"+"===e[0]}(e)?m(e):void 0}(e);if("object"==typeof r){var n=me.projections.get(r.projName);if(n){if(r.datumCode&&"none"!==r.datumCode){var i=A(ae,r.datumCode);i&&(r.datum_params=r.datum_params||(i.towgs84?i.towgs84.split(","):null),r.ellps=i.ellipse,r.datumName=i.datumName?i.datumName:r.datumCode)}r.k0=r.k0||1,r.axis=r.axis||"enu",r.ellps=r.ellps||"wgs84",r.lat1=r.lat1||r.lat0;var o,l,c,h,u,d,p=function(e,t,r,n,i){if(!e){var s=A(re,n);s||(s=ne),e=s.a,t=s.b,r=s.rf}return r&&!t&&(t=(1-1/r)*e),(0===r||Math.abs(e-t)<a)&&(i=!0,t=e),{a:e,b:t,rf:r,sphere:i}}(r.a,r.b,r.rf,r.ellps,r.sphere),f=(o=p.a,l=p.b,p.rf,u=((c=o*o)-(h=l*l))/c,d=0,r.R_A?(c=(o*=1-u*(.16666666666666666+u*(.04722222222222222+.022156084656084655*u)))*o,u=0):d=Math.sqrt(u),{es:u,e:d,ep2:(c-h)/h}),g=function(e){return void 0===e?null:e.split(",").map(he)}(r.nadgrids),y=r.datum||function(e,t,r,n,i,o,a){var l={};return l.datum_type=void 0===e||"none"===e?5:4,t&&(l.datum_params=t.map(parseFloat),0===l.datum_params[0]&&0===l.datum_params[1]&&0===l.datum_params[2]||(l.datum_type=1),l.datum_params.length>3&&(0===l.datum_params[3]&&0===l.datum_params[4]&&0===l.datum_params[5]&&0===l.datum_params[6]||(l.datum_type=2,l.datum_params[3]*=s,l.datum_params[4]*=s,l.datum_params[5]*=s,l.datum_params[6]=l.datum_params[6]/1e6+1))),a&&(l.datum_type=3,l.grids=a),l.a=r,l.b=n,l.es=i,l.ep2=o,l}(r.datumCode,r.datum_params,p.a,p.b,f.es,f.ep2,g);j(this,r),j(this,n),this.a=p.a,this.b=p.b,this.rf=p.rf,this.sphere=p.sphere,this.es=f.es,this.e=f.e,this.ep2=f.ep2,this.datum=y,"init"in this&&"function"==typeof this.init&&this.init(),t(null,this)}else t("Could not get projection name from: "+e)}else t("Could not parse to valid json: "+e)}me.projections=te,me.projections.start();const ye=me;function ve(e,t,r){var n,i,s,a,l=e.x,c=e.y,h=e.z?e.z:0;if(c<-o&&c>-1.001*o)c=-o;else if(c>o&&c<1.001*o)c=o;else{if(c<-o)return{x:-1/0,y:-1/0,z:e.z};if(c>o)return{x:1/0,y:1/0,z:e.z}}return l>Math.PI&&(l-=2*Math.PI),i=Math.sin(c),a=Math.cos(c),s=i*i,{x:((n=r/Math.sqrt(1-t*s))+h)*a*Math.cos(l),y:(n+h)*a*Math.sin(l),z:(n*(1-t)+h)*i}}function we(e,t,r,n){var i,s,o,a,l,c,h,u,d,p,f,g,A,m,y,v=e.x,w=e.y,b=e.z?e.z:0;if(i=Math.sqrt(v*v+w*w),s=Math.sqrt(v*v+w*w+b*b),i/r<1e-12){if(m=0,s/r<1e-12)return y=-n,{x:e.x,y:e.y,z:e.z}}else m=Math.atan2(w,v);o=b/s,u=(a=i/s)*(1-t)*(l=1/Math.sqrt(1-t*(2-t)*a*a)),d=o*l,A=0;do{A++,c=t*(h=r/Math.sqrt(1-t*d*d))/(h+(y=i*u+b*d-h*(1-t*d*d))),g=(f=o*(l=1/Math.sqrt(1-c*(2-c)*a*a)))*u-(p=a*(1-c)*l)*d,u=p,d=f}while(g*g>1e-24&&A<30);return{x:m,y:Math.atan(f/Math.abs(p)),z:y}}function be(e){return 1===e||2===e}function Ee(e,t,r){if(null===e.grids||0===e.grids.length)return console.log("Grid shift grids not found"),-1;var n={x:-r.x,y:r.y},i={x:Number.NaN,y:Number.NaN},s=[];e:for(var o=0;o<e.grids.length;o++){var a=e.grids[o];if(s.push(a.name),a.isNull){i=n;break}if(null!==a.grid)for(var l=a.grid.subgrids,h=0,u=l.length;h<u;h++){var d=l[h],p=(Math.abs(d.del[1])+Math.abs(d.del[0]))/1e4,f=d.ll[0]-p,g=d.ll[1]-p,A=d.ll[0]+(d.lim[0]-1)*d.del[0]+p,m=d.ll[1]+(d.lim[1]-1)*d.del[1]+p;if(!(g>n.y||f>n.x||m<n.y||A<n.x||(i=xe(n,t,d),isNaN(i.x))))break e}else if(a.mandatory)return console.log("Unable to find mandatory grid '"+a.name+"'"),-1}return isNaN(i.x)?(console.log("Failed to find a grid shift table for location '"+-n.x*c+" "+n.y*c+" tried: '"+s+"'"),-1):(r.x=-i.x,r.y=i.y,0)}function xe(e,t,r){var n={x:Number.NaN,y:Number.NaN};if(isNaN(e.x))return n;var i={x:e.x,y:e.y};i.x-=r.ll[0],i.y-=r.ll[1],i.x=H(i.x-Math.PI)+Math.PI;var s=Ce(i,r);if(t){if(isNaN(s.x))return n;s.x=i.x-s.x,s.y=i.y-s.y;var o,a,l=9;do{if(a=Ce(s,r),isNaN(a.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}o={x:i.x-(a.x+s.x),y:i.y-(a.y+s.y)},s.x+=o.x,s.y+=o.y}while(l--&&Math.abs(o.x)>1e-12&&Math.abs(o.y)>1e-12);if(l<0)return console.log("Inverse grid shift iterator failed to converge."),n;n.x=H(s.x+r.ll[0]),n.y=s.y+r.ll[1]}else isNaN(s.x)||(n.x=e.x+s.x,n.y=e.y+s.y);return n}function Ce(e,t){var r,n={x:e.x/t.del[0],y:e.y/t.del[1]},i=Math.floor(n.x),s=Math.floor(n.y),o=n.x-1*i,a=n.y-1*s,l={x:Number.NaN,y:Number.NaN};if(i<0||i>=t.lim[0])return l;if(s<0||s>=t.lim[1])return l;r=s*t.lim[0]+i;var c=t.cvs[r][0],h=t.cvs[r][1];r++;var u=t.cvs[r][0],d=t.cvs[r][1];r+=t.lim[0];var p=t.cvs[r][0],f=t.cvs[r][1];r--;var g=t.cvs[r][0],A=t.cvs[r][1],m=o*a,y=o*(1-a),v=(1-o)*(1-a),w=(1-o)*a;return l.x=v*c+y*u+w*g+m*p,l.y=v*h+y*d+w*A+m*f,l}function _e(e,t,r){var n,i,s,o=r.x,a=r.y,l=r.z||0,c={};for(s=0;s<3;s++)if(!t||2!==s||void 0!==r.z)switch(0===s?(n=o,i=-1!=="ew".indexOf(e.axis[s])?"x":"y"):1===s?(n=a,i=-1!=="ns".indexOf(e.axis[s])?"y":"x"):(n=l,i="z"),e.axis[s]){case"e":case"n":c[i]=n;break;case"w":case"s":c[i]=-n;break;case"u":void 0!==r[i]&&(c.z=n);break;case"d":void 0!==r[i]&&(c.z=-n);break;default:return null}return c}function Ie(e){var t={x:e[0],y:e[1]};return e.length>2&&(t.z=e[2]),e.length>3&&(t.m=e[3]),t}function Se(e){if("function"==typeof Number.isFinite){if(Number.isFinite(e))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof e||e!=e||!isFinite(e))throw new TypeError("coordinates must be finite numbers")}function Me(e,t,r,s){var o,a=void 0!==(r=Array.isArray(r)?Ie(r):{x:r.x,y:r.y,z:r.z,m:r.m}).z;if(function(e){Se(e.x),Se(e.y)}(r),e.datum&&t.datum&&function(e,t){return(1===e.datum.datum_type||2===e.datum.datum_type||3===e.datum.datum_type)&&"WGS84"!==t.datumCode||(1===t.datum.datum_type||2===t.datum.datum_type||3===t.datum.datum_type)&&"WGS84"!==e.datumCode}(e,t)&&(r=Me(e,o=new ye("WGS84"),r,s),e=o),s&&"enu"!==e.axis&&(r=_e(e,!1,r)),"longlat"===e.projName)r={x:r.x*l,y:r.y*l,z:r.z||0};else if(e.to_meter&&(r={x:r.x*e.to_meter,y:r.y*e.to_meter,z:r.z||0}),!(r=e.inverse(r)))return;if(e.from_greenwich&&(r.x+=e.from_greenwich),r=function(e,t,r){if(function(e,t){return e.datum_type===t.datum_type&&!(e.a!==t.a||Math.abs(e.es-t.es)>5e-11)&&(1===e.datum_type?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]:2!==e.datum_type||e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]&&e.datum_params[3]===t.datum_params[3]&&e.datum_params[4]===t.datum_params[4]&&e.datum_params[5]===t.datum_params[5]&&e.datum_params[6]===t.datum_params[6])}(e,t))return r;if(5===e.datum_type||5===t.datum_type)return r;var s=e.a,o=e.es;if(3===e.datum_type){if(0!==Ee(e,!1,r))return;s=n,o=i}var a=t.a,l=t.b,c=t.es;return 3===t.datum_type&&(a=n,l=6356752.314,c=i),o!==c||s!==a||be(e.datum_type)||be(t.datum_type)?(r=ve(r,o,s),be(e.datum_type)&&(r=function(e,t,r){if(1===t)return{x:e.x+r[0],y:e.y+r[1],z:e.z+r[2]};if(2===t){var n=r[0],i=r[1],s=r[2],o=r[3],a=r[4],l=r[5],c=r[6];return{x:c*(e.x-l*e.y+a*e.z)+n,y:c*(l*e.x+e.y-o*e.z)+i,z:c*(-a*e.x+o*e.y+e.z)+s}}}(r,e.datum_type,e.datum_params)),be(t.datum_type)&&(r=function(e,t,r){if(1===t)return{x:e.x-r[0],y:e.y-r[1],z:e.z-r[2]};if(2===t){var n=r[0],i=r[1],s=r[2],o=r[3],a=r[4],l=r[5],c=r[6],h=(e.x-n)/c,u=(e.y-i)/c,d=(e.z-s)/c;return{x:h+l*u-a*d,y:-l*h+u+o*d,z:a*h-o*u+d}}}(r,t.datum_type,t.datum_params)),r=we(r,c,a,l),3!==t.datum_type||0===Ee(t,!0,r)?r:void 0):r}(e.datum,t.datum,r))return t.from_greenwich&&(r={x:r.x-t.from_greenwich,y:r.y,z:r.z||0}),"longlat"===t.projName?r={x:r.x*c,y:r.y*c,z:r.z||0}:(r=t.forward(r),t.to_meter&&(r={x:r.x/t.to_meter,y:r.y/t.to_meter,z:r.z||0})),s&&"enu"!==t.axis?_e(t,!0,r):(r&&!a&&delete r.z,r)}var Te=ye("WGS84");function Be(e,t,r,n){var i,s,o;return Array.isArray(r)?(i=Me(e,t,r,n)||{x:NaN,y:NaN},r.length>2?void 0!==e.name&&"geocent"===e.name||void 0!==t.name&&"geocent"===t.name?"number"==typeof i.z?[i.x,i.y,i.z].concat(r.slice(3)):[i.x,i.y,r[2]].concat(r.slice(3)):[i.x,i.y].concat(r.slice(2)):[i.x,i.y]):(s=Me(e,t,r,n),2===(o=Object.keys(r)).length||o.forEach((function(n){if(void 0!==e.name&&"geocent"===e.name||void 0!==t.name&&"geocent"===t.name){if("x"===n||"y"===n||"z"===n)return}else if("x"===n||"y"===n)return;s[n]=r[n]})),s)}function Pe(e){return e instanceof ye?e:"object"==typeof e&&"oProj"in e?e.oProj:ye(e)}var Re="AJSAJS",De="AFAFAF",Le=65,ke=73,Oe=79;const Fe={forward:Ne,inverse:function(e){var t=ze(Ve(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]},toPoint:Ue};function Ne(e,t){return t=t||5,function(e,t){var r,n,i,s,o,a,l,c,h,u,d,p="00000"+e.easting,f="00000"+e.northing;return e.zoneNumber+e.zoneLetter+(h=e.easting,u=e.northing,d=je(e.zoneNumber),r=Math.floor(h/1e5),n=Math.floor(u/1e5)%20,s=Re.charCodeAt(i=d-1),o=De.charCodeAt(i),c=!1,(a=s+r-1)>90&&(a=a-90+Le-1,c=!0),(a===ke||s<ke&&a>ke||(a>ke||s<ke)&&c)&&a++,(a===Oe||s<Oe&&a>Oe||(a>Oe||s<Oe)&&c)&&++a===ke&&a++,a>90&&(a=a-90+Le-1),(l=o+n)>86?(l=l-86+Le-1,c=!0):c=!1,(l===ke||o<ke&&l>ke||(l>ke||o<ke)&&c)&&l++,(l===Oe||o<Oe&&l>Oe||(l>Oe||o<Oe)&&c)&&++l===ke&&l++,l>86&&(l=l-86+Le-1),String.fromCharCode(a)+String.fromCharCode(l))+p.substr(p.length-5,t)+f.substr(f.length-5,t)}(function(e){var t,r,n,i,s,o,a,l=e.lat,c=e.lon,h=6378137,u=.00669438,d=.9996,p=Qe(l),f=Qe(c);a=Math.floor((c+180)/6)+1,180===c&&(a=60),l>=56&&l<64&&c>=3&&c<12&&(a=32),l>=72&&l<84&&(c>=0&&c<9?a=31:c>=9&&c<21?a=33:c>=21&&c<33?a=35:c>=33&&c<42&&(a=37)),o=Qe(6*(a-1)-180+3),t=.006739496752268451,r=h/Math.sqrt(1-u*Math.sin(p)*Math.sin(p)),n=Math.tan(p)*Math.tan(p),i=t*Math.cos(p)*Math.cos(p);var g,A,m=d*r*((s=Math.cos(p)*(f-o))+(1-n+i)*s*s*s/6+(5-18*n+n*n+72*i-58*t)*s*s*s*s*s/120)+5e5,y=d*(h*(.9983242984503243*p-.002514607064228144*Math.sin(2*p)+2639046602129982e-21*Math.sin(4*p)-3.418046101696858e-9*Math.sin(6*p))+r*Math.tan(p)*(s*s/2+(5-n+9*i+4*i*i)*s*s*s*s/24+(61-58*n+n*n+600*i-2.2240339282485886)*s*s*s*s*s*s/720));return l<0&&(y+=1e7),{northing:Math.round(y),easting:Math.round(m),zoneNumber:a,zoneLetter:(g=l,A="Z",84>=g&&g>=72?A="X":72>g&&g>=64?A="W":64>g&&g>=56?A="V":56>g&&g>=48?A="U":48>g&&g>=40?A="T":40>g&&g>=32?A="S":32>g&&g>=24?A="R":24>g&&g>=16?A="Q":16>g&&g>=8?A="P":8>g&&g>=0?A="N":0>g&&g>=-8?A="M":-8>g&&g>=-16?A="L":-16>g&&g>=-24?A="K":-24>g&&g>=-32?A="J":-32>g&&g>=-40?A="H":-40>g&&g>=-48?A="G":-48>g&&g>=-56?A="F":-56>g&&g>=-64?A="E":-64>g&&g>=-72?A="D":-72>g&&g>=-80&&(A="C"),A)}}({lat:e[1],lon:e[0]}),t)}function Ue(e){var t=ze(Ve(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function Qe(e){return e*(Math.PI/180)}function Ge(e){return e/Math.PI*180}function ze(e){var t=e.northing,r=e.easting,n=e.zoneLetter,i=e.zoneNumber;if(i<0||i>60)return null;var s,o,a,l,c,h,u,d,p,f=.9996,g=6378137,A=.00669438,m=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),y=r-5e5,v=t;n<"N"&&(v-=1e7),u=6*(i-1)-180+3,s=.006739496752268451,p=(d=v/f/6367449.145945056)+(3*m/2-27*m*m*m/32)*Math.sin(2*d)+(21*m*m/16-55*m*m*m*m/32)*Math.sin(4*d)+151*m*m*m/96*Math.sin(6*d),o=g/Math.sqrt(1-A*Math.sin(p)*Math.sin(p)),a=Math.tan(p)*Math.tan(p),l=s*Math.cos(p)*Math.cos(p),c=.99330562*g/Math.pow(1-A*Math.sin(p)*Math.sin(p),1.5),h=y/(o*f);var w=p-o*Math.tan(p)/c*(h*h/2-(5+3*a+10*l-4*l*l-9*s)*h*h*h*h/24+(61+90*a+298*l+45*a*a-1.6983531815716497-3*l*l)*h*h*h*h*h*h/720);w=Ge(w);var b,E=(h-(1+2*a+l)*h*h*h/6+(5-2*l+28*a-3*l*l+8*s+24*a*a)*h*h*h*h*h/120)/Math.cos(p);if(E=u+Ge(E),e.accuracy){var x=ze({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});b={top:x.lat,right:x.lon,bottom:w,left:E}}else b={lat:w,lon:E};return b}function je(e){var t=e%6;return 0===t&&(t=6),t}function Ve(e){if(e&&0===e.length)throw"MGRSPoint coverting from nothing";for(var t,r=e.length,n=null,i="",s=0;!/[A-Z]/.test(t=e.charAt(s));){if(s>=2)throw"MGRSPoint bad conversion from: "+e;i+=t,s++}var o=parseInt(i,10);if(0===s||s+3>r)throw"MGRSPoint bad conversion from: "+e;var a=e.charAt(s++);if(a<="A"||"B"===a||"Y"===a||a>="Z"||"I"===a||"O"===a)throw"MGRSPoint zone letter "+a+" not handled: "+e;n=e.substring(s,s+=2);for(var l=je(o),c=function(e,t){for(var r=Re.charCodeAt(t-1),n=1e5,i=!1;r!==e.charCodeAt(0);){if(++r===ke&&r++,r===Oe&&r++,r>90){if(i)throw"Bad character: "+e;r=Le,i=!0}n+=1e5}return n}(n.charAt(0),l),h=function(e,t){if(e>"V")throw"MGRSPoint given invalid Northing "+e;for(var r=De.charCodeAt(t-1),n=0,i=!1;r!==e.charCodeAt(0);){if(++r===ke&&r++,r===Oe&&r++,r>86){if(i)throw"Bad character: "+e;r=Le,i=!0}n+=1e5}return n}(n.charAt(1),l);h<qe(a);)h+=2e6;var u=r-s;if(u%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+e;var d,p,f,g=u/2,A=0,m=0;return g>0&&(d=1e5/Math.pow(10,g),p=e.substring(s,s+g),A=parseFloat(p)*d,f=e.substring(s+g),m=parseFloat(f)*d),{easting:A+c,northing:m+h,zoneLetter:a,zoneNumber:o,accuracy:d}}function qe(e){var t;switch(e){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+e}function He(e,t,r){if(!(this instanceof He))return new He(e,t,r);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if("object"==typeof e)this.x=e.x,this.y=e.y,this.z=e.z||0;else if("string"==typeof e&&void 0===t){var n=e.split(",");this.x=parseFloat(n[0]),this.y=parseFloat(n[1]),this.z=parseFloat(n[2])||0}else this.x=e,this.y=t,this.z=r||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}He.fromMGRS=function(e){return new He(Ue(e))},He.prototype.toMGRS=function(e){return Ne([this.x,this.y],e)};const We=He;var $e=.046875,Ye=.01953125,Ke=.01068115234375;function Je(e){var t=[];t[0]=1-e*(.25+e*($e+e*(Ye+e*Ke))),t[1]=e*(.75-e*($e+e*(Ye+e*Ke)));var r=e*e;return t[2]=r*(.46875-e*(.013020833333333334+.007120768229166667*e)),r*=e,t[3]=r*(.3645833333333333-.005696614583333333*e),t[4]=r*e*.3076171875,t}function Xe(e,t,r,n){return r*=t,t*=t,n[0]*e-r*(n[1]+t*(n[2]+t*(n[3]+t*n[4])))}function Ze(e,t,r){for(var n=1/(1-t),i=e,s=20;s;--s){var o=Math.sin(i),l=1-t*o*o;if(i-=l=(Xe(i,o,Math.cos(i),r)-e)*(l*Math.sqrt(l))*n,Math.abs(l)<a)return i}return i}const et={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=Je(this.es),this.ml0=Xe(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(e){var t,r,n,i=e.x,s=e.y,o=H(i-this.long0),l=Math.sin(s),c=Math.cos(s);if(this.es){var h=c*o,u=Math.pow(h,2),d=this.ep2*Math.pow(c,2),p=Math.pow(d,2),f=Math.abs(c)>a?Math.tan(s):0,g=Math.pow(f,2),A=Math.pow(g,2);t=1-this.es*Math.pow(l,2),h/=Math.sqrt(t);var m=Xe(s,l,c,this.en);r=this.a*(this.k0*h*(1+u/6*(1-g+d+u/20*(5-18*g+A+14*d-58*g*d+u/42*(61+179*A-A*g-479*g)))))+this.x0,n=this.a*(this.k0*(m-this.ml0+l*o*h/2*(1+u/12*(5-g+9*d+4*p+u/30*(61+A-58*g+270*d-330*g*d+u/56*(1385+543*A-A*g-3111*g))))))+this.y0}else{var y=c*Math.sin(o);if(Math.abs(Math.abs(y)-1)<a)return 93;if(r=.5*this.a*this.k0*Math.log((1+y)/(1-y))+this.x0,n=c*Math.cos(o)/Math.sqrt(1-Math.pow(y,2)),(y=Math.abs(n))>=1){if(y-1>a)return 93;n=0}else n=Math.acos(n);s<0&&(n=-n),n=this.a*this.k0*(n-this.lat0)+this.y0}return e.x=r,e.y=n,e},inverse:function(e){var t,r,n,i,s=(e.x-this.x0)*(1/this.a),l=(e.y-this.y0)*(1/this.a);if(this.es)if(r=Ze(t=this.ml0+l/this.k0,this.es,this.en),Math.abs(r)<o){var c=Math.sin(r),h=Math.cos(r),u=Math.abs(h)>a?Math.tan(r):0,d=this.ep2*Math.pow(h,2),p=Math.pow(d,2),f=Math.pow(u,2),g=Math.pow(f,2);t=1-this.es*Math.pow(c,2);var A=s*Math.sqrt(t)/this.k0,m=Math.pow(A,2);n=r-(t*=u)*m/(1-this.es)*.5*(1-m/12*(5+3*f-9*d*f+d-4*p-m/30*(61+90*f-252*d*f+45*g+46*d-m/56*(1385+3633*f+4095*g+1574*g*f)))),i=H(this.long0+A*(1-m/6*(1+2*f+d-m/20*(5+28*f+24*g+8*d*f+6*d-m/42*(61+662*f+1320*g+720*g*f))))/h)}else n=o*q(l),i=0;else{var y=Math.exp(s/this.k0),v=.5*(y-1/y),w=this.lat0+l/this.k0,b=Math.cos(w);t=Math.sqrt((1-Math.pow(b,2))/(1+Math.pow(v,2))),n=Math.asin(t),l<0&&(n=-n),i=0===v&&0===b?0:H(Math.atan2(v,b)+this.long0)}return e.x=i,e.y=n,e},names:["Fast_Transverse_Mercator","Fast Transverse Mercator"]};function tt(e){var t=Math.exp(e);return(t-1/t)/2}function rt(e,t){e=Math.abs(e),t=Math.abs(t);var r=Math.max(e,t),n=Math.min(e,t)/(r||1);return r*Math.sqrt(1+Math.pow(n,2))}function nt(e,t){for(var r,n=2*Math.cos(2*t),i=e.length-1,s=e[i],o=0;--i>=0;)r=n*s-o+e[i],o=s,s=r;return t+r*Math.sin(2*t)}function it(e,t,r){for(var n,i,s=Math.sin(t),o=Math.cos(t),a=tt(r),l=function(e){var t=Math.exp(e);return(t+1/t)/2}(r),c=2*o*l,h=-2*s*a,u=e.length-1,d=e[u],p=0,f=0,g=0;--u>=0;)n=f,i=p,d=c*(f=d)-n-h*(p=g)+e[u],g=h*f-i+c*p;return[(c=s*l)*d-(h=o*a)*g,c*g+h*d]}const st={init:function(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(et.init.apply(this),this.forward=et.forward,this.inverse=et.inverse),this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=this.es/(1+Math.sqrt(1-this.es)),t=e/(2-e),r=t;this.cgb[0]=t*(2+t*(-2/3+t*(t*(116/45+t*(26/45+t*(-2854/675)))-2))),this.cbg[0]=t*(t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))-2),r*=t,this.cgb[1]=r*(7/3+t*(t*(-227/45+t*(2704/315+t*(2323/945)))-1.6)),this.cbg[1]=r*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),r*=t,this.cgb[2]=r*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=r*(-26/15+t*(34/21+t*(1.6+t*(-12686/2835)))),r*=t,this.cgb[3]=r*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=r*(1237/630+t*(t*(-24832/14175)-2.4)),r*=t,this.cgb[4]=r*(4174/315+t*(-144838/6237)),this.cbg[4]=r*(-734/315+t*(109598/31185)),r*=t,this.cgb[5]=r*(601676/22275),this.cbg[5]=r*(444337/155925),r=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+r*(1/4+r*(1/64+r/256))),this.utg[0]=t*(t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))-.5),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=r*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=r*(13/48+t*(t*(557/1440+t*(281/630+t*(-1983433/1935360)))-.6)),r*=t,this.utg[2]=r*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=r*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),r*=t,this.utg[3]=r*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=r*(49561/161280+t*(-179/168+t*(6601661/7257600))),r*=t,this.utg[4]=r*(-4583/161280+t*(108847/3991680)),this.gtu[4]=r*(34729/80640+t*(-3418889/1995840)),r*=t,this.utg[5]=r*(-20648693/638668800),this.gtu[5]=.6650675310896665*r;var n=nt(this.cbg,this.lat0);this.Zb=-this.Qn*(n+function(e,t){for(var r,n=2*Math.cos(t),i=e.length-1,s=e[i],o=0;--i>=0;)r=n*s-o+e[i],o=s,s=r;return Math.sin(t)*r}(this.gtu,2*n))},forward:function(e){var t=H(e.x-this.long0),r=e.y;r=nt(this.cbg,r);var n=Math.sin(r),i=Math.cos(r),s=Math.sin(t),o=Math.cos(t);r=Math.atan2(n,o*i),t=Math.atan2(s*i,rt(n,i*o)),t=function(e){var t=Math.abs(e);return t=function(e){var t=1+e,r=t-1;return 0===r?e:e*Math.log(t)/r}(t*(1+t/(rt(1,t)+1))),e<0?-t:t}(Math.tan(t));var a,l,c=it(this.gtu,2*r,2*t);return r+=c[0],t+=c[1],Math.abs(t)<=2.623395162778?(a=this.a*(this.Qn*t)+this.x0,l=this.a*(this.Qn*r+this.Zb)+this.y0):(a=1/0,l=1/0),e.x=a,e.y=l,e},inverse:function(e){var t,r,n=(e.x-this.x0)*(1/this.a),i=(e.y-this.y0)*(1/this.a);if(i=(i-this.Zb)/this.Qn,n/=this.Qn,Math.abs(n)<=2.623395162778){var s=it(this.utg,2*i,2*n);i+=s[0],n+=s[1],n=Math.atan(tt(n));var o=Math.sin(i),a=Math.cos(i),l=Math.sin(n),c=Math.cos(n);i=Math.atan2(o*c,rt(l,c*a)),t=H((n=Math.atan2(l,c*a))+this.long0),r=nt(this.cgb,i)}else t=1/0,r=1/0;return e.x=t,e.y=r,e},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"]},ot={init:function(){var e=function(e,t){if(void 0===e){if((e=Math.floor(30*(H(t)+Math.PI)/Math.PI)+1)<0)return 0;if(e>60)return 60}return e}(this.zone,this.long0);if(void 0===e)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*l,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,st.init.apply(this),this.forward=st.forward,this.inverse=st.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function at(e,t){return Math.pow((1-e)/(1+e),t)}const lt={init:function(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+h)/(Math.pow(Math.tan(.5*this.lat0+h),this.C)*at(this.e*e,this.ratexp))},forward:function(e){var t=e.x,r=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*r+h),this.C)*at(this.e*Math.sin(r),this.ratexp))-o,e.x=this.C*t,e},inverse:function(e){for(var t=e.x/this.C,r=e.y,n=Math.pow(Math.tan(.5*r+h)/this.K,1/this.C),i=20;i>0&&(r=2*Math.atan(n*at(this.e*Math.sin(e.y),-.5*this.e))-o,!(Math.abs(r-e.y)<1e-14));--i)e.y=r;return i?(e.x=t,e.y=r,e):null},names:["gauss"]},ct={init:function(){lt.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(e){var t,r,n,i;return e.x=H(e.x-this.long0),lt.forward.apply(this,[e]),t=Math.sin(e.y),r=Math.cos(e.y),n=Math.cos(e.x),i=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*r*n),e.x=i*r*Math.sin(e.x),e.y=i*(this.cosc0*t-this.sinc0*r*n),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e},inverse:function(e){var t,r,n,i,s;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,s=rt(e.x,e.y)){var o=2*Math.atan2(s,this.R2);t=Math.sin(o),r=Math.cos(o),i=Math.asin(r*this.sinc0+e.y*t*this.cosc0/s),n=Math.atan2(e.x*t,s*this.cosc0*r-e.y*this.sinc0*t)}else i=this.phic0,n=0;return e.x=n,e.y=i,lt.inverse.apply(this,[e]),e.x=H(e.x+this.long0),e},names:["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]};function ht(e,t,r){return t*=r,Math.tan(.5*(o+e))*Math.pow((1-t)/(1+t),.5*r)}const ut={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=a&&(this.k0=.5*(1+q(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=a&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=a&&Math.abs(Math.cos(this.lat_ts))>a&&(this.k0=.5*this.cons*V(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/W(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=V(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(ht(this.lat0,this.sinlat0,this.e))-o,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(e){var t,r,n,i,s,l,c=e.x,h=e.y,u=Math.sin(h),d=Math.cos(h),p=H(c-this.long0);return Math.abs(Math.abs(c-this.long0)-Math.PI)<=a&&Math.abs(h+this.lat0)<=a?(e.x=NaN,e.y=NaN,e):this.sphere?(t=2*this.k0/(1+this.sinlat0*u+this.coslat0*d*Math.cos(p)),e.x=this.a*t*d*Math.sin(p)+this.x0,e.y=this.a*t*(this.coslat0*u-this.sinlat0*d*Math.cos(p))+this.y0,e):(r=2*Math.atan(ht(h,u,this.e))-o,i=Math.cos(r),n=Math.sin(r),Math.abs(this.coslat0)<=a?(s=W(this.e,h*this.con,this.con*u),l=2*this.a*this.k0*s/this.cons,e.x=this.x0+l*Math.sin(c-this.long0),e.y=this.y0-this.con*l*Math.cos(c-this.long0),e):(Math.abs(this.sinlat0)<a?(t=2*this.a*this.k0/(1+i*Math.cos(p)),e.y=t*n):(t=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*n+this.cosX0*i*Math.cos(p))),e.y=t*(this.cosX0*n-this.sinX0*i*Math.cos(p))+this.y0),e.x=t*i*Math.sin(p)+this.x0,e))},inverse:function(e){var t,r,n,i,s;e.x-=this.x0,e.y-=this.y0;var l=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var c=2*Math.atan(l/(2*this.a*this.k0));return t=this.long0,r=this.lat0,l<=a?(e.x=t,e.y=r,e):(r=Math.asin(Math.cos(c)*this.sinlat0+e.y*Math.sin(c)*this.coslat0/l),t=Math.abs(this.coslat0)<a?this.lat0>0?H(this.long0+Math.atan2(e.x,-1*e.y)):H(this.long0+Math.atan2(e.x,e.y)):H(this.long0+Math.atan2(e.x*Math.sin(c),l*this.coslat0*Math.cos(c)-e.y*this.sinlat0*Math.sin(c))),e.x=t,e.y=r,e)}if(Math.abs(this.coslat0)<=a){if(l<=a)return r=this.lat0,t=this.long0,e.x=t,e.y=r,e;e.x*=this.con,e.y*=this.con,n=l*this.cons/(2*this.a*this.k0),r=this.con*$(this.e,n),t=this.con*H(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else i=2*Math.atan(l*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,l<=a?s=this.X0:(s=Math.asin(Math.cos(i)*this.sinX0+e.y*Math.sin(i)*this.cosX0/l),t=H(this.long0+Math.atan2(e.x*Math.sin(i),l*this.cosX0*Math.cos(i)-e.y*this.sinX0*Math.sin(i)))),r=-1*$(this.e,Math.tan(.5*(o+s)));return e.x=t,e.y=r,e},names:["stere","Stereographic_South_Pole","Polar_Stereographic_variant_A","Polar_Stereographic_variant_B","Polar_Stereographic"],ssfn_:ht},dt={init:function(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),r=this.a,n=1/this.rf,i=2*n-Math.pow(n,2),s=this.e=Math.sqrt(i);this.R=this.k0*r*Math.sqrt(1-i)/(1-i*Math.pow(t,2)),this.alpha=Math.sqrt(1+i/(1-i)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),a=Math.log(Math.tan(Math.PI/4+e/2)),l=Math.log((1+s*t)/(1-s*t));this.K=o-this.alpha*a+this.alpha*s/2*l},forward:function(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),r=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),n=-this.alpha*(t+r)+this.K,i=2*(Math.atan(Math.exp(n))-Math.PI/4),s=this.alpha*(e.x-this.lambda0),o=Math.atan(Math.sin(s)/(Math.sin(this.b0)*Math.tan(i)+Math.cos(this.b0)*Math.cos(s))),a=Math.asin(Math.cos(this.b0)*Math.sin(i)-Math.sin(this.b0)*Math.cos(i)*Math.cos(s));return e.y=this.R/2*Math.log((1+Math.sin(a))/(1-Math.sin(a)))+this.y0,e.x=this.R*o+this.x0,e},inverse:function(e){for(var t=e.x-this.x0,r=e.y-this.y0,n=t/this.R,i=2*(Math.atan(Math.exp(r/this.R))-Math.PI/4),s=Math.asin(Math.cos(this.b0)*Math.sin(i)+Math.sin(this.b0)*Math.cos(i)*Math.cos(n)),o=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(i))),a=this.lambda0+o/this.alpha,l=0,c=s,h=-1e3,u=0;Math.abs(c-h)>1e-7;){if(++u>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+s/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2)),h=c,c=2*Math.atan(Math.exp(l))-Math.PI/2}return e.x=a,e.y=c,e},names:["somerc"]};var pt=1e-7;const ft={init:function(){var e,t,r,n,i,s,l,c,d,p,f,g,A,m,y=0,v=0,w=0,b=0,E=0,x=0,C=0;this.no_off=(A=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],m="object"==typeof(g=this).projName?Object.keys(g.projName)[0]:g.projName,"no_uoff"in g||"no_off"in g||-1!==A.indexOf(m)||-1!==A.indexOf(ee(m))),this.no_rot="no_rot"in this;var _=!1;"alpha"in this&&(_=!0);var I=!1;if("rectified_grid_angle"in this&&(I=!0),_&&(C=this.alpha),I&&(y=this.rectified_grid_angle),_||I)v=this.longc;else if(w=this.long1,E=this.lat1,b=this.long2,x=this.lat2,Math.abs(E-x)<=pt||(e=Math.abs(E))<=pt||Math.abs(e-o)<=pt||Math.abs(Math.abs(this.lat0)-o)<=pt||Math.abs(Math.abs(x)-o)<=pt)throw new Error;var S=1-this.es;t=Math.sqrt(S),Math.abs(this.lat0)>a?(c=Math.sin(this.lat0),r=Math.cos(this.lat0),e=1-this.es*c*c,this.B=r*r,this.B=Math.sqrt(1+this.es*this.B*this.B/S),this.A=this.B*this.k0*t/e,(i=(n=this.B*t/(r*Math.sqrt(e)))*n-1)<=0?i=0:(i=Math.sqrt(i),this.lat0<0&&(i=-i)),this.E=i+=n,this.E*=Math.pow(W(this.e,this.lat0,c),this.B)):(this.B=1/t,this.A=this.k0,this.E=n=i=1),_||I?(_?(f=Math.asin(Math.sin(C)/n),I||(y=C)):(f=y,C=Math.asin(n*Math.sin(f))),this.lam0=v-Math.asin(.5*(i-1/i)*Math.tan(f))/this.B):(s=Math.pow(W(this.e,E,Math.sin(E)),this.B),l=Math.pow(W(this.e,x,Math.sin(x)),this.B),i=this.E/s,d=(l-s)/(l+s),p=((p=this.E*this.E)-l*s)/(p+l*s),(e=w-b)<-Math.PI?b-=u:e>Math.PI&&(b+=u),this.lam0=H(.5*(w+b)-Math.atan(p*Math.tan(.5*this.B*(w-b))/d)/this.B),f=Math.atan(2*Math.sin(this.B*H(w-this.lam0))/(i-1/i)),y=C=Math.asin(n*Math.sin(f))),this.singam=Math.sin(f),this.cosgam=Math.cos(f),this.sinrot=Math.sin(y),this.cosrot=Math.cos(y),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(n*n-1)/Math.cos(C))),this.lat0<0&&(this.u_0=-this.u_0)),i=.5*f,this.v_pole_n=this.ArB*Math.log(Math.tan(h-i)),this.v_pole_s=this.ArB*Math.log(Math.tan(h+i))},forward:function(e){var t,r,n,i,s,l,c,h,u={};if(e.x=e.x-this.lam0,Math.abs(Math.abs(e.y)-o)>a){if(t=.5*((s=this.E/Math.pow(W(this.e,e.y,Math.sin(e.y)),this.B))-(l=1/s)),r=.5*(s+l),i=Math.sin(this.B*e.x),n=(t*this.singam-i*this.cosgam)/r,Math.abs(Math.abs(n)-1)<a)throw new Error;h=.5*this.ArB*Math.log((1-n)/(1+n)),l=Math.cos(this.B*e.x),c=Math.abs(l)<pt?this.A*e.x:this.ArB*Math.atan2(t*this.cosgam+i*this.singam,l)}else h=e.y>0?this.v_pole_n:this.v_pole_s,c=this.ArB*e.y;return this.no_rot?(u.x=c,u.y=h):(c-=this.u_0,u.x=h*this.cosrot+c*this.sinrot,u.y=c*this.cosrot-h*this.sinrot),u.x=this.a*u.x+this.x0,u.y=this.a*u.y+this.y0,u},inverse:function(e){var t,r,n,i,s,l,c,h={};if(e.x=(e.x-this.x0)*(1/this.a),e.y=(e.y-this.y0)*(1/this.a),this.no_rot?(r=e.y,t=e.x):(r=e.x*this.cosrot-e.y*this.sinrot,t=e.y*this.cosrot+e.x*this.sinrot+this.u_0),i=.5*((n=Math.exp(-this.BrA*r))-1/n),s=.5*(n+1/n),c=((l=Math.sin(this.BrA*t))*this.cosgam+i*this.singam)/s,Math.abs(Math.abs(c)-1)<a)h.x=0,h.y=c<0?-o:o;else{if(h.y=this.E/Math.sqrt((1+c)/(1-c)),h.y=$(this.e,Math.pow(h.y,1/this.B)),h.y===1/0)throw new Error;h.x=-this.rB*Math.atan2(i*this.cosgam-l*this.singam,Math.cos(this.BrA*t))}return h.x+=this.lam0,h},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Variant_B","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"]},gt={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<a)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),r=Math.cos(this.lat1),n=V(this.e,t,r),i=W(this.e,this.lat1,t),s=Math.sin(this.lat2),l=Math.cos(this.lat2),c=V(this.e,s,l),h=W(this.e,this.lat2,s),u=Math.abs(Math.abs(this.lat0)-o)<a?0:W(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>a?this.ns=Math.log(n/c)/Math.log(i/h):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=n/(this.ns*Math.pow(i,this.ns)),this.rh=this.a*this.f0*Math.pow(u,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(e){var t=e.x,r=e.y;Math.abs(2*Math.abs(r)-Math.PI)<=a&&(r=q(r)*(o-2e-10));var n,i,s=Math.abs(Math.abs(r)-o);if(s>a)n=W(this.e,r,Math.sin(r)),i=this.a*this.f0*Math.pow(n,this.ns);else{if((s=r*this.ns)<=0)return null;i=0}var l=this.ns*H(t-this.long0);return e.x=this.k0*(i*Math.sin(l))+this.x0,e.y=this.k0*(this.rh-i*Math.cos(l))+this.y0,e},inverse:function(e){var t,r,n,i,s,a=(e.x-this.x0)/this.k0,l=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(a*a+l*l),r=1):(t=-Math.sqrt(a*a+l*l),r=-1);var c=0;if(0!==t&&(c=Math.atan2(r*a,r*l)),0!==t||this.ns>0){if(r=1/this.ns,n=Math.pow(t/(this.a*this.f0),r),-9999===(i=$(this.e,n)))return null}else i=-o;return s=H(c/this.ns+this.long0),e.x=s,e.y=i,e},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"]},At={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(e){var t,r,n,i,s,o,a,l=e.x,c=e.y,h=H(l-this.long0);return t=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2),r=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/t)-this.s45),n=-h*this.alfa,i=Math.asin(Math.cos(this.ad)*Math.sin(r)+Math.sin(this.ad)*Math.cos(r)*Math.cos(n)),s=Math.asin(Math.cos(r)*Math.sin(n)/Math.cos(i)),o=this.n*s,a=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n),e.y=a*Math.cos(o)/1,e.x=a*Math.sin(o)/1,this.czech||(e.y*=-1,e.x*=-1),e},inverse:function(e){var t,r,n,i,s,o,a,l=e.x;e.x=e.y,e.y=l,this.czech||(e.y*=-1,e.x*=-1),s=Math.sqrt(e.x*e.x+e.y*e.y),i=Math.atan2(e.y,e.x)/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/s,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(i)),r=Math.asin(Math.cos(n)*Math.sin(i)/Math.cos(t)),e.x=this.long0-r/this.alfa,o=t,a=0;var c=0;do{e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-e.y)<1e-10&&(a=1),o=e.y,c+=1}while(0===a&&c<15);return c>=15?null:e},names:["Krovak","krovak"]};function mt(e,t,r,n,i){return e*i-t*Math.sin(2*i)+r*Math.sin(4*i)-n*Math.sin(6*i)}function yt(e){return 1-.25*e*(1+e/16*(3+1.25*e))}function vt(e){return.375*e*(1+.25*e*(1+.46875*e))}function wt(e){return.05859375*e*e*(1+.75*e)}function bt(e){return e*e*e*(35/3072)}function Et(e,t,r){var n=t*r;return e/Math.sqrt(1-n*n)}function xt(e){return Math.abs(e)<o?e:e-q(e)*Math.PI}function Ct(e,t,r,n,i){var s,o;s=e/t;for(var a=0;a<15;a++)if(s+=o=(e-(t*s-r*Math.sin(2*s)+n*Math.sin(4*s)-i*Math.sin(6*s)))/(t-2*r*Math.cos(2*s)+4*n*Math.cos(4*s)-6*i*Math.cos(6*s)),Math.abs(o)<=1e-10)return s;return NaN}const _t={init:function(){this.sphere||(this.e0=yt(this.es),this.e1=vt(this.es),this.e2=wt(this.es),this.e3=bt(this.es),this.ml0=this.a*mt(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(e){var t,r,n=e.x,i=e.y;if(n=H(n-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(i)*Math.sin(n)),r=this.a*(Math.atan2(Math.tan(i),Math.cos(n))-this.lat0);else{var s=Math.sin(i),o=Math.cos(i),a=Et(this.a,this.e,s),l=Math.tan(i)*Math.tan(i),c=n*Math.cos(i),h=c*c,u=this.es*o*o/(1-this.es);t=a*c*(1-h*l*(1/6-(8-l+8*u)*h/120)),r=this.a*mt(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+a*s/o*h*(.5+(5-l+6*u)*h/24)}return e.x=t+this.x0,e.y=r+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,r,n=e.x/this.a,i=e.y/this.a;if(this.sphere){var s=i+this.lat0;t=Math.asin(Math.sin(s)*Math.cos(n)),r=Math.atan2(Math.tan(n),Math.cos(s))}else{var l=Ct(this.ml0/this.a+i,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(l)-o)<=a)return e.x=this.long0,e.y=o,i<0&&(e.y*=-1),e;var c=Et(this.a,this.e,Math.sin(l)),h=c*c*c/this.a/this.a*(1-this.es),u=Math.pow(Math.tan(l),2),d=n*this.a/c,p=d*d;t=l-c*Math.tan(l)/h*d*d*(.5-(1+3*u)*d*d/24),r=d*(1-p*(u/3+(1+3*u)*u*p/15))/Math.cos(l)}return e.x=H(r+this.long0),e.y=xt(t),e},names:["Cassini","Cassini_Soldner","cass"]};function It(e,t){var r;return e>1e-7?(1-e*e)*(t/(1-(r=e*t)*r)-.5/e*Math.log((1-r)/(1+r))):2*t}const St={init:function(){var e,t=Math.abs(this.lat0);if(Math.abs(t-o)<a?this.mode=this.lat0<0?1:2:Math.abs(t)<a?this.mode=3:this.mode=4,this.es>0)switch(this.qp=It(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(e){var t,r=[];return r[0]=.3333333333333333*e,t=e*e,r[0]+=.17222222222222222*t,r[1]=.06388888888888888*t,t*=e,r[0]+=.10257936507936508*t,r[1]+=.0664021164021164*t,r[2]=.016415012942191543*t,r}(this.es),this.mode){case 2:case 1:this.dd=1;break;case 3:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case 4:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=It(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else 4===this.mode&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(e){var t,r,n,i,s,l,c,u,d,p,f=e.x,g=e.y;if(f=H(f-this.long0),this.sphere){if(s=Math.sin(g),p=Math.cos(g),n=Math.cos(f),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((r=this.mode===this.EQUIT?1+p*n:1+this.sinph0*s+this.cosph0*p*n)<=a)return null;t=(r=Math.sqrt(2/r))*p*Math.sin(f),r*=this.mode===this.EQUIT?s:this.cosph0*s-this.sinph0*p*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(g+this.lat0)<a)return null;r=h-.5*g,t=(r=2*(this.mode===this.S_POLE?Math.cos(r):Math.sin(r)))*Math.sin(f),r*=n}}else{switch(c=0,u=0,d=0,n=Math.cos(f),i=Math.sin(f),s=Math.sin(g),l=It(this.e,s),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(c=l/this.qp,u=Math.sqrt(1-c*c)),this.mode){case this.OBLIQ:d=1+this.sinb1*c+this.cosb1*u*n;break;case this.EQUIT:d=1+u*n;break;case this.N_POLE:d=o+g,l=this.qp-l;break;case this.S_POLE:d=g-o,l=this.qp+l}if(Math.abs(d)<a)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:d=Math.sqrt(2/d),r=this.mode===this.OBLIQ?this.ymf*d*(this.cosb1*c-this.sinb1*u*n):(d=Math.sqrt(2/(1+u*n)))*c*this.ymf,t=this.xmf*d*u*i;break;case this.N_POLE:case this.S_POLE:l>=0?(t=(d=Math.sqrt(l))*i,r=n*(this.mode===this.S_POLE?d:-d)):t=r=0}}return e.x=this.a*t+this.x0,e.y=this.a*r+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,r,n,i,s,l,c,h,u,d,p=e.x/this.a,f=e.y/this.a;if(this.sphere){var g,A=0,m=0;if((r=.5*(g=Math.sqrt(p*p+f*f)))>1)return null;switch(r=2*Math.asin(r),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(m=Math.sin(r),A=Math.cos(r)),this.mode){case this.EQUIT:r=Math.abs(g)<=a?0:Math.asin(f*m/g),p*=m,f=A*g;break;case this.OBLIQ:r=Math.abs(g)<=a?this.lat0:Math.asin(A*this.sinph0+f*m*this.cosph0/g),p*=m*this.cosph0,f=(A-Math.sin(r)*this.sinph0)*g;break;case this.N_POLE:f=-f,r=o-r;break;case this.S_POLE:r-=o}t=0!==f||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(p,f):0}else{if(c=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(p/=this.dd,f*=this.dd,(l=Math.sqrt(p*p+f*f))<a)return e.x=this.long0,e.y=this.lat0,e;i=2*Math.asin(.5*l/this.rq),n=Math.cos(i),p*=i=Math.sin(i),this.mode===this.OBLIQ?(c=n*this.sinb1+f*i*this.cosb1/l,s=this.qp*c,f=l*this.cosb1*n-f*this.sinb1*i):(c=f*i/l,s=this.qp*c,f=l*n)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(f=-f),!(s=p*p+f*f))return e.x=this.long0,e.y=this.lat0,e;c=1-s/this.qp,this.mode===this.S_POLE&&(c=-c)}t=Math.atan2(p,f),d=(h=Math.asin(c))+h,r=h+(u=this.apa)[0]*Math.sin(d)+u[1]*Math.sin(d+d)+u[2]*Math.sin(d+d+d)}return e.x=H(this.long0+t),e.y=r,e},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function Mt(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)}const Tt={init:function(){Math.abs(this.lat1+this.lat2)<a||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=V(this.e3,this.sin_po,this.cos_po),this.qs1=It(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=V(this.e3,this.sin_po,this.cos_po),this.qs2=It(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=It(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>a?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(e){var t=e.x,r=e.y;this.sin_phi=Math.sin(r),this.cos_phi=Math.cos(r);var n=It(this.e3,this.sin_phi),i=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,s=this.ns0*H(t-this.long0),o=i*Math.sin(s)+this.x0,a=this.rh-i*Math.cos(s)+this.y0;return e.x=o,e.y=a,e},inverse:function(e){var t,r,n,i,s,o;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),n=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),n=-1),i=0,0!==t&&(i=Math.atan2(n*e.x,n*e.y)),n=t*this.ns0/this.a,this.sphere?o=Math.asin((this.c-n*n)/(2*this.ns0)):(r=(this.c-n*n)/this.ns0,o=this.phi1z(this.e3,r)),s=H(i/this.ns0+this.long0),e.x=s,e.y=o,e},names:["Albers_Conic_Equal_Area","Albers_Equal_Area","Albers","aea"],phi1z:function(e,t){var r,n,i,s,o=Mt(.5*t);if(e<a)return o;for(var l=e*e,c=1;c<=25;c++)if(o+=s=.5*(i=1-(n=e*(r=Math.sin(o)))*n)*i/Math.cos(o)*(t/(1-l)-r/i+.5/e*Math.log((1-n)/(1+n))),Math.abs(s)<=1e-7)return o;return null}},Bt={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(e){var t,r,n,i,s,o,l,c=e.x,h=e.y;return n=H(c-this.long0),t=Math.sin(h),r=Math.cos(h),i=Math.cos(n),(s=this.sin_p14*t+this.cos_p14*r*i)>0||Math.abs(s)<=a?(o=this.x0+1*this.a*r*Math.sin(n)/s,l=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*r*i)/s):(o=this.x0+this.infinity_dist*r*Math.sin(n),l=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*r*i)),e.x=o,e.y=l,e},inverse:function(e){var t,r,n,i,s,o;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(i=Math.atan2(t,this.rc),r=Math.sin(i),o=Mt((n=Math.cos(i))*this.sin_p14+e.y*r*this.cos_p14/t),s=Math.atan2(e.x*r,t*this.cos_p14*n-e.y*this.sin_p14*r),s=H(this.long0+s)):(o=this.phic0,s=0),e.x=s,e.y=o,e},names:["gnom"]},Pt={init:function(){this.sphere||(this.k0=V(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(e){var t,r,n=e.x,i=e.y,s=H(n-this.long0);if(this.sphere)t=this.x0+this.a*s*Math.cos(this.lat_ts),r=this.y0+this.a*Math.sin(i)/Math.cos(this.lat_ts);else{var o=It(this.e,Math.sin(i));t=this.x0+this.a*this.k0*s,r=this.y0+this.a*o*.5/this.k0}return e.x=t,e.y=r,e},inverse:function(e){var t,r;return e.x-=this.x0,e.y-=this.y0,this.sphere?(t=H(this.long0+e.x/this.a/Math.cos(this.lat_ts)),r=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(r=function(e,t){var r=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(t)-r)<1e-6)return t<0?-1*o:o;for(var n,i,s,a,l=Math.asin(.5*t),c=0;c<30;c++)if(i=Math.sin(l),s=Math.cos(l),a=e*i,l+=n=Math.pow(1-a*a,2)/(2*s)*(t/(1-e*e)-i/(1-a*a)+.5/e*Math.log((1-a)/(1+a))),Math.abs(n)<=1e-10)return l;return NaN}(this.e,2*e.y*this.k0/this.a),t=H(this.long0+e.x/(this.a*this.k0))),e.x=t,e.y=r,e},names:["cea"]},Rt={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(e){var t=e.x,r=e.y,n=H(t-this.long0),i=xt(r-this.lat0);return e.x=this.x0+this.a*n*this.rc,e.y=this.y0+this.a*i,e},inverse:function(e){var t=e.x,r=e.y;return e.x=H(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=xt(this.lat0+(r-this.y0)/this.a),e},names:["Equirectangular","Equidistant_Cylindrical","Equidistant_Cylindrical_Spherical","eqc"]},Dt={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=yt(this.es),this.e1=vt(this.es),this.e2=wt(this.es),this.e3=bt(this.es),this.ml0=this.a*mt(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,r,n,i=e.x,s=e.y,o=H(i-this.long0);if(n=o*Math.sin(s),this.sphere)Math.abs(s)<=a?(t=this.a*o,r=-1*this.a*this.lat0):(t=this.a*Math.sin(n)/Math.tan(s),r=this.a*(xt(s-this.lat0)+(1-Math.cos(n))/Math.tan(s)));else if(Math.abs(s)<=a)t=this.a*o,r=-1*this.ml0;else{var l=Et(this.a,this.e,Math.sin(s))/Math.tan(s);t=l*Math.sin(n),r=this.a*mt(this.e0,this.e1,this.e2,this.e3,s)-this.ml0+l*(1-Math.cos(n))}return e.x=t+this.x0,e.y=r+this.y0,e},inverse:function(e){var t,r,n,i,s,o,l,c,h;if(n=e.x-this.x0,i=e.y-this.y0,this.sphere)if(Math.abs(i+this.a*this.lat0)<=a)t=H(n/this.a+this.long0),r=0;else{var u;for(o=this.lat0+i/this.a,l=n*n/this.a/this.a+o*o,c=o,s=20;s;--s)if(c+=h=-1*(o*(c*(u=Math.tan(c))+1)-c-.5*(c*c+l)*u)/((c-o)/u-1),Math.abs(h)<=a){r=c;break}t=H(this.long0+Math.asin(n*Math.tan(c)/this.a)/Math.sin(r))}else if(Math.abs(i+this.ml0)<=a)r=0,t=H(this.long0+n/this.a);else{var d,p,f,g,A;for(o=(this.ml0+i)/this.a,l=n*n/this.a/this.a+o*o,c=o,s=20;s;--s)if(A=this.e*Math.sin(c),d=Math.sqrt(1-A*A)*Math.tan(c),p=this.a*mt(this.e0,this.e1,this.e2,this.e3,c),f=this.e0-2*this.e1*Math.cos(2*c)+4*this.e2*Math.cos(4*c)-6*this.e3*Math.cos(6*c),c-=h=(o*(d*(g=p/this.a)+1)-g-.5*d*(g*g+l))/(this.es*Math.sin(2*c)*(g*g+l-2*o*g)/(4*d)+(o-g)*(d*f-2/Math.sin(2*c))-f),Math.abs(h)<=a){r=c;break}d=Math.sqrt(1-this.es*Math.pow(Math.sin(r),2))*Math.tan(r),t=H(this.long0+Math.asin(n*d/this.a)/Math.sin(r))}return e.x=t,e.y=r,e},names:["Polyconic","American_Polyconic","poly"]},Lt={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(e){var t,r=e.x,n=e.y-this.lat0,i=r-this.long0,o=n/s*1e-5,a=i,l=1,c=0;for(t=1;t<=10;t++)l*=o,c+=this.A[t]*l;var h,u=c,d=a,p=1,f=0,g=0,A=0;for(t=1;t<=6;t++)h=f*u+p*d,p=p*u-f*d,f=h,g=g+this.B_re[t]*p-this.B_im[t]*f,A=A+this.B_im[t]*p+this.B_re[t]*f;return e.x=A*this.a+this.x0,e.y=g*this.a+this.y0,e},inverse:function(e){var t,r,n=e.x,i=e.y,o=n-this.x0,a=(i-this.y0)/this.a,l=o/this.a,c=1,h=0,u=0,d=0;for(t=1;t<=6;t++)r=h*a+c*l,c=c*a-h*l,h=r,u=u+this.C_re[t]*c-this.C_im[t]*h,d=d+this.C_im[t]*c+this.C_re[t]*h;for(var p=0;p<this.iterations;p++){var f,g=u,A=d,m=a,y=l;for(t=2;t<=6;t++)f=A*u+g*d,g=g*u-A*d,A=f,m+=(t-1)*(this.B_re[t]*g-this.B_im[t]*A),y+=(t-1)*(this.B_im[t]*g+this.B_re[t]*A);g=1,A=0;var v=this.B_re[1],w=this.B_im[1];for(t=2;t<=6;t++)f=A*u+g*d,g=g*u-A*d,A=f,v+=t*(this.B_re[t]*g-this.B_im[t]*A),w+=t*(this.B_im[t]*g+this.B_re[t]*A);var b=v*v+w*w;u=(m*v+y*w)/b,d=(y*v-m*w)/b}var E=u,x=d,C=1,_=0;for(t=1;t<=9;t++)C*=E,_+=this.D[t]*C;var I=this.lat0+_*s*1e5,S=this.long0+x;return e.x=S,e.y=I,e},names:["New_Zealand_Map_Grid","nzmg"]},kt={init:function(){},forward:function(e){var t=e.x,r=e.y,n=H(t-this.long0),i=this.x0+this.a*n,s=this.y0+this.a*Math.log(Math.tan(Math.PI/4+r/2.5))*1.25;return e.x=i,e.y=s,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=H(this.long0+e.x/this.a),r=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=t,e.y=r,e},names:["Miller_Cylindrical","mill"]},Ot={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Je(this.es)},forward:function(e){var t,r,n=e.x,i=e.y;if(n=H(n-this.long0),this.sphere){if(this.m)for(var s=this.n*Math.sin(i),o=20;o;--o){var l=(this.m*i+Math.sin(i)-s)/(this.m+Math.cos(i));if(i-=l,Math.abs(l)<a)break}else i=1!==this.n?Math.asin(this.n*Math.sin(i)):i;t=this.a*this.C_x*n*(this.m+Math.cos(i)),r=this.a*this.C_y*i}else{var c=Math.sin(i),h=Math.cos(i);r=this.a*Xe(i,c,h,this.en),t=this.a*n*h/Math.sqrt(1-this.es*c*c)}return e.x=t,e.y=r,e},inverse:function(e){var t,r,n;return e.x-=this.x0,r=e.x/this.a,e.y-=this.y0,t=e.y/this.a,this.sphere?(t/=this.C_y,r/=this.C_x*(this.m+Math.cos(t)),this.m?t=Mt((this.m*t+Math.sin(t))/this.n):1!==this.n&&(t=Mt(Math.sin(t)/this.n)),r=H(r+this.long0),t=xt(t)):(t=Ze(e.y/this.a,this.es,this.en),(n=Math.abs(t))<o?(n=Math.sin(t),r=H(this.long0+e.x*Math.sqrt(1-this.es*n*n)/(this.a*Math.cos(t)))):n-a<o&&(r=this.long0)),e.x=r,e.y=t,e},names:["Sinusoidal","sinu"]},Ft={init:function(){},forward:function(e){for(var t=e.x,r=e.y,n=H(t-this.long0),i=r,s=Math.PI*Math.sin(r);;){var o=-(i+Math.sin(i)-s)/(1+Math.cos(i));if(i+=o,Math.abs(o)<a)break}i/=2,Math.PI/2-Math.abs(r)<a&&(n=0);var l=.900316316158*this.a*n*Math.cos(i)+this.x0,c=1.4142135623731*this.a*Math.sin(i)+this.y0;return e.x=l,e.y=c,e},inverse:function(e){var t,r;e.x-=this.x0,e.y-=this.y0,r=e.y/(1.4142135623731*this.a),Math.abs(r)>.999999999999&&(r=.999999999999),t=Math.asin(r);var n=H(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),r=(2*t+Math.sin(2*t))/Math.PI,Math.abs(r)>1&&(r=1);var i=Math.asin(r);return e.x=n,e.y=i,e},names:["Mollweide","moll"]},Nt={init:function(){Math.abs(this.lat1+this.lat2)<a||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=yt(this.es),this.e1=vt(this.es),this.e2=wt(this.es),this.e3=bt(this.es),this.sin_phi=Math.sin(this.lat1),this.cos_phi=Math.cos(this.lat1),this.ms1=V(this.e,this.sin_phi,this.cos_phi),this.ml1=mt(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<a?this.ns=this.sin_phi:(this.sin_phi=Math.sin(this.lat2),this.cos_phi=Math.cos(this.lat2),this.ms2=V(this.e,this.sin_phi,this.cos_phi),this.ml2=mt(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=mt(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(e){var t,r=e.x,n=e.y;if(this.sphere)t=this.a*(this.g-n);else{var i=mt(this.e0,this.e1,this.e2,this.e3,n);t=this.a*(this.g-i)}var s=this.ns*H(r-this.long0),o=this.x0+t*Math.sin(s),a=this.y0+this.rh-t*Math.cos(s);return e.x=o,e.y=a,e},inverse:function(e){var t,r,n,i;e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns>=0?(r=Math.sqrt(e.x*e.x+e.y*e.y),t=1):(r=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1);var s=0;return 0!==r&&(s=Math.atan2(t*e.x,t*e.y)),this.sphere?(i=H(this.long0+s/this.ns),n=xt(this.g-r/this.a),e.x=i,e.y=n,e):(n=Ct(this.g-r/this.a,this.e0,this.e1,this.e2,this.e3),i=H(this.long0+s/this.ns),e.x=i,e.y=n,e)},names:["Equidistant_Conic","eqdc"]},Ut={init:function(){this.R=this.a},forward:function(e){var t,r,n=e.x,i=e.y,s=H(n-this.long0);Math.abs(i)<=a&&(t=this.x0+this.R*s,r=this.y0);var l=Mt(2*Math.abs(i/Math.PI));(Math.abs(s)<=a||Math.abs(Math.abs(i)-o)<=a)&&(t=this.x0,r=i>=0?this.y0+Math.PI*this.R*Math.tan(.5*l):this.y0+Math.PI*this.R*-Math.tan(.5*l));var c=.5*Math.abs(Math.PI/s-s/Math.PI),h=c*c,u=Math.sin(l),d=Math.cos(l),p=d/(u+d-1),f=p*p,g=p*(2/u-1),A=g*g,m=Math.PI*this.R*(c*(p-A)+Math.sqrt(h*(p-A)*(p-A)-(A+h)*(f-A)))/(A+h);s<0&&(m=-m),t=this.x0+m;var y=h+p;return m=Math.PI*this.R*(g*y-c*Math.sqrt((A+h)*(h+1)-y*y))/(A+h),r=i>=0?this.y0+m:this.y0-m,e.x=t,e.y=r,e},inverse:function(e){var t,r,n,i,s,o,l,c,h,u,d,p;return e.x-=this.x0,e.y-=this.y0,d=Math.PI*this.R,s=(n=e.x/d)*n+(i=e.y/d)*i,d=3*(i*i/(c=-2*(o=-Math.abs(i)*(1+s))+1+2*i*i+s*s)+(2*(l=o-2*i*i+n*n)*l*l/c/c/c-9*o*l/c/c)/27)/(h=(o-l*l/3/c)/c)/(u=2*Math.sqrt(-h/3)),Math.abs(d)>1&&(d=d>=0?1:-1),p=Math.acos(d)/3,r=e.y>=0?(-u*Math.cos(p+Math.PI/3)-l/3/c)*Math.PI:-(-u*Math.cos(p+Math.PI/3)-l/3/c)*Math.PI,t=Math.abs(n)<a?this.long0:H(this.long0+Math.PI*(s-1+Math.sqrt(1+2*(n*n-i*i)+s*s))/2/n),e.x=t,e.y=r,e},names:["Van_der_Grinten_I","VanDerGrinten","Van_der_Grinten","vandg"]},Qt={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0),this.f=this.es/(1+Math.sqrt(1-this.es))},forward:function(e){var t,r,n,i,s,l,c,h,u,d,p,f=e.x,g=e.y,A=Math.sin(e.y),m=Math.cos(e.y),y=H(f-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=a?(e.x=this.x0+this.a*(o-g)*Math.sin(y),e.y=this.y0-this.a*(o-g)*Math.cos(y),e):Math.abs(this.sin_p12+1)<=a?(e.x=this.x0+this.a*(o+g)*Math.sin(y),e.y=this.y0+this.a*(o+g)*Math.cos(y),e):(u=this.sin_p12*A+this.cos_p12*m*Math.cos(y),h=(c=Math.acos(u))?c/Math.sin(c):1,e.x=this.x0+this.a*h*m*Math.sin(y),e.y=this.y0+this.a*h*(this.cos_p12*A-this.sin_p12*m*Math.cos(y)),e):(t=yt(this.es),r=vt(this.es),n=wt(this.es),i=bt(this.es),Math.abs(this.sin_p12-1)<=a?(s=this.a*mt(t,r,n,i,o),l=this.a*mt(t,r,n,i,g),e.x=this.x0+(s-l)*Math.sin(y),e.y=this.y0-(s-l)*Math.cos(y),e):Math.abs(this.sin_p12+1)<=a?(s=this.a*mt(t,r,n,i,o),l=this.a*mt(t,r,n,i,g),e.x=this.x0+(s+l)*Math.sin(y),e.y=this.y0+(s+l)*Math.cos(y),e):Math.abs(f)<a&&Math.abs(g-this.lat0)<a?(e.x=e.y=0,e):(d=function(e,t,r,n,i,s){const o=n-t,a=Math.atan((1-s)*Math.tan(e)),l=Math.atan((1-s)*Math.tan(r)),c=Math.sin(a),h=Math.cos(a),u=Math.sin(l),d=Math.cos(l);let p,f,g,A,m,y,v,w,b,E,x,C,_,I,S,M=o,T=100;do{if(f=Math.sin(M),g=Math.cos(M),A=Math.sqrt(d*f*(d*f)+(h*u-c*d*g)*(h*u-c*d*g)),0===A)return{azi1:0,s12:0};m=c*u+h*d*g,y=Math.atan2(A,m),v=h*d*f/A,w=1-v*v,b=0!==w?m-2*c*u/w:0,E=s/16*w*(4+s*(4-3*w)),p=M,M=o+(1-E)*s*v*(y+E*A*(b+E*m*(2*b*b-1)))}while(Math.abs(M-p)>1e-12&&--T>0);return 0===T?{azi1:NaN,s12:NaN}:(x=w*(i*i-i*(1-s)*(i*(1-s)))/(i*(1-s)*(i*(1-s))),C=1+x/16384*(4096+x*(x*(320-175*x)-768)),_=x/1024*(256+x*(x*(74-47*x)-128)),I=_*A*(b+_/4*(m*(2*b*b-1)-_/6*b*(4*A*A-3)*(4*b*b-3))),S=i*(1-s)*C*(y-I),{azi1:Math.atan2(d*f,h*u-c*d*g),s12:S})}(this.lat0,this.long0,g,f,this.a,this.f),p=d.azi1,e.x=d.s12*Math.sin(p),e.y=d.s12*Math.cos(p),e))},inverse:function(e){var t,r,n,i,s,l,c,h,u,d,p,f,g,A,m;if(e.x-=this.x0,e.y-=this.y0,this.sphere){if((t=Math.sqrt(e.x*e.x+e.y*e.y))>2*o*this.a)return;return r=t/this.a,n=Math.sin(r),i=Math.cos(r),s=this.long0,Math.abs(t)<=a?l=this.lat0:(l=Mt(i*this.sin_p12+e.y*n*this.cos_p12/t),c=Math.abs(this.lat0)-o,s=Math.abs(c)<=a?this.lat0>=0?H(this.long0+Math.atan2(e.x,-e.y)):H(this.long0-Math.atan2(-e.x,e.y)):H(this.long0+Math.atan2(e.x*n,t*this.cos_p12*i-e.y*this.sin_p12*n))),e.x=s,e.y=l,e}return h=yt(this.es),u=vt(this.es),d=wt(this.es),p=bt(this.es),Math.abs(this.sin_p12-1)<=a?(l=Ct(((f=this.a*mt(h,u,d,p,o))-(t=Math.sqrt(e.x*e.x+e.y*e.y)))/this.a,h,u,d,p),s=H(this.long0+Math.atan2(e.x,-1*e.y)),e.x=s,e.y=l,e):Math.abs(this.sin_p12+1)<=a?(f=this.a*mt(h,u,d,p,o),l=Ct(((t=Math.sqrt(e.x*e.x+e.y*e.y))-f)/this.a,h,u,d,p),s=H(this.long0+Math.atan2(e.x,e.y)),e.x=s,e.y=l,e):(g=Math.atan2(e.x,e.y),A=Math.sqrt(e.x*e.x+e.y*e.y),m=function(e,t,r,n,i,s){const o=Math.atan((1-s)*Math.tan(e)),a=Math.sin(o),l=Math.cos(o),c=Math.sin(r),h=Math.cos(r),u=Math.atan2(a,l*h),d=l*c,p=1-d*d,f=p*(i*i-i*(1-s)*(i*(1-s)))/(i*(1-s)*(i*(1-s))),g=1+f/16384*(4096+f*(f*(320-175*f)-768)),A=f/1024*(256+f*(f*(74-47*f)-128));let m,y,v,w,b,E=n/(i*(1-s)*g),x=100;do{y=Math.cos(2*u+E),v=Math.sin(E),w=Math.cos(E),b=A*v*(y+A/4*(w*(2*y*y-1)-A/6*y*(4*v*v-3)*(4*y*y-3))),m=E,E=n/(i*(1-s)*g)+b}while(Math.abs(E-m)>1e-12&&--x>0);if(0===x)return{lat2:NaN,lon2:NaN};const C=a*v-l*w*h,_=s/16*p*(4+s*(4-3*p));return{lat2:Math.atan2(a*w+l*v*h,(1-s)*Math.sqrt(d*d+C*C)),lon2:t+(Math.atan2(v*c,l*w-a*v*h)-(1-_)*s*d*(E+_*v*(y+_*w*(2*y*y-1))))}}(this.lat0,this.long0,g,A,this.a,this.f),e.x=m.lon2,e.y=m.lat2,e)},names:["Azimuthal_Equidistant","aeqd"]},Gt={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(e){var t,r,n,i,s,o,l,c=e.x,h=e.y;return n=H(c-this.long0),t=Math.sin(h),r=Math.cos(h),i=Math.cos(n),((s=this.sin_p14*t+this.cos_p14*r*i)>0||Math.abs(s)<=a)&&(o=1*this.a*r*Math.sin(n),l=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*r*i)),e.x=o,e.y=l,e},inverse:function(e){var t,r,n,i,s,l,c;return e.x-=this.x0,e.y-=this.y0,r=Mt((t=Math.sqrt(e.x*e.x+e.y*e.y))/this.a),n=Math.sin(r),i=Math.cos(r),l=this.long0,Math.abs(t)<=a?(c=this.lat0,e.x=l,e.y=c,e):(c=Mt(i*this.sin_p14+e.y*n*this.cos_p14/t),s=Math.abs(this.lat0)-o,Math.abs(s)<=a?(l=this.lat0>=0?H(this.long0+Math.atan2(e.x,-e.y)):H(this.long0-Math.atan2(-e.x,e.y)),e.x=l,e.y=c,e):(l=H(this.long0+Math.atan2(e.x*n,t*this.cos_p14*i-e.y*this.sin_p14*n)),e.x=l,e.y=c,e))},names:["ortho"]};function zt(e,t,r,n){var i;return e<a?(n.value=1,i=0):(i=Math.atan2(t,r),Math.abs(i)<=h?n.value=1:i>h&&i<=o+h?(n.value=2,i-=o):i>o+h||i<=-(o+h)?(n.value=3,i=i>=0?i-d:i+d):(n.value=4,i+=o)),i}function jt(e,t){var r=e+t;return r<-d?r+=u:r>+d&&(r-=u),r}const Vt={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=o-h/2?this.face=5:this.lat0<=-(o-h/2)?this.face=6:Math.abs(this.long0)<=h?this.face=1:Math.abs(this.long0)<=o+h?this.face=this.long0>0?2:4:this.face=3,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(e){var t,r,n,i,s,a,l={x:0,y:0},c={value:0};if(e.x-=this.long0,t=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(e.y)):e.y,r=e.x,5===this.face)i=o-t,r>=h&&r<=o+h?(c.value=1,n=r-o):r>o+h||r<=-(o+h)?(c.value=2,n=r>0?r-d:r+d):r>-(o+h)&&r<=-h?(c.value=3,n=r+o):(c.value=4,n=r);else if(6===this.face)i=o+t,r>=h&&r<=o+h?(c.value=1,n=-r+o):r<h&&r>=-h?(c.value=2,n=-r):r<-h&&r>=-(o+h)?(c.value=3,n=-r-o):(c.value=4,n=r>0?-r+d:-r-d);else{var u,p,f,g,A,m;2===this.face?r=jt(r,+o):3===this.face?r=jt(r,+d):4===this.face&&(r=jt(r,-o)),g=Math.sin(t),A=Math.cos(t),m=Math.sin(r),u=A*Math.cos(r),p=A*m,f=g,1===this.face?n=zt(i=Math.acos(u),f,p,c):2===this.face?n=zt(i=Math.acos(p),f,-u,c):3===this.face?n=zt(i=Math.acos(-u),f,-p,c):4===this.face?n=zt(i=Math.acos(-p),f,u,c):(i=n=0,c.value=1)}return a=Math.atan(12/d*(n+Math.acos(Math.sin(n)*Math.cos(h))-o)),s=Math.sqrt((1-Math.cos(i))/(Math.cos(a)*Math.cos(a))/(1-Math.cos(Math.atan(1/Math.cos(n))))),2===c.value?a+=o:3===c.value?a+=d:4===c.value&&(a+=1.5*d),l.x=s*Math.cos(a),l.y=s*Math.sin(a),l.x=l.x*this.a+this.x0,l.y=l.y*this.a+this.y0,e.x=l.x,e.y=l.y,e},inverse:function(e){var t,r,n,i,s,a,l,c,h,u,p,f,g={lam:0,phi:0},A={value:0};if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,r=Math.atan(Math.sqrt(e.x*e.x+e.y*e.y)),t=Math.atan2(e.y,e.x),e.x>=0&&e.x>=Math.abs(e.y)?A.value=1:e.y>=0&&e.y>=Math.abs(e.x)?(A.value=2,t-=o):e.x<0&&-e.x>=Math.abs(e.y)?(A.value=3,t=t<0?t+d:t-d):(A.value=4,t+=o),h=d/12*Math.tan(t),s=Math.sin(h)/(Math.cos(h)-1/Math.sqrt(2)),a=Math.atan(s),(l=1-(n=Math.cos(t))*n*(i=Math.tan(r))*i*(1-Math.cos(Math.atan(1/Math.cos(a)))))<-1?l=-1:l>1&&(l=1),5===this.face)c=Math.acos(l),g.phi=o-c,1===A.value?g.lam=a+o:2===A.value?g.lam=a<0?a+d:a-d:3===A.value?g.lam=a-o:g.lam=a;else if(6===this.face)c=Math.acos(l),g.phi=c-o,1===A.value?g.lam=-a+o:2===A.value?g.lam=-a:3===A.value?g.lam=-a-o:g.lam=a<0?-a-d:-a+d;else{var m,y,v;h=(m=l)*m,y=(h+=(v=h>=1?0:Math.sqrt(1-h)*Math.sin(a))*v)>=1?0:Math.sqrt(1-h),2===A.value?(h=y,y=-v,v=h):3===A.value?(y=-y,v=-v):4===A.value&&(h=y,y=v,v=-h),2===this.face?(h=m,m=-y,y=h):3===this.face?(m=-m,y=-y):4===this.face&&(h=m,m=y,y=-h),g.phi=Math.acos(-v)-o,g.lam=Math.atan2(y,m),2===this.face?g.lam=jt(g.lam,-o):3===this.face?g.lam=jt(g.lam,-d):4===this.face&&(g.lam=jt(g.lam,+o))}return 0!==this.es&&(u=g.phi<0?1:0,p=Math.tan(g.phi),f=this.b/Math.sqrt(p*p+this.one_minus_f_squared),g.phi=Math.atan(Math.sqrt(this.a*this.a-f*f)/(this.one_minus_f*f)),u&&(g.phi=-g.phi)),g.lam+=this.long0,e.x=g.lam,e.y=g.phi,e},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]};var qt=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Ht=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Wt=.8487,$t=1.3523,Yt=c/5,Kt=1/Yt,Jt=function(e,t){return e[0]+t*(e[1]+t*(e[2]+t*e[3]))};const Xt={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(e){var t=H(e.x-this.long0),r=Math.abs(e.y),n=Math.floor(r*Yt);n<0?n=0:n>=18&&(n=17);var i={x:Jt(qt[n],r=c*(r-Kt*n))*t,y:Jt(Ht[n],r)};return e.y<0&&(i.y=-i.y),i.x=i.x*this.a*Wt+this.x0,i.y=i.y*this.a*$t+this.y0,i},inverse:function(e){var t={x:(e.x-this.x0)/(this.a*Wt),y:Math.abs(e.y-this.y0)/(this.a*$t)};if(t.y>=1)t.x/=qt[18][0],t.y=e.y<0?-o:o;else{var r=Math.floor(18*t.y);for(r<0?r=0:r>=18&&(r=17);;)if(Ht[r][0]>t.y)--r;else{if(!(Ht[r+1][0]<=t.y))break;++r}var n=Ht[r],i=5*(t.y-n[0])/(Ht[r+1][0]-n[0]);i=function(e,t,r,n){for(var i=t;n;--n){var s=e(i);if(i-=s,Math.abs(s)<1e-10)break}return i}((function(e){return(Jt(n,e)-t.y)/function(e,t){return e[1]+t*(2*e[2]+3*t*e[3])}(n,e)}),i,0,100),t.x/=Jt(qt[r],i),t.y=(5*r+i)*l,e.y<0&&(t.y=-t.y)}return t.x=H(t.x+this.long0),t},names:["Robinson","robin"]},Zt={init:function(){this.name="geocent"},forward:function(e){return ve(e,this.es,this.a)},inverse:function(e){return we(e,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]};var er={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};const tr={init:function(){if(Object.keys(er).forEach(function(e){if(void 0===this[e])this[e]=er[e].def;else{if(er[e].num&&isNaN(this[e]))throw new Error("Invalid parameter value, must be numeric "+e+" = "+this[e]);er[e].num&&(this[e]=parseFloat(this[e]))}er[e].degrees&&(this[e]=this[e]*l)}.bind(this)),Math.abs(Math.abs(this.lat0)-o)<a?this.mode=this.lat0<0?1:0:Math.abs(this.lat0)<a?this.mode=2:(this.mode=3,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var e=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(e),this.sw=Math.sin(e)},forward:function(e){e.x-=this.long0;var t,r,n,i,s=Math.sin(e.y),o=Math.cos(e.y),a=Math.cos(e.x);switch(this.mode){case 3:r=this.sinph0*s+this.cosph0*o*a;break;case 2:r=o*a;break;case 1:r=-s;break;case 0:r=s}switch(t=(r=this.pn1/(this.p-r))*o*Math.sin(e.x),this.mode){case 3:r*=this.cosph0*s-this.sinph0*o*a;break;case 2:r*=s;break;case 0:r*=-o*a;break;case 1:r*=o*a}return i=1/((n=r*this.cg+t*this.sg)*this.sw*this.h1+this.cw),t=(t*this.cg-r*this.sg)*this.cw*i,r=n*i,e.x=t*this.a,e.y=r*this.a,e},inverse:function(e){e.x/=this.a,e.y/=this.a;var t,r,n,i={x:e.x,y:e.y};n=1/(this.pn1-e.y*this.sw),t=this.pn1*e.x*n,r=this.pn1*e.y*this.cw*n,e.x=t*this.cg+r*this.sg,e.y=r*this.cg-t*this.sg;var s=rt(e.x,e.y);if(Math.abs(s)<a)i.x=0,i.y=e.y;else{var o,l;switch(l=1-s*s*this.pfact,l=(this.p-Math.sqrt(l))/(this.pn1/s+s/this.pn1),o=Math.sqrt(1-l*l),this.mode){case 3:i.y=Math.asin(o*this.sinph0+e.y*l*this.cosph0/s),e.y=(o-this.sinph0*Math.sin(i.y))*s,e.x*=l*this.cosph0;break;case 2:i.y=Math.asin(e.y*l/s),e.y=o*s,e.x*=l;break;case 0:i.y=Math.asin(o),e.y=-e.y;break;case 1:i.y=-Math.asin(o)}i.x=Math.atan2(e.x,e.y)}return e.x=i.x+this.long0,e.y=i.y,e},names:["Tilted_Perspective","tpers"]},rr={init:function(){if(this.flip_axis="x"===this.sweep?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,0!==this.es){var e=1-this.es,t=1/e;this.radius_p=Math.sqrt(e),this.radius_p2=e,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")},forward:function(e){var t,r,n,i,s=e.x,o=e.y;if(s-=this.long0,"ellipse"===this.shape){o=Math.atan(this.radius_p2*Math.tan(o));var a=this.radius_p/rt(this.radius_p*Math.cos(o),Math.sin(o));if(r=a*Math.cos(s)*Math.cos(o),n=a*Math.sin(s)*Math.cos(o),i=a*Math.sin(o),(this.radius_g-r)*r-n*n-i*i*this.radius_p_inv2<0)return e.x=Number.NaN,e.y=Number.NaN,e;t=this.radius_g-r,this.flip_axis?(e.x=this.radius_g_1*Math.atan(n/rt(i,t)),e.y=this.radius_g_1*Math.atan(i/t)):(e.x=this.radius_g_1*Math.atan(n/t),e.y=this.radius_g_1*Math.atan(i/rt(n,t)))}else"sphere"===this.shape&&(t=Math.cos(o),r=Math.cos(s)*t,n=Math.sin(s)*t,i=Math.sin(o),t=this.radius_g-r,this.flip_axis?(e.x=this.radius_g_1*Math.atan(n/rt(i,t)),e.y=this.radius_g_1*Math.atan(i/t)):(e.x=this.radius_g_1*Math.atan(n/t),e.y=this.radius_g_1*Math.atan(i/rt(n,t))));return e.x=e.x*this.a,e.y=e.y*this.a,e},inverse:function(e){var t,r,n,i,s=-1,o=0,a=0;if(e.x=e.x/this.a,e.y=e.y/this.a,"ellipse"===this.shape){this.flip_axis?(a=Math.tan(e.y/this.radius_g_1),o=Math.tan(e.x/this.radius_g_1)*rt(1,a)):(o=Math.tan(e.x/this.radius_g_1),a=Math.tan(e.y/this.radius_g_1)*rt(1,o));var l=a/this.radius_p;if(t=o*o+l*l+s*s,(n=(r=2*this.radius_g*s)*r-4*t*this.C)<0)return e.x=Number.NaN,e.y=Number.NaN,e;i=(-r-Math.sqrt(n))/(2*t),s=this.radius_g+i*s,o*=i,a*=i,e.x=Math.atan2(o,s),e.y=Math.atan(a*Math.cos(e.x)/s),e.y=Math.atan(this.radius_p_inv2*Math.tan(e.y))}else if("sphere"===this.shape){if(this.flip_axis?(a=Math.tan(e.y/this.radius_g_1),o=Math.tan(e.x/this.radius_g_1)*Math.sqrt(1+a*a)):(o=Math.tan(e.x/this.radius_g_1),a=Math.tan(e.y/this.radius_g_1)*Math.sqrt(1+o*o)),t=o*o+a*a+s*s,(n=(r=2*this.radius_g*s)*r-4*t*this.C)<0)return e.x=Number.NaN,e.y=Number.NaN,e;i=(-r-Math.sqrt(n))/(2*t),s=this.radius_g+i*s,o*=i,a*=i,e.x=Math.atan2(o,s),e.y=Math.atan(a*Math.cos(e.x)/s)}return e.x=e.x+this.long0,e},names:["Geostationary Satellite View","Geostationary_Satellite","geos"]};var nr=1.340264,ir=-.081106,sr=893e-6,or=.003796,ar=Math.sqrt(3)/2;const lr={init:function(){this.es=0,this.long0=void 0!==this.long0?this.long0:0},forward:function(e){var t=H(e.x-this.long0),r=e.y,n=Math.asin(ar*Math.sin(r)),i=n*n,s=i*i*i;return e.x=t*Math.cos(n)/(ar*(nr+3*ir*i+s*(7*sr+9*or*i))),e.y=n*(nr+ir*i+s*(sr+or*i)),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e},inverse:function(e){e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a;var t,r,n,i,s=e.y;for(i=0;i<12&&(s-=n=(s*(nr+ir*(t=s*s)+(r=t*t*t)*(sr+or*t))-e.y)/(nr+3*ir*t+r*(7*sr+9*or*t)),!(Math.abs(n)<1e-9));++i);return r=(t=s*s)*t*t,e.x=ar*e.x*(nr+3*ir*t+r*(7*sr+9*or*t))/Math.cos(s),e.y=Math.asin(Math.sin(s)/ar),e.x=H(e.x+this.long0),e},names:["eqearth","Equal Earth","Equal_Earth"]};var cr=1e-10;function hr(e){var t,r,n,i=H(e.x-(this.long0||0)),s=e.y;return t=this.am1+this.m1-Xe(s,r=Math.sin(s),n=Math.cos(s),this.en),r=n*i/(t*Math.sqrt(1-this.es*r*r)),e.x=t*Math.sin(r),e.y=this.am1-t*Math.cos(r),e.x=this.a*e.x+(this.x0||0),e.y=this.a*e.y+(this.y0||0),e}function ur(e){var t,r,n,i;if(e.x=(e.x-(this.x0||0))/this.a,e.y=(e.y-(this.y0||0))/this.a,r=rt(e.x,e.y=this.am1-e.y),i=Ze(this.am1+this.m1-r,this.es,this.en),(t=Math.abs(i))<o)t=Math.sin(i),n=r*Math.atan2(e.x,e.y)*Math.sqrt(1-this.es*t*t)/Math.cos(i);else{if(!(Math.abs(t-o)<=cr))throw new Error;n=0}return e.x=H(n+(this.long0||0)),e.y=xt(i),e}function dr(e){var t,r,n=H(e.x-(this.long0||0)),i=e.y;return r=this.cphi1+this.phi1-i,Math.abs(r)>cr?(e.x=r*Math.sin(t=n*Math.cos(i)/r),e.y=this.cphi1-r*Math.cos(t)):e.x=e.y=0,e.x=this.a*e.x+(this.x0||0),e.y=this.a*e.y+(this.y0||0),e}function pr(e){var t,r;e.x=(e.x-(this.x0||0))/this.a,e.y=(e.y-(this.y0||0))/this.a;var n=rt(e.x,e.y=this.cphi1-e.y);if(r=this.cphi1+this.phi1-n,Math.abs(r)>o)throw new Error;return t=Math.abs(Math.abs(r)-o)<=cr?0:n*Math.atan2(e.x,e.y)/Math.cos(r),e.x=H(t+(this.long0||0)),e.y=xt(r),e}const fr={init:function(){var e;if(this.phi1=this.lat1,Math.abs(this.phi1)<cr)throw new Error;this.es?(this.en=Je(this.es),this.m1=Xe(this.phi1,this.am1=Math.sin(this.phi1),e=Math.cos(this.phi1),this.en),this.am1=e/(Math.sqrt(1-this.es*this.am1*this.am1)*this.am1),this.inverse=ur,this.forward=hr):(Math.abs(this.phi1)+cr>=o?this.cphi1=0:this.cphi1=1/Math.tan(this.phi1),this.inverse=pr,this.forward=dr)},names:["bonne","Bonne (Werner lat_1=90)"]},gr=Object.assign((function(e,t,r){var n,i,s,o=!1;return void 0===t?(i=Pe(e),n=Te,o=!0):(void 0!==t.x||Array.isArray(t))&&(r=t,i=Pe(e),n=Te,o=!0),n||(n=Pe(e)),i||(i=Pe(t)),r?Be(n,i,r):(s={forward:function(e,t){return Be(n,i,e,t)},inverse:function(e,t){return Be(i,n,e,t)}},o&&(s.oProj=i),s)}),{defaultDatum:"WGS84",Proj:ye,WGS84:new ye("WGS84"),Point:We,toPoint:Ie,defs:G,nadgrid:function(e,t,r){return t instanceof ArrayBuffer?function(e,t,r){var n=!0;void 0!==r&&!1===r.includeErrorFields&&(n=!1);var i=new DataView(t),s=function(e){var t=e.getInt32(8,!1);return 11!==t&&(11!==(t=e.getInt32(8,!0))&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}(i),o=function(e,t){return{nFields:e.getInt32(8,t),nSubgridFields:e.getInt32(24,t),nSubgrids:e.getInt32(40,t),shiftType:pe(e,56,64).trim(),fromSemiMajorAxis:e.getFloat64(120,t),fromSemiMinorAxis:e.getFloat64(136,t),toSemiMajorAxis:e.getFloat64(152,t),toSemiMinorAxis:e.getFloat64(168,t)}}(i,s),a=function(e,t,r,n){for(var i=176,s=[],o=0;o<t.nSubgrids;o++){var a=ge(e,i,r),l=Ae(e,i,a,r,n),c=Math.round(1+(a.upperLongitude-a.lowerLongitude)/a.longitudeInterval),h=Math.round(1+(a.upperLatitude-a.lowerLatitude)/a.latitudeInterval);s.push({ll:[de(a.lowerLongitude),de(a.lowerLatitude)],del:[de(a.longitudeInterval),de(a.latitudeInterval)],lim:[c,h],count:a.gridNodeCount,cvs:fe(l)});var u=16;!1===n&&(u=8),i+=176+a.gridNodeCount*u}return s}(i,o,s,n),l={header:o,subgrids:a};return le[e]=l,l}(e,t,r):{ready:ce(e,t)}},transform:Me,mgrs:Fe,version:"__VERSION__"});var Ar;(Ar=gr).Proj.projections.add(et),Ar.Proj.projections.add(st),Ar.Proj.projections.add(ot),Ar.Proj.projections.add(ct),Ar.Proj.projections.add(ut),Ar.Proj.projections.add(dt),Ar.Proj.projections.add(ft),Ar.Proj.projections.add(gt),Ar.Proj.projections.add(At),Ar.Proj.projections.add(_t),Ar.Proj.projections.add(St),Ar.Proj.projections.add(Tt),Ar.Proj.projections.add(Bt),Ar.Proj.projections.add(Pt),Ar.Proj.projections.add(Rt),Ar.Proj.projections.add(Dt),Ar.Proj.projections.add(Lt),Ar.Proj.projections.add(kt),Ar.Proj.projections.add(Ot),Ar.Proj.projections.add(Ft),Ar.Proj.projections.add(Nt),Ar.Proj.projections.add(Ut),Ar.Proj.projections.add(Qt),Ar.Proj.projections.add(Gt),Ar.Proj.projections.add(Vt),Ar.Proj.projections.add(Xt),Ar.Proj.projections.add(Zt),Ar.Proj.projections.add(tr),Ar.Proj.projections.add(rr),Ar.Proj.projections.add(lr),Ar.Proj.projections.add(fr);const mr=gr},14601:(e,t,r)=>{var n=r(97751),i=r(39297),s=r(66699),o=r(1625),a=r(52967),l=r(77740),c=r(11056),h=r(23167),u=r(32603),d=r(77584),p=r(80747),f=r(43724),g=r(96395);e.exports=function(e,t,r,A){var m="stackTraceLimit",y=A?2:1,v=e.split("."),w=v[v.length-1],b=n.apply(null,v);if(b){var E=b.prototype;if(!g&&i(E,"cause")&&delete E.cause,!r)return b;var x=n("Error"),C=t((function(e,t){var r=u(A?t:e,void 0),n=A?new b(e):new b;return void 0!==r&&s(n,"message",r),p(n,C,n.stack,2),this&&o(E,this)&&h(n,this,C),arguments.length>y&&d(n,arguments[y]),n}));if(C.prototype=E,"Error"!==w?a?a(C,x):l(C,x,{name:!0}):f&&m in b&&(c(C,b,m),c(C,b,"prepareStackTrace")),l(C,b),!g)try{E.name!==w&&s(E,"name",w),E.constructor=C}catch(e){}return C}}},14603:(e,t,r)=>{var n=r(36840),i=r(79504),s=r(655),o=r(22812),a=URLSearchParams,l=a.prototype,c=i(l.append),h=i(l.delete),u=i(l.forEach),d=i([].push),p=new a("a=1&a=2&b=3");p.delete("a",1),p.delete("b",void 0),p+""!="a=2"&&n(l,"delete",(function(e){var t=arguments.length,r=t<2?void 0:arguments[1];if(t&&void 0===r)return h(this,e);var n=[];u(this,(function(e,t){d(n,{key:t,value:e})})),o(t,1);for(var i,a=s(e),l=s(r),p=0,f=0,g=!1,A=n.length;p<A;)i=n[p++],g||i.key===a?(g=!0,h(this,i.key)):f++;for(;f<A;)(i=n[f++]).key===a&&i.value===l||c(this,i.key,i.value)}),{enumerable:!0,unsafe:!0})},14628:(e,t,r)=>{var n=r(46518),i=r(36043);n({target:"Promise",stat:!0},{withResolvers:function(){var e=i.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}})},14905:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(79306),o=r(28551),a=r(20034),l=r(97751),c=r(1767),h=r(20772),u=l("Promise"),d=TypeError;n({target:"AsyncIterator",proto:!0,real:!0},{reduce:function(e){o(this),s(e);var t=c(this),r=t.iterator,n=t.next,l=arguments.length<2,p=l?void 0:arguments[1],f=0;return new u((function(t,s){var c=function(e){h(r,s,e,s)},g=function(){try{u.resolve(o(i(n,r))).then((function(r){try{if(o(r).done)l?s(new d("Reduce of empty iterator with no initial value")):t(p);else{var n=r.value;if(l)l=!1,p=n,g();else try{var i=e(p,n,f),h=function(e){p=e,g()};a(i)?u.resolve(i).then(h,c):h(i)}catch(e){c(e)}}f++}catch(e){s(e)}}),s)}catch(e){s(e)}};g()}))}})},15024:(e,t,r)=>{var n=r(46518),i=r(83650);n({target:"Set",proto:!0,real:!0,forced:!r(84916)("symmetricDifference")},{symmetricDifference:i})},15086:(e,t,r)=>{var n=r(46518),i=r(59213).some;n({target:"Array",proto:!0,forced:!r(34598)("some")},{some:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},15234:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},o=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.Las=t.Ept=void 0,t.Ept=s(r(68962)),o(r(36564),t),t.Las=s(r(30549)),o(r(876),t)},15239:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(43724),o=r(87633),a=r(79306),l=r(28551),c=r(90679),h=r(94901),u=r(64117),d=r(20034),p=r(55966),f=r(36840),g=r(56279),A=r(62106),m=r(90757),y=r(78227),v=r(91181),w=y("observable"),b="Observable",E="Subscription",x="SubscriptionObserver",C=v.getterFor,_=v.set,I=C(b),S=C(E),M=C(x),T=function(e){this.observer=l(e),this.cleanup=null,this.subscriptionObserver=null};T.prototype={type:E,clean:function(){var e=this.cleanup;if(e){this.cleanup=null;try{e()}catch(e){m(e)}}},close:function(){if(!s){var e=this.facade,t=this.subscriptionObserver;e.closed=!0,t&&(t.closed=!0)}this.observer=null},isClosed:function(){return null===this.observer}};var B=function(e,t){var r,n=_(this,new T(e));s||(this.closed=!1);try{(r=p(e,"start"))&&i(r,e,this)}catch(e){m(e)}if(!n.isClosed()){var o=n.subscriptionObserver=new P(n);try{var l=t(o),c=l;u(l)||(n.cleanup=h(l.unsubscribe)?function(){c.unsubscribe()}:a(l))}catch(e){return void o.error(e)}n.isClosed()&&n.clean()}};B.prototype=g({},{unsubscribe:function(){var e=S(this);e.isClosed()||(e.close(),e.clean())}}),s&&A(B.prototype,"closed",{configurable:!0,get:function(){return S(this).isClosed()}});var P=function(e){_(this,{type:x,subscriptionState:e}),s||(this.closed=!1)};P.prototype=g({},{next:function(e){var t=M(this).subscriptionState;if(!t.isClosed()){var r=t.observer;try{var n=p(r,"next");n&&i(n,r,e)}catch(e){m(e)}}},error:function(e){var t=M(this).subscriptionState;if(!t.isClosed()){var r=t.observer;t.close();try{var n=p(r,"error");n?i(n,r,e):m(e)}catch(e){m(e)}t.clean()}},complete:function(){var e=M(this).subscriptionState;if(!e.isClosed()){var t=e.observer;e.close();try{var r=p(t,"complete");r&&i(r,t)}catch(e){m(e)}e.clean()}}}),s&&A(P.prototype,"closed",{configurable:!0,get:function(){return M(this).subscriptionState.isClosed()}});var R=function(e){c(this,D),_(this,{type:b,subscriber:a(e)})},D=R.prototype;g(D,{subscribe:function(e){var t=arguments.length;return new B(h(e)?{next:e,error:t>1?arguments[1]:void 0,complete:t>2?arguments[2]:void 0}:d(e)?e:{},I(this).subscriber)}}),f(D,w,(function(){return this})),n({global:!0,constructor:!0,forced:!0},{Observable:R}),o(b)},15472:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(10687);n({global:!0},{Reflect:{}}),s(i.Reflect,"Reflect",!0)},15575:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(79472)(i.setInterval,!0);n({global:!0,bind:!0,forced:i.setInterval!==s},{setInterval:s})},15617:(e,t,r)=>{var n=r(33164);e.exports=Math.fround||function(e){return n(e,1.1920928955078125e-7,34028234663852886e22,11754943508222875e-54)}},15637:(e,t,r)=>{r(46518)({target:"Math",stat:!0,forced:!0},{isubh:function(e,t,r,n){var i=e>>>0,s=r>>>0;return(t>>>0)-(n>>>0)-((~i&s|(i^~s)&i-s>>>0)>>>31)|0}})},15652:(e,t,r)=>{var n=r(79039);e.exports=n((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}}))},15690:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Info=void 0;const n=r(876),i=r(50329);t.Info={parse:function(e){const t=n.Binary.toDataView(e);if(t.byteLength!==i.infoLength)throw new Error(`Invalid COPC info VLR length (should be ${i.infoLength}): ${t.byteLength}`);const r=[t.getFloat64(0,!0),t.getFloat64(8,!0),t.getFloat64(16,!0)],s=t.getFloat64(24,!0);return{cube:[r[0]-s,r[1]-s,r[2]-s,r[0]+s,r[1]+s,r[2]+s],spacing:t.getFloat64(32,!0),rootHierarchyPage:{pageOffset:(0,n.parseBigInt)((0,n.getBigUint64)(t,40,!0)),pageLength:(0,n.parseBigInt)((0,n.getBigUint64)(t,48,!0))},gpsTimeRange:[t.getFloat64(56,!0),t.getFloat64(64,!0)]}}}},15823:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(69565),o=r(43724),a=r(72805),l=r(94644),c=r(66346),h=r(90679),u=r(6980),d=r(66699),p=r(2087),f=r(18014),g=r(57696),A=r(58229),m=r(58319),y=r(56969),v=r(39297),w=r(36955),b=r(20034),E=r(10757),x=r(2360),C=r(1625),_=r(52967),I=r(38480).f,S=r(43251),M=r(59213).forEach,T=r(87633),B=r(62106),P=r(24913),R=r(77347),D=r(35370),L=r(91181),k=r(23167),O=L.get,F=L.set,N=L.enforce,U=P.f,Q=R.f,G=i.RangeError,z=c.ArrayBuffer,j=z.prototype,V=c.DataView,q=l.NATIVE_ARRAY_BUFFER_VIEWS,H=l.TYPED_ARRAY_TAG,W=l.TypedArray,$=l.TypedArrayPrototype,Y=l.isTypedArray,K="BYTES_PER_ELEMENT",J="Wrong length",X=function(e,t){B(e,t,{configurable:!0,get:function(){return O(this)[t]}})},Z=function(e){var t;return C(j,e)||"ArrayBuffer"===(t=w(e))||"SharedArrayBuffer"===t},ee=function(e,t){return Y(e)&&!E(t)&&t in e&&p(+t)&&t>=0},te=function(e,t){return t=y(t),ee(e,t)?u(2,e[t]):Q(e,t)},re=function(e,t,r){return t=y(t),!(ee(e,t)&&b(r)&&v(r,"value"))||v(r,"get")||v(r,"set")||r.configurable||v(r,"writable")&&!r.writable||v(r,"enumerable")&&!r.enumerable?U(e,t,r):(e[t]=r.value,e)};o?(q||(R.f=te,P.f=re,X($,"buffer"),X($,"byteOffset"),X($,"byteLength"),X($,"length")),n({target:"Object",stat:!0,forced:!q},{getOwnPropertyDescriptor:te,defineProperty:re}),e.exports=function(e,t,r){var o=e.match(/\d+/)[0]/8,l=e+(r?"Clamped":"")+"Array",c="get"+e,u="set"+e,p=i[l],y=p,v=y&&y.prototype,w={},E=function(e,t){U(e,t,{get:function(){return function(e,t){var r=O(e);return r.view[c](t*o+r.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,n){var i=O(e);i.view[u](t*o+i.byteOffset,r?m(n):n,!0)}(this,t,e)},enumerable:!0})};q?a&&(y=t((function(e,t,r,n){return h(e,v),k(b(t)?Z(t)?void 0!==n?new p(t,A(r,o),n):void 0!==r?new p(t,A(r,o)):new p(t):Y(t)?D(y,t):s(S,y,t):new p(g(t)),e,y)})),_&&_(y,W),M(I(p),(function(e){e in y||d(y,e,p[e])})),y.prototype=v):(y=t((function(e,t,r,n){h(e,v);var i,a,l,c=0,u=0;if(b(t)){if(!Z(t))return Y(t)?D(y,t):s(S,y,t);i=t,u=A(r,o);var d=t.byteLength;if(void 0===n){if(d%o)throw new G(J);if((a=d-u)<0)throw new G(J)}else if((a=f(n)*o)+u>d)throw new G(J);l=a/o}else l=g(t),i=new z(a=l*o);for(F(e,{buffer:i,byteOffset:u,byteLength:a,length:l,view:new V(i)});c<l;)E(e,c++)})),_&&_(y,W),v=y.prototype=x($)),v.constructor!==y&&d(v,"constructor",y),N(v).TypedArrayConstructor=y,H&&d(v,H,l);var C=y!==p;w[l]=y,n({global:!0,constructor:!0,forced:C,sham:!q},w),K in y||d(y,K,o),K in v||d(v,K,o),T(l)}):e.exports=function(){}},15941:(e,t,r)=>{r(46518)({target:"Math",stat:!0,forced:!0},{umulh:function(e,t){var r=65535,n=+e,i=+t,s=n&r,o=i&r,a=n>>>16,l=i>>>16,c=(a*o>>>0)+(s*o>>>16);return a*l+(c>>>16)+((s*l>>>0)+(c&r)>>>16)}})},16034:(e,t,r)=>{var n=r(46518),i=r(32357).values;n({target:"Object",stat:!0},{values:function(e){return i(e)}})},16037:(e,t,r)=>{var n=r(69565),i=r(36840),s=r(55966),o=r(39297),a=r(78227),l=r(57657).IteratorPrototype,c=a("dispose");o(l,c)||i(l,c,(function(){var e=s(this,"return");e&&n(e,this)}))},16193:(e,t,r)=>{var n=r(79504),i=Error,s=n("".replace),o=String(new i("zxcasd").stack),a=/\n\s*at [^:]*:[^\n]*/,l=a.test(o);e.exports=function(e,t){if(l&&"string"==typeof e&&!i.prepareStackTrace)for(;t--;)e=s(e,a,"");return e}},16215:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(47650),o=r(44204);n({target:"Set",proto:!0,real:!0,forced:!0},{union:function(e){return i(o,this,s(e))}})},16280:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(18745),o=r(14601),a="WebAssembly",l=i[a],c=7!==new Error("e",{cause:7}).cause,h=function(e,t){var r={};r[e]=o(e,t,c),n({global:!0,constructor:!0,arity:1,forced:c},r)},u=function(e,t){if(l&&l[e]){var r={};r[e]=o(a+"."+e,t,c),n({target:a,stat:!0,constructor:!0,arity:1,forced:c},r)}};h("Error",(function(e){return function(t){return s(e,this,arguments)}})),h("EvalError",(function(e){return function(t){return s(e,this,arguments)}})),h("RangeError",(function(e){return function(t){return s(e,this,arguments)}})),h("ReferenceError",(function(e){return function(t){return s(e,this,arguments)}})),h("SyntaxError",(function(e){return function(t){return s(e,this,arguments)}})),h("TypeError",(function(e){return function(t){return s(e,this,arguments)}})),h("URIError",(function(e){return function(t){return s(e,this,arguments)}})),u("CompileError",(function(e){return function(t){return s(e,this,arguments)}})),u("LinkError",(function(e){return function(t){return s(e,this,arguments)}})),u("RuntimeError",(function(e){return function(t){return s(e,this,arguments)}}))},16308:(e,t,r)=>{var n=r(46518),i=r(77240);n({target:"String",proto:!0,forced:r(23061)("sup")},{sup:function(){return i(this,"sup","","")}})},16385:(e,t,r)=>{var n=r(46518),i=r(72248);n({target:"Map",stat:!0,forced:!0},{of:r(87500)(i.Map,i.set,!0)})},16401:(e,t,r)=>{var n=r(78227),i=r(24913).f,s=n("metadata"),o=Function.prototype;void 0===o[s]&&i(o,s,{value:null})},16453:(e,t,r)=>{r(4360)},16468:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(79504),o=r(92796),a=r(36840),l=r(3451),c=r(72652),h=r(90679),u=r(94901),d=r(64117),p=r(20034),f=r(79039),g=r(84428),A=r(10687),m=r(23167);e.exports=function(e,t,r){var y=-1!==e.indexOf("Map"),v=-1!==e.indexOf("Weak"),w=y?"set":"add",b=i[e],E=b&&b.prototype,x=b,C={},_=function(e){var t=s(E[e]);a(E,e,"add"===e?function(e){return t(this,0===e?0:e),this}:"delete"===e?function(e){return!(v&&!p(e))&&t(this,0===e?0:e)}:"get"===e?function(e){return v&&!p(e)?void 0:t(this,0===e?0:e)}:"has"===e?function(e){return!(v&&!p(e))&&t(this,0===e?0:e)}:function(e,r){return t(this,0===e?0:e,r),this})};if(o(e,!u(b)||!(v||E.forEach&&!f((function(){(new b).entries().next()})))))x=r.getConstructor(t,e,y,w),l.enable();else if(o(e,!0)){var I=new x,S=I[w](v?{}:-0,1)!==I,M=f((function(){I.has(1)})),T=g((function(e){new b(e)})),B=!v&&f((function(){for(var e=new b,t=5;t--;)e[w](t,t);return!e.has(-0)}));T||((x=t((function(e,t){h(e,E);var r=m(new b,e,x);return d(t)||c(t,r[w],{that:r,AS_ENTRIES:y}),r}))).prototype=E,E.constructor=x),(M||B)&&(_("delete"),_("has"),y&&_("get")),(B||S)&&_(w),v&&E.clear&&delete E.clear}return C[e]=x,n({global:!0,constructor:!0,forced:x!==b},C),A(x,e),v||r.setStrong(x,e,y),x}},16499:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(79306),o=r(36043),a=r(1103),l=r(72652);n({target:"Promise",stat:!0,forced:r(90537)},{all:function(e){var t=this,r=o.f(t),n=r.resolve,c=r.reject,h=a((function(){var r=s(t.resolve),o=[],a=0,h=1;l(e,(function(e){var s=a++,l=!1;h++,i(r,t,e).then((function(e){l||(l=!0,o[s]=e,--h||n(o))}),c)})),--h||n(o)}));return h.error&&c(h.value),r.promise}})},16573:(e,t,r)=>{var n=r(43724),i=r(62106),s=r(3238),o=ArrayBuffer.prototype;n&&!("detached"in o)&&i(o,"detached",{configurable:!0,get:function(){return s(this)}})},16575:(e,t,r)=>{var n=r(39297);e.exports=function(e){return void 0!==e&&(n(e,"value")||n(e,"writable"))}},16823:e=>{var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},16864:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(47650),o=r(83650);n({target:"Set",proto:!0,real:!0,forced:!0},{symmetricDifference:function(e){return i(o,this,s(e))}})},16882:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getBigUint64=t.parseBigInt=void 0,t.parseBigInt=function(e){if(e>BigInt(Number.MAX_SAFE_INTEGER)||e<BigInt(-Number.MAX_SAFE_INTEGER))throw new Error(`Cannot convert bigint to number: ${e}`);return Number(e)},t.getBigUint64=function(e,t,r){if(e.getBigUint64)return e.getBigUint64(t,r);const[n,i]=r?[4,0]:[0,4],s=BigInt(e.getUint32(t+n,r)),o=BigInt(e.getUint32(t+i,r));return(s<<BigInt(32))+o}},17145:(e,t,r)=>{var n=r(46518),i=r(1625),s=r(42787),o=r(52967),a=r(77740),l=r(2360),c=r(66699),h=r(6980),u=r(77584),d=r(80747),p=r(72652),f=r(32603),g=r(78227)("toStringTag"),A=Error,m=[].push,y=function(e,t){var r,n=i(v,this);o?r=o(new A,n?s(this):v):(r=n?this:l(v),c(r,g,"Error")),void 0!==t&&c(r,"message",f(t)),d(r,y,r.stack,1),arguments.length>2&&u(r,arguments[2]);var a=[];return p(e,m,{that:a}),c(r,"errors",a),r};o?o(y,A):a(y,A,{name:!0});var v=y.prototype=l(A.prototype,{constructor:h(1,y),message:h(1,""),name:h(1,"AggregateError")});n({global:!0,constructor:!0,arity:2},{AggregateError:y})},17273:(e,t,r)=>{var n=r(46518),i=r(33317),s=r(36194),o=r(26223);n({target:"Map",proto:!0,real:!0,forced:!0},{includes:function(e){return!0===o(s(this),(function(t){if(i(t,e))return!0}),!0)}})},17333:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(79306),o=r(28551),a=r(20034),l=r(1767),c=r(92059),h=r(62529),u=r(20772),d=r(96395),p=c((function(e){var t=this,r=t.iterator,n=t.predicate;return new e((function(s,l){var c=function(e){t.done=!0,l(e)},d=function(e){u(r,c,e,c)},p=function(){try{e.resolve(o(i(t.next,r))).then((function(r){try{if(o(r).done)t.done=!0,s(h(void 0,!0));else{var i=r.value;try{var l=n(i,t.counter++),u=function(e){e?s(h(i,!1)):p()};a(l)?e.resolve(l).then(u,d):u(l)}catch(e){d(e)}}}catch(e){c(e)}}),c)}catch(e){c(e)}};p()}))}));n({target:"AsyncIterator",proto:!0,real:!0,forced:d},{filter:function(e){return o(this),s(e),new p(l(this),{predicate:e})}})},17427:(e,t,r)=>{var n=r(46518),i=r(43724),s=r(42551),o=r(79306),a=r(48981),l=r(24913);i&&n({target:"Object",proto:!0,forced:s},{__defineGetter__:function(e,t){l.f(a(this),e,{get:o(t),enumerable:!0,configurable:!0})}})},17561:(e,t,r)=>{r(15024)},17642:(e,t,r)=>{var n=r(46518),i=r(83440);n({target:"Set",proto:!0,real:!0,forced:!r(84916)("difference",(function(e){return 0===e.size}))},{difference:i})},17656:(e,t,r)=>{var n=r(43724),i=r(6469),s=r(48981),o=r(26198),a=r(62106);n&&(a(Array.prototype,"lastIndex",{configurable:!0,get:function(){var e=s(this),t=o(e);return 0===t?0:t-1}}),i("lastIndex"))},17978:(e,t,r)=>{r(13451)},18014:(e,t,r)=>{var n=r(91291),i=Math.min;e.exports=function(e){var t=n(e);return t>0?i(t,9007199254740991):0}},18107:(e,t,r)=>{var n=r(46518),i=r(48981),s=r(26198),o=r(91291),a=r(6469);n({target:"Array",proto:!0},{at:function(e){var t=i(this),r=s(t),n=o(e),a=n>=0?n:r+n;return a<0||a>=r?void 0:t[a]}}),a("at")},18111:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(90679),o=r(28551),a=r(94901),l=r(42787),c=r(62106),h=r(97040),u=r(79039),d=r(39297),p=r(78227),f=r(57657).IteratorPrototype,g=r(43724),A=r(96395),m="constructor",y="Iterator",v=p("toStringTag"),w=TypeError,b=i[y],E=A||!a(b)||b.prototype!==f||!u((function(){b({})})),x=function(){if(s(this,f),l(this)===f)throw new w("Abstract class Iterator not directly constructable")},C=function(e,t){g?c(f,e,{configurable:!0,get:function(){return t},set:function(t){if(o(this),this===f)throw new w("You can't redefine this property");d(this,e)?this[e]=t:h(this,e,t)}}):f[e]=t};d(f,v)||C(v,y),!E&&d(f,m)&&f[m]!==Object||C(m,x),x.prototype=f,n({global:!0,constructor:!0,forced:E},{Iterator:x})},18237:(e,t,r)=>{var n=r(46518),i=r(72652),s=r(79306),o=r(28551),a=r(1767),l=TypeError;n({target:"Iterator",proto:!0,real:!0},{reduce:function(e){o(this),s(e);var t=a(this),r=arguments.length<2,n=r?void 0:arguments[1],c=0;if(i(t,(function(t){r?(r=!1,n=t):n=e(n,t,c),c++}),{IS_RECORD:!0}),r)throw new l("Reduce of empty iterator with no initial value");return n}})},18265:e=>{var t=function(){this.head=null,this.tail=null};t.prototype={add:function(e){var t={item:e,next:null},r=this.tail;r?r.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}},e.exports=t},18449:(e,t,r)=>{r(36033),r(73772);var n=r(97751),i=r(79504),s=r(25745),o=n("Map"),a=n("WeakMap"),l=i([].push),c=s("metadata"),h=c.store||(c.store=new a),u=function(e,t,r){var n=h.get(e);if(!n){if(!r)return;h.set(e,n=new o)}var i=n.get(t);if(!i){if(!r)return;n.set(t,i=new o)}return i};e.exports={store:h,getMap:u,has:function(e,t,r){var n=u(t,r,!1);return void 0!==n&&n.has(e)},get:function(e,t,r){var n=u(t,r,!1);return void 0===n?void 0:n.get(e)},set:function(e,t,r,n){u(r,n,!0).set(e,t)},keys:function(e,t){var r=u(e,t,!1),n=[];return r&&r.forEach((function(e,t){l(n,t)})),n},toKey:function(e){return void 0===e||"symbol"==typeof e?e:String(e)}}},18640:(e,t,r)=>{r(46518)({target:"Function",proto:!0,forced:!0,name:"demethodize"},{unThis:r(12865)})},18727:(e,t,r)=>{var n=r(36955);e.exports=function(e){var t=n(e);return"BigInt64Array"===t||"BigUint64Array"===t}},18745:(e,t,r)=>{var n=r(40616),i=Function.prototype,s=i.apply,o=i.call;e.exports="object"==typeof Reflect&&Reflect.apply||(n?o.bind(s):function(){return o.apply(s,arguments)})},18814:(e,t,r)=>{var n=r(79039),i=r(44576).RegExp;e.exports=n((function(){var e=i("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")}))},18863:(e,t,r)=>{var n=r(46518),i=r(80926).right,s=r(34598),o=r(39519);n({target:"Array",proto:!0,forced:!r(38574)&&o>79&&o<83||!s("reduceRight")},{reduceRight:function(e){return i(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})},18866:(e,t,r)=>{var n=r(43802).end,i=r(60706);e.exports=i("trimEnd")?function(){return n(this)}:"".trimEnd},18999:(e,t,r)=>{r(70511)("metadataKey")},19167:(e,t,r)=>{var n=r(44576);e.exports=n},19369:(e,t,r)=>{var n=r(94644),i=r(79504),s=n.aTypedArray,o=n.exportTypedArrayMethod,a=i([].join);o("join",(function(e){return a(s(this),e)}))},19459:(e,t)=>{function r([e,t,r,n,i,s]){return[e+(n-e)/2,t+(i-t)/2,r+(s-r)/2]}function n(e){return e[3]-e[0]}function i(e){return e[4]-e[1]}function s(e){return e[5]-e[2]}function o(e,[t,n,i]){const[s,o,a,l,c,h]=e,[u,d,p]=r(e);return[t?u:s,n?d:o,i?p:a,t?l:u,n?c:d,i?h:p]}Object.defineProperty(t,"__esModule",{value:!0}),t.Bounds=void 0,t.Bounds={min:function(e){return[e[0],e[1],e[2]]},max:function(e){return[e[3],e[4],e[5]]},mid:r,width:n,depth:i,height:s,cube:function(e){const t=r(e),o=Math.max(n(e),i(e),s(e))/2;return[t[0]-o,t[1]-o,t[2]-o,t[0]+o,t[1]+o,t[2]+o]},step:o,stepTo:function(e,[t,r,n,i]){for(let s=t-1;s>=0;--s)e=o(e,[r>>s&1,n>>s&1,i>>s&1]);return e},intersection:function(e,t){return[Math.max(e[0],t[0]),Math.max(e[1],t[1]),Math.max(e[2],t[2]),Math.min(e[3],t[3]),Math.min(e[4],t[4]),Math.min(e[5],t[5])]}}},19462:(e,t,r)=>{var n=r(69565),i=r(2360),s=r(66699),o=r(56279),a=r(78227),l=r(91181),c=r(55966),h=r(57657).IteratorPrototype,u=r(62529),d=r(9539),p=a("toStringTag"),f="IteratorHelper",g="WrapForValidIterator",A=l.set,m=function(e){var t=l.getterFor(e?g:f);return o(i(h),{next:function(){var r=t(this);if(e)return r.nextHandler();if(r.done)return u(void 0,!0);try{var n=r.nextHandler();return r.returnHandlerResult?n:u(n,r.done)}catch(e){throw r.done=!0,e}},return:function(){var r=t(this),i=r.iterator;if(r.done=!0,e){var s=c(i,"return");return s?n(s,i):u(void 0,!0)}if(r.inner)try{d(r.inner.iterator,"normal")}catch(e){return d(i,"throw",e)}return i&&d(i,"normal"),u(void 0,!0)}})},y=m(!0),v=m(!1);s(v,p,"Iterator Helper"),e.exports=function(e,t,r){var n=function(n,i){i?(i.iterator=n.iterator,i.next=n.next):i=n,i.type=t?g:f,i.returnHandlerResult=!!r,i.nextHandler=e,i.counter=0,i.done=!1,A(this,i)};return n.prototype=t?y:v,n}},19617:(e,t,r)=>{var n=r(25397),i=r(35610),s=r(26198),o=function(e){return function(t,r,o){var a=n(t),l=s(a);if(0===l)return!e&&-1;var c,h=i(o,l);if(e&&r!=r){for(;l>h;)if((c=a[h++])!=c)return!0}else for(;l>h;h++)if((e||h in a)&&a[h]===r)return e||h||0;return!e&&-1}};e.exports={includes:o(!0),indexOf:o(!1)}},19717:(e,t,r)=>{r(46518)({target:"Map",proto:!0,real:!0,name:"upsert",forced:!0},{updateOrInsert:r(162)})},19767:e=>{var t=TypeError;e.exports=function(e){if("number"==typeof e)return e;throw new t("Argument is not a number")}},19929:(e,t,r)=>{var n=r(46518),i=r(76080),s=r(36194),o=r(72248),a=r(26223),l=o.Map,c=o.set;n({target:"Map",proto:!0,real:!0,forced:!0},{mapKeys:function(e){var t=s(this),r=i(e,arguments.length>1?arguments[1]:void 0),n=new l;return a(t,(function(e,i){c(n,r(e,i,t),e)})),n}})},20034:(e,t,r)=>{var n=r(94901);e.exports=function(e){return"object"==typeof e?null!==e:n(e)}},20116:(e,t,r)=>{var n=r(46518),i=r(72652),s=r(79306),o=r(28551),a=r(1767);n({target:"Iterator",proto:!0,real:!0},{find:function(e){o(this),s(e);var t=a(this),r=0;return i(t,(function(t,n){if(e(t,r++))return n(t)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})},20230:(e,t,r)=>{var n=r(46518),i=r(79306),s=r(36194),o=r(26223),a=TypeError;n({target:"Map",proto:!0,real:!0,forced:!0},{reduce:function(e){var t=s(this),r=arguments.length<2,n=r?void 0:arguments[1];if(i(e),o(t,(function(i,s){r?(r=!1,n=i):n=e(n,i,s,t)})),r)throw new a("Reduce of empty map with no initial value");return n}})},20326:(e,t,r)=>{r(70511)("unscopables")},20397:(e,t,r)=>{var n=r(97751);e.exports=n("document","documentElement")},20713:(e,t,r)=>{var n=r(69565),i=r(79306),s=r(28551),o=r(1767),a=r(19462),l=r(96319),c=a((function(){var e=this.iterator,t=s(n(this.next,e));if(!(this.done=!!t.done))return l(e,this.mapper,[t.value,this.counter++],!0)}));e.exports=function(e){return s(this),i(e),new c(o(this),{mapper:e})}},20772:(e,t,r)=>{var n=r(69565),i=r(97751),s=r(55966);e.exports=function(e,t,r,o){try{var a=s(e,"return");if(a)return i("Promise").resolve(n(a,e)).then((function(){t(r)}),(function(e){o(e)}))}catch(e){return o(e)}t(r)}},20781:(e,t,r)=>{var n=r(46518),i=r(77240);n({target:"String",proto:!0,forced:r(23061)("italics")},{italics:function(){return i(this,"i","","")}})},21211:(e,t,r)=>{var n=r(46518),i=r(28551),s=r(77347).f;n({target:"Reflect",stat:!0},{deleteProperty:function(e,t){var r=s(i(e),t);return!(r&&!r.configurable)&&delete e[t]}})},21489:(e,t,r)=>{r(15823)("Uint8",(function(e){return function(t,r,n){return e(this,t,r,n)}}))},21699:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(60511),o=r(67750),a=r(655),l=r(41436),c=i("".indexOf);n({target:"String",proto:!0,forced:!l("includes")},{includes:function(e){return!!~c(a(o(this)),a(s(e)),arguments.length>1?arguments[1]:void 0)}})},21903:(e,t,r)=>{var n=r(94644),i=r(43839).findLast,s=n.aTypedArray;(0,n.exportTypedArrayMethod)("findLast",(function(e){return i(s(this),e,arguments.length>1?arguments[1]:void 0)}))},21926:(e,t,r)=>{var n=r(46518),i=r(76080),s=r(97080),o=r(38469);n({target:"Set",proto:!0,real:!0,forced:!0},{some:function(e){var t=s(this),r=i(e,arguments.length>1?arguments[1]:void 0);return!0===o(t,(function(e){if(r(e,e,t))return!0}),!0)}})},22134:(e,t,r)=>{r(15823)("Uint8",(function(e){return function(t,r,n){return e(this,t,r,n)}}),!0)},22195:(e,t,r)=>{var n=r(79504),i=n({}.toString),s=n("".slice);e.exports=function(e){return s(i(e),8,-1)}},22489:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(79306),o=r(28551),a=r(1767),l=r(19462),c=r(96319),h=r(96395),u=l((function(){for(var e,t,r=this.iterator,n=this.predicate,s=this.next;;){if(e=o(i(s,r)),this.done=!!e.done)return;if(t=e.value,c(r,n,[t,this.counter++],!0))return t}}));n({target:"Iterator",proto:!0,real:!0,forced:h},{filter:function(e){return o(this),s(e),new u(a(this),{predicate:e})}})},22812:e=>{var t=TypeError;e.exports=function(e,r){if(e<r)throw new t("Not enough arguments");return e}},23061:(e,t,r)=>{var n=r(79039);e.exports=function(e){return n((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))}},23167:(e,t,r)=>{var n=r(94901),i=r(20034),s=r(52967);e.exports=function(e,t,r){var o,a;return s&&n(o=t.constructor)&&o!==r&&i(a=o.prototype)&&a!==r.prototype&&s(e,a),e}},23215:(e,t,r)=>{r(81148)},23241:(e,t,r)=>{var n=r(94644),i=r(77957),s=n.aTypedArray,o=n.getTypedArrayConstructor;(0,n.exportTypedArrayMethod)("groupBy",(function(e){var t=arguments.length>1?arguments[1]:void 0;return i(s(this),e,t,o)}),!0)},23283:(e,t,r)=>{var n=r(46518),i=r(94402);n({target:"Set",stat:!0,forced:!0},{of:r(87500)(i.Set,i.add,!1)})},23288:(e,t,r)=>{var n=r(79504),i=r(36840),s=Date.prototype,o="Invalid Date",a="toString",l=n(s[a]),c=n(s.getTime);String(new Date(NaN))!==o&&i(s,a,(function(){var e=c(this);return e==e?l(this):o}))},23418:(e,t,r)=>{var n=r(46518),i=r(97916);n({target:"Array",stat:!0,forced:!r(84428)((function(e){Array.from(e)}))},{from:i})},23500:(e,t,r)=>{var n=r(44576),i=r(67400),s=r(79296),o=r(90235),a=r(66699),l=function(e){if(e&&e.forEach!==o)try{a(e,"forEach",o)}catch(t){e.forEach=o}};for(var c in i)i[c]&&l(n[c]&&n[c].prototype);l(s)},23755:(e,t,r)=>{var n=r(88205).has;e.exports=function(e){return n(e),e}},23792:(e,t,r)=>{var n=r(25397),i=r(6469),s=r(26269),o=r(91181),a=r(24913).f,l=r(51088),c=r(62529),h=r(96395),u=r(43724),d="Array Iterator",p=o.set,f=o.getterFor(d);e.exports=l(Array,"Array",(function(e,t){p(this,{type:d,target:n(e),index:0,kind:t})}),(function(){var e=f(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,c(void 0,!0);switch(e.kind){case"keys":return c(r,!1);case"values":return c(t[r],!1)}return c([r,t[r]],!1)}),"values");var g=s.Arguments=s.Array;if(i("keys"),i("values"),i("entries"),!h&&u&&"values"!==g.name)try{a(g,"name",{value:"values"})}catch(e){}},23860:(e,t,r)=>{var n=r(46518),i=r(68183).codeAt;n({target:"String",proto:!0},{codePointAt:function(e){return i(this,e)}})},24074:(e,t,r)=>{var n=r(69565),i=r(28551),s=r(2360),o=r(55966),a=r(56279),l=r(91181),c=r(97751),h=r(53982),u=r(62529),d=c("Promise"),p="AsyncFromSyncIterator",f=l.set,g=l.getterFor(p),A=function(e,t,r){var n=e.done;d.resolve(e.value).then((function(e){t(u(e,n))}),r)},m=function(e){e.type=p,f(this,e)};m.prototype=a(s(h),{next:function(){var e=g(this);return new d((function(t,r){var s=i(n(e.next,e.iterator));A(s,t,r)}))},return:function(){var e=g(this).iterator;return new d((function(t,r){var s=o(e,"return");if(void 0===s)return t(u(void 0,!0));var a=i(n(s,e));A(a,t,r)}))}}),e.exports=m},24082:(e,t,r)=>{r(79577)},24149:e=>{var t=RangeError;e.exports=function(e){if(e==e)return e;throw new t("NaN is not allowed")}},24194:(e,t,r)=>{var n=r(36955),i=TypeError;e.exports=function(e){if("DataView"===n(e))return e;throw new i("Argument is not a DataView")}},24305:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Hierarchy=void 0,t.Hierarchy={parse:function(e){return Object.entries(e).reduce(((e,[t,r])=>(-1===r?e.pages[t]={}:r&&(e.nodes[t]={pointCount:r}),e)),{nodes:{},pages:{}})}}},24359:(e,t,r)=>{var n=r(46518),i=r(66346);n({global:!0,constructor:!0,forced:!r(77811)},{DataView:i.DataView})},24599:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(79472)(i.setTimeout,!0);n({global:!0,bind:!0,forced:i.setTimeout!==s},{setTimeout:s})},24659:(e,t,r)=>{var n=r(79039),i=r(6980);e.exports=!n((function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",i(1,7)),7!==e.stack)}))},24746:(e,t,r)=>{r(46518)({target:"Math",stat:!0,forced:!0},{scale:r(77905)})},24842:(e,t,r)=>{var n=r(46518),i=Math.PI/180;n({target:"Math",stat:!0,forced:!0},{radians:function(e){return e*i}})},24913:(e,t,r)=>{var n=r(43724),i=r(35917),s=r(48686),o=r(28551),a=r(56969),l=TypeError,c=Object.defineProperty,h=Object.getOwnPropertyDescriptor,u="enumerable",d="configurable",p="writable";t.f=n?s?function(e,t,r){if(o(e),t=a(t),o(r),"function"==typeof e&&"prototype"===t&&"value"in r&&p in r&&!r[p]){var n=h(e,t);n&&n[p]&&(e[t]=r.value,r={configurable:d in r?r[d]:n[d],enumerable:u in r?r[u]:n[u],writable:!1})}return c(e,t,r)}:c:function(e,t,r){if(o(e),t=a(t),o(r),i)try{return c(e,t,r)}catch(e){}if("get"in r||"set"in r)throw new l("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},24949:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}l((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.spawn=void 0;const s=i(r(90148)),o=r(54527),a=r(99278),l=r(54238),c=r(83682),h=r(72931),u=r(48215),d=s.default("threads:master:messages"),p=s.default("threads:master:spawn"),f=s.default("threads:master:thread-utils"),g="undefined"!=typeof process&&process.env.THREADS_WORKER_INIT_TIMEOUT?Number.parseInt(process.env.THREADS_WORKER_INIT_TIMEOUT,10):1e4;function A(e,t,r,n){const i=r.filter((e=>e.type===h.WorkerEventType.internalError)).map((e=>e.error));return Object.assign(e,{[c.$errors]:i,[c.$events]:r,[c.$terminate]:n,[c.$worker]:t})}t.spawn=function(e,t){return n(this,void 0,void 0,(function*(){p("Initializing new thread");const r=t&&t.timeout?t.timeout:g,i=yield function(e,t,r){return n(this,void 0,void 0,(function*(){let n;const i=new Promise(((e,i)=>{n=setTimeout((()=>i(Error(r))),t)})),s=yield Promise.race([e,i]);return clearTimeout(n),s}))}(function(e){return new Promise(((t,r)=>{const n=i=>{var s;d("Message from worker before finishing initialization:",i.data),(s=i.data)&&"init"===s.type?(e.removeEventListener("message",n),t(i.data)):(e=>e&&"uncaughtError"===e.type)(i.data)&&(e.removeEventListener("message",n),r(a.deserialize(i.data.error)))};e.addEventListener("message",n)}))}(e),r,`Timeout: Did not receive an init message from worker after ${r}ms. Make sure the worker calls expose().`),s=i.exposed,{termination:c,terminate:m}=function(e){const[t,r]=l.createPromiseWithResolver();return{terminate:()=>n(this,void 0,void 0,(function*(){f("Terminating worker"),yield e.terminate(),r()})),termination:t}}(e),y=function(e,t){return new o.Observable((r=>{const n=e=>{const t={type:h.WorkerEventType.message,data:e.data};r.next(t)},i=e=>{f("Unhandled promise rejection event in thread:",e);const t={type:h.WorkerEventType.internalError,error:Error(e.reason)};r.next(t)};e.addEventListener("message",n),e.addEventListener("unhandledrejection",i),t.then((()=>{const t={type:h.WorkerEventType.termination};e.removeEventListener("message",n),e.removeEventListener("unhandledrejection",i),r.next(t),r.complete()}))}))}(e,c);if("function"===s.type)return A(u.createProxyFunction(e),e,y,m);if("module"===s.type)return A(u.createProxyModule(e,s.methods),e,y,m);{const e=s.type;throw Error(`Worker init message states unexpected type of expose(): ${e}`)}}))}},24964:(e,t,r)=>{var n=r(46518),i=r(14468);"function"==typeof BigInt&&n({target:"BigInt",stat:!0,forced:!0},{range:function(e,t,r){return new i(e,t,r,"bigint",BigInt(0),BigInt(1))}})},25170:(e,t,r)=>{var n=r(46706),i=r(94402);e.exports=n(i.proto,"size","get")||function(e){return e.size}},25276:(e,t,r)=>{var n=r(46518),i=r(27476),s=r(19617).indexOf,o=r(34598),a=i([].indexOf),l=!!a&&1/a([1],1,-0)<0;n({target:"Array",proto:!0,forced:l||!o("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return l?a(this,e,t)||0:s(this,e,t)}})},25397:(e,t,r)=>{var n=r(47055),i=r(67750);e.exports=function(e){return n(i(e))}},25428:(e,t,r)=>{r(46518)({target:"Number",stat:!0},{isFinite:r(50360)})},25440:(e,t,r)=>{var n=r(18745),i=r(69565),s=r(79504),o=r(89228),a=r(79039),l=r(28551),c=r(94901),h=r(64117),u=r(91291),d=r(18014),p=r(655),f=r(67750),g=r(57829),A=r(55966),m=r(2478),y=r(56682),v=r(78227)("replace"),w=Math.max,b=Math.min,E=s([].concat),x=s([].push),C=s("".indexOf),_=s("".slice),I="$0"==="a".replace(/./,"$0"),S=!!/./[v]&&""===/./[v]("a","$0");o("replace",(function(e,t,r){var s=S?"$":"$0";return[function(e,r){var n=f(this),s=h(e)?void 0:A(e,v);return s?i(s,e,n,r):i(t,p(n),e,r)},function(e,i){var o=l(this),a=p(e);if("string"==typeof i&&-1===C(i,s)&&-1===C(i,"$<")){var h=r(t,o,a,i);if(h.done)return h.value}var f=c(i);f||(i=p(i));var A,v=o.global;v&&(A=o.unicode,o.lastIndex=0);for(var I,S=[];null!==(I=y(o,a))&&(x(S,I),v);)""===p(I[0])&&(o.lastIndex=g(a,d(o.lastIndex),A));for(var M,T="",B=0,P=0;P<S.length;P++){for(var R,D=p((I=S[P])[0]),L=w(b(u(I.index),a.length),0),k=[],O=1;O<I.length;O++)x(k,void 0===(M=I[O])?M:String(M));var F=I.groups;if(f){var N=E([D],k,L,a);void 0!==F&&x(N,F),R=p(n(i,void 0,N))}else R=m(D,a,L,k,F,i);L>=B&&(T+=_(a,B,L)+R,B=L+D.length)}return T+_(a,B)}]}),!!a((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!I||S)},25509:(e,t,r)=>{var n=r(46518),i=r(97080),s=r(94402).add;n({target:"Set",proto:!0,real:!0,forced:!0},{addAll:function(){for(var e=i(this),t=0,r=arguments.length;t<r;t++)s(e,arguments[t]);return e}})},25714:(e,t,r)=>{r(32475)},25745:(e,t,r)=>{var n=r(77629);e.exports=function(e,t){return n[e]||(n[e]=t||{})}},25843:(e,t,r)=>{var n=r(46518),i=r(52703);n({target:"Number",stat:!0,forced:Number.parseInt!==i},{parseInt:i})},25914:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultSerializer=t.extendSerializer=void 0,t.extendSerializer=function(e,t){const r=e.deserialize.bind(e),n=e.serialize.bind(e);return{deserialize:e=>t.deserialize(e,r),serialize:e=>t.serialize(e,n)}};const r=e=>Object.assign(Error(e.message),{name:e.name,stack:e.stack}),n=e=>({__error_marker:"$$error",message:e.message,name:e.name,stack:e.stack});t.DefaultSerializer={deserialize(e){return(t=e)&&"object"==typeof t&&"__error_marker"in t&&"$$error"===t.__error_marker?r(e):e;var t},serialize:e=>e instanceof Error?n(e):e}},26099:(e,t,r)=>{var n=r(92140),i=r(36840),s=r(53179);n||i(Object.prototype,"toString",s,{unsafe:!0})},26148:(e,t,r)=>{var n=r(46518),i=r(8045),s=r(79039),o=Array.fromAsync;n({target:"Array",stat:!0,forced:!o||s((function(){var e=0;return o.call((function(){return e++,[]}),{length:0}),1!==e}))},{fromAsync:i})},26198:(e,t,r)=>{var n=r(18014);e.exports=function(e){return n(e.length)}},26223:(e,t,r)=>{var n=r(79504),i=r(40507),s=r(72248),o=s.Map,a=s.proto,l=n(a.forEach),c=n(a.entries),h=c(new o).next;e.exports=function(e,t,r){return r?i({iterator:c(e),next:h},(function(e){return t(e[1],e[0])})):l(e,t)}},26269:e=>{e.exports={}},26280:(e,t,r)=>{r(16573)},26615:(e,t,r)=>{var n=r(46518),i=r(97751),s=r(20034),o=r(36955),a=r(79039),l="Error",c="DOMException",h=Object.setPrototypeOf||{}.__proto__,u=i(c),d=Error,p=d.isError;n({target:"Error",stat:!0,sham:!0,forced:!p||!h||a((function(){return u&&!p(new u(c))||!p(new d(l,{cause:function(){}}))||p(i("Object","create")(d.prototype))}))},{isError:function(e){if(!s(e))return!1;var t=o(e);return t===l||t===c}})},26675:e=>{function t(e,t){const r=new RegExp(t,"g"),n=e.match(r);return n?n.length:0}e.exports=t,e.exports.default=t},26835:(e,t,r)=>{var n=r(46518),i=r(57029),s=r(6469);n({target:"Array",proto:!0},{copyWithin:i}),s("copyWithin")},26838:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Worker=t.BlobWorker=t.isWorkerRuntime=t.Thread=t.spawn=t.Pool=void 0;const n=r(81592);Object.defineProperty(t,"isWorkerRuntime",{enumerable:!0,get:function(){return n.isWorkerRuntime}});var i=r(52734);Object.defineProperty(t,"Pool",{enumerable:!0,get:function(){return i.Pool}});var s=r(24949);Object.defineProperty(t,"spawn",{enumerable:!0,get:function(){return s.spawn}});var o=r(62996);Object.defineProperty(t,"Thread",{enumerable:!0,get:function(){return o.Thread}}),t.BlobWorker=n.getWorkerImplementation().blob,t.Worker=n.getWorkerImplementation().default},26910:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(79306),o=r(48981),a=r(26198),l=r(84606),c=r(655),h=r(79039),u=r(74488),d=r(34598),p=r(13709),f=r(13763),g=r(39519),A=r(3607),m=[],y=i(m.sort),v=i(m.push),w=h((function(){m.sort(void 0)})),b=h((function(){m.sort(null)})),E=d("sort"),x=!h((function(){if(g)return g<70;if(!(p&&p>3)){if(f)return!0;if(A)return A<603;var e,t,r,n,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)m.push({k:t+n,v:r})}for(m.sort((function(e,t){return t.v-e.v})),n=0;n<m.length;n++)t=m[n].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));n({target:"Array",proto:!0,forced:w||!b||!E||!x},{sort:function(e){void 0!==e&&s(e);var t=o(this);if(x)return void 0===e?y(t):y(t,e);var r,n,i=[],h=a(t);for(n=0;n<h;n++)n in t&&v(i,t[n]);for(u(i,function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:c(t)>c(r)?1:-1}}(e)),r=a(i),n=0;n<r;)t[n]=i[n++];for(;n<h;)l(t,n++);return t}})},26957:(e,t,r)=>{var n=r(46518),i=r(44995);n({target:"WeakMap",stat:!0,forced:!0},{from:r(70933)(i.WeakMap,i.set,!0)})},26977:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LazPerf=t.create=t.createLazPerf=void 0;const i=n(r(67316));t.createLazPerf=i.default,t.create=i.default,t.LazPerf={create:i.default}},27201:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Getter=void 0;const a=o(r(74945));function l(e){return async function(t,r){if(t<0||r<0||t>r)throw new Error("Invalid range");const n=await(0,a.default)(e,{headers:{Range:`bytes=${t}-${r-1}`}}),i=await n.arrayBuffer();return new Uint8Array(i)}}function c(e){return async function(t,n){const i=await Promise.resolve().then((()=>s(r(10539))));return async function(t=0,r=1/0){if(t<0||r<0||t>r)throw new Error("Invalid range");return await i.promises.access(e),async function(e){return await new Promise(((t,r)=>{const n=[];e.on("data",(e=>n.push(e))),e.on("error",r),e.on("end",(()=>t(Buffer.concat(n))))}))}(i.createReadStream(e,{start:t,end:r-1,autoClose:!0}))}(t,n)}}t.Getter={create:function(e){return"function"==typeof e?e:e.startsWith("http://")||e.startsWith("https://")?l(e):c(e)},http:l,file:c}},27208:(e,t,r)=>{var n=r(46518),i=r(69565);n({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return i(URL.prototype.toString,this)}})},27254:(e,t,r)=>{var n=r(46518),i=r(36194),s=r(72248),o=s.get,a=s.has,l=s.set;n({target:"Map",proto:!0,real:!0,forced:!0},{getOrInsert:function(e,t){return a(i(this),e)?o(this,e):(l(this,e,t),t)}})},27337:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(35610),o=RangeError,a=String.fromCharCode,l=String.fromCodePoint,c=i([].join);n({target:"String",stat:!0,arity:1,forced:!!l&&1!==l.length},{fromCodePoint:function(e){for(var t,r=[],n=arguments.length,i=0;n>i;){if(t=+arguments[i++],s(t,1114111)!==t)throw new o(t+" is not a valid code point");r[i]=t<65536?a(t):a(55296+((t-=65536)>>10),t%1024+56320)}return c(r,"")}})},27379:e=>{function t(e,t,r){const n=r&&r.debug||!1;n&&console.log("[xml-utils] getting "+t+" in "+e);const i="object"==typeof e?e.outer:e,s=i.slice(0,i.indexOf(">")+1),o=['"',"'"];for(let e=0;e<o.length;e++){const r=o[e],i=t+"\\="+r+"([^"+r+"]*)"+r;n&&console.log("[xml-utils] pattern:",i);const a=new RegExp(i).exec(s);if(n&&console.log("[xml-utils] match:",a),a)return a[1]}}e.exports=t,e.exports.default=t},27413:(e,t,r)=>{r(54972)},27415:(e,t,r)=>{var n=r(46518),i=r(36194),s=r(26223);n({target:"Map",proto:!0,real:!0,forced:!0},{keyOf:function(e){var t=s(i(this),(function(t,r){if(t===e)return{key:r}}),!0);return t&&t.key}})},27476:(e,t,r)=>{var n=r(22195),i=r(79504);e.exports=function(e){if("Function"===n(e))return i(e)}},27495:(e,t,r)=>{var n=r(46518),i=r(57323);n({target:"RegExp",proto:!0,forced:/./.exec!==i},{exec:i})},27650:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(63463),o=r(42303);i.Uint8Array&&n({target:"Uint8Array",stat:!0},{fromHex:function(e){return o(s(e)).bytes}})},27819:(e,t,r)=>{var n=r(79039);e.exports=!n((function(){var e="9007199254740993",t=JSON.rawJSON(e);return!JSON.isRawJSON(t)||JSON.stringify(t)!==e}))},27913:(e,t,r)=>{r(78100)},28527:(e,t,r)=>{var n=r(97080),i=r(94402).has,s=r(25170),o=r(83789),a=r(40507),l=r(9539);e.exports=function(e){var t=n(this),r=o(e);if(s(t)<r.size)return!1;var c=r.getIterator();return!1!==a(c,(function(e){if(!i(t,e))return l(c,"normal",!1)}))}},28543:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(27476),o=r(33994),a=r(62529),l=r(67750),c=r(18014),h=r(655),u=r(28551),d=r(64117),p=r(22195),f=r(60788),g=r(61034),A=r(55966),m=r(36840),y=r(79039),v=r(78227),w=r(2293),b=r(57829),E=r(56682),x=r(91181),C=r(96395),_=v("matchAll"),I="RegExp String",S=I+" Iterator",M=x.set,T=x.getterFor(S),B=RegExp.prototype,P=TypeError,R=s("".indexOf),D=s("".matchAll),L=!!D&&!y((function(){D("a",/./)})),k=o((function(e,t,r,n){M(this,{type:S,regexp:e,string:t,global:r,unicode:n,done:!1})}),I,(function(){var e=T(this);if(e.done)return a(void 0,!0);var t=e.regexp,r=e.string,n=E(t,r);return null===n?(e.done=!0,a(void 0,!0)):e.global?(""===h(n[0])&&(t.lastIndex=b(r,c(t.lastIndex),e.unicode)),a(n,!1)):(e.done=!0,a(n,!1))})),O=function(e){var t,r,n,i=u(this),s=h(e),o=w(i,RegExp),a=h(g(i));return t=new o(o===RegExp?i.source:i,a),r=!!~R(a,"g"),n=!!~R(a,"u"),t.lastIndex=c(i.lastIndex),new k(t,s,r,n)};n({target:"String",proto:!0,forced:L},{matchAll:function(e){var t,r,n,s,o=l(this);if(d(e)){if(L)return D(o,e)}else{if(f(e)&&(t=h(l(g(e))),!~R(t,"g")))throw new P("`.matchAll` does not allow non-global regexes");if(L)return D(o,e);if(void 0===(n=A(e,_))&&C&&"RegExp"===p(e)&&(n=O),n)return i(n,e,o)}return r=h(o),s=new RegExp(e,"g"),C?i(O,s,r):s[_](r)}}),C||_ in B||m(B,_,O)},28551:(e,t,r)=>{var n=r(20034),i=String,s=TypeError;e.exports=function(e){if(n(e))return e;throw new s(i(e)+" is not an object")}},28625:()=>{},28706:(e,t,r)=>{var n=r(46518),i=r(79039),s=r(34376),o=r(20034),a=r(48981),l=r(26198),c=r(96837),h=r(97040),u=r(1469),d=r(70597),p=r(78227),f=r(39519),g=p("isConcatSpreadable"),A=f>=51||!i((function(){var e=[];return e[g]=!1,e.concat()[0]!==e})),m=function(e){if(!o(e))return!1;var t=e[g];return void 0!==t?!!t:s(e)};n({target:"Array",proto:!0,arity:1,forced:!A||!d("concat")},{concat:function(e){var t,r,n,i,s,o=a(this),d=u(o,0),p=0;for(t=-1,n=arguments.length;t<n;t++)if(m(s=-1===t?o:arguments[t]))for(i=l(s),c(p+i),r=0;r<i;r++,p++)r in s&&h(d,p,s[r]);else c(p+1),h(d,p++,s);return d.length=p,d}})},28845:(e,t,r)=>{var n=r(44576),i=r(69565),s=r(94644),o=r(26198),a=r(58229),l=r(48981),c=r(79039),h=n.RangeError,u=n.Int8Array,d=u&&u.prototype,p=d&&d.set,f=s.aTypedArray,g=s.exportTypedArrayMethod,A=!c((function(){var e=new Uint8ClampedArray(2);return i(p,e,{length:1,0:3},1),3!==e[1]})),m=A&&s.NATIVE_ARRAY_BUFFER_VIEWS&&c((function(){var e=new u(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));g("set",(function(e){f(this);var t=a(arguments.length>1?arguments[1]:void 0,1),r=l(e);if(A)return i(p,this,r,t);var n=this.length,s=o(r),c=0;if(s+t>n)throw new h("Wrong length");for(;c<s;)this[t+c]=r[c++]}),!A||m)},29150:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(28551),o=r(1767),a=r(24149),l=r(99590),c=r(92059),h=r(62529),u=r(96395),d=c((function(e){var t=this;return new e((function(r,n){var o=function(e){t.done=!0,n(e)},a=function(){try{e.resolve(s(i(t.next,t.iterator))).then((function(e){try{s(e).done?(t.done=!0,r(h(void 0,!0))):t.remaining?(t.remaining--,a()):r(h(e.value,!1))}catch(e){o(e)}}),o)}catch(e){o(e)}};a()}))}));n({target:"AsyncIterator",proto:!0,real:!0,forced:u},{drop:function(e){s(this);var t=l(a(+e));return new d(o(this),{remaining:t})}})},29309:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(59225).set,o=r(79472),a=i.setImmediate?o(s,!1):s;n({global:!0,bind:!0,enumerable:!0,forced:i.setImmediate!==a},{setImmediate:a})},29314:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(28551),o=r(1767),a=r(24149),l=r(99590),c=r(19462),h=r(96395),u=c((function(){for(var e,t=this.iterator,r=this.next;this.remaining;)if(this.remaining--,e=s(i(r,t)),this.done=!!e.done)return;if(e=s(i(r,t)),!(this.done=!!e.done))return e.value}));n({target:"Iterator",proto:!0,real:!0,forced:h},{drop:function(e){s(this);var t=l(a(+e));return new u(o(this),{remaining:t})}})},29423:(e,t,r)=>{var n=r(94644),i=r(79039),s=r(67680),o=n.aTypedArray,a=n.getTypedArrayConstructor;(0,n.exportTypedArrayMethod)("slice",(function(e,t){for(var r=s(o(this),e,t),n=a(this),i=0,l=r.length,c=new n(l);l>i;)c[i]=r[i++];return c}),i((function(){new Int8Array(1).slice()})))},29833:(e,t,r)=>{r(15823)("Float64",(function(e){return function(t,r,n){return e(this,t,r,n)}}))},29908:(e,t,r)=>{r(46518)({target:"Object",stat:!0},{is:r(3470)})},29948:(e,t,r)=>{var n=r(35370),i=r(94644).getTypedArrayConstructor;e.exports=function(e,t){return n(i(e),t)}},30067:(e,t,r)=>{r(17145)},30237:(e,t,r)=>{r(6469)("flatMap")},30421:e=>{e.exports={}},30456:(e,t,r)=>{r(46518)({target:"Math",stat:!0,nonConfigurable:!0,nonWritable:!0},{DEG_PER_RAD:Math.PI/180})},30465:(e,t,r)=>{r(70511)("metadata")},30531:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(79306),o=r(28551),a=r(1767),l=r(48646),c=r(19462),h=r(9539),u=r(96395),d=c((function(){for(var e,t,r=this.iterator,n=this.mapper;;){if(t=this.inner)try{if(!(e=o(i(t.next,t.iterator))).done)return e.value;this.inner=null}catch(e){h(r,"throw",e)}if(e=o(i(this.next,r)),this.done=!!e.done)return;try{this.inner=l(n(e.value,this.counter++),!1)}catch(e){h(r,"throw",e)}}}));n({target:"Iterator",proto:!0,real:!0,forced:u},{flatMap:function(e){return o(this),s(e),new d(a(this),{mapper:e,inner:null})}})},30549:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Vlr=t.View=t.PointData=t.Header=t.Extractor=t.ExtraBytes=t.Dimensions=t.Constants=void 0,t.Constants=s(r(48300));var o=r(51652);Object.defineProperty(t,"Dimensions",{enumerable:!0,get:function(){return o.Dimensions}});var a=r(94553);Object.defineProperty(t,"ExtraBytes",{enumerable:!0,get:function(){return a.ExtraBytes}});var l=r(11677);Object.defineProperty(t,"Extractor",{enumerable:!0,get:function(){return l.Extractor}});var c=r(68916);Object.defineProperty(t,"Header",{enumerable:!0,get:function(){return c.Header}});var h=r(90380);Object.defineProperty(t,"PointData",{enumerable:!0,get:function(){return h.PointData}});var u=r(58148);Object.defineProperty(t,"View",{enumerable:!0,get:function(){return u.View}});var d=r(32101);Object.defineProperty(t,"Vlr",{enumerable:!0,get:function(){return d.Vlr}})},30566:(e,t,r)=>{var n=r(79504),i=r(79306),s=r(20034),o=r(39297),a=r(67680),l=r(40616),c=Function,h=n([].concat),u=n([].join),d={};e.exports=l?c.bind:function(e){var t=i(this),r=t.prototype,n=a(arguments,1),l=function(){var r=h(n,a(arguments));return this instanceof l?function(e,t,r){if(!o(d,t)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";d[t]=c("C,a","return new C("+u(n,",")+")")}return d[t](e,r)}(t,r.length,r):t.apply(e,r)};return s(r)&&(l.prototype=r),l}},30670:(e,t,r)=>{r(30531)},30958:(e,t,r)=>{r(5240)},30985:(e,t,r)=>{var n=r(46518),i=r(97751),s=r(28551);n({target:"Reflect",stat:!0,sham:!r(92744)},{preventExtensions:function(e){s(e);try{var t=i("Object","preventExtensions");return t&&t(e),!0}catch(e){return!1}}})},31051:(e,t,r)=>{var n=r(46518),i=r(79039),s=r(33517),o=r(97040),a=Array;n({target:"Array",stat:!0,forced:i((function(){function e(){}return!(a.of.call(e)instanceof e)}))},{of:function(){for(var e=0,t=arguments.length,r=new(s(this)?this:a)(t);t>e;)o(r,e,arguments[e++]);return r.length=t,r}})},31073:(e,t,r)=>{r(70511)("split")},31240:(e,t,r)=>{var n=r(79504);e.exports=n(1..valueOf)},31415:(e,t,r)=>{r(92405)},31563:(e,t,r)=>{var n=r(36955),i=r(39297),s=r(64117),o=r(78227),a=r(26269),l=o("iterator"),c=Object;e.exports=function(e){if(s(e))return!1;var t=c(e);return void 0!==t[l]||"@@iterator"in t||i(a,n(t))}},31575:(e,t,r)=>{var n=r(94644),i=r(80926).left,s=n.aTypedArray;(0,n.exportTypedArrayMethod)("reduce",(function(e){var t=arguments.length;return i(s(this),e,t,t>1?arguments[1]:void 0)}))},31659:(e,t,r)=>{var n=r(46518),i=r(59213).filterReject,s=r(6469);n({target:"Array",proto:!0,forced:!0},{filterReject:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),s("filterReject")},31689:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(18745),o=r(67680),a=r(36043),l=r(79306),c=r(1103),h=i.Promise,u=!1;n({target:"Promise",stat:!0,forced:!h||!h.try||c((function(){h.try((function(e){u=8===e}),8)})).error||!u},{try:function(e){var t=arguments.length>1?o(arguments,1):[],r=a.f(this),n=c((function(){return s(l(e),void 0,t)}));return(n.error?r.reject:r.resolve)(n.value),r.promise}})},31694:(e,t,r)=>{var n=r(94644),i=r(59213).find,s=n.aTypedArray;(0,n.exportTypedArrayMethod)("find",(function(e){return i(s(this),e,arguments.length>1?arguments[1]:void 0)}))},31698:(e,t,r)=>{var n=r(46518),i=r(44204);n({target:"Set",proto:!0,real:!0,forced:!r(84916)("union")},{union:i})},32101:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Vlr=void 0;const n=r(876),i=r(48300);function s(e,t,r){return e.find((e=>e.userId===t&&e.recordId===r))}function o(e,t){return(t?l:a)(e)}function a(e){const t=n.Binary.toDataView(e);if(t.byteLength!==i.vlrHeaderLength)throw new Error(`Invalid VLR header length (must be ${i.vlrHeaderLength}): ${t.byteLength}`);return{userId:n.Binary.toCString(e.slice(2,18)),recordId:t.getUint16(18,!0),contentLength:t.getUint16(20,!0),description:n.Binary.toCString(e.slice(22,54)),isExtended:!1}}function l(e){const t=n.Binary.toDataView(e);if(t.byteLength!==i.evlrHeaderLength)throw new Error(`Invalid EVLR header length (must be ${i.evlrHeaderLength}): ${t.byteLength}`);return{userId:n.Binary.toCString(e.slice(2,18)),recordId:t.getUint16(18,!0),contentLength:(0,n.parseBigInt)((0,n.getBigUint64)(t,20,!0)),description:n.Binary.toCString(e.slice(28,60)),isExtended:!0}}async function c({get:e,startOffset:t,count:r,isExtended:n}){const s=[];let a=t;const l=n?i.evlrHeaderLength:i.vlrHeaderLength;for(let t=0;t<r;++t){const t=l?await e(a,a+l):new Uint8Array,{userId:r,recordId:i,contentLength:c,description:h}=o(t,n);s.push({userId:r,recordId:i,contentOffset:a+l,contentLength:c,description:h,isExtended:n}),a+=l+c}return s}t.Vlr={walk:async function(e,t){const r=n.Getter.create(e);return[...await c({get:r,startOffset:t.headerLength,count:t.vlrCount,isExtended:!1}),...await c({get:r,startOffset:t.evlrOffset,count:t.evlrCount,isExtended:!0})]},parse:o,find:s,at:function(e,t,r){const n=s(e,t,r);if(!n)throw new Error(`VLR not found: ${t}/${r}`);return n},fetch:function(e,{contentOffset:t,contentLength:r}){return 0===r?new Uint8Array:n.Getter.create(e)(t,t+r)}}},32357:(e,t,r)=>{var n=r(43724),i=r(79039),s=r(79504),o=r(42787),a=r(71072),l=r(25397),c=s(r(48773).f),h=s([].push),u=n&&i((function(){var e=Object.create(null);return e[2]=2,!c(e,2)})),d=function(e){return function(t){for(var r,i=l(t),s=a(i),d=u&&null===o(i),p=s.length,f=0,g=[];p>f;)r=s[f++],n&&!(d?r in i:c(i,r))||h(g,e?[r,i[r]]:i[r]);return g}};e.exports={entries:d(!0),values:d(!1)}},32475:(e,t,r)=>{var n=r(46518),i=r(28527);n({target:"Set",proto:!0,real:!0,forced:!r(84916)("isSupersetOf",(function(e){return!e}))},{isSupersetOf:i})},32603:(e,t,r)=>{var n=r(655);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:n(e)}},32637:(e,t,r)=>{r(46518)({target:"Number",stat:!0},{isInteger:r(2087)})},32679:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(79306),o=r(28551),a=r(20034),l=r(1767),c=r(92059),h=r(62529),u=r(50133),d=r(20772),p=r(96395),f=c((function(e){var t=this,r=t.iterator,n=t.mapper;return new e((function(s,l){var c=function(e){t.done=!0,l(e)},p=function(e){d(r,c,e,c)},f=function(){try{e.resolve(o(i(t.next,r))).then((function(r){try{if(o(r).done)t.done=!0,s(h(void 0,!0));else{var i=r.value;try{var l=n(i,t.counter++),d=function(e){try{t.inner=u(e),g()}catch(e){p(e)}};a(l)?e.resolve(l).then(d,p):d(l)}catch(e){p(e)}}}catch(e){c(e)}}),c)}catch(e){c(e)}},g=function(){var r=t.inner;if(r)try{e.resolve(o(i(r.next,r.iterator))).then((function(e){try{o(e).done?(t.inner=null,f()):s(h(e.value,!1))}catch(e){p(e)}}),p)}catch(e){p(e)}else f()};g()}))}));n({target:"AsyncIterator",proto:!0,real:!0,forced:p},{flatMap:function(e){return o(this),s(e),new f(l(this),{mapper:e,inner:null})}})},32812:(e,t,r)=>{r(46518)({target:"Reflect",stat:!0},{has:function(e,t){return t in e}})},33110:(e,t,r)=>{var n=r(46518),i=r(97751),s=r(18745),o=r(69565),a=r(79504),l=r(79039),c=r(94901),h=r(10757),u=r(67680),d=r(66933),p=r(4495),f=String,g=i("JSON","stringify"),A=a(/./.exec),m=a("".charAt),y=a("".charCodeAt),v=a("".replace),w=a(1..toString),b=/[\uD800-\uDFFF]/g,E=/^[\uD800-\uDBFF]$/,x=/^[\uDC00-\uDFFF]$/,C=!p||l((function(){var e=i("Symbol")("stringify detection");return"[null]"!==g([e])||"{}"!==g({a:e})||"{}"!==g(Object(e))})),_=l((function(){return'"\\udf06\\ud834"'!==g("\udf06\ud834")||'"\\udead"'!==g("\udead")})),I=function(e,t){var r=u(arguments),n=d(t);if(c(n)||void 0!==e&&!h(e))return r[1]=function(e,t){if(c(n)&&(t=o(n,this,f(e),t)),!h(t))return t},s(g,null,r)},S=function(e,t,r){var n=m(r,t-1),i=m(r,t+1);return A(E,e)&&!A(x,i)||A(x,e)&&!A(E,n)?"\\u"+w(y(e,0),16):e};g&&n({target:"JSON",stat:!0,arity:3,forced:C||_},{stringify:function(e,t,r){var n=u(arguments),i=s(C?I:g,null,n);return _&&"string"==typeof i?v(i,b,S):i}})},33164:(e,t,r)=>{var n=r(77782),i=r(53602),s=Math.abs;e.exports=function(e,t,r,o){var a=+e,l=s(a),c=n(a);if(l<o)return c*i(l/o/t)*o*t;var h=(1+t/2220446049250313e-31)*l,u=h-(h-l);return u>r||u!=u?c*(1/0):c*u}},33206:(e,t,r)=>{var n=r(94644),i=r(59213).forEach,s=n.aTypedArray;(0,n.exportTypedArrayMethod)("forEach",(function(e){i(s(this),e,arguments.length>1?arguments[1]:void 0)}))},33313:(e,t,r)=>{var n=r(46518),i=r(18866);n({target:"String",proto:!0,name:"trimEnd",forced:"".trimRight!==i},{trimRight:i})},33317:e=>{e.exports=function(e,t){return e===t||e!=e&&t!=t}},33359:(e,t)=>{function r(e){return new DataView(e.buffer,e.byteOffset,e.length)}function n(e){const t=r(e);let n="";for(let e=0;e<t.byteLength;++e){const r=t.getInt8(e);if(0===r)return n;n+=String.fromCharCode(r)}return n}Object.defineProperty(t,"__esModule",{value:!0}),t.toCString=t.toDataView=t.Binary=void 0,t.Binary={toDataView:r,toCString:n},t.toDataView=r,t.toCString=n},33392:(e,t,r)=>{var n=r(79504),i=0,s=Math.random(),o=n(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+o(++i+s,36)}},33454:(e,t,r)=>{var n=r(46518),i=r(28551),s=r(50360),o=r(33994),a=r(62529),l=r(91181),c="Seeded Random",h=c+" Generator",u=l.set,d=l.getterFor(h),p=TypeError,f=o((function(e){u(this,{type:h,seed:e%2147483647})}),c,(function(){var e=d(this),t=e.seed=(1103515245*e.seed+12345)%2147483647;return a((1073741823&t)/1073741823,!1)}));n({target:"Math",stat:!0,forced:!0},{seededPRNG:function(e){var t=i(e).seed;if(!s(t))throw new p('Math.seededPRNG() argument should have a "seed" field with a finite value.');return new f(t)}})},33517:(e,t,r)=>{var n=r(79504),i=r(79039),s=r(94901),o=r(36955),a=r(97751),l=r(33706),c=function(){},h=a("Reflect","construct"),u=/^\s*(?:class|function)\b/,d=n(u.exec),p=!u.test(c),f=function(e){if(!s(e))return!1;try{return h(c,[],e),!0}catch(e){return!1}},g=function(e){if(!s(e))return!1;switch(o(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return p||!!d(u,l(e))}catch(e){return!0}};g.sham=!0,e.exports=!h||i((function(){var e;return f(f.call)||!f(Object)||!f((function(){e=!0}))||e}))?g:f},33684:(e,t,r)=>{var n=r(94644).exportTypedArrayMethod,i=r(79039),s=r(44576),o=r(79504),a=s.Uint8Array,l=a&&a.prototype||{},c=[].toString,h=o([].join);i((function(){c.call({})}))&&(c=function(){return h(this)});var u=l.toString!==c;n("toString",c,u)},33706:(e,t,r)=>{var n=r(79504),i=r(94901),s=r(77629),o=n(Function.toString);i(s.inspectSource)||(s.inspectSource=function(e){return o(e)}),e.exports=s.inspectSource},33717:(e,t)=>{t.f=Object.getOwnPropertySymbols},33771:(e,t,r)=>{var n=r(46518),i=r(84373),s=r(6469);n({target:"Array",proto:!0},{fill:i}),s("fill")},33811:(e,t,r)=>{var n=r(46518),i=r(90679),s=r(42787),o=r(66699),a=r(39297),l=r(78227),c=r(53982),h=r(96395),u=l("toStringTag"),d=TypeError,p=function(){if(i(this,c),s(this)===c)throw new d("Abstract class AsyncIterator not directly constructable")};p.prototype=c,a(c,u)||o(c,u,"AsyncIterator"),!h&&a(c,"constructor")&&c.constructor!==Object||o(c,"constructor",p),n({global:!0,constructor:!0,forced:h},{AsyncIterator:p})},33853:(e,t,r)=>{var n=r(46518),i=r(64449);n({target:"Set",proto:!0,real:!0,forced:!r(84916)("isDisjointFrom",(function(e){return!e}))},{isDisjointFrom:i})},33904:(e,t,r)=>{var n=r(44576),i=r(79039),s=r(79504),o=r(655),a=r(43802).trim,l=r(47452),c=s("".charAt),h=n.parseFloat,u=n.Symbol,d=u&&u.iterator,p=1/h(l+"-0")!=-1/0||d&&!i((function(){h(Object(d))}));e.exports=p?function(e){var t=a(o(e)),r=h(t);return 0===r&&"-"===c(t,0)?-0:r}:h},33981:(e,t,r)=>{var n=r(46518),i=r(92744),s=r(27819),o=r(97751),a=r(69565),l=r(79504),c=r(94901),h=r(65810),u=r(655),d=r(97040),p=r(616),f=r(66933),g=r(33392),A=r(91181).set,m=String,y=SyntaxError,v=o("JSON","parse"),w=o("JSON","stringify"),b=o("Object","create"),E=o("Object","freeze"),x=l("".charAt),C=l("".slice),_=l([].push),I=g(),S=I.length,M="Unacceptable as raw JSON",T=function(e){return" "===e||"\t"===e||"\n"===e||"\r"===e};n({target:"JSON",stat:!0,forced:!s},{rawJSON:function(e){var t=u(e);if(""===t||T(x(t,0))||T(x(t,t.length-1)))throw new y(M);var r=v(t);if("object"==typeof r&&null!==r)throw new y(M);var n=b(null);return A(n,{type:"RawJSON"}),d(n,"rawJSON",t),i?E(n):n}}),w&&n({target:"JSON",stat:!0,arity:3,forced:!s},{stringify:function(e,t,r){var n=f(t),i=[],s=w(e,(function(e,t){var r=c(n)?a(n,this,m(e),t):t;return h(r)?I+(_(i,r.rawJSON)-1):r}),r);if("string"!=typeof s)return s;for(var o="",l=s.length,u=0;u<l;u++){var d=x(s,u);if('"'===d){var g=p(s,++u).end-1,A=C(s,u,g);o+=C(A,0,S)===I?i[C(A,S)]:'"'+A+'"',u=g}else o+=d}return o}})},33994:(e,t,r)=>{var n=r(57657).IteratorPrototype,i=r(2360),s=r(6980),o=r(10687),a=r(26269),l=function(){return this};e.exports=function(e,t,r,c){var h=t+" Iterator";return e.prototype=i(n,{next:s(+!c,r)}),o(e,h,!1,!0),a[h]=l,e}},34124:(e,t,r)=>{var n=r(79039),i=r(20034),s=r(22195),o=r(15652),a=Object.isExtensible,l=n((function(){a(1)}));e.exports=l||o?function(e){return!!i(e)&&(!o||"ArrayBuffer"!==s(e))&&(!a||a(e))}:a},34154:(e,t,r)=>{var n=r(36955),i=TypeError;e.exports=function(e){if("Uint8Array"===n(e))return e;throw new i("Argument is not an Uint8Array")}},34268:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(28551),o=r(20034),a=r(16575),l=r(79039),c=r(24913),h=r(77347),u=r(42787),d=r(6980);n({target:"Reflect",stat:!0,forced:l((function(){var e=function(){},t=c.f(new e,"a",{configurable:!0});return!1!==Reflect.set(e.prototype,"a",1,t)}))},{set:function e(t,r,n){var l,p,f,g=arguments.length<4?t:arguments[3],A=h.f(s(t),r);if(!A){if(o(p=u(t)))return e(p,r,n,g);A=d(0)}if(a(A)){if(!1===A.writable||!o(g))return!1;if(l=h.f(g,r)){if(l.get||l.set||!1===l.writable)return!1;l.value=n,c.f(g,r,l)}else c.f(g,r,d(0,n))}else{if(void 0===(f=A.set))return!1;i(f,g,n)}return!0}})},34376:(e,t,r)=>{var n=r(22195);e.exports=Array.isArray||function(e){return"Array"===n(e)}},34504:(e,t,r)=>{r(18107)},34527:(e,t,r)=>{var n=r(43724),i=r(34376),s=TypeError,o=Object.getOwnPropertyDescriptor,a=n&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=a?function(e,t){if(i(e)&&!o(e,"length").writable)throw new s("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}},34594:(e,t,r)=>{r(15823)("Float32",(function(e){return function(t,r,n){return e(this,t,r,n)}}))},34598:(e,t,r)=>{var n=r(79039);e.exports=function(e,t){var r=[][e];return!!r&&n((function(){r.call(null,t||function(){return 1},1)}))}},34782:(e,t,r)=>{var n=r(46518),i=r(34376),s=r(33517),o=r(20034),a=r(35610),l=r(26198),c=r(25397),h=r(97040),u=r(78227),d=r(70597),p=r(67680),f=d("slice"),g=u("species"),A=Array,m=Math.max;n({target:"Array",proto:!0,forced:!f},{slice:function(e,t){var r,n,u,d=c(this),f=l(d),y=a(e,f),v=a(void 0===t?f:t,f);if(i(d)&&(r=d.constructor,(s(r)&&(r===A||i(r.prototype))||o(r)&&null===(r=r[g]))&&(r=void 0),r===A||void 0===r))return p(d,y,v);for(n=new(void 0===r?A:r)(m(v-y,0)),u=0;y<v;y++,u++)y in d&&h(n,u,d[y]);return n.length=u,n}})},34873:(e,t,r)=>{var n=r(46518),i=r(28551),s=r(73506),o=r(52967);o&&n({target:"Reflect",stat:!0},{setPrototypeOf:function(e,t){i(e),s(t);try{return o(e,t),!0}catch(e){return!1}}})},35031:(e,t,r)=>{var n=r(97751),i=r(79504),s=r(38480),o=r(33717),a=r(28551),l=i([].concat);e.exports=n("Reflect","ownKeys")||function(e){var t=s.f(a(e)),r=o.f;return r?l(t,r(e)):t}},35370:(e,t,r)=>{var n=r(26198);e.exports=function(e,t,r){for(var i=0,s=arguments.length>2?r:n(t),o=new e(s);s>i;)o[i]=t[i++];return o}},35490:(e,t,r)=>{var n=r(46518),i=r(77240);n({target:"String",proto:!0,forced:r(23061)("blink")},{blink:function(){return i(this,"blink","","")}})},35548:(e,t,r)=>{var n=r(33517),i=r(16823),s=TypeError;e.exports=function(e){if(n(e))return e;throw new s(i(e)+" is not a constructor")}},35610:(e,t,r)=>{var n=r(91291),i=Math.max,s=Math.min;e.exports=function(e,t){var r=n(e);return r<0?i(r+t,0):s(r,t)}},35623:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(79504),o=r(34154),a=r(55169),l=s(1..toString);i.Uint8Array&&n({target:"Uint8Array",proto:!0},{toHex:function(){o(this),a(this.buffer);for(var e="",t=0,r=this.length;t<r;t++){var n=l(this[t],16);e+=1===n.length?"0"+n:n}return e}})},35644:(e,t,r)=>{var n=r(46518),i=r(76557),s=r(44995),o=s.get,a=s.has,l=s.set;n({target:"WeakMap",proto:!0,real:!0,forced:!0},{emplace:function(e,t){var r,n,s=i(this);return a(s,e)?(r=o(s,e),"update"in t&&(r=t.update(r,e,s),l(s,e,r)),r):(n=t.insert(e,s),l(s,e,n),n)}})},35694:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(97080),o=r(38469),a=r(655),l=i([].join),c=i([].push);n({target:"Set",proto:!0,real:!0,forced:!0},{join:function(e){var t=s(this),r=void 0===e?",":a(e),n=[];return o(t,(function(e){c(n,e)})),l(n,r)}})},35701:(e,t,r)=>{var n=r(46518),i=r(60533).end;n({target:"String",proto:!0,forced:r(83063)},{padEnd:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},35874:(e,t,r)=>{r(96167)},35917:(e,t,r)=>{var n=r(43724),i=r(79039),s=r(4055);e.exports=!n&&!i((function(){return 7!==Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a}))},36033:(e,t,r)=>{r(48523)},36043:(e,t,r)=>{var n=r(79306),i=TypeError,s=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw new i("Bad Promise constructor");t=e,r=n})),this.resolve=n(t),this.reject=n(r)};e.exports.f=function(e){return new s(e)}},36072:(e,t,r)=>{var n=r(94644),i=r(80926).right,s=n.aTypedArray;(0,n.exportTypedArrayMethod)("reduceRight",(function(e){var t=arguments.length;return i(s(this),e,t,t>1?arguments[1]:void 0)}))},36194:(e,t,r)=>{var n=r(72248).has;e.exports=function(e){return n(e),e}},36389:(e,t,r)=>{var n=r(46518),i=Math.atanh,s=Math.log;n({target:"Math",stat:!0,forced:!(i&&1/i(-0)<0)},{atanh:function(e){var t=+e;return 0===t?t:s((1+t)/(1-t))/2}})},36456:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(655),o=i("".charAt),a=i("".charCodeAt),l=i(/./.exec),c=i(1..toString),h=i("".toUpperCase),u=/[\w*+\-./@]/,d=function(e,t){for(var r=c(e,16);r.length<t;)r="0"+r;return r};n({global:!0},{escape:function(e){for(var t,r,n=s(e),i="",c=n.length,p=0;p<c;)t=o(n,p++),l(u,t)?i+=t:i+=(r=a(t,0))<256?"%"+d(r,2):"%u"+h(d(r,4));return i}})},36564:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Info=t.Hierarchy=t.Copc=t.Constants=void 0,t.Constants=s(r(50329));var o=r(86601);Object.defineProperty(t,"Copc",{enumerable:!0,get:function(){return o.Copc}});var a=r(98363);Object.defineProperty(t,"Hierarchy",{enumerable:!0,get:function(){return a.Hierarchy}});var l=r(15690);Object.defineProperty(t,"Info",{enumerable:!0,get:function(){return l.Info}})},36639:(e,t,r)=>{var n=r(69565),i=r(79306),s=r(28551),o=r(20034),a=r(96837),l=r(97751),c=r(1767),h=r(20772),u=function(e){var t=0===e,r=1===e,u=2===e,d=3===e;return function(e,p,f){s(e);var g=void 0!==p;!g&&t||i(p);var A=c(e),m=l("Promise"),y=A.iterator,v=A.next,w=0;return new m((function(e,i){var l=function(e){h(y,i,e,i)},c=function(){try{if(g)try{a(w)}catch(e){l(e)}m.resolve(s(n(v,y))).then((function(n){try{if(s(n).done)t?(f.length=w,e(f)):e(!d&&(u||void 0));else{var a=n.value;try{if(g){var A=p(a,w),v=function(n){if(r)c();else if(u)n?c():h(y,e,!1,i);else if(t)try{f[w++]=n,c()}catch(e){l(e)}else n?h(y,e,d||a,i):c()};o(A)?m.resolve(A).then(v,l):v(A)}else f[w++]=a,c()}catch(e){l(e)}}}catch(e){i(e)}}),i)}catch(e){i(e)}};c()}))}};e.exports={toArray:u(0),forEach:u(1),every:u(2),some:u(3),find:u(4)}},36840:(e,t,r)=>{var n=r(94901),i=r(24913),s=r(50283),o=r(39433);e.exports=function(e,t,r,a){a||(a={});var l=a.enumerable,c=void 0!==a.name?a.name:t;if(n(r)&&s(r,c,a),a.global)l?e[t]=r:o(t,r);else{try{a.unsafe?e[t]&&(l=!0):delete e[t]}catch(e){}l?e[t]=r:i.f(e,t,{value:r,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return e}},36955:(e,t,r)=>{var n=r(92140),i=r(94901),s=r(22195),o=r(78227)("toStringTag"),a=Object,l="Arguments"===s(function(){return arguments}());e.exports=n?s:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=a(e),o))?r:l?s(t):"Object"===(n=s(t))&&i(t.callee)?"Arguments":n}},37108:(e,t,r)=>{r(96069)},37467:(e,t,r)=>{var n=r(37628),i=r(94644),s=i.aTypedArray,o=i.exportTypedArrayMethod,a=i.getTypedArrayConstructor;o("toReversed",(function(){return n(s(this),a(this))}))},37550:(e,t,r)=>{r(13579)},37583:(e,t,r)=>{var n=r(46518),i=r(76080),s=r(36194),o=r(72248),a=r(26223),l=o.Map,c=o.set;n({target:"Map",proto:!0,real:!0,forced:!0},{mapValues:function(e){var t=s(this),r=i(e,arguments.length>1?arguments[1]:void 0),n=new l;return a(t,(function(e,i){c(n,i,r(e,i,t))})),n}})},37628:(e,t,r)=>{var n=r(26198);e.exports=function(e,t){for(var r=n(e),i=new t(r),s=0;s<r;s++)i[s]=e[r-s-1];return i}},37998:(e,t,r)=>{r(46518)({target:"Function",stat:!0,forced:!0},{isConstructor:r(33517)})},38309:(e,t,r)=>{r(24359)},38344:(e,t,r)=>{r(28543)},38469:(e,t,r)=>{var n=r(79504),i=r(40507),s=r(94402),o=s.Set,a=s.proto,l=n(a.forEach),c=n(a.keys),h=c(new o).next;e.exports=function(e,t,r){return r?i({iterator:c(e),next:h},t):l(e,t)}},38480:(e,t,r)=>{var n=r(61828),i=r(88727).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},38574:(e,t,r)=>{var n=r(84215);e.exports="NODE"===n},38781:(e,t,r)=>{var n=r(10350).PROPER,i=r(36840),s=r(28551),o=r(655),a=r(79039),l=r(61034),c="toString",h=RegExp.prototype,u=h[c],d=a((function(){return"/a/b"!==u.call({source:"a",flags:"b"})})),p=n&&u.name!==c;(d||p)&&i(h,c,(function(){var e=s(this);return"/"+o(e.source)+"/"+o(l(e))}),{unsafe:!0})},39172:(e,t,r)=>{var n=r(46518),i=r(72248);n({target:"Map",stat:!0,forced:!0},{from:r(70933)(i.Map,i.set,!0)})},39202:(e,t,r)=>{r(33313);var n=r(46518),i=r(18866);n({target:"String",proto:!0,name:"trimEnd",forced:"".trimEnd!==i},{trimEnd:i})},39225:(e,t,r)=>{r(58004)},39297:(e,t,r)=>{var n=r(79504),i=r(48981),s=n({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return s(i(e),t)}},39320:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(28551),o=r(1767),a=r(24149),l=r(99590),c=r(92059),h=r(62529),u=r(96395),d=c((function(e){var t,r=this,n=r.iterator;if(!r.remaining--){var o=h(void 0,!0);return r.done=!0,void 0!==(t=n.return)?e.resolve(i(t,n,void 0)).then((function(){return o})):o}return e.resolve(i(r.next,n)).then((function(e){return s(e).done?(r.done=!0,h(void 0,!0)):h(e.value,!1)})).then(null,(function(e){throw r.done=!0,e}))}));n({target:"AsyncIterator",proto:!0,real:!0,forced:u},{take:function(e){s(this);var t=l(a(+e));return new d(o(this),{remaining:t})}})},39433:(e,t,r)=>{var n=r(44576),i=Object.defineProperty;e.exports=function(e,t){try{i(n,e,{value:t,configurable:!0,writable:!0})}catch(r){n[e]=t}return t}},39469:(e,t,r)=>{var n=r(46518),i=Math.hypot,s=Math.abs,o=Math.sqrt;n({target:"Math",stat:!0,arity:2,forced:!!i&&i(1/0,NaN)!==1/0},{hypot:function(e,t){for(var r,n,i=0,a=0,l=arguments.length,c=0;a<l;)c<(r=s(arguments[a++]))?(i=i*(n=c/r)*n+1,c=r):i+=r>0?(n=r/c)*n:r;return c===1/0?1/0:c*o(i)}})},39519:(e,t,r)=>{var n,i,s=r(44576),o=r(82839),a=s.process,l=s.Deno,c=a&&a.versions||l&&l.version,h=c&&c.v8;h&&(i=(n=h.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!i&&o&&(!(n=o.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=o.match(/Chrome\/(\d+)/))&&(i=+n[1]),e.exports=i},39687:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(1625),o=r(42787),a=r(52967),l=r(77740),c=r(2360),h=r(66699),u=r(6980),d=r(80747),p=r(32603),f=r(78227),g=r(79039),A=r(96395),m=i.SuppressedError,y=f("toStringTag"),v=Error,w=!!m&&3!==m.length,b=!!m&&g((function(){return 4===new m(1,2,3,{cause:4}).cause})),E=w||b,x=function(e,t,r){var n,i=s(C,this);return a?n=!E||i&&o(this)!==C?a(new v,i?o(this):C):new m:(n=i?this:c(C),h(n,y,"Error")),void 0!==r&&h(n,"message",p(r)),d(n,x,n.stack,1),h(n,"error",e),h(n,"suppressed",t),n};a?a(x,v):l(x,v,{name:!0});var C=x.prototype=E?m.prototype:c(v.prototype,{constructor:u(1,x),message:u(1,""),name:u(1,"SuppressedError")});E&&!A&&(C.constructor=x),n({global:!0,constructor:!0,arity:3,forced:E},{SuppressedError:x})},39796:(e,t,r)=>{var n=r(46518),i=r(18745),s=r(79306),o=r(28551);n({target:"Reflect",stat:!0,forced:!r(79039)((function(){Reflect.apply((function(){}))}))},{apply:function(e,t,r){return i(s(e),t,o(r))}})},39928:(e,t,r)=>{var n=r(26198),i=r(91291),s=RangeError;e.exports=function(e,t,r,o){var a=n(e),l=i(r),c=l<0?a+l:l;if(c>=a||c<0)throw new s("Incorrect index");for(var h=new t(a),u=0;u<a;u++)h[u]=u===c?o:e[u];return h}},40150:(e,t,r)=>{r(46518)({target:"Number",stat:!0},{isNaN:function(e){return e!=e}})},40280:(e,t,r)=>{var n=r(46518),i=r(97751),s=r(96395),o=r(80550),a=r(10916).CONSTRUCTOR,l=r(93438),c=i("Promise"),h=s&&!a;n({target:"Promise",stat:!0,forced:s||a},{resolve:function(e){return l(h&&this===c?o:this,e)}})},40447:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.Transfer=t.DefaultSerializer=t.expose=t.registerSerializer=void 0;var s=r(99278);Object.defineProperty(t,"registerSerializer",{enumerable:!0,get:function(){return s.registerSerializer}}),i(r(26838),t);var o=r(11854);Object.defineProperty(t,"expose",{enumerable:!0,get:function(){return o.expose}});var a=r(25914);Object.defineProperty(t,"DefaultSerializer",{enumerable:!0,get:function(){return a.DefaultSerializer}});var l=r(66712);Object.defineProperty(t,"Transfer",{enumerable:!0,get:function(){return l.Transfer}})},40507:(e,t,r)=>{var n=r(69565);e.exports=function(e,t,r){for(var i,s,o=r?e:e.iterator,a=e.next;!(i=n(a,o)).done;)if(void 0!==(s=t(i.value)))return s}},40616:(e,t,r)=>{var n=r(79039);e.exports=!n((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},40617:(e,t,r)=>{var n=r(46518),i=r(18449),s=r(28551),o=i.keys,a=i.toKey;n({target:"Reflect",stat:!0},{getOwnMetadataKeys:function(e){var t=arguments.length<2?void 0:a(arguments[1]);return o(s(e),t)}})},40875:(e,t,r)=>{var n=r(46518),i=r(79039),s=r(48981),o=r(42787),a=r(12211);n({target:"Object",stat:!0,forced:i((function(){o(1)})),sham:!a},{getPrototypeOf:function(e){return o(s(e))}})},40888:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(20034),o=r(28551),a=r(16575),l=r(77347),c=r(42787);n({target:"Reflect",stat:!0},{get:function e(t,r){var n,h,u=arguments.length<3?t:arguments[2];return o(t)===u?t[r]:(n=l.f(t,r))?a(n)?n.value:void 0===n.get?void 0:i(n.get,u):s(h=c(t))?e(h,r,u):void 0}})},41393:(e,t,r)=>{var n=r(46518),i=r(41750);n({target:"AsyncIterator",proto:!0,real:!0,forced:r(96395)},{map:i})},41405:(e,t,r)=>{var n=r(44576),i=r(18745),s=r(94644),o=r(79039),a=r(67680),l=n.Int8Array,c=s.aTypedArray,h=s.exportTypedArrayMethod,u=[].toLocaleString,d=!!l&&o((function(){u.call(new l(1))}));h("toLocaleString",(function(){return i(u,d?a(c(this)):c(this),a(arguments))}),o((function(){return[1,2].toLocaleString()!==new l([1,2]).toLocaleString()}))||!o((function(){l.prototype.toLocaleString.call([1,2])})))},41436:(e,t,r)=>{var n=r(78227)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[n]=!1,"/./"[e](t)}catch(e){}}return!1}},41549:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(59143),o=r(34154);i.Uint8Array&&n({target:"Uint8Array",proto:!0},{setFromBase64:function(e){o(this);var t=s(e,arguments.length>1?arguments[1]:void 0,this,this.length);return{read:t.read,written:t.written}}})},41750:(e,t,r)=>{var n=r(69565),i=r(79306),s=r(28551),o=r(20034),a=r(1767),l=r(92059),c=r(62529),h=r(20772),u=l((function(e){var t=this,r=t.iterator,i=t.mapper;return new e((function(a,l){var u=function(e){t.done=!0,l(e)},d=function(e){h(r,u,e,u)};e.resolve(s(n(t.next,r))).then((function(r){try{if(s(r).done)t.done=!0,a(c(void 0,!0));else{var n=r.value;try{var l=i(n,t.counter++),h=function(e){a(c(e,!1))};o(l)?e.resolve(l).then(h,d):h(l)}catch(e){d(e)}}}catch(e){u(e)}}),u)}))}));e.exports=function(e){return s(this),i(e),new u(a(this),{mapper:e})}},41795:(e,t,r)=>{r(61806)},41898:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ObservablePromise=void 0;const n=r(54527),i=()=>{},s=e=>e,o=e=>Promise.resolve().then(e);function a(e){throw e}class l extends n.Observable{constructor(e){super((t=>{const r=this,n=Object.assign(Object.assign({},t),{complete(){t.complete(),r.onCompletion()},error(e){t.error(e),r.onError(e)},next(e){t.next(e),r.onNext(e)}});try{return this.initHasRun=!0,e(n)}catch(e){n.error(e)}})),this.initHasRun=!1,this.fulfillmentCallbacks=[],this.rejectionCallbacks=[],this.firstValueSet=!1,this.state="pending"}onNext(e){this.firstValueSet||(this.firstValue=e,this.firstValueSet=!0)}onError(e){this.state="rejected",this.rejection=e;for(const t of this.rejectionCallbacks)o((()=>t(e)))}onCompletion(){this.state="fulfilled";for(const e of this.fulfillmentCallbacks)o((()=>e(this.firstValue)))}then(e,t){const r=e||s,n=t||a;let i=!1;return new Promise(((e,t)=>{const s=r=>{if(!i){i=!0;try{e(n(r))}catch(e){t(e)}}};return this.initHasRun||this.subscribe({error:s}),"fulfilled"===this.state?e(r(this.firstValue)):"rejected"===this.state?(i=!0,e(n(this.rejection))):(this.fulfillmentCallbacks.push((t=>{try{e(r(t))}catch(e){s(e)}})),void this.rejectionCallbacks.push(s))}))}catch(e){return this.then(void 0,e)}finally(e){const t=e||i;return this.then((e=>(t(),e)),(()=>t()))}static from(e){return function(e){return e&&"function"==typeof e.then}(e)?new l((t=>{e.then((e=>{t.next(e),t.complete()}),(e=>{t.error(e)}))})):super.from(e)}}t.ObservablePromise=l},41927:(e,t,r)=>{var n=r(46518),i=r(76080),s=r(97080),o=r(38469);n({target:"Set",proto:!0,real:!0,forced:!0},{every:function(e){var t=s(this),r=i(e,arguments.length>1?arguments[1]:void 0);return!1!==o(t,(function(e){if(!r(e,e,t))return!1}),!0)}})},42043:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(67750),o=r(655),a=i("".charCodeAt);n({target:"String",proto:!0},{isWellFormed:function(){for(var e=o(s(this)),t=e.length,r=0;r<t;r++){var n=a(e,r);if(55296==(63488&n)&&(n>=56320||++r>=t||56320!=(64512&a(e,r))))return!1}return!0}})},42207:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(97751),o=r(79504),a=r(69565),l=r(79039),c=r(655),h=r(22812),u=r(92804).i2c,d=s("btoa"),p=o("".charAt),f=o("".charCodeAt),g=!!d&&!l((function(){return"aGk="!==d("hi")})),A=g&&!l((function(){d()})),m=g&&l((function(){return"bnVsbA=="!==d(null)})),y=g&&1!==d.length;n({global:!0,bind:!0,enumerable:!0,forced:!g||A||m||y},{btoa:function(e){if(h(arguments.length,1),g)return a(d,i,c(e));for(var t,r,n=c(e),o="",l=0,A=u;p(n,l)||(A="=",l%1);){if((r=f(n,l+=3/4))>255)throw new(s("DOMException"))("The string contains characters outside of the Latin1 range","InvalidCharacterError");o+=p(A,63&(t=t<<8|r)>>8-l%1*8)}return o}})},42303:(e,t,r)=>{var n=r(44576),i=r(79504),s=n.Uint8Array,o=n.SyntaxError,a=n.parseInt,l=Math.min,c=/[^\da-f]/i,h=i(c.exec),u=i("".slice);e.exports=function(e,t){var r=e.length;if(r%2!=0)throw new o("String should be an even number of characters");for(var n=t?l(t.length,r/2):r/2,i=t||new s(n),d=0,p=0;p<n;){var f=u(e,d,d+=2);if(h(c,f))throw new o("String should only contain hex characters");i[p++]=a(f,16)}return{bytes:i,read:d}}},42376:(e,t,r)=>{var n=r(46518),i=r(18449),s=r(28551),o=i.get,a=i.toKey;n({target:"Reflect",stat:!0},{getOwnMetadata:function(e,t){var r=arguments.length<3?void 0:a(arguments[2]);return o(e,s(t),r)}})},42551:(e,t,r)=>{var n=r(96395),i=r(44576),s=r(79039),o=r(3607);e.exports=n||!s((function(){if(!(o&&o<535)){var e=Math.random();__defineSetter__.call(null,e,(function(){})),delete i[e]}}))},42762:(e,t,r)=>{var n=r(46518),i=r(43802).trim;n({target:"String",proto:!0,forced:r(60706)("trim")},{trim:function(){return i(this)}})},42781:(e,t,r)=>{r(46518)({target:"String",proto:!0},{repeat:r(72333)})},42787:(e,t,r)=>{var n=r(39297),i=r(94901),s=r(48981),o=r(66119),a=r(12211),l=o("IE_PROTO"),c=Object,h=c.prototype;e.exports=a?c.getPrototypeOf:function(e){var t=s(e);if(n(t,l))return t[l];var r=t.constructor;return i(r)&&t instanceof r?r.prototype:t instanceof c?h:null}},42793:(e,t,r)=>{r(70511)("observable")},42978:(e,t,r)=>{var n=r(46518),i=r(18449),s=r(28551),o=i.toKey,a=i.getMap,l=i.store;n({target:"Reflect",stat:!0},{deleteMetadata:function(e,t){var r=arguments.length<3?void 0:o(arguments[2]),n=a(s(t),r,!1);if(void 0===n||!n.delete(e))return!1;if(n.size)return!0;var i=l.get(t);return i.delete(r),!!i.size||l.delete(t)}})},43070:(t,r,n)=>{var i,s;t.exports=(i={AddEquation:()=>e.AddEquation,AdditiveBlending:()=>e.AdditiveBlending,AlphaFormat:()=>e.AlphaFormat,AlwaysDepth:()=>e.AlwaysDepth,AmbientLight:()=>e.AmbientLight,AnimationClip:()=>e.AnimationClip,BackSide:()=>e.BackSide,Bone:()=>e.Bone,Box2:()=>e.Box2,Box3:()=>e.Box3,Box3Helper:()=>e.Box3Helper,BoxGeometry:()=>e.BoxGeometry,BoxHelper:()=>e.BoxHelper,BufferAttribute:()=>e.BufferAttribute,BufferGeometry:()=>e.BufferGeometry,ByteType:()=>e.ByteType,Camera:()=>e.Camera,CameraHelper:()=>e.CameraHelper,CanvasTexture:()=>e.CanvasTexture,CircleGeometry:()=>e.CircleGeometry,ClampToEdgeWrapping:()=>e.ClampToEdgeWrapping,Color:()=>e.Color,ColorManagement:()=>e.ColorManagement,CompressedArrayTexture:()=>e.CompressedArrayTexture,CompressedCubeTexture:()=>e.CompressedCubeTexture,CompressedTexture:()=>e.CompressedTexture,CustomBlending:()=>e.CustomBlending,Data3DTexture:()=>e.Data3DTexture,DataTexture:()=>e.DataTexture,DefaultLoadingManager:()=>e.DefaultLoadingManager,DepthTexture:()=>e.DepthTexture,DirectionalLight:()=>e.DirectionalLight,DoubleSide:()=>e.DoubleSide,DstAlphaFactor:()=>e.DstAlphaFactor,DstColorFactor:()=>e.DstColorFactor,EdgesGeometry:()=>e.EdgesGeometry,EqualDepth:()=>e.EqualDepth,Euler:()=>e.Euler,EventDispatcher:()=>e.EventDispatcher,FileLoader:()=>e.FileLoader,Float32BufferAttribute:()=>e.Float32BufferAttribute,FloatType:()=>e.FloatType,Fog:()=>e.Fog,FrontSide:()=>e.FrontSide,Frustum:()=>e.Frustum,GreaterEqualDepth:()=>e.GreaterEqualDepth,Group:()=>e.Group,HalfFloatType:()=>e.HalfFloatType,HemisphereLight:()=>e.HemisphereLight,ImageBitmapLoader:()=>e.ImageBitmapLoader,InstancedBufferAttribute:()=>e.InstancedBufferAttribute,InstancedMesh:()=>e.InstancedMesh,IntType:()=>e.IntType,InterleavedBuffer:()=>e.InterleavedBuffer,InterleavedBufferAttribute:()=>e.InterleavedBufferAttribute,Interpolant:()=>e.Interpolant,InterpolateDiscrete:()=>e.InterpolateDiscrete,InterpolateLinear:()=>e.InterpolateLinear,LessDepth:()=>e.LessDepth,LessEqualDepth:()=>e.LessEqualDepth,Line:()=>e.Line,LineBasicMaterial:()=>e.LineBasicMaterial,LineLoop:()=>e.LineLoop,LineSegments:()=>e.LineSegments,LinearFilter:()=>e.LinearFilter,LinearMipmapLinearFilter:()=>e.LinearMipmapLinearFilter,LinearMipmapNearestFilter:()=>e.LinearMipmapNearestFilter,LinearSRGBColorSpace:()=>e.LinearSRGBColorSpace,LinearTransfer:()=>e.LinearTransfer,Loader:()=>e.Loader,LoaderUtils:()=>e.LoaderUtils,LoadingManager:()=>e.LoadingManager,LuminanceAlphaFormat:()=>e.LuminanceAlphaFormat,LuminanceFormat:()=>e.LuminanceFormat,MOUSE:()=>e.MOUSE,Material:()=>e.Material,MathUtils:()=>e.MathUtils,Matrix2:()=>e.Matrix2,Matrix3:()=>e.Matrix3,Matrix4:()=>e.Matrix4,Mesh:()=>e.Mesh,MeshBasicMaterial:()=>e.MeshBasicMaterial,MeshLambertMaterial:()=>e.MeshLambertMaterial,MeshPhongMaterial:()=>e.MeshPhongMaterial,MeshPhysicalMaterial:()=>e.MeshPhysicalMaterial,MeshStandardMaterial:()=>e.MeshStandardMaterial,MirroredRepeatWrapping:()=>e.MirroredRepeatWrapping,NearestFilter:()=>e.NearestFilter,NearestMipmapLinearFilter:()=>e.NearestMipmapLinearFilter,NearestMipmapNearestFilter:()=>e.NearestMipmapNearestFilter,NeverDepth:()=>e.NeverDepth,NoBlending:()=>e.NoBlending,NoColorSpace:()=>e.NoColorSpace,NormalBlending:()=>e.NormalBlending,NotEqualDepth:()=>e.NotEqualDepth,NumberKeyframeTrack:()=>e.NumberKeyframeTrack,Object3D:()=>e.Object3D,OneFactor:()=>e.OneFactor,OneMinusDstAlphaFactor:()=>e.OneMinusDstAlphaFactor,OneMinusDstColorFactor:()=>e.OneMinusDstColorFactor,OneMinusSrcAlphaFactor:()=>e.OneMinusSrcAlphaFactor,OneMinusSrcColorFactor:()=>e.OneMinusSrcColorFactor,OrthographicCamera:()=>e.OrthographicCamera,PerspectiveCamera:()=>e.PerspectiveCamera,Plane:()=>e.Plane,PlaneGeometry:()=>e.PlaneGeometry,PointLight:()=>e.PointLight,Points:()=>e.Points,PointsMaterial:()=>e.PointsMaterial,PropertyBinding:()=>e.PropertyBinding,Quaternion:()=>e.Quaternion,QuaternionKeyframeTrack:()=>e.QuaternionKeyframeTrack,RGBAFormat:()=>e.RGBAFormat,RGBA_ASTC_4x4_Format:()=>e.RGBA_ASTC_4x4_Format,RGBA_ASTC_6x6_Format:()=>e.RGBA_ASTC_6x6_Format,RGBA_BPTC_Format:()=>e.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:()=>e.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:()=>e.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format:()=>e.RGBA_S3TC_DXT1_Format,RGBA_S3TC_DXT5_Format:()=>e.RGBA_S3TC_DXT5_Format,RGB_BPTC_UNSIGNED_Format:()=>e.RGB_BPTC_UNSIGNED_Format,RGB_ETC1_Format:()=>e.RGB_ETC1_Format,RGB_ETC2_Format:()=>e.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:()=>e.RGB_PVRTC_4BPPV1_Format,RGFormat:()=>e.RGFormat,RawShaderMaterial:()=>e.RawShaderMaterial,Ray:()=>e.Ray,Raycaster:()=>e.Raycaster,RedFormat:()=>e.RedFormat,RepeatWrapping:()=>e.RepeatWrapping,ReverseSubtractEquation:()=>e.ReverseSubtractEquation,SRGBColorSpace:()=>e.SRGBColorSpace,SRGBTransfer:()=>e.SRGBTransfer,Scene:()=>e.Scene,ShaderChunk:()=>e.ShaderChunk,ShaderMaterial:()=>e.ShaderMaterial,ShortType:()=>e.ShortType,Skeleton:()=>e.Skeleton,SkinnedMesh:()=>e.SkinnedMesh,Sphere:()=>e.Sphere,SphereGeometry:()=>e.SphereGeometry,Spherical:()=>e.Spherical,SpotLight:()=>e.SpotLight,SrcAlphaFactor:()=>e.SrcAlphaFactor,SrcAlphaSaturateFactor:()=>e.SrcAlphaSaturateFactor,SrcColorFactor:()=>e.SrcColorFactor,SubtractEquation:()=>e.SubtractEquation,Texture:()=>e.Texture,TextureLoader:()=>e.TextureLoader,TextureUtils:()=>e.TextureUtils,Triangle:()=>e.Triangle,TriangleFanDrawMode:()=>e.TriangleFanDrawMode,TriangleStripDrawMode:()=>e.TriangleStripDrawMode,TrianglesDrawMode:()=>e.TrianglesDrawMode,Uniform:()=>e.Uniform,UniformsLib:()=>e.UniformsLib,UniformsUtils:()=>e.UniformsUtils,UnsignedByteType:()=>e.UnsignedByteType,UnsignedIntType:()=>e.UnsignedIntType,UnsignedShort4444Type:()=>e.UnsignedShort4444Type,UnsignedShort5551Type:()=>e.UnsignedShort5551Type,UnsignedShortType:()=>e.UnsignedShortType,Vector2:()=>e.Vector2,Vector3:()=>e.Vector3,Vector4:()=>e.Vector4,VectorKeyframeTrack:()=>e.VectorKeyframeTrack,WebGLArrayRenderTarget:()=>e.WebGLArrayRenderTarget,WebGLRenderTarget:()=>e.WebGLRenderTarget,WebGLRenderer:()=>e.WebGLRenderer,ZeroFactor:()=>e.ZeroFactor},s={},n.d(s,i),s)},43250:(e,t,r)=>{r(37467)},43251:(e,t,r)=>{var n=r(76080),i=r(69565),s=r(35548),o=r(48981),a=r(26198),l=r(70081),c=r(50851),h=r(44209),u=r(18727),d=r(94644).aTypedArrayConstructor,p=r(75854);e.exports=function(e){var t,r,f,g,A,m,y,v,w=s(this),b=o(e),E=arguments.length,x=E>1?arguments[1]:void 0,C=void 0!==x,_=c(b);if(_&&!h(_))for(v=(y=l(b,_)).next,b=[];!(m=i(v,y)).done;)b.push(m.value);for(C&&E>2&&(x=n(x,arguments[2])),r=a(b),f=new(d(w))(r),g=u(f),t=0;r>t;t++)A=C?x(b[t],t):b[t],f[t]=g?p(A):+A;return f}},43275:(e,t,r)=>{var n=r(44576),i=r(70511),s=r(24913).f,o=r(77347).f,a=n.Symbol;if(i("dispose"),a){var l=o(a,"dispose");l.enumerable&&l.configurable&&l.writable&&s(a,"dispose",{value:l.value,enumerable:!1,configurable:!1,writable:!1})}},43359:(e,t,r)=>{r(58934);var n=r(46518),i=r(53487);n({target:"String",proto:!0,name:"trimStart",forced:"".trimStart!==i},{trimStart:i})},43375:(e,t,r)=>{r(17642)},43614:e=>{function t(e,t,r){const n=new RegExp(t).exec(e.slice(r));return n?r+n.index:-1}e.exports=t,e.exports.default=t},43724:(e,t,r)=>{var n=r(79039);e.exports=!n((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},43799:(e,t,r)=>{r(14628)},43802:(e,t,r)=>{var n=r(79504),i=r(67750),s=r(655),o=r(47452),a=n("".replace),l=RegExp("^["+o+"]+"),c=RegExp("(^|[^"+o+"])["+o+"]+$"),h=function(e){return function(t){var r=s(i(t));return 1&e&&(r=a(r,l,"")),2&e&&(r=a(r,c,"$1")),r}};e.exports={start:h(1),end:h(2),trim:h(3)}},43839:(e,t,r)=>{var n=r(76080),i=r(47055),s=r(48981),o=r(26198),a=function(e){var t=1===e;return function(r,a,l){for(var c,h=s(r),u=i(h),d=o(u),p=n(a,l);d-- >0;)if(p(c=u[d],d,h))switch(e){case 0:return c;case 1:return d}return t?-1:void 0}};e.exports={findLast:a(0),findLastIndex:a(1)}},44114:(e,t,r)=>{var n=r(46518),i=r(48981),s=r(26198),o=r(34527),a=r(96837);n({target:"Array",proto:!0,arity:1,forced:r(79039)((function(){return 4294967297!==[].push.call({length:4294967296},1)}))||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}}()},{push:function(e){var t=i(this),r=s(t),n=arguments.length;a(r+n);for(var l=0;l<n;l++)t[r]=arguments[l],r++;return o(t,r),r}})},44124:(e,t,r)=>{var n=r(44576);e.exports=function(e,t){var r=n[e],i=r&&r.prototype;return i&&i[t]}},44204:(e,t,r)=>{var n=r(97080),i=r(94402).add,s=r(89286),o=r(83789),a=r(40507);e.exports=function(e){var t=n(this),r=o(e).getIterator(),l=s(t);return a(r,(function(e){i(l,e)})),l}},44209:(e,t,r)=>{var n=r(78227),i=r(26269),s=n("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(i.Array===e||o[s]===e)}},44213:(e,t,r)=>{var n=r(43724),i=r(79504),s=r(69565),o=r(79039),a=r(71072),l=r(33717),c=r(48773),h=r(48981),u=r(47055),d=Object.assign,p=Object.defineProperty,f=i([].concat);e.exports=!d||o((function(){if(n&&1!==d({b:1},d(p({},"a",{enumerable:!0,get:function(){p(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol("assign detection"),i="abcdefghijklmnopqrst";return e[r]=7,i.split("").forEach((function(e){t[e]=e})),7!==d({},e)[r]||a(d({},t)).join("")!==i}))?function(e,t){for(var r=h(e),i=arguments.length,o=1,d=l.f,p=c.f;i>o;)for(var g,A=u(arguments[o++]),m=d?f(a(A),d(A)):a(A),y=m.length,v=0;y>v;)g=m[v++],n&&!s(p,A,g)||(r[g]=A[g]);return r}:d},44265:(e,t,r)=>{var n=r(82839);e.exports=/ipad|iphone|ipod/i.test(n)&&"undefined"!=typeof Pebble},44324:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Dimension=void 0,t.Dimension={Type:{int8:{type:"signed",size:1},int16:{type:"signed",size:2},int32:{type:"signed",size:4},int64:{type:"signed",size:8},uint8:{type:"unsigned",size:1},uint16:{type:"unsigned",size:2},uint32:{type:"unsigned",size:4},uint64:{type:"unsigned",size:8},float32:{type:"float",size:4},float64:{type:"float",size:8},float:{type:"float",size:4},double:{type:"float",size:8},bool:{type:"unsigned",size:1},boolean:{type:"unsigned",size:1}},ctype:function({type:e,size:t}){switch(e){case"signed":switch(t){case 1:return"int8";case 2:return"int16";case 4:return"int32";case 8:return"int64"}case"unsigned":switch(t){case 1:return"uint8";case 2:return"uint16";case 4:return"uint32";case 8:return"uint64"}case"float":switch(t){case 4:return"float";case 8:return"double"}}throw new Error(`Invalid dimension type/size: ${e}/${t}`)}}},44435:(e,t,r)=>{r(46518)({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MIN_SAFE_INTEGER:-9007199254740991})},44496:(e,t,r)=>{var n=r(94644),i=r(19617).includes,s=n.aTypedArray;(0,n.exportTypedArrayMethod)("includes",(function(e){return i(s(this),e,arguments.length>1?arguments[1]:void 0)}))},44576:function(e,t,r){var n=function(e){return e&&e.Math===Math&&e};e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof r.g&&r.g)||n("object"==typeof this&&this)||function(){return this}()||Function("return this")()},44590:(e,t,r)=>{r(42043)},44690:(e,t,r)=>{var n=r(69565),i=r(92059);e.exports=i((function(){return n(this.next,this.iterator)}),!0)},44732:(e,t,r)=>{var n=r(94644),i=r(79504),s=r(79306),o=r(35370),a=n.aTypedArray,l=n.getTypedArrayConstructor,c=n.exportTypedArrayMethod,h=i(n.TypedArrayPrototype.sort);c("toSorted",(function(e){void 0!==e&&s(e);var t=a(this),r=o(l(t),t);return h(r,e)}))},44847:(e,t,r)=>{r(11025)},44995:(e,t,r)=>{var n=r(79504),i=WeakMap.prototype;e.exports={WeakMap,set:n(i.set),get:n(i.get),has:n(i.has),remove:n(i.delete)}},45182:(e,t,r)=>{r(46518)({target:"AsyncIterator",proto:!0,real:!0,forced:!0},{indexed:r(87481)})},45374:(e,t,r)=>{r(46518)({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{EPSILON:Math.pow(2,-52)})},45490:(e,t,r)=>{var n=r(46518),i=r(34376),s=Object.isFrozen,o=function(e,t){if(!s||!i(e)||!s(e))return!1;for(var r,n=0,o=e.length;n<o;)if(!("string"==typeof(r=e[n++])||t&&void 0===r))return!1;return 0!==o};n({target:"Array",stat:!0,sham:!0,forced:!0},{isTemplateObject:function(e){if(!o(e,!0))return!1;var t=e.raw;return t.length===e.length&&o(t,!1)}})},45700:(e,t,r)=>{var n=r(70511),i=r(58242);n("toPrimitive"),i()},45781:(e,t,r)=>{var n=r(46518),i=r(97751),s=r(22812),o=r(655),a=r(67416),l=i("URL");n({target:"URL",stat:!0,forced:!a},{parse:function(e){var t=s(arguments.length,1),r=o(e),n=t<2||void 0===arguments[1]?void 0:o(arguments[1]);try{return new l(r,n)}catch(e){return null}}})},45806:(e,t,r)=>{r(47764);var n,i=r(46518),s=r(43724),o=r(67416),a=r(44576),l=r(76080),c=r(79504),h=r(36840),u=r(62106),d=r(90679),p=r(39297),f=r(44213),g=r(97916),A=r(67680),m=r(68183).codeAt,y=r(3717),v=r(655),w=r(10687),b=r(22812),E=r(98406),x=r(91181),C=x.set,_=x.getterFor("URL"),I=E.URLSearchParams,S=E.getState,M=a.URL,T=a.TypeError,B=a.parseInt,P=Math.floor,R=Math.pow,D=c("".charAt),L=c(/./.exec),k=c([].join),O=c(1..toString),F=c([].pop),N=c([].push),U=c("".replace),Q=c([].shift),G=c("".split),z=c("".slice),j=c("".toLowerCase),V=c([].unshift),q="Invalid scheme",H="Invalid host",W="Invalid port",$=/[a-z]/i,Y=/[\d+-.a-z]/i,K=/\d/,J=/^0x/i,X=/^[0-7]+$/,Z=/^\d+$/,ee=/^[\da-f]+$/i,te=/[\0\t\n\r #%/:<>?@[\\\]^|]/,re=/[\0\t\n\r #/:<>?@[\\\]^|]/,ne=/^[\u0000-\u0020]+/,ie=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,se=/[\t\n\r]/g,oe=function(e){var t,r,n,i;if("number"==typeof e){for(t=[],r=0;r<4;r++)V(t,e%256),e=P(e/256);return k(t,".")}if("object"==typeof e){for(t="",n=function(e){for(var t=null,r=1,n=null,i=0,s=0;s<8;s++)0!==e[s]?(i>r&&(t=n,r=i),n=null,i=0):(null===n&&(n=s),++i);return i>r?n:t}(e),r=0;r<8;r++)i&&0===e[r]||(i&&(i=!1),n===r?(t+=r?":":"::",i=!0):(t+=O(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},ae={},le=f({},ae,{" ":1,'"':1,"<":1,">":1,"`":1}),ce=f({},le,{"#":1,"?":1,"{":1,"}":1}),he=f({},ce,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),ue=function(e,t){var r=m(e,0);return r>32&&r<127&&!p(t,e)?e:encodeURIComponent(e)},de={ftp:21,file:null,http:80,https:443,ws:80,wss:443},pe=function(e,t){var r;return 2===e.length&&L($,D(e,0))&&(":"===(r=D(e,1))||!t&&"|"===r)},fe=function(e){var t;return e.length>1&&pe(z(e,0,2))&&(2===e.length||"/"===(t=D(e,2))||"\\"===t||"?"===t||"#"===t)},ge=function(e){return"."===e||"%2e"===j(e)},Ae={},me={},ye={},ve={},we={},be={},Ee={},xe={},Ce={},_e={},Ie={},Se={},Me={},Te={},Be={},Pe={},Re={},De={},Le={},ke={},Oe={},Fe=function(e,t,r){var n,i,s,o=v(e);if(t){if(i=this.parse(o))throw new T(i);this.searchParams=null}else{if(void 0!==r&&(n=new Fe(r,!0)),i=this.parse(o,null,n))throw new T(i);(s=S(new I)).bindURL(this),this.searchParams=s}};Fe.prototype={type:"URL",parse:function(e,t,r){var i,s,o,a,l,c=this,h=t||Ae,u=0,d="",f=!1,m=!1,y=!1;for(e=v(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=U(e,ne,""),e=U(e,ie,"$1")),e=U(e,se,""),i=g(e);u<=i.length;){switch(s=i[u],h){case Ae:if(!s||!L($,s)){if(t)return q;h=ye;continue}d+=j(s),h=me;break;case me:if(s&&(L(Y,s)||"+"===s||"-"===s||"."===s))d+=j(s);else{if(":"!==s){if(t)return q;d="",h=ye,u=0;continue}if(t&&(c.isSpecial()!==p(de,d)||"file"===d&&(c.includesCredentials()||null!==c.port)||"file"===c.scheme&&!c.host))return;if(c.scheme=d,t)return void(c.isSpecial()&&de[c.scheme]===c.port&&(c.port=null));d="","file"===c.scheme?h=Te:c.isSpecial()&&r&&r.scheme===c.scheme?h=ve:c.isSpecial()?h=xe:"/"===i[u+1]?(h=we,u++):(c.cannotBeABaseURL=!0,N(c.path,""),h=Le)}break;case ye:if(!r||r.cannotBeABaseURL&&"#"!==s)return q;if(r.cannotBeABaseURL&&"#"===s){c.scheme=r.scheme,c.path=A(r.path),c.query=r.query,c.fragment="",c.cannotBeABaseURL=!0,h=Oe;break}h="file"===r.scheme?Te:be;continue;case ve:if("/"!==s||"/"!==i[u+1]){h=be;continue}h=Ce,u++;break;case we:if("/"===s){h=_e;break}h=De;continue;case be:if(c.scheme=r.scheme,s===n)c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=A(r.path),c.query=r.query;else if("/"===s||"\\"===s&&c.isSpecial())h=Ee;else if("?"===s)c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=A(r.path),c.query="",h=ke;else{if("#"!==s){c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=A(r.path),c.path.length--,h=De;continue}c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=A(r.path),c.query=r.query,c.fragment="",h=Oe}break;case Ee:if(!c.isSpecial()||"/"!==s&&"\\"!==s){if("/"!==s){c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,h=De;continue}h=_e}else h=Ce;break;case xe:if(h=Ce,"/"!==s||"/"!==D(d,u+1))continue;u++;break;case Ce:if("/"!==s&&"\\"!==s){h=_e;continue}break;case _e:if("@"===s){f&&(d="%40"+d),f=!0,o=g(d);for(var w=0;w<o.length;w++){var b=o[w];if(":"!==b||y){var E=ue(b,he);y?c.password+=E:c.username+=E}else y=!0}d=""}else if(s===n||"/"===s||"?"===s||"#"===s||"\\"===s&&c.isSpecial()){if(f&&""===d)return"Invalid authority";u-=g(d).length+1,d="",h=Ie}else d+=s;break;case Ie:case Se:if(t&&"file"===c.scheme){h=Pe;continue}if(":"!==s||m){if(s===n||"/"===s||"?"===s||"#"===s||"\\"===s&&c.isSpecial()){if(c.isSpecial()&&""===d)return H;if(t&&""===d&&(c.includesCredentials()||null!==c.port))return;if(a=c.parseHost(d))return a;if(d="",h=Re,t)return;continue}"["===s?m=!0:"]"===s&&(m=!1),d+=s}else{if(""===d)return H;if(a=c.parseHost(d))return a;if(d="",h=Me,t===Se)return}break;case Me:if(!L(K,s)){if(s===n||"/"===s||"?"===s||"#"===s||"\\"===s&&c.isSpecial()||t){if(""!==d){var x=B(d,10);if(x>65535)return W;c.port=c.isSpecial()&&x===de[c.scheme]?null:x,d=""}if(t)return;h=Re;continue}return W}d+=s;break;case Te:if(c.scheme="file","/"===s||"\\"===s)h=Be;else{if(!r||"file"!==r.scheme){h=De;continue}switch(s){case n:c.host=r.host,c.path=A(r.path),c.query=r.query;break;case"?":c.host=r.host,c.path=A(r.path),c.query="",h=ke;break;case"#":c.host=r.host,c.path=A(r.path),c.query=r.query,c.fragment="",h=Oe;break;default:fe(k(A(i,u),""))||(c.host=r.host,c.path=A(r.path),c.shortenPath()),h=De;continue}}break;case Be:if("/"===s||"\\"===s){h=Pe;break}r&&"file"===r.scheme&&!fe(k(A(i,u),""))&&(pe(r.path[0],!0)?N(c.path,r.path[0]):c.host=r.host),h=De;continue;case Pe:if(s===n||"/"===s||"\\"===s||"?"===s||"#"===s){if(!t&&pe(d))h=De;else if(""===d){if(c.host="",t)return;h=Re}else{if(a=c.parseHost(d))return a;if("localhost"===c.host&&(c.host=""),t)return;d="",h=Re}continue}d+=s;break;case Re:if(c.isSpecial()){if(h=De,"/"!==s&&"\\"!==s)continue}else if(t||"?"!==s)if(t||"#"!==s){if(s!==n&&(h=De,"/"!==s))continue}else c.fragment="",h=Oe;else c.query="",h=ke;break;case De:if(s===n||"/"===s||"\\"===s&&c.isSpecial()||!t&&("?"===s||"#"===s)){if(".."===(l=j(l=d))||"%2e."===l||".%2e"===l||"%2e%2e"===l?(c.shortenPath(),"/"===s||"\\"===s&&c.isSpecial()||N(c.path,"")):ge(d)?"/"===s||"\\"===s&&c.isSpecial()||N(c.path,""):("file"===c.scheme&&!c.path.length&&pe(d)&&(c.host&&(c.host=""),d=D(d,0)+":"),N(c.path,d)),d="","file"===c.scheme&&(s===n||"?"===s||"#"===s))for(;c.path.length>1&&""===c.path[0];)Q(c.path);"?"===s?(c.query="",h=ke):"#"===s&&(c.fragment="",h=Oe)}else d+=ue(s,ce);break;case Le:"?"===s?(c.query="",h=ke):"#"===s?(c.fragment="",h=Oe):s!==n&&(c.path[0]+=ue(s,ae));break;case ke:t||"#"!==s?s!==n&&("'"===s&&c.isSpecial()?c.query+="%27":c.query+="#"===s?"%23":ue(s,ae)):(c.fragment="",h=Oe);break;case Oe:s!==n&&(c.fragment+=ue(s,le))}u++}},parseHost:function(e){var t,r,n;if("["===D(e,0)){if("]"!==D(e,e.length-1))return H;if(t=function(e){var t,r,n,i,s,o,a,l=[0,0,0,0,0,0,0,0],c=0,h=null,u=0,d=function(){return D(e,u)};if(":"===d()){if(":"!==D(e,1))return;u+=2,h=++c}for(;d();){if(8===c)return;if(":"!==d()){for(t=r=0;r<4&&L(ee,d());)t=16*t+B(d(),16),u++,r++;if("."===d()){if(0===r)return;if(u-=r,c>6)return;for(n=0;d();){if(i=null,n>0){if(!("."===d()&&n<4))return;u++}if(!L(K,d()))return;for(;L(K,d());){if(s=B(d(),10),null===i)i=s;else{if(0===i)return;i=10*i+s}if(i>255)return;u++}l[c]=256*l[c]+i,2!=++n&&4!==n||c++}if(4!==n)return;break}if(":"===d()){if(u++,!d())return}else if(d())return;l[c++]=t}else{if(null!==h)return;u++,h=++c}}if(null!==h)for(o=c-h,c=7;0!==c&&o>0;)a=l[c],l[c--]=l[h+o-1],l[h+--o]=a;else if(8!==c)return;return l}(z(e,1,-1)),!t)return H;this.host=t}else if(this.isSpecial()){if(e=y(e),L(te,e))return H;if(t=function(e){var t,r,n,i,s,o,a,l=G(e,".");if(l.length&&""===l[l.length-1]&&l.length--,(t=l.length)>4)return e;for(r=[],n=0;n<t;n++){if(""===(i=l[n]))return e;if(s=10,i.length>1&&"0"===D(i,0)&&(s=L(J,i)?16:8,i=z(i,8===s?1:2)),""===i)o=0;else{if(!L(10===s?Z:8===s?X:ee,i))return e;o=B(i,s)}N(r,o)}for(n=0;n<t;n++)if(o=r[n],n===t-1){if(o>=R(256,5-t))return null}else if(o>255)return null;for(a=F(r),n=0;n<r.length;n++)a+=r[n]*R(256,3-n);return a}(e),null===t)return H;this.host=t}else{if(L(re,e))return H;for(t="",r=g(e),n=0;n<r.length;n++)t+=ue(r[n],ae);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme},includesCredentials:function(){return""!==this.username||""!==this.password},isSpecial:function(){return p(de,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"===this.scheme&&1===t&&pe(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,n=e.password,i=e.host,s=e.port,o=e.path,a=e.query,l=e.fragment,c=t+":";return null!==i?(c+="//",e.includesCredentials()&&(c+=r+(n?":"+n:"")+"@"),c+=oe(i),null!==s&&(c+=":"+s)):"file"===t&&(c+="//"),c+=e.cannotBeABaseURL?o[0]:o.length?"/"+k(o,"/"):"",null!==a&&(c+="?"+a),null!==l&&(c+="#"+l),c},setHref:function(e){var t=this.parse(e);if(t)throw new T(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"===e)try{return new Ne(e.path[0]).origin}catch(e){return"null"}return"file"!==e&&this.isSpecial()?e+"://"+oe(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(v(e)+":",Ae)},getUsername:function(){return this.username},setUsername:function(e){var t=g(v(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=ue(t[r],he)}},getPassword:function(){return this.password},setPassword:function(e){var t=g(v(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=ue(t[r],he)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?oe(e):oe(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Ie)},getHostname:function(){var e=this.host;return null===e?"":oe(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Se)},getPort:function(){var e=this.port;return null===e?"":v(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""===(e=v(e))?this.port=null:this.parse(e,Me))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+k(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Re))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""===(e=v(e))?this.query=null:("?"===D(e,0)&&(e=z(e,1)),this.query="",this.parse(e,ke)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!==(e=v(e))?("#"===D(e,0)&&(e=z(e,1)),this.fragment="",this.parse(e,Oe)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Ne=function(e){var t=d(this,Ue),r=b(arguments.length,1)>1?arguments[1]:void 0,n=C(t,new Fe(e,!1,r));s||(t.href=n.serialize(),t.origin=n.getOrigin(),t.protocol=n.getProtocol(),t.username=n.getUsername(),t.password=n.getPassword(),t.host=n.getHost(),t.hostname=n.getHostname(),t.port=n.getPort(),t.pathname=n.getPathname(),t.search=n.getSearch(),t.searchParams=n.getSearchParams(),t.hash=n.getHash())},Ue=Ne.prototype,Qe=function(e,t){return{get:function(){return _(this)[e]()},set:t&&function(e){return _(this)[t](e)},configurable:!0,enumerable:!0}};if(s&&(u(Ue,"href",Qe("serialize","setHref")),u(Ue,"origin",Qe("getOrigin")),u(Ue,"protocol",Qe("getProtocol","setProtocol")),u(Ue,"username",Qe("getUsername","setUsername")),u(Ue,"password",Qe("getPassword","setPassword")),u(Ue,"host",Qe("getHost","setHost")),u(Ue,"hostname",Qe("getHostname","setHostname")),u(Ue,"port",Qe("getPort","setPort")),u(Ue,"pathname",Qe("getPathname","setPathname")),u(Ue,"search",Qe("getSearch","setSearch")),u(Ue,"searchParams",Qe("getSearchParams")),u(Ue,"hash",Qe("getHash","setHash"))),h(Ue,"toJSON",(function(){return _(this).serialize()}),{enumerable:!0}),h(Ue,"toString",(function(){return _(this).serialize()}),{enumerable:!0}),M){var Ge=M.createObjectURL,ze=M.revokeObjectURL;Ge&&h(Ne,"createObjectURL",l(Ge,M)),ze&&h(Ne,"revokeObjectURL",l(ze,M))}w(Ne,"URL"),i({global:!0,constructor:!0,forced:!o,sham:!s},{URL:Ne})},45876:(e,t,r)=>{var n=r(46518),i=r(53838);n({target:"Set",proto:!0,real:!0,forced:!r(84916)("isSubsetOf",(function(e){return e}))},{isSubsetOf:i})},45882:(e,t,r)=>{r(49603)},45995:(e,t,r)=>{e.exports=function(e){function t(e){let r,i,s,o=null;function a(...e){if(!a.enabled)return;const n=a,i=Number(new Date),s=i-(r||i);n.diff=s,n.prev=r,n.curr=i,r=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,i)=>{if("%%"===r)return"%";o++;const s=t.formatters[i];if("function"==typeof s){const t=e[o];r=s.call(n,t),e.splice(o,1),o--}return r})),t.formatArgs.call(n,e),(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==t.namespaces&&(i=t.namespaces,s=t.enabled(e)),s),set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function i(e,t){let r=0,n=0,i=-1,s=0;for(;r<e.length;)if(n<t.length&&(t[n]===e[r]||"*"===t[n]))"*"===t[n]?(i=n,s=r,n++):(r++,n++);else{if(-1===i)return!1;n=i+1,s++,r=s}for(;n<t.length&&"*"===t[n];)n++;return n===t.length}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names,...t.skips.map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").trim().replace(" ",",").split(",").filter(Boolean);for(const e of r)"-"===e[0]?t.skips.push(e.slice(1)):t.names.push(e)},t.enabled=function(e){for(const r of t.skips)if(i(e,r))return!1;for(const r of t.names)if(i(e,r))return!0;return!1},t.humanize=r(6585),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}},46058:(e,t,r)=>{var n=r(46518),i=r(77957),s=r(6469);n({target:"Array",proto:!0},{group:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),s("group")},46270:(e,t,r)=>{var n=r(46518),i=r(88205);n({target:"WeakSet",stat:!0,forced:!0},{of:r(87500)(i.WeakSet,i.add,!1)})},46276:(e,t,r)=>{var n=r(46518),i=r(77240);n({target:"String",proto:!0,forced:r(23061)("strike")},{strike:function(){return i(this,"strike","","")}})},46449:(e,t,r)=>{var n=r(46518),i=r(70259),s=r(48981),o=r(26198),a=r(91291),l=r(1469);n({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=s(this),r=o(t),n=l(t,0);return n.length=i(n,t,t,r,0,void 0===e?1:a(e)),n}})},46518:(e,t,r)=>{var n=r(44576),i=r(77347).f,s=r(66699),o=r(36840),a=r(39433),l=r(77740),c=r(92796);e.exports=function(e,t){var r,h,u,d,p,f=e.target,g=e.global,A=e.stat;if(r=g?n:A?n[f]||a(f,{}):n[f]&&n[f].prototype)for(h in t){if(d=t[h],u=e.dontCallGetSet?(p=i(r,h))&&p.value:r[h],!c(g?h:f+(A?".":"#")+h,e.forced)&&void 0!==u){if(typeof d==typeof u)continue;l(d,u)}(e.sham||u&&u.sham)&&s(d,"sham",!0),o(r,h,d,e)}}},46594:(e,t,r)=>{r(15823)("Int8",(function(e){return function(t,r,n){return e(this,t,r,n)}}))},46706:(e,t,r)=>{var n=r(79504),i=r(79306);e.exports=function(e,t,r){try{return n(i(Object.getOwnPropertyDescriptor(e,t)[r]))}catch(e){}}},46761:(e,t,r)=>{var n=r(46518),i=r(94644);n({target:"ArrayBuffer",stat:!0,forced:!i.NATIVE_ARRAY_BUFFER_VIEWS},{isView:i.isView})},46967:(e,t,r)=>{var n=r(46518),i=r(48981),s=r(1625),o=r(50133),a=r(53982),l=r(44690);n({target:"AsyncIterator",stat:!0,forced:r(96395)},{from:function(e){var t=o("string"==typeof e?i(e):e);return s(a,t.iterator)?t.iterator:new l(t)}})},47055:(e,t,r)=>{var n=r(79504),i=r(79039),s=r(22195),o=Object,a=n("".split);e.exports=i((function(){return!o("z").propertyIsEnumerable(0)}))?function(e){return"String"===s(e)?a(e,""):o(e)}:o},47072:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(79306),o=r(67750),a=r(72652),l=r(72248),c=r(96395),h=r(79039),u=l.Map,d=l.has,p=l.get,f=l.set,g=i([].push),A=c||h((function(){return 1!==u.groupBy("ab",(function(e){return e})).get("a").length}));n({target:"Map",stat:!0,forced:c||A},{groupBy:function(e,t){o(e),s(t);var r=new u,n=0;return a(e,(function(e){var i=t(e,n++);d(r,i)?g(p(r,i),e):f(r,i,[e])})),r}})},47350:(e,t,r)=>{var n=r(94644),i=r(59213).filterReject,s=r(29948),o=n.aTypedArray;(0,n.exportTypedArrayMethod)("filterReject",(function(e){var t=i(o(this),e,arguments.length>1?arguments[1]:void 0);return s(this,t)}),!0)},47390:(e,t,r)=>{r(10255)},47452:e=>{e.exports="\t\n\v\f\r \u2028\u2029\ufeff"},47566:(e,t,r)=>{var n=r(36840),i=r(79504),s=r(655),o=r(22812),a=URLSearchParams,l=a.prototype,c=i(l.getAll),h=i(l.has),u=new a("a=1");!u.has("a",2)&&u.has("a",void 0)||n(l,"has",(function(e){var t=arguments.length,r=t<2?void 0:arguments[1];if(t&&void 0===r)return h(this,e);var n=c(this,e);o(t,1);for(var i=s(r),a=0;a<n.length;)if(n[a++]===i)return!0;return!1}),{enumerable:!0,unsafe:!0})},47575:(e,t,r)=>{r(93518)},47628:(e,t,r)=>{r(31689)},47650:(e,t,r)=>{var n=r(97751),i=r(94901),s=r(31563),o=r(20034),a=n("Set");e.exports=function(e){return function(e){return o(e)&&"number"==typeof e.size&&i(e.has)&&i(e.keys)}(e)?e:s(e)?new a(e):e}},47764:(e,t,r)=>{var n=r(68183).charAt,i=r(655),s=r(91181),o=r(51088),a=r(62529),l="String Iterator",c=s.set,h=s.getterFor(l);o(String,"String",(function(e){c(this,{type:l,string:i(e),index:0})}),(function(){var e,t=h(this),r=t.string,i=t.index;return i>=r.length?a(void 0,!0):(e=n(r,i),t.index+=e.length,a(e,!1))}))},47801:(e,t,r)=>{r(77936)},47952:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.formatGuid=t.parsePoint=void 0;const n=r(876);t.parsePoint=function(e){const t=n.Binary.toDataView(e);if(24!==t.byteLength)throw new Error(`Invalid tuple buffer length: ${t.byteLength}`);return[t.getFloat64(0,!0),t.getFloat64(8,!0),t.getFloat64(16,!0)]},t.formatGuid=function(e){const t=n.Binary.toDataView(e);if(16!==t.byteLength)throw new Error(`Invalid GUID buffer length: ${t.byteLength}`);let r="";for(let e=0;e<t.byteLength;e+=4)r+=t.getUint32(e,!0).toString(16).padStart(8,"0");return[r.slice(0,8),r.slice(8,12),r.slice(12,16),r.slice(16,32)].join("-")}},47958:(e,t,r)=>{var n=r(69565),i=r(20713),s=function(e,t){return[t,e]};e.exports=function(){return n(i,this,s)}},48140:(e,t,r)=>{var n=r(94644),i=r(26198),s=r(91291),o=n.aTypedArray;(0,n.exportTypedArrayMethod)("at",(function(e){var t=o(this),r=i(t),n=s(e),a=n>=0?n:r+n;return a<0||a>=r?void 0:t[a]}))},48215:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createProxyModule=t.createProxyFunction=void 0;const i=n(r(90148)),s=r(54527),o=r(99278),a=r(41898),l=r(66712),c=r(12781),h=i.default("threads:master:messages");let u=1;function d(e,t){return(...r)=>{const n=u++,{args:i,transferables:d}=function(e){if(0===e.length)return{args:[],transferables:[]};const t=[],r=[];for(const n of e)l.isTransferDescriptor(n)?(t.push(o.serialize(n.send)),r.push(...n.transferables)):t.push(o.serialize(n));return{args:t,transferables:0===r.length?r:(n=r,Array.from(new Set(n)))};var n}(r),p={type:c.MasterMessageType.run,uid:n,method:t,args:i};h("Sending command to run function to worker:",p);try{e.postMessage(p,d)}catch(e){return a.ObservablePromise.from(Promise.reject(e))}return a.ObservablePromise.from(s.multicast(function(e,t){return new s.Observable((r=>{let n;const i=s=>{var a;if(h("Message from worker:",s.data),s.data&&s.data.uid===t)if((a=s.data)&&a.type===c.WorkerMessageType.running)n=s.data.resultType;else if((e=>e&&e.type===c.WorkerMessageType.result)(s.data))"promise"===n?(void 0!==s.data.payload&&r.next(o.deserialize(s.data.payload)),r.complete(),e.removeEventListener("message",i)):(s.data.payload&&r.next(o.deserialize(s.data.payload)),s.data.complete&&(r.complete(),e.removeEventListener("message",i)));else if((e=>e&&e.type===c.WorkerMessageType.error)(s.data)){const t=o.deserialize(s.data.error);r.error(t),e.removeEventListener("message",i)}};return e.addEventListener("message",i),()=>{if("observable"===n||!n){const r={type:c.MasterMessageType.cancel,uid:t};e.postMessage(r)}e.removeEventListener("message",i)}}))}(e,n)))}}t.createProxyFunction=d,t.createProxyModule=function(e,t){const r={};for(const n of t)r[n]=d(e,n);return r}},48300:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.evlrHeaderLength=t.vlrHeaderLength=t.minHeaderLength=void 0,t.minHeaderLength=375,t.vlrHeaderLength=54,t.evlrHeaderLength=60},48345:(e,t,r)=>{var n=r(72805);(0,r(94644).exportTypedArrayStaticMethod)("from",r(43251),n)},48408:(e,t,r)=>{r(98406)},48523:(e,t,r)=>{r(16468)("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),r(86938))},48598:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(47055),o=r(25397),a=r(34598),l=i([].join);n({target:"Array",proto:!0,forced:s!==Object||!a("join",",")},{join:function(e){return l(o(this),void 0===e?",":e)}})},48646:(e,t,r)=>{var n=r(69565),i=r(28551),s=r(1767),o=r(50851);e.exports=function(e,t){t&&"string"==typeof e||i(e);var r=o(e);return s(i(void 0!==r?n(r,e):e))}},48686:(e,t,r)=>{var n=r(43724),i=r(79039);e.exports=n&&i((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},48694:e=>{function t(e,t,r){const n=new RegExp(t).exec(e.slice(r));return n?r+n.index+n[0].length-1:-1}e.exports=t,e.exports.default=t},48718:(e,t,r)=>{var n=r(46518),i=r(77240);n({target:"String",proto:!0,forced:r(23061)("sub")},{sub:function(){return i(this,"sub","","")}})},48773:(e,t)=>{var r={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,i=n&&!r.call({1:2},1);t.f=i?function(e){var t=n(this,e);return!!t&&t.enumerable}:r},48918:(e,t,r)=>{var n=r(46518),i=r(91354);n({target:"Object",stat:!0,forced:!0},{iterateValues:function(e){return new i(e,"values")}})},48957:(e,t,r)=>{var n=r(94901),i=r(20034),s=r(24913),o=r(1625),a=r(78227),l=r(50283),c=a("hasInstance"),h=Function.prototype;c in h||s.f(h,c,{value:l((function(e){if(!n(this)||!i(e))return!1;var t=this.prototype;return i(t)?o(t,e):e instanceof this}),c)})},48980:(e,t,r)=>{var n=r(46518),i=r(59213).findIndex,s=r(6469),o="findIndex",a=!0;o in[]&&Array(1)[o]((function(){a=!1})),n({target:"Array",proto:!0,forced:a},{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),s(o)},48981:(e,t,r)=>{var n=r(67750),i=Object;e.exports=function(e){return i(n(e))}},49340:e=>{var t=Math.log,r=Math.LOG10E;e.exports=Math.log10||function(e){return t(e)*r}},49522:(e,t,r)=>{var n=r(46518),i=r(94402);n({target:"Set",stat:!0,forced:!0},{from:r(70933)(i.Set,i.add,!1)})},49536:(e,t,r)=>{var n=r(46518),i=r(79306),s=r(97080),o=r(38469),a=TypeError;n({target:"Set",proto:!0,real:!0,forced:!0},{reduce:function(e){var t=s(this),r=arguments.length<2,n=r?void 0:arguments[1];if(i(e),o(t,(function(i){r?(r=!1,n=i):n=e(n,i,i,t)})),r)throw new a("Reduce of empty set with no initial value");return n}})},49603:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(48981),o=r(1625),a=r(57657).IteratorPrototype,l=r(19462),c=r(48646),h=r(96395),u=l((function(){return i(this.next,this.iterator)}),!0);n({target:"Iterator",stat:!0,forced:h},{from:function(e){var t=c("string"==typeof e?s(e):e,!0);return o(a,t.iterator)?t.iterator:new u(t)}})},49604:(e,t,r)=>{r(70511)("customMatcher")},49631:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(79504),o=r(83972),a=r(34154),l=r(55169),c=r(92804),h=r(944),u=c.i2c,d=c.i2cUrl,p=s("".charAt);i.Uint8Array&&n({target:"Uint8Array",proto:!0},{toBase64:function(){var e=a(this),t=arguments.length?o(arguments[0]):void 0,r="base64"===h(t)?u:d,n=!!t&&!!t.omitPadding;l(this.buffer);for(var i,s="",c=0,f=e.length,g=function(e){return p(r,i>>6*e&63)};c+2<f;c+=3)i=(e[c]<<16)+(e[c+1]<<8)+e[c+2],s+=g(3)+g(2)+g(1)+g(0);return c+2===f?(i=(e[c]<<16)+(e[c+1]<<8),s+=g(3)+g(2)+g(1)+(n?"":"=")):c+1===f&&(i=e[c]<<16,s+=g(3)+g(2)+(n?"":"==")),s}})},49634:(e,t,r)=>{r(46518)({target:"WeakMap",proto:!0,real:!0,forced:!0},{upsert:r(162)})},49773:(e,t,r)=>{var n=r(46518),i=r(4495),s=r(79039),o=r(33717),a=r(48981);n({target:"Object",stat:!0,forced:!i||s((function(){o.f(1)}))},{getOwnPropertySymbols:function(e){var t=o.f;return t?t(a(e)):[]}})},49797:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(63463),o=r(34154),a=r(55169),l=r(42303);i.Uint8Array&&n({target:"Uint8Array",proto:!0},{setFromHex:function(e){o(this),s(e),a(this.buffer);var t=l(e,this).read;return{read:t,written:t/2}}})},49806:(e,t,r)=>{r(30067)},50040:(e,t,r)=>{r.d(t,{Ay:()=>y});var n,i=Object.freeze({Linear:Object.freeze({None:function(e){return e},In:function(e){return e},Out:function(e){return e},InOut:function(e){return e}}),Quadratic:Object.freeze({In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}}),Cubic:Object.freeze({In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}}),Quartic:Object.freeze({In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}}),Quintic:Object.freeze({In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}}),Sinusoidal:Object.freeze({In:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return.5*(1-Math.sin(Math.PI*(.5-e)))}}),Exponential:Object.freeze({In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(2-Math.pow(2,-10*(e-1)))}}),Circular:Object.freeze({In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}}),Elastic:Object.freeze({In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin(5*(e-.1)*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin(5*(e-1.1)*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin(5*(e-1.1)*Math.PI)+1}}),Back:Object.freeze({In:function(e){var t=1.70158;return 1===e?1:e*e*((t+1)*e-t)},Out:function(e){var t=1.70158;return 0===e?0:--e*e*((t+1)*e+t)+1},InOut:function(e){var t=2.5949095;return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}}),Bounce:Object.freeze({In:function(e){return 1-i.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*i.Bounce.In(2*e):.5*i.Bounce.Out(2*e-1)+.5}}),generatePow:function(e){return void 0===e&&(e=4),e=(e=e<Number.EPSILON?Number.EPSILON:e)>1e4?1e4:e,{In:function(t){return Math.pow(t,e)},Out:function(t){return 1-Math.pow(1-t,e)},InOut:function(t){return t<.5?Math.pow(2*t,e)/2:(1-Math.pow(2-2*t,e))/2+.5}}}}),s=function(){return performance.now()},o=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._tweens={},this._tweensAddedDuringUpdate={},this.add.apply(this,e)}return e.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map((function(t){return e._tweens[t]}))},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];for(var n=0,i=t;n<i.length;n++){var s=i[n];null===(e=s._group)||void 0===e||e.remove(s),s._group=this,this._tweens[s.getId()]=s,this._tweensAddedDuringUpdate[s.getId()]=s}},e.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0,n=e;r<n.length;r++){var i=n[r];i._group=void 0,delete this._tweens[i.getId()],delete this._tweensAddedDuringUpdate[i.getId()]}},e.prototype.allStopped=function(){return this.getAll().every((function(e){return!e.isPlaying()}))},e.prototype.update=function(e,t){void 0===e&&(e=s()),void 0===t&&(t=!0);var r=Object.keys(this._tweens);if(0!==r.length)for(;r.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<r.length;n++){var i=this._tweens[r[n]],o=!t;i&&!1===i.update(e,o)&&!t&&this.remove(i)}r=Object.keys(this._tweensAddedDuringUpdate)}},e}(),a={Linear:function(e,t){var r=e.length-1,n=r*t,i=Math.floor(n),s=a.Utils.Linear;return t<0?s(e[0],e[1],n):t>1?s(e[r],e[r-1],r-n):s(e[i],e[i+1>r?r:i+1],n-i)},Bezier:function(e,t){for(var r=0,n=e.length-1,i=Math.pow,s=a.Utils.Bernstein,o=0;o<=n;o++)r+=i(1-t,n-o)*i(t,o)*e[o]*s(n,o);return r},CatmullRom:function(e,t){var r=e.length-1,n=r*t,i=Math.floor(n),s=a.Utils.CatmullRom;return e[0]===e[r]?(t<0&&(i=Math.floor(n=r*(1+t))),s(e[(i-1+r)%r],e[i],e[(i+1)%r],e[(i+2)%r],n-i)):t<0?e[0]-(s(e[0],e[0],e[1],e[1],-n)-e[0]):t>1?e[r]-(s(e[r],e[r],e[r-1],e[r-1],n-r)-e[r]):s(e[i?i-1:0],e[i],e[r<i+1?r:i+1],e[r<i+2?r:i+2],n-i)},Utils:{Linear:function(e,t,r){return(t-e)*r+e},Bernstein:function(e,t){var r=a.Utils.Factorial;return r(e)/r(t)/r(e-t)},Factorial:(n=[1],function(e){var t=1;if(n[e])return n[e];for(var r=e;r>1;r--)t*=r;return n[e]=t,t}),CatmullRom:function(e,t,r,n,i){var s=.5*(r-e),o=.5*(n-t),a=i*i;return(2*t-2*r+s+o)*(i*a)+(-3*t+3*r-2*s-o)*a+s*i+t}}},l=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),c=new o,h=function(){function e(e,t){this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=i.Linear.None,this._interpolationFunction=a.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=l.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1,this._object=e,"object"==typeof t?(this._group=t,t.add(this)):!0===t&&(this._group=c,c.add(this))}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.getDuration=function(){return this._duration},e.prototype.to=function(e,t){if(void 0===t&&(t=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=e,this._propertiesAreSetUp=!1,this._duration=t<0?0:t,this},e.prototype.duration=function(e){return void 0===e&&(e=1e3),this._duration=e<0?0:e,this},e.prototype.dynamic=function(e){return void 0===e&&(e=!1),this._isDynamic=e,this},e.prototype.start=function(e,t){if(void 0===e&&(e=s()),void 0===t&&(t=!1),this._isPlaying)return this;if(this._repeat=this._initialRepeat,this._reversed)for(var r in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(r),this._valuesStart[r]=this._valuesStartRepeat[r];if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=e,this._startTime+=this._delayTime,!this._propertiesAreSetUp||t){if(this._propertiesAreSetUp=!0,!this._isDynamic){var n={};for(var i in this._valuesEnd)n[i]=this._valuesEnd[i];this._valuesEnd=n}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,t)}return this},e.prototype.startFromCurrentValues=function(e){return this.start(e,!0)},e.prototype._setupProperties=function(e,t,r,n,i){for(var s in r){var o=e[s],a=Array.isArray(o),l=a?"array":typeof o,c=!a&&Array.isArray(r[s]);if("undefined"!==l&&"function"!==l){if(c){if(0===(A=r[s]).length)continue;for(var h=[o],u=0,d=A.length;u<d;u+=1){var p=this._handleRelativeValue(o,A[u]);if(isNaN(p)){c=!1,console.warn("Found invalid interpolation list. Skipping.");break}h.push(p)}c&&(r[s]=h)}if("object"!==l&&!a||!o||c)(void 0===t[s]||i)&&(t[s]=o),a||(t[s]*=1),n[s]=c?r[s].slice().reverse():t[s]||0;else{t[s]=a?[]:{};var f=o;for(var g in f)t[s][g]=f[g];n[s]=a?[]:{};var A=r[s];if(!this._isDynamic){var m={};for(var g in A)m[g]=A[g];r[s]=A=m}this._setupProperties(f,t[s],A,n[s],i)}}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},e.prototype.end=function(){return this._goToEnd=!0,this.update(this._startTime+this._duration),this},e.prototype.pause=function(e){return void 0===e&&(e=s()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=e),this},e.prototype.resume=function(e){return void 0===e&&(e=s()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this):this},e.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},e.prototype.group=function(e){return e?(e.add(this),this):(console.warn("tween.group() without args has been removed, use group.add(tween) instead."),this)},e.prototype.remove=function(){var e;return null===(e=this._group)||void 0===e||e.remove(this),this},e.prototype.delay=function(e){return void 0===e&&(e=0),this._delayTime=e,this},e.prototype.repeat=function(e){return void 0===e&&(e=0),this._initialRepeat=e,this._repeat=e,this},e.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},e.prototype.yoyo=function(e){return void 0===e&&(e=!1),this._yoyo=e,this},e.prototype.easing=function(e){return void 0===e&&(e=i.Linear.None),this._easingFunction=e,this},e.prototype.interpolation=function(e){return void 0===e&&(e=a.Linear),this._interpolationFunction=e,this},e.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},e.prototype.onStart=function(e){return this._onStartCallback=e,this},e.prototype.onEveryStart=function(e){return this._onEveryStartCallback=e,this},e.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},e.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},e.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},e.prototype.onStop=function(e){return this._onStopCallback=e,this},e.prototype.update=function(t,r){var n,i,o=this;if(void 0===t&&(t=s()),void 0===r&&(r=e.autoStartOnUpdate),this._isPaused)return!0;if(!this._goToEnd&&!this._isPlaying){if(!r)return!1;this.start(t,!0)}if(this._goToEnd=!1,t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),!1===this._onEveryStartCallbackFired&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0);var a=t-this._startTime,l=this._duration+(null!==(n=this._repeatDelayTime)&&void 0!==n?n:this._delayTime),c=this._duration+this._repeat*l,h=function(){if(0===o._duration)return 1;if(a>c)return 1;var e=Math.trunc(a/l),t=a-e*l,r=Math.min(t/o._duration,1);return 0===r&&a===o._duration?1:r}(),u=this._easingFunction(h);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,u),this._onUpdateCallback&&this._onUpdateCallback(this._object,h),0===this._duration||a>=this._duration){if(this._repeat>0){var d=Math.min(Math.trunc((a-this._duration)/l)+1,this._repeat);for(i in isFinite(this._repeat)&&(this._repeat-=d),this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[i]||(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];return this._yoyo&&(this._reversed=!this._reversed),this._startTime+=l*d,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var p=0,f=this._chainedTweens.length;p<f;p++)this._chainedTweens[p].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},e.prototype._updateProperties=function(e,t,r,n){for(var i in r)if(void 0!==t[i]){var s=t[i]||0,o=r[i],a=Array.isArray(e[i]),l=Array.isArray(o);!a&&l?e[i]=this._interpolationFunction(o,n):"object"==typeof o&&o?this._updateProperties(e[i],s,o,n):"number"==typeof(o=this._handleRelativeValue(s,o))&&(e[i]=s+(o-s)*n)}},e.prototype._handleRelativeValue=function(e,t){return"string"!=typeof t?t:"+"===t.charAt(0)||"-"===t.charAt(0)?e+parseFloat(t):parseFloat(t)},e.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],r=this._valuesEnd[e];this._valuesStartRepeat[e]="string"==typeof r?this._valuesStartRepeat[e]+parseFloat(r):this._valuesEnd[e],this._valuesEnd[e]=t},e.autoStartOnUpdate=!1,e}(),u=l.nextId,d=c,p=d.getAll.bind(d),f=d.removeAll.bind(d),g=d.add.bind(d),A=d.remove.bind(d),m=d.update.bind(d),y={Easing:i,Group:o,Interpolation:a,now:s,Sequence:l,nextId:u,Tween:h,VERSION:"25.0.0",getAll:p,removeAll:f,add:g,remove:A,update:m}},50113:(e,t,r)=>{var n=r(46518),i=r(59213).find,s=r(6469),o="find",a=!0;o in[]&&Array(1)[o]((function(){a=!1})),n({target:"Array",proto:!0,forced:a},{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),s(o)},50133:(e,t,r)=>{var n=r(69565),i=r(94901),s=r(28551),o=r(1767),a=r(50851),l=r(55966),c=r(78227),h=r(24074),u=c("asyncIterator");e.exports=function(e){var t,r=s(e),c=!0,d=l(r,u);return i(d)||(d=a(r),c=!1),void 0!==d?t=n(d,r):(t=r,c=!0),s(t),o(c?t:new h(o(t)))}},50283:(e,t,r)=>{var n=r(79504),i=r(79039),s=r(94901),o=r(39297),a=r(43724),l=r(10350).CONFIGURABLE,c=r(33706),h=r(91181),u=h.enforce,d=h.get,p=String,f=Object.defineProperty,g=n("".slice),A=n("".replace),m=n([].join),y=a&&!i((function(){return 8!==f((function(){}),"length",{value:8}).length})),v=String(String).split("String"),w=e.exports=function(e,t,r){"Symbol("===g(p(t),0,7)&&(t="["+A(p(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!o(e,"name")||l&&e.name!==t)&&(a?f(e,"name",{value:t,configurable:!0}):e.name=t),y&&r&&o(r,"arity")&&e.length!==r.arity&&f(e,"length",{value:r.arity});try{r&&o(r,"constructor")&&r.constructor?a&&f(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var n=u(e);return o(n,"source")||(n.source=m(v,"string"==typeof t?t:"")),e};Function.prototype.toString=w((function(){return s(this)&&d(this).source||c(this)}),"toString")},50329:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hierarchyItemLength=t.infoLength=void 0,t.infoLength=160,t.hierarchyItemLength=32},50360:(e,t,r)=>{var n=r(44576).isFinite;e.exports=Number.isFinite||function(e){return"number"==typeof e&&n(e)}},50375:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(67750),o=r(91291),a=r(655),l=i("".slice),c=Math.max,h=Math.min;n({target:"String",proto:!0,forced:!"".substr||"b"!=="ab".substr(-1)},{substr:function(e,t){var r,n,i=a(s(this)),u=i.length,d=o(e);return d===1/0&&(d=0),d<0&&(d=c(u+d,0)),(r=void 0===t?u:o(t))<=0||r===1/0||d>=(n=h(d+r,u))?"":l(i,d,n)}})},50778:(e,t,r)=>{var n=r(46518),i=r(77240);n({target:"String",proto:!0,forced:r(23061)("link")},{link:function(e){return i(this,"a","href",e)}})},50851:(e,t,r)=>{var n=r(36955),i=r(55966),s=r(64117),o=r(26269),a=r(78227)("iterator");e.exports=function(e){if(!s(e))return i(e,a)||i(e,"@@iterator")||o[n(e)]}},51088:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(96395),o=r(10350),a=r(94901),l=r(33994),c=r(42787),h=r(52967),u=r(10687),d=r(66699),p=r(36840),f=r(78227),g=r(26269),A=r(57657),m=o.PROPER,y=o.CONFIGURABLE,v=A.IteratorPrototype,w=A.BUGGY_SAFARI_ITERATORS,b=f("iterator"),E="keys",x="values",C="entries",_=function(){return this};e.exports=function(e,t,r,o,f,A,I){l(r,t,o);var S,M,T,B=function(e){if(e===f&&k)return k;if(!w&&e&&e in D)return D[e];switch(e){case E:case x:case C:return function(){return new r(this,e)}}return function(){return new r(this)}},P=t+" Iterator",R=!1,D=e.prototype,L=D[b]||D["@@iterator"]||f&&D[f],k=!w&&L||B(f),O="Array"===t&&D.entries||L;if(O&&(S=c(O.call(new e)))!==Object.prototype&&S.next&&(s||c(S)===v||(h?h(S,v):a(S[b])||p(S,b,_)),u(S,P,!0,!0),s&&(g[P]=_)),m&&f===x&&L&&L.name!==x&&(!s&&y?d(D,"name",x):(R=!0,k=function(){return i(L,this)})),f)if(M={values:B(x),keys:A?k:B(E),entries:B(C)},I)for(T in M)(w||R||!(T in D))&&p(D,T,M[T]);else n({target:t,proto:!0,forced:w||R},M);return s&&!I||D[b]===k||p(D,b,k,{name:f}),g[t]=k,M}},51098:(e,t,r)=>{r(46518)({target:"Iterator",name:"indexed",proto:!0,real:!0,forced:!0},{asIndexedPairs:r(47958)})},51481:(e,t,r)=>{var n=r(46518),i=r(36043);n({target:"Promise",stat:!0,forced:r(10916).CONSTRUCTOR},{reject:function(e){var t=i.f(this);return(0,t.reject)(e),t.promise}})},51629:(e,t,r)=>{var n=r(46518),i=r(90235);n({target:"Array",proto:!0,forced:[].forEach!==i},{forEach:i})},51652:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Dimensions=void 0;const n=r(876),i=r(94553);t.Dimensions={create:function(e,t=[]){return Object.keys(e).reduce(((e,r)=>{const n=o[r];if(n)return{...e,[r]:n};const s=t.find((e=>e.name===r)),a=s&&i.ExtraBytes.getDimension(s);if(a)return{...e,[r]:a};throw new Error(`Failed to look up LAS type: ${r}`)}),{})}};const{Type:s}=n.Dimension,o={X:s.float64,Y:s.float64,Z:s.float64,Intensity:s.uint16,ReturnNumber:s.uint8,NumberOfReturns:s.uint8,ScanDirectionFlag:s.boolean,EdgeOfFlightLine:s.boolean,Classification:s.uint8,Synthetic:s.boolean,KeyPoint:s.boolean,Withheld:s.boolean,Overlap:s.boolean,ScanAngle:s.float32,UserData:s.uint8,PointSourceId:s.uint16,GpsTime:s.float64,Red:s.uint16,Green:s.uint16,Blue:s.uint16,ScannerChannel:s.uint8,Infrared:s.uint16}},51755:(e,t,r)=>{r(67438)},51839:(e,t,r)=>{r(48140)},52104:(e,t,r)=>{for(var n=r(25745),i=r(97751),s=r(79504),o=r(10757),a=r(78227),l=i("Symbol"),c=l.isWellKnownSymbol,h=i("Object","getOwnPropertyNames"),u=s(l.prototype.valueOf),d=n("wks"),p=0,f=h(l),g=f.length;p<g;p++)try{var A=f[p];o(l[A])&&a(A)}catch(e){}e.exports=function(e){if(c&&c(e))return!0;try{for(var t=u(e),r=0,n=h(d),i=n.length;r<i;r++)if(d[n[r]]==t)return!0}catch(e){}return!1}},52219:(e,t,r)=>{r.d(t,{C1:()=>m});var n=r(43070);new n.Spherical,new n.Vector3;const i=new n.Spherical,s=new n.Vector3,o=new n.Vector3,a=new n.Vector3,l=new n.Matrix4,c=new n.Matrix4,h=new n.Sphere,u=new n.Euler,d=new n.Vector3,p=new n.Vector3,f=new n.Vector3,g=new n.Vector3,A=new n.Ray;class m{constructor(e=1,t=1,r=1){this.name="",this.radius=new n.Vector3(e,t,r)}intersectRay(e,t){return l.makeScale(...this.radius).invert(),h.center.set(0,0,0),h.radius=1,A.copy(e).applyMatrix4(l),A.intersectSphere(h,t)?(l.makeScale(...this.radius),t.applyMatrix4(l),t):null}getEastNorthUpFrame(e,t,r){return this.getEastNorthUpAxes(e,t,d,p,f,g),r.makeBasis(d,p,f).setPosition(g)}getEastNorthUpAxes(e,t,r,n,i,s=g){this.getCartographicToPosition(e,t,0,s),this.getCartographicToNormal(e,t,i),r.set(-s.y,s.x,0).normalize(),n.crossVectors(i,r).normalize()}getAzElRollFromRotationMatrix(e,t,r,n,i=0){return 1===i?(u.set(-Math.PI/2,0,0,"XYZ"),c.makeRotationFromEuler(u).premultiply(r)):2===i?(u.set(-Math.PI/2,0,Math.PI,"XYZ"),c.makeRotationFromEuler(u).premultiply(r)):c.copy(r),this.getEastNorthUpFrame(e,t,l).invert(),c.premultiply(l),u.setFromRotationMatrix(c,"ZXY"),n.azimuth=-u.z,n.elevation=u.x,n.roll=u.y,n}getRotationMatrixFromAzElRoll(e,t,r,n,i,s,o=0){return this.getEastNorthUpFrame(e,t,l),u.set(n,i,-r,"ZXY"),s.makeRotationFromEuler(u).premultiply(l).setPosition(0,0,0),1===o?(u.set(Math.PI/2,0,0,"XYZ"),c.makeRotationFromEuler(u),s.multiply(c)):2===o&&(u.set(-Math.PI/2,0,Math.PI,"XYZ"),c.makeRotationFromEuler(u),s.multiply(c)),s}getFrame(e,t,r,n,i,s,o,a=0){return this.getRotationMatrixFromAzElRoll(e,t,r,n,i,o,a),this.getCartographicToPosition(e,t,s,g),o.setPosition(g),o}getCartographicToPosition(e,t,r,n){this.getCartographicToNormal(e,t,s);const i=this.radius;o.copy(s),o.x*=i.x**2,o.y*=i.y**2,o.z*=i.z**2;const a=Math.sqrt(s.dot(o));return o.divideScalar(a),n.copy(o).addScaledVector(s,r)}getPositionToCartographic(e,t){this.getPositionToSurfacePoint(e,o),this.getPositionToNormal(e,s);const r=a.subVectors(e,o);return t.lon=Math.atan2(s.y,s.x),t.lat=Math.asin(s.z),t.height=Math.sign(r.dot(e))*r.length(),t}getCartographicToNormal(e,t,r){return i.set(1,-e+Math.PI/2,t),r.setFromSpherical(i).normalize(),function(e){const{x:t,y:r,z:n}=e;e.x=n,e.y=t,e.z=r}(r),r}getPositionToNormal(e,t){const r=this.radius;return t.copy(e),t.x/=r.x**2,t.y/=r.y**2,t.z/=r.z**2,t.normalize(),t}getPositionToSurfacePoint(e,t){const r=this.radius,n=1/r.x**2,i=1/r.y**2,s=1/r.z**2,l=e.x*e.x*n,c=e.y*e.y*i,h=e.z*e.z*s,u=l+c+h,d=Math.sqrt(1/u),p=o.copy(e).multiplyScalar(d);if(u<.1)return isFinite(d)?t.copy(p):null;const f=a.set(p.x*n*2,p.y*i*2,p.z*s*2);let g,A,m,y,v,w,b,E,x,C,_,I=(1-d)*e.length()/(.5*f.length()),S=0;do{I-=S,m=1/(1+I*n),y=1/(1+I*i),v=1/(1+I*s),w=m*m,b=y*y,E=v*v,x=w*m,C=b*y,_=E*v,g=l*w+c*b+h*E-1,A=l*x*n+c*C*i+h*_*s,S=g/(-2*A)}while(Math.abs(g)>1e-12);return t.set(e.x*m,e.y*y,e.z*v)}calculateHorizonDistance(e,t){const r=this.calculateEffectiveRadius(e);return Math.sqrt(2*r*t+t**2)}calculateEffectiveRadius(e){const t=this.radius.x,r=1-this.radius.z**2/t**2,i=e*n.MathUtils.DEG2RAD,s=Math.sin(i)**2;return t/Math.sqrt(1-r*s)}getPositionElevation(e){this.getPositionToSurfacePoint(e,o);const t=a.subVectors(e,o);return Math.sign(t.dot(e))*t.length()}copy(e){return this.radius.copy(e.radius),this}clone(){return(new this.constructor).copy(this)}}},52231:(e,t,r)=>{r(46518)({target:"Map",proto:!0,real:!0,forced:!0},{upsert:r(162)})},52514:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(47650),o=r(28527);n({target:"Set",proto:!0,real:!0,forced:!0},{isSupersetOf:function(e){return i(o,this,s(e))}})},52568:(e,t,r)=>{var n=r(94644),i=r(72805),s=n.aTypedArrayConstructor;(0,n.exportTypedArrayStaticMethod)("of",(function(){for(var e=0,t=arguments.length,r=new(s(this))(t);t>e;)r[e]=arguments[e++];return r}),i)},52675:(e,t,r)=>{r(6761),r(81510),r(97812),r(33110),r(49773)},52703:(e,t,r)=>{var n=r(44576),i=r(79039),s=r(79504),o=r(655),a=r(43802).trim,l=r(47452),c=n.parseInt,h=n.Symbol,u=h&&h.iterator,d=/^[+-]?0x/i,p=s(d.exec),f=8!==c(l+"08")||22!==c(l+"0x16")||u&&!i((function(){c(Object(u))}));e.exports=f?function(e,t){var r=a(o(e));return c(r,t>>>0||(p(d,r)?16:10))}:c},52734:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{l(n.next(e))}catch(e){s(e)}}function a(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}l((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Pool=t.Thread=t.PoolEventType=void 0;const s=i(r(90148)),o=r(54527),a=r(7709),l=r(81592),c=r(72882);Object.defineProperty(t,"PoolEventType",{enumerable:!0,get:function(){return c.PoolEventType}});const h=r(62996);Object.defineProperty(t,"Thread",{enumerable:!0,get:function(){return h.Thread}});let u=1;class d{constructor(e,t){this.eventSubject=new o.Subject,this.initErrors=[],this.isClosing=!1,this.nextTaskID=1,this.taskQueue=[];const r="number"==typeof t?{size:t}:t||{},{size:n=l.defaultPoolSize}=r;var i;this.debug=s.default(`threads:pool:${i=r.name||String(u++),i.replace(/\W/g," ").trim().replace(/\s+/g,"-")}`),this.options=r,this.workers=function(e,t){return function(e){const t=[];for(let r=0;r<e;r++)t.push(r);return t}(t).map((()=>({init:e(),runningTasks:[]})))}(e,n),this.eventObservable=o.multicast(o.Observable.from(this.eventSubject)),Promise.all(this.workers.map((e=>e.init))).then((()=>this.eventSubject.next({type:c.PoolEventType.initialized,size:this.workers.length})),(e=>{this.debug("Error while initializing pool worker:",e),this.eventSubject.error(e),this.initErrors.push(e)}))}findIdlingWorker(){const{concurrency:e=1}=this.options;return this.workers.find((t=>t.runningTasks.length<e))}runPoolTask(e,t){return n(this,void 0,void 0,(function*(){const r=this.workers.indexOf(e)+1;this.debug(`Running task #${t.id} on worker #${r}...`),this.eventSubject.next({type:c.PoolEventType.taskStart,taskID:t.id,workerID:r});try{const n=yield t.run(yield e.init);this.debug(`Task #${t.id} completed successfully`),this.eventSubject.next({type:c.PoolEventType.taskCompleted,returnValue:n,taskID:t.id,workerID:r})}catch(e){this.debug(`Task #${t.id} failed`),this.eventSubject.next({type:c.PoolEventType.taskFailed,taskID:t.id,error:e,workerID:r})}}))}run(e,t){return n(this,void 0,void 0,(function*(){const r=(()=>n(this,void 0,void 0,(function*(){yield new Promise((e=>setTimeout(e,0)));try{yield this.runPoolTask(e,t)}finally{e.runningTasks=e.runningTasks.filter((e=>e!==r)),this.isClosing||this.scheduleWork()}})))();e.runningTasks.push(r)}))}scheduleWork(){this.debug("Attempt de-queueing a task in order to run it...");const e=this.findIdlingWorker();if(!e)return;const t=this.taskQueue.shift();if(!t)return this.debug("Task queue is empty"),void this.eventSubject.next({type:c.PoolEventType.taskQueueDrained});this.run(e,t)}taskCompletion(e){return new Promise(((t,r)=>{const n=this.events().subscribe((i=>{i.type===c.PoolEventType.taskCompleted&&i.taskID===e?(n.unsubscribe(),t(i.returnValue)):i.type===c.PoolEventType.taskFailed&&i.taskID===e?(n.unsubscribe(),r(i.error)):i.type===c.PoolEventType.terminated&&(n.unsubscribe(),r(Error("Pool has been terminated before task was run.")))}))}))}settled(e=!1){return n(this,void 0,void 0,(function*(){const t=()=>{return e=this.workers,t=e=>e.runningTasks,e.reduce(((e,r)=>[...e,...t(r)]),[]);var e,t},r=[],n=this.eventObservable.subscribe((e=>{e.type===c.PoolEventType.taskFailed&&r.push(e.error)}));return this.initErrors.length>0?Promise.reject(this.initErrors[0]):e&&0===this.taskQueue.length?(yield a.allSettled(t()),r):(yield new Promise(((e,t)=>{const r=this.eventObservable.subscribe({next(t){t.type===c.PoolEventType.taskQueueDrained&&(r.unsubscribe(),e(void 0))},error:t})})),yield a.allSettled(t()),n.unsubscribe(),r)}))}completed(e=!1){return n(this,void 0,void 0,(function*(){const t=this.settled(e),r=new Promise(((e,r)=>{const n=this.eventObservable.subscribe({next(i){i.type===c.PoolEventType.taskQueueDrained?(n.unsubscribe(),e(t)):i.type===c.PoolEventType.taskFailed&&(n.unsubscribe(),r(i.error))},error:r})})),n=yield Promise.race([t,r]);if(n.length>0)throw n[0]}))}events(){return this.eventObservable}queue(e){const{maxQueuedJobs:t=1/0}=this.options;if(this.isClosing)throw Error("Cannot schedule pool tasks after terminate() has been called.");if(this.initErrors.length>0)throw this.initErrors[0];const r=this.nextTaskID++,n=this.taskCompletion(r);n.catch((e=>{this.debug(`Task #${r} errored:`,e)}));const i={id:r,run:e,cancel:()=>{-1!==this.taskQueue.indexOf(i)&&(this.taskQueue=this.taskQueue.filter((e=>e!==i)),this.eventSubject.next({type:c.PoolEventType.taskCanceled,taskID:i.id}))},then:n.then.bind(n)};if(this.taskQueue.length>=t)throw Error("Maximum number of pool tasks queued. Refusing to queue another one.\nThis usually happens for one of two reasons: We are either at peak workload right now or some tasks just won't finish, thus blocking the pool.");return this.debug(`Queueing task #${i.id}...`),this.taskQueue.push(i),this.eventSubject.next({type:c.PoolEventType.taskQueued,taskID:i.id}),this.scheduleWork(),i}terminate(e){return n(this,void 0,void 0,(function*(){this.isClosing=!0,e||(yield this.completed(!0)),this.eventSubject.next({type:c.PoolEventType.terminated,remainingQueue:[...this.taskQueue]}),this.eventSubject.complete(),yield Promise.all(this.workers.map((e=>n(this,void 0,void 0,(function*(){return h.Thread.terminate(yield e.init)})))))}))}}function p(e,t){return new d(e,t)}d.EventType=c.PoolEventType,p.EventType=c.PoolEventType,t.Pool=p},52774:(e,t,r)=>{var n=r(46518),i=r(76080),s=r(97080),o=r(94402),a=r(38469),l=o.Set,c=o.add;n({target:"Set",proto:!0,real:!0,forced:!0},{map:function(e){var t=s(this),r=i(e,arguments.length>1?arguments[1]:void 0),n=new l;return a(t,(function(e){c(n,r(e,e,t))})),n}})},52811:(e,t,r)=>{var n=r(46518),i=r(92744),s=r(79039),o=r(20034),a=r(3451).onFreeze,l=Object.freeze;n({target:"Object",stat:!0,forced:s((function(){l(1)})),sham:!i},{freeze:function(e){return l&&o(e)?l(a(e)):e}})},52967:(e,t,r)=>{var n=r(46706),i=r(20034),s=r(67750),o=r(73506);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=n(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return s(r),o(n),i(r)?(t?e(r,n):r.__proto__=n,r):r}}():void 0)},53032:(e,t,r)=>{r(46518)({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:r(52104)})},53179:(e,t,r)=>{var n=r(92140),i=r(36955);e.exports=n?{}.toString:function(){return"[object "+i(this)+"]"}},53250:e=>{var t=Math.expm1,r=Math.exp;e.exports=!t||t(10)>22025.465794806718||t(10)<22025.465794806718||-2e-17!==t(-2e-17)?function(e){var t=+e;return 0===t?t:t>-1e-6&&t<1e-6?t+t*t/2:r(t)-1}:t},53487:(e,t,r)=>{var n=r(43802).start,i=r(60706);e.exports=i("trimStart")?function(){return n(this)}:"".trimStart},53602:e=>{var t=4503599627370496;e.exports=function(e){return e+t-t}},53640:(e,t,r)=>{var n=r(28551),i=r(84270),s=TypeError;e.exports=function(e){if(n(this),"string"===e||"default"===e)e="string";else if("number"!==e)throw new s("Incorrect hint");return i(this,e)}},53803:(e,t,r)=>{r(46518)({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:r(52104)})},53838:(e,t,r)=>{var n=r(97080),i=r(25170),s=r(38469),o=r(83789);e.exports=function(e){var t=n(this),r=o(e);return!(i(t)>r.size)&&!1!==s(t,(function(e){if(!r.includes(e))return!1}),!0)}},53921:(e,t,r)=>{var n=r(46518),i=r(72652),s=r(97040);n({target:"Object",stat:!0},{fromEntries:function(e){var t={};return i(e,(function(e,r){s(t,e,r)}),{AS_ENTRIES:!0}),t}})},53982:(e,t,r)=>{var n,i,s=r(44576),o=r(77629),a=r(94901),l=r(2360),c=r(42787),h=r(36840),u=r(78227),d=r(96395),p="USE_FUNCTION_CONSTRUCTOR",f=u("asyncIterator"),g=s.AsyncIterator,A=o.AsyncIteratorPrototype;if(A)n=A;else if(a(g))n=g.prototype;else if(o[p]||s[p])try{i=c(c(c(Function("return async function*(){}()")()))),c(i)===Object.prototype&&(n=i)}catch(e){}n?d&&(n=l(n)):n={},a(n[f])||h(n,f,(function(){return this})),e.exports=n},54151:(e,t,r)=>{r(9678)},54238:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createPromiseWithResolver=void 0;const r=()=>{};t.createPromiseWithResolver=function(){let e,t=!1,n=r;return[new Promise((r=>{t?r(e):n=r})),r=>{t=!0,e=r,n(e)}]}},54520:(e,t,r)=>{r(22489)},54527:(e,t,r)=>{r.r(t),r.d(t,{Observable:()=>b,Subject:()=>M,filter:()=>x,flatMap:()=>C,interval:()=>_,map:()=>I,merge:()=>S,multicast:()=>T,scan:()=>B,unsubscribe:()=>E});class n{constructor(e){this._baseObserver=e,this._pendingPromises=new Set}complete(){Promise.all(this._pendingPromises).then((()=>this._baseObserver.complete())).catch((e=>this._baseObserver.error(e)))}error(e){this._baseObserver.error(e)}schedule(e){const t=Promise.all(this._pendingPromises),r=[],n=e=>r.push(e),i=Promise.resolve().then((()=>{return s=this,o=void 0,l=function*(){yield t,yield e(n),this._pendingPromises.delete(i);for(const e of r)this._baseObserver.next(e)},new((a=void 0)||(a=Promise))((function(e,t){function r(e){try{i(l.next(e))}catch(e){t(e)}}function n(e){try{i(l.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):(i=t.value,i instanceof a?i:new a((function(e){e(i)}))).then(r,n)}i((l=l.apply(s,o||[])).next())}));var s,o,a,l})).catch((e=>{this._pendingPromises.delete(i),this._baseObserver.error(e)}));this._pendingPromises.add(i)}}const i=()=>"function"==typeof Symbol,s=e=>i()&&Boolean(Symbol[e]),o=e=>s(e)?Symbol[e]:"@@"+e;s("asyncIterator")||(Symbol.asyncIterator=Symbol.asyncIterator||Symbol.for("Symbol.asyncIterator"));const a=o("iterator"),l=o("observable"),c=o("species");function h(e,t){const r=e[t];if(null!=r){if("function"!=typeof r)throw new TypeError(r+" is not a function");return r}}function u(e){let t=e.constructor;return void 0!==t&&(t=t[c],null===t&&(t=void 0)),void 0!==t?t:w}function d(e){d.log?d.log(e):setTimeout((()=>{throw e}),0)}function p(e){Promise.resolve().then((()=>{try{e()}catch(e){d(e)}}))}function f(e){const t=e._cleanup;if(void 0!==t&&(e._cleanup=void 0,t))try{if("function"==typeof t)t();else{const e=h(t,"unsubscribe");e&&e.call(t)}}catch(e){d(e)}}function g(e){e._observer=void 0,e._queue=void 0,e._state="closed"}function A(e,t,r){e._state="running";const n=e._observer;try{const i=n?h(n,t):void 0;switch(t){case"next":i&&i.call(n,r);break;case"error":if(g(e),!i)throw r;i.call(n,r);break;case"complete":g(e),i&&i.call(n)}}catch(e){d(e)}"closed"===e._state?f(e):"running"===e._state&&(e._state="ready")}function m(e,t,r){if("closed"!==e._state)return"buffering"===e._state?(e._queue=e._queue||[],void e._queue.push({type:t,value:r})):"ready"!==e._state?(e._state="buffering",e._queue=[{type:t,value:r}],void p((()=>function(e){const t=e._queue;if(t){e._queue=void 0,e._state="ready";for(const r of t)if(A(e,r.type,r.value),"closed"===e._state)break}}(e)))):void A(e,t,r)}class y{constructor(e,t){this._cleanup=void 0,this._observer=e,this._queue=void 0,this._state="initializing";const r=new v(this);try{this._cleanup=t.call(void 0,r)}catch(e){r.error(e)}"initializing"===this._state&&(this._state="ready")}get closed(){return"closed"===this._state}unsubscribe(){"closed"!==this._state&&(g(this),f(this))}}class v{constructor(e){this._subscription=e}get closed(){return"closed"===this._subscription._state}next(e){m(this._subscription,"next",e)}error(e){m(this._subscription,"error",e)}complete(){m(this._subscription,"complete")}}class w{constructor(e){if(!(this instanceof w))throw new TypeError("Observable cannot be called as a function");if("function"!=typeof e)throw new TypeError("Observable initializer must be a function");this._subscriber=e}subscribe(e,t,r){return"object"==typeof e&&null!==e||(e={next:e,error:t,complete:r}),new y(e,this._subscriber)}pipe(e,...t){let r=this;for(const n of[e,...t])r=n(r);return r}tap(e,t,r){const n="object"!=typeof e||null===e?{next:e,error:t,complete:r}:e;return new w((e=>this.subscribe({next(t){n.next&&n.next(t),e.next(t)},error(t){n.error&&n.error(t),e.error(t)},complete(){n.complete&&n.complete(),e.complete()},start(e){n.start&&n.start(e)}})))}forEach(e){return new Promise(((t,r)=>{if("function"!=typeof e)return void r(new TypeError(e+" is not a function"));function n(){i.unsubscribe(),t(void 0)}const i=this.subscribe({next(t){try{e(t,n)}catch(e){r(e),i.unsubscribe()}},error(e){r(e)},complete(){t(void 0)}})}))}map(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(u(this))((t=>this.subscribe({next(r){let n=r;try{n=e(r)}catch(e){return t.error(e)}t.next(n)},error(e){t.error(e)},complete(){t.complete()}})))}filter(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(u(this))((t=>this.subscribe({next(r){try{if(!e(r))return}catch(e){return t.error(e)}t.next(r)},error(e){t.error(e)},complete(){t.complete()}})))}reduce(e,t){if("function"!=typeof e)throw new TypeError(e+" is not a function");const r=u(this),n=arguments.length>1;let i=!1,s=t;return new r((t=>this.subscribe({next(r){const o=!i;if(i=!0,!o||n)try{s=e(s,r)}catch(e){return t.error(e)}else s=r},error(e){t.error(e)},complete(){if(!i&&!n)return t.error(new TypeError("Cannot reduce an empty sequence"));t.next(s),t.complete()}})))}concat(...e){const t=u(this);return new t((r=>{let n,i=0;return function s(o){n=o.subscribe({next(e){r.next(e)},error(e){r.error(e)},complete(){i===e.length?(n=void 0,r.complete()):s(t.from(e[i++]))}})}(this),()=>{n&&(n.unsubscribe(),n=void 0)}}))}flatMap(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");const t=u(this);return new t((r=>{const n=[],i=this.subscribe({next(i){let o;if(e)try{o=e(i)}catch(e){return r.error(e)}else o=i;const a=t.from(o).subscribe({next(e){r.next(e)},error(e){r.error(e)},complete(){const e=n.indexOf(a);e>=0&&n.splice(e,1),s()}});n.push(a)},error(e){r.error(e)},complete(){s()}});function s(){i.closed&&0===n.length&&r.complete()}return()=>{n.forEach((e=>e.unsubscribe())),i.unsubscribe()}}))}[(Symbol.observable,l)](){return this}static from(e){const t="function"==typeof this?this:w;if(null==e)throw new TypeError(e+" is not an object");const r=h(e,l);if(r){const n=r.call(e);if(Object(n)!==n)throw new TypeError(n+" is not an object");return function(e){return e instanceof w}(n)&&n.constructor===t?n:new t((e=>n.subscribe(e)))}if(s("iterator")){const r=h(e,a);if(r)return new t((t=>{p((()=>{if(!t.closed){for(const n of r.call(e))if(t.next(n),t.closed)return;t.complete()}}))}))}if(Array.isArray(e))return new t((t=>{p((()=>{if(!t.closed){for(const r of e)if(t.next(r),t.closed)return;t.complete()}}))}));throw new TypeError(e+" is not observable")}static of(...e){return new("function"==typeof this?this:w)((t=>{p((()=>{if(!t.closed){for(const r of e)if(t.next(r),t.closed)return;t.complete()}}))}))}static get[c](){return this}}i()&&Object.defineProperty(w,Symbol("extensions"),{value:{symbol:l,hostReportError:d},configurable:!0});const b=w,E=function(e){"function"==typeof e?e():e&&"function"==typeof e.unsubscribe&&e.unsubscribe()};const x=function(e){return t=>new b((r=>{const i=new n(r),s=t.subscribe({complete(){i.complete()},error(e){i.error(e)},next(t){i.schedule((r=>{return n=this,i=void 0,o=function*(){(yield e(t))&&r(t)},new((s=void 0)||(s=Promise))((function(e,t){function r(e){try{l(o.next(e))}catch(e){t(e)}}function a(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s((function(e){e(n)}))).then(r,a)}l((o=o.apply(n,i||[])).next())}));var n,i,s,o}))}});return()=>E(s)}))};const C=function(e){return t=>new b((r=>{const i=new n(r),o=t.subscribe({complete(){i.complete()},error(e){i.error(e)},next(t){i.schedule((r=>{return n=this,i=void 0,a=function*(){var n,i;const o=yield e(t);if((c=o)&&s("iterator")&&c[Symbol.iterator]||function(e){return e&&s("asyncIterator")&&e[Symbol.asyncIterator]}(o))try{for(var a,l=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,i){!function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)}(n,i,(t=e[r](t)).done,t.value)}))}}}(o);!(a=yield l.next()).done;){const e=a.value;r(e)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(i=l.return)&&(yield i.call(l))}finally{if(n)throw n.error}}else o.map((e=>r(e)));var c},new((o=void 0)||(o=Promise))((function(e,t){function r(e){try{l(a.next(e))}catch(e){t(e)}}function s(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(r,s)}l((a=a.apply(n,i||[])).next())}));var n,i,o,a}))}});return()=>E(o)}))};function _(e){return new w((t=>{let r=0;const n=setInterval((()=>{t.next(r++)}),e);return()=>clearInterval(n)}))}const I=function(e){return t=>new b((r=>{const i=new n(r),s=t.subscribe({complete(){i.complete()},error(e){i.error(e)},next(t){i.schedule((r=>{return n=this,i=void 0,o=function*(){const n=yield e(t);r(n)},new((s=void 0)||(s=Promise))((function(e,t){function r(e){try{l(o.next(e))}catch(e){t(e)}}function a(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s((function(e){e(n)}))).then(r,a)}l((o=o.apply(n,i||[])).next())}));var n,i,s,o}))}});return()=>E(s)}))},S=function(...e){return 0===e.length?w.from([]):new w((t=>{let r=0;const n=e.map((n=>n.subscribe({error(e){t.error(e),i()},next(e){t.next(e)},complete(){++r===e.length&&(t.complete(),i())}}))),i=()=>{n.forEach((e=>E(e)))};return i}))},M=class extends b{constructor(){super((e=>(this._observers.add(e),()=>this._observers.delete(e)))),this._observers=new Set}next(e){for(const t of this._observers)t.next(e)}error(e){for(const t of this._observers)t.error(e)}complete(){for(const e of this._observers)e.complete()}},T=function(e){const t=new M;let r,n=0;return new b((i=>{r||(r=e.subscribe(t));const s=t.subscribe(i);return n++,()=>{n--,s.unsubscribe(),0===n&&(E(r),r=void 0)}}))};const B=function(e,t){return r=>new b((i=>{let s,o=0;const a=new n(i),l=r.subscribe({complete(){a.complete()},error(e){a.error(e)},next(r){a.schedule((n=>{return i=this,a=void 0,c=function*(){const i=0===o?void 0===t?r:t:s;s=yield e(i,r,o++),n(s)},new((l=void 0)||(l=Promise))((function(e,t){function r(e){try{s(c.next(e))}catch(e){t(e)}}function n(e){try{s(c.throw(e))}catch(e){t(e)}}function s(t){var i;t.done?e(t.value):(i=t.value,i instanceof l?i:new l((function(e){e(i)}))).then(r,n)}s((c=c.apply(i,a||[])).next())}));var i,a,l,c}))}});return()=>E(l)}))}},54554:(e,t,r)=>{var n=r(46518),i=r(48981),s=r(35610),o=r(91291),a=r(26198),l=r(34527),c=r(96837),h=r(1469),u=r(97040),d=r(84606),p=r(70597)("splice"),f=Math.max,g=Math.min;n({target:"Array",proto:!0,forced:!p},{splice:function(e,t){var r,n,p,A,m,y,v=i(this),w=a(v),b=s(e,w),E=arguments.length;for(0===E?r=n=0:1===E?(r=0,n=w-b):(r=E-2,n=g(f(o(t),0),w-b)),c(w+r-n),p=h(v,n),A=0;A<n;A++)(m=b+A)in v&&u(p,A,v[m]);if(p.length=n,r<n){for(A=b;A<w-n;A++)y=A+r,(m=A+n)in v?v[y]=v[m]:d(v,y);for(A=w;A>w-n+r;A--)d(v,A-1)}else if(r>n)for(A=w-n;A>b;A--)y=A+r-1,(m=A+n-1)in v?v[y]=v[m]:d(v,y);for(A=0;A<r;A++)v[A+b]=arguments[A+2];return l(v,w-n+r),p}})},54623:(e,t)=>{function r(e){if("string"!=typeof e)return e;const[t,r,n,i,...s]=e.split("-").map((e=>parseInt(e,10))),o=[t,r,n,i];if(0!==s.length||o.some((e=>"number"!=typeof e||Number.isNaN(e))))throw new Error(`Invalid key: ${e}`);return o}Object.defineProperty(t,"__esModule",{value:!0}),t.Key=void 0,t.Key={create:function(e,t=0,n=0,i=0){return"number"!=typeof e?r(e):[e,t,n,i]},parse:r,toString:function(e){return"string"==typeof e?e:e.join("-")},step:function(e,[r,n,i]){const[s,o,a,l]=t.Key.create(e);return[s+1,2*o+r,2*a+n,2*l+i]},up:function(e,r=1){const[n,i,s,o]=t.Key.create(e);return[n-r,i>>r,s>>r,o>>r]},compare:function(e,t){for(let r=0;r<e.length;++r){if(e[r]<t[r])return-1;if(e[r]>t[r])return 1}return 0},depth:function(e){return e[0]}}},54743:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(66346),o=r(87633),a="ArrayBuffer",l=s[a];n({global:!0,constructor:!0,forced:i[a]!==l},{ArrayBuffer:l}),o(a)},54972:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(28551),o=r(1767),a=r(24149),l=r(99590),c=r(19462),h=r(9539),u=r(96395),d=c((function(){var e=this.iterator;if(!this.remaining--)return this.done=!0,h(e,"normal",void 0);var t=s(i(this.next,e));return(this.done=!!t.done)?void 0:t.value}));n({target:"Iterator",proto:!0,real:!0,forced:u},{take:function(e){s(this);var t=l(a(+e));return new d(o(this),{remaining:t})}})},55002:e=>{e.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},55081:(e,t,r)=>{var n=r(46518),i=r(44576);n({global:!0,forced:i.globalThis!==i},{globalThis:i})},55105:(e,t,r)=>{var n=r(43724),i=r(6469),s=r(48981),o=r(26198),a=r(62106);n&&(a(Array.prototype,"lastItem",{configurable:!0,get:function(){var e=s(this),t=o(e);return 0===t?void 0:e[t-1]},set:function(e){var t=s(this),r=o(t);return t[0===r?0:r-1]=e}}),i("lastItem"))},55122:(e,t,r)=>{var n=r(46518),i=r(36194),s=r(72652),o=r(72248).set;n({target:"Map",proto:!0,real:!0,arity:1,forced:!0},{merge:function(e){for(var t=i(this),r=arguments.length,n=0;n<r;)s(arguments[n++],(function(e,r){o(t,e,r)}),{AS_ENTRIES:!0});return t}})},55169:(e,t,r)=>{var n=r(3238),i=TypeError;e.exports=function(e){if(n(e))throw new i("ArrayBuffer is detached");return e}},55815:(e,t,r)=>{var n=r(46518),i=r(97751),s=r(89429),o=r(79039),a=r(2360),l=r(6980),c=r(24913).f,h=r(36840),u=r(62106),d=r(39297),p=r(90679),f=r(28551),g=r(77536),A=r(32603),m=r(55002),y=r(16193),v=r(91181),w=r(43724),b=r(96395),E="DOMException",x="DATA_CLONE_ERR",C=i("Error"),_=i(E)||function(){try{(new(i("MessageChannel")||s("worker_threads").MessageChannel)).port1.postMessage(new WeakMap)}catch(e){if(e.name===x&&25===e.code)return e.constructor}}(),I=_&&_.prototype,S=C.prototype,M=v.set,T=v.getterFor(E),B="stack"in new C(E),P=function(e){return d(m,e)&&m[e].m?m[e].c:0},R=function(){p(this,D);var e=arguments.length,t=A(e<1?void 0:arguments[0]),r=A(e<2?void 0:arguments[1],"Error"),n=P(r);if(M(this,{type:E,name:r,message:t,code:n}),w||(this.name=r,this.message=t,this.code=n),B){var i=new C(t);i.name=E,c(this,"stack",l(1,y(i.stack,1)))}},D=R.prototype=a(S),L=function(e){return{enumerable:!0,configurable:!0,get:e}},k=function(e){return L((function(){return T(this)[e]}))};w&&(u(D,"code",k("code")),u(D,"message",k("message")),u(D,"name",k("name"))),c(D,"constructor",l(1,R));var O=o((function(){return!(new _ instanceof C)})),F=O||o((function(){return S.toString!==g||"2: 1"!==String(new _(1,2))})),N=O||o((function(){return 25!==new _(1,"DataCloneError").code})),U=O||25!==_[x]||25!==I[x],Q=b?F||N||U:O;n({global:!0,constructor:!0,forced:Q},{DOMException:Q?R:_});var G=i(E),z=G.prototype;for(var j in F&&(b||_===G)&&h(z,"toString",g),N&&w&&_===G&&u(z,"code",L((function(){return P(f(this).name)}))),m)if(d(m,j)){var V=m[j],q=V.s,H=l(6,V.c);d(G,q)||c(G,q,H),d(z,q)||c(z,q,H)}},55871:(e,t,r)=>{var n=r(79504),i=r(94644),s=r(35370),o=r(79565),a=i.aTypedArray,l=i.getTypedArrayConstructor,c=i.exportTypedArrayMethod,h=n(o);c("uniqueBy",(function(e){return a(this),s(l(this),h(this,e))}),!0)},55966:(e,t,r)=>{var n=r(79306),i=r(64117);e.exports=function(e,t){var r=e[t];return i(r)?void 0:n(r)}},56192:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(24194),o=r(57696),a=r(58319),l=i(DataView.prototype.setUint8);n({target:"DataView",proto:!0,forced:!0},{setUint8Clamped:function(e,t){s(this);var r=o(e);return l(this,r,a(t))}})},56279:(e,t,r)=>{var n=r(36840);e.exports=function(e,t,r){for(var i in t)n(e,i,t[i],r);return e}},56422:(e,t,r)=>{var n=r(46518),i=r(23755),s=r(88205).remove;n({target:"WeakSet",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var e,t=i(this),r=!0,n=0,o=arguments.length;n<o;n++)e=s(t,arguments[n]),r=r&&e;return!!r}})},56504:()=>{},56624:(e,t,r)=>{r(46518)({target:"Math",stat:!0},{log1p:r(7740)})},56682:(e,t,r)=>{var n=r(69565),i=r(28551),s=r(94901),o=r(22195),a=r(57323),l=TypeError;e.exports=function(e,t){var r=e.exec;if(s(r)){var c=n(r,e,t);return null!==c&&i(c),c}if("RegExp"===o(e))return n(a,e,t);throw new l("RegExp#exec called on incompatible receiver")}},56969:(e,t,r)=>{var n=r(72777),i=r(10757);e.exports=function(e){var t=n(e,"string");return i(t)?t:t+""}},57019:(e,t,r)=>{r(47072)},57029:(e,t,r)=>{var n=r(48981),i=r(35610),s=r(26198),o=r(84606),a=Math.min;e.exports=[].copyWithin||function(e,t){var r=n(this),l=s(r),c=i(e,l),h=i(t,l),u=arguments.length>2?arguments[2]:void 0,d=a((void 0===u?l:i(u,l))-h,l-c),p=1;for(h<c&&c<h+d&&(p=-1,h+=d-1,c+=d-1);d-- >0;)h in r?r[c]=r[h]:o(r,c),c+=p,h+=p;return r}},57051:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(35370),o=r(59143),a=i.Uint8Array;a&&n({target:"Uint8Array",stat:!0},{fromBase64:function(e){var t=o(e,arguments.length>1?arguments[1]:void 0,null,9007199254740991);return s(a,t.bytes)}})},57145:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(79306),o=r(25397),a=r(35370),l=r(44124),c=r(6469),h=Array,u=i(l("Array","sort"));n({target:"Array",proto:!0},{toSorted:function(e){void 0!==e&&s(e);var t=o(this),r=a(h,t);return u(r,e)}}),c("toSorted")},57268:(e,t,r)=>{var n=r(46518),i=r(76080),s=r(36194),o=r(26223);n({target:"Map",proto:!0,real:!0,forced:!0},{some:function(e){var t=s(this),r=i(e,arguments.length>1?arguments[1]:void 0);return!0===o(t,(function(e,n){if(r(e,n,t))return!0}),!0)}})},57301:(e,t,r)=>{var n=r(94644),i=r(59213).some,s=n.aTypedArray;(0,n.exportTypedArrayMethod)("some",(function(e){return i(s(this),e,arguments.length>1?arguments[1]:void 0)}))},57323:(e,t,r)=>{var n,i,s=r(69565),o=r(79504),a=r(655),l=r(67979),c=r(58429),h=r(25745),u=r(2360),d=r(91181).get,p=r(83635),f=r(18814),g=h("native-string-replace",String.prototype.replace),A=RegExp.prototype.exec,m=A,y=o("".charAt),v=o("".indexOf),w=o("".replace),b=o("".slice),E=(i=/b*/g,s(A,n=/a/,"a"),s(A,i,"a"),0!==n.lastIndex||0!==i.lastIndex),x=c.BROKEN_CARET,C=void 0!==/()??/.exec("")[1];(E||C||x||p||f)&&(m=function(e){var t,r,n,i,o,c,h,p=this,f=d(p),_=a(e),I=f.raw;if(I)return I.lastIndex=p.lastIndex,t=s(m,I,_),p.lastIndex=I.lastIndex,t;var S=f.groups,M=x&&p.sticky,T=s(l,p),B=p.source,P=0,R=_;if(M&&(T=w(T,"y",""),-1===v(T,"g")&&(T+="g"),R=b(_,p.lastIndex),p.lastIndex>0&&(!p.multiline||p.multiline&&"\n"!==y(_,p.lastIndex-1))&&(B="(?: "+B+")",R=" "+R,P++),r=new RegExp("^(?:"+B+")",T)),C&&(r=new RegExp("^"+B+"$(?!\\s)",T)),E&&(n=p.lastIndex),i=s(A,M?r:p,R),M?i?(i.input=b(i.input,P),i[0]=b(i[0],P),i.index=p.lastIndex,p.lastIndex+=i[0].length):p.lastIndex=0:E&&i&&(p.lastIndex=p.global?i.index+i[0].length:n),C&&i&&i.length>1&&s(g,i[0],r,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(i[o]=void 0)})),i&&S)for(i.groups=c=u(null),o=0;o<S.length;o++)c[(h=S[o])[0]]=i[h[1]];return i}),e.exports=m},57465:(e,t,r)=>{var n=r(43724),i=r(83635),s=r(22195),o=r(62106),a=r(91181).get,l=RegExp.prototype,c=TypeError;n&&i&&o(l,"dotAll",{configurable:!0,get:function(){if(this!==l){if("RegExp"===s(this))return!!a(this).dotAll;throw new c("Incompatible receiver, RegExp required")}}})},57657:(e,t,r)=>{var n,i,s,o=r(79039),a=r(94901),l=r(20034),c=r(2360),h=r(42787),u=r(36840),d=r(78227),p=r(96395),f=d("iterator"),g=!1;[].keys&&("next"in(s=[].keys())?(i=h(h(s)))!==Object.prototype&&(n=i):g=!0),!l(n)||o((function(){var e={};return n[f].call(e)!==e}))?n={}:p&&(n=c(n)),a(n[f])||u(n,f,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:g}},57696:(e,t,r)=>{var n=r(91291),i=r(18014),s=RangeError;e.exports=function(e){if(void 0===e)return 0;var t=n(e),r=i(t);if(t!==r)throw new s("Wrong length or index");return r}},57829:(e,t,r)=>{var n=r(68183).charAt;e.exports=function(e,t,r){return t+(r?n(e,t).length:1)}},58004:(e,t,r)=>{var n=r(46518),i=r(79039),s=r(68750);n({target:"Set",proto:!0,real:!0,forced:!r(84916)("intersection",(function(e){return 2===e.size&&e.has(1)&&e.has(2)}))||i((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}))},{intersection:s})},58148:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.View=void 0;const n=r(876),i=r(51652),s=r(11677);t.View={create:function(e,t,r=[],o){let a=s.Extractor.create(t,r);if(o){const e=new Set([...o]);a=Object.entries(a).reduce(((t,[r,n])=>(e.has(r)&&(t[r]=n),t)),{})}const l=i.Dimensions.create(a,r),c=n.Binary.toDataView(e),h=t.pointDataRecordLength;if(c.byteLength%h!=0)throw new Error(`Invalid buffer length (${c.byteLength}) for point length ${h}`);const u=c.byteLength/t.pointDataRecordLength;return{pointCount:u,dimensions:l,getter:function(e){const t=a[e];if(!t)throw new Error(`No extractor for dimension: ${e}`);return function(e){if(e>=u)throw new RangeError(`View index (${e}) out of range: ${u}`);return t(c,e)}}}}}},58179:(e,t,r)=>{var n=r(46518),i=r(19767),s=r(24149),o=r(3470),a=RangeError,l=Math.min,c=Math.max;n({target:"Math",stat:!0,forced:!0},{clamp:function(e,t,r){if(i(e),s(i(t)),s(i(r)),o(t,0)&&o(r,-0)||t>r)throw new a("`min` should be smaller than `max`");return l(r,c(t,e))}})},58229:(e,t,r)=>{var n=r(99590),i=RangeError;e.exports=function(e,t){var r=n(e);if(r%t)throw new i("Wrong offset");return r}},58242:(e,t,r)=>{var n=r(69565),i=r(97751),s=r(78227),o=r(36840);e.exports=function(){var e=i("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,a=s("toPrimitive");t&&!t[a]&&o(t,a,(function(e){return n(r,this)}),{arity:1})}},58319:e=>{var t=Math.round;e.exports=function(e){var r=t(e);return r<0?0:r>255?255:255&r}},58335:(e,t,r)=>{var n=r(46518),i=r(43724),s=r(44576),o=r(97751),a=r(79504),l=r(69565),c=r(94901),h=r(20034),u=r(34376),d=r(39297),p=r(655),f=r(26198),g=r(97040),A=r(79039),m=r(616),y=r(4495),v=s.JSON,w=s.Number,b=s.SyntaxError,E=v&&v.parse,x=o("Object","keys"),C=Object.getOwnPropertyDescriptor,_=a("".charAt),I=a("".slice),S=a(/./.exec),M=a([].push),T=/^\d$/,B=/^[1-9]$/,P=/^[\d-]$/,R=/^[\t\n\r ]$/,D=function(e,t,r,n){var i,s,o,a,c,p=e[t],g=n&&p===n.value,A=g&&"string"==typeof n.source?{source:n.source}:{};if(h(p)){var m=u(p),y=g?n.nodes:m?[]:{};if(m)for(i=y.length,o=f(p),a=0;a<o;a++)L(p,a,D(p,""+a,r,a<i?y[a]:void 0));else for(s=x(p),o=f(s),a=0;a<o;a++)c=s[a],L(p,c,D(p,c,r,d(y,c)?y[c]:void 0))}return l(r,e,t,p,A)},L=function(e,t,r){if(i){var n=C(e,t);if(n&&!n.configurable)return}void 0===r?delete e[t]:g(e,t,r)},k=function(e,t,r,n){this.value=e,this.end=t,this.source=r,this.nodes=n},O=function(e,t){this.source=e,this.index=t};O.prototype={fork:function(e){return new O(this.source,e)},parse:function(){var e=this.source,t=this.skip(R,this.index),r=this.fork(t),n=_(e,t);if(S(P,n))return r.number();switch(n){case"{":return r.object();case"[":return r.array();case'"':return r.string();case"t":return r.keyword(!0);case"f":return r.keyword(!1);case"n":return r.keyword(null)}throw new b('Unexpected character: "'+n+'" at: '+t)},node:function(e,t,r,n,i){return new k(t,n,e?null:I(this.source,r,n),i)},object:function(){for(var e=this.source,t=this.index+1,r=!1,n={},i={};t<e.length;){if(t=this.until(['"',"}"],t),"}"===_(e,t)&&!r){t++;break}var s=this.fork(t).string(),o=s.value;t=s.end,t=this.until([":"],t)+1,t=this.skip(R,t),s=this.fork(t).parse(),g(i,o,s),g(n,o,s.value),t=this.until([",","}"],s.end);var a=_(e,t);if(","===a)r=!0,t++;else if("}"===a){t++;break}}return this.node(1,n,this.index,t,i)},array:function(){for(var e=this.source,t=this.index+1,r=!1,n=[],i=[];t<e.length;){if(t=this.skip(R,t),"]"===_(e,t)&&!r){t++;break}var s=this.fork(t).parse();if(M(i,s),M(n,s.value),t=this.until([",","]"],s.end),","===_(e,t))r=!0,t++;else if("]"===_(e,t)){t++;break}}return this.node(1,n,this.index,t,i)},string:function(){var e=this.index,t=m(this.source,this.index+1);return this.node(0,t.value,e,t.end)},number:function(){var e=this.source,t=this.index,r=t;if("-"===_(e,r)&&r++,"0"===_(e,r))r++;else{if(!S(B,_(e,r)))throw new b("Failed to parse number at: "+r);r=this.skip(T,r+1)}if(!("."===_(e,r)&&(r=this.skip(T,r+1)),"e"!==_(e,r)&&"E"!==_(e,r)||(r++,"+"!==_(e,r)&&"-"!==_(e,r)||r++,r!==(r=this.skip(T,r)))))throw new b("Failed to parse number's exponent value at: "+r);return this.node(0,w(I(e,t,r)),t,r)},keyword:function(e){var t=""+e,r=this.index,n=r+t.length;if(I(this.source,r,n)!==t)throw new b("Failed to parse value at: "+r);return this.node(0,e,r,n)},skip:function(e,t){for(var r=this.source;t<r.length&&S(e,_(r,t));t++);return t},until:function(e,t){t=this.skip(R,t);for(var r=_(this.source,t),n=0;n<e.length;n++)if(e[n]===r)return t;throw new b('Unexpected character: "'+r+'" at: '+t)}};var F=A((function(){var e,t="9007199254740993";return E(t,(function(t,r,n){e=n.source})),e!==t})),N=y&&!A((function(){return 1/E("-0 \t")!=-1/0}));n({target:"JSON",stat:!0,forced:F},{parse:function(e,t){return N&&!c(t)?E(e):function(e,t){e=p(e);var r=new O(e,0,""),n=r.parse(),i=n.value,s=r.skip(R,n.end);if(s<e.length)throw new b('Unexpected extra character: "'+_(e,s)+'" after the parsed data at: '+s);return c(t)?D({"":i},"",t,n):i}(e,t)}})},58429:(e,t,r)=>{var n=r(79039),i=r(44576).RegExp,s=n((function(){var e=i("a","y");return e.lastIndex=2,null!==e.exec("abcd")})),o=s||n((function(){return!i("a","y").sticky})),a=s||n((function(){var e=i("^r","gy");return e.lastIndex=2,null!==e.exec("str")}));e.exports={BROKEN_CARET:a,MISSED_STICKY:o,UNSUPPORTED_Y:s}},58523:(e,t,r)=>{var n=r(97751),i=r(79504),s=String.fromCharCode,o=n("String","fromCodePoint"),a=i("".charAt),l=i("".charCodeAt),c=i("".indexOf),h=i("".slice),u=function(e,t){var r=l(e,t);return r>=48&&r<=57},d=function(e,t,r){if(r>=e.length)return-1;for(var n=0;t<r;t++){var i=p(l(e,t));if(-1===i)return-1;n=16*n+i}return n},p=function(e){return e>=48&&e<=57?e-48:e>=97&&e<=102?e-97+10:e>=65&&e<=70?e-65+10:-1};e.exports=function(e){for(var t,r="",n=0,i=0;(i=c(e,"\\",i))>-1;){if(r+=h(e,n,i),++i===e.length)return;var l=a(e,i++);switch(l){case"b":r+="\b";break;case"t":r+="\t";break;case"n":r+="\n";break;case"v":r+="\v";break;case"f":r+="\f";break;case"r":r+="\r";break;case"\r":i<e.length&&"\n"===a(e,i)&&++i;case"\n":case"\u2028":case"\u2029":break;case"0":if(u(e,i))return;r+="\0";break;case"x":if(-1===(t=d(e,i,i+2)))return;i+=2,r+=s(t);break;case"u":if(i<e.length&&"{"===a(e,i)){var p=c(e,"}",++i);if(-1===p)return;t=d(e,i,p),i=p+1}else t=d(e,i,i+4),i+=4;if(-1===t||t>1114111)return;r+=o(t);break;default:if(u(l,0))return;r+=l}n=i}return r+h(e,n)}},58556:(e,t,r)=>{const n=r(43614),i=r(48694),s=r(26675);function o(e,t,r){const o=r&&r.debug||!1,a=!(r&&!1===typeof r.nested),l=r&&r.startIndex||0;o&&console.log("[xml-utils] starting findTagByName with",t," and ",r);const c=n(e,`<${t}[ \n>/]`,l);if(o&&console.log("[xml-utils] start:",c),-1===c)return;const h=e.slice(c+t.length);let u=i(h,"^[^<]*[ /]>",0);const d=-1!==u&&"/"===h[u-1];if(o&&console.log("[xml-utils] selfClosing:",d),!1===d)if(a){let e=0,r=1,n=0;for(;-1!==(u=i(h,"[ /]"+t+">",e));){const i=h.substring(e,u+1);if(r+=s(i,"<"+t+"[ \n\t>]"),n+=s(i,"</"+t+">"),n>=r)break;e=u}}else u=i(h,"[ /]"+t+">",0);const p=c+t.length+u+1;if(o&&console.log("[xml-utils] end:",p),-1===p)return;const f=e.slice(c,p);let g;return g=d?null:f.slice(f.indexOf(">")+1,f.lastIndexOf("<")),{inner:g,outer:f,start:c,end:p}}e.exports=o,e.exports.default=o},58622:(e,t,r)=>{var n=r(44576),i=r(94901),s=n.WeakMap;e.exports=i(s)&&/native code/.test(String(s))},58934:(e,t,r)=>{var n=r(46518),i=r(53487);n({target:"String",proto:!0,name:"trimStart",forced:"".trimLeft!==i},{trimLeft:i})},58940:(e,t,r)=>{var n=r(46518),i=r(52703);n({global:!0,forced:parseInt!==i},{parseInt:i})},59089:(e,t,r)=>{var n=r(46518),i=r(79504),s=Date,o=i(s.prototype.getTime);n({target:"Date",stat:!0},{now:function(){return o(new s)}})},59143:(e,t,r)=>{var n=r(44576),i=r(79504),s=r(83972),o=r(63463),a=r(39297),l=r(92804),c=r(944),h=r(55169),u=l.c2i,d=l.c2iUrl,p=n.SyntaxError,f=n.TypeError,g=i("".charAt),A=function(e,t){for(var r=e.length;t<r;t++){var n=g(e,t);if(" "!==n&&"\t"!==n&&"\n"!==n&&"\f"!==n&&"\r"!==n)break}return t},m=function(e,t,r){var n=e.length;n<4&&(e+=2===n?"AA":"A");var i=(t[g(e,0)]<<18)+(t[g(e,1)]<<12)+(t[g(e,2)]<<6)+t[g(e,3)],s=[i>>16&255,i>>8&255,255&i];if(2===n){if(r&&0!==s[1])throw new p("Extra bits");return[s[0]]}if(3===n){if(r&&0!==s[2])throw new p("Extra bits");return[s[0],s[1]]}return s},y=function(e,t,r){for(var n=t.length,i=0;i<n;i++)e[r+i]=t[i];return r+n};e.exports=function(e,t,r,n){o(e),s(t);var i="base64"===c(t)?u:d,l=t?t.lastChunkHandling:void 0;if(void 0===l&&(l="loose"),"loose"!==l&&"strict"!==l&&"stop-before-partial"!==l)throw new f("Incorrect `lastChunkHandling` option");r&&h(r.buffer);var v=r||[],w=0,b=0,E="",x=0;if(n)for(;;){if((x=A(e,x))===e.length){if(E.length>0){if("stop-before-partial"===l)break;if("loose"!==l)throw new p("Missing padding");if(1===E.length)throw new p("Malformed padding: exactly one additional character");w=y(v,m(E,i,!1),w)}b=e.length;break}var C=g(e,x);if(++x,"="===C){if(E.length<2)throw new p("Padding is too early");if(x=A(e,x),2===E.length){if(x===e.length){if("stop-before-partial"===l)break;throw new p("Malformed padding: only one =")}"="===g(e,x)&&(++x,x=A(e,x))}if(x<e.length)throw new p("Unexpected character after padding");w=y(v,m(E,i,"strict"===l),w),b=e.length;break}if(!a(i,C))throw new p("Unexpected character");var _=n-w;if(1===_&&2===E.length||2===_&&3===E.length)break;if(4===(E+=C).length&&(w=y(v,m(E,i,!1),w),E="",b=x,w===n))break}return{bytes:v,read:b,written:w}}},59149:(e,t,r)=>{var n=r(46518),i=r(2087),s=Math.abs;n({target:"Number",stat:!0},{isSafeInteger:function(e){return i(e)&&s(e)<=9007199254740991}})},59213:(e,t,r)=>{var n=r(76080),i=r(79504),s=r(47055),o=r(48981),a=r(26198),l=r(1469),c=i([].push),h=function(e){var t=1===e,r=2===e,i=3===e,h=4===e,u=6===e,d=7===e,p=5===e||u;return function(f,g,A,m){for(var y,v,w=o(f),b=s(w),E=a(b),x=n(g,A),C=0,_=m||l,I=t?_(f,E):r||d?_(f,0):void 0;E>C;C++)if((p||C in b)&&(v=x(y=b[C],C,w),e))if(t)I[C]=v;else if(v)switch(e){case 3:return!0;case 5:return y;case 6:return C;case 2:c(I,y)}else switch(e){case 4:return!1;case 7:c(I,y)}return u?-1:i||h?h:I}};e.exports={forEach:h(0),map:h(1),filter:h(2),some:h(3),every:h(4),find:h(5),findIndex:h(6),filterReject:h(7)}},59225:(e,t,r)=>{var n,i,s,o,a=r(44576),l=r(18745),c=r(76080),h=r(94901),u=r(39297),d=r(79039),p=r(20397),f=r(67680),g=r(4055),A=r(22812),m=r(89544),y=r(38574),v=a.setImmediate,w=a.clearImmediate,b=a.process,E=a.Dispatch,x=a.Function,C=a.MessageChannel,_=a.String,I=0,S={},M="onreadystatechange";d((function(){n=a.location}));var T=function(e){if(u(S,e)){var t=S[e];delete S[e],t()}},B=function(e){return function(){T(e)}},P=function(e){T(e.data)},R=function(e){a.postMessage(_(e),n.protocol+"//"+n.host)};v&&w||(v=function(e){A(arguments.length,1);var t=h(e)?e:x(e),r=f(arguments,1);return S[++I]=function(){l(t,void 0,r)},i(I),I},w=function(e){delete S[e]},y?i=function(e){b.nextTick(B(e))}:E&&E.now?i=function(e){E.now(B(e))}:C&&!m?(o=(s=new C).port2,s.port1.onmessage=P,i=c(o.postMessage,o)):a.addEventListener&&h(a.postMessage)&&!a.importScripts&&n&&"file:"!==n.protocol&&!d(R)?(i=R,a.addEventListener("message",P,!1)):i=M in g("script")?function(e){p.appendChild(g("script"))[M]=function(){p.removeChild(this),T(e)}}:function(e){setTimeout(B(e),0)}),e.exports={set:v,clear:w}},59323:(e,t,r)=>{r(36033),r(73772);var n=r(97751),i=r(2360),s=r(20034),o=Object,a=TypeError,l=n("Map"),c=n("WeakMap"),h=function(){this.object=null,this.symbol=null,this.primitives=null,this.objectsByIndex=i(null)};h.prototype.get=function(e,t){return this[e]||(this[e]=t())},h.prototype.next=function(e,t,r){var n=r?this.objectsByIndex[e]||(this.objectsByIndex[e]=new c):this.primitives||(this.primitives=new l),i=n.get(t);return i||n.set(t,i=new h),i};var u=new h;e.exports=function(){var e,t,r=u,n=arguments.length;for(e=0;e<n;e++)s(t=arguments[e])&&(r=r.next(e,t,!0));if(this===o&&r===u)throw new a("Composite keys must contain a non-primitive component");for(e=0;e<n;e++)s(t=arguments[e])||(r=r.next(e,t,!1));return r}},59848:(e,t,r)=>{r(86368),r(29309)},59904:(e,t,r)=>{r(46518)({target:"Object",stat:!0,sham:!r(43724)},{create:r(2360)})},60193:(e,t,r)=>{r(70511)("hasInstance")},60268:(e,t,r)=>{var n=r(46518),i=r(77240);n({target:"String",proto:!0,forced:r(23061)("fontcolor")},{fontcolor:function(e){return i(this,"font","color",e)}})},60321:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(47650),o=r(83440);n({target:"Set",proto:!0,real:!0,forced:!0},{difference:function(e){return i(o,this,s(e))}})},60479:(e,t,r)=>{r(10687)(Math,"Math",!0)},60511:(e,t,r)=>{var n=r(60788),i=TypeError;e.exports=function(e){if(n(e))throw new i("The method doesn't accept regular expressions");return e}},60533:(e,t,r)=>{var n=r(79504),i=r(18014),s=r(655),o=r(72333),a=r(67750),l=n(o),c=n("".slice),h=Math.ceil,u=function(e){return function(t,r,n){var o,u,d=s(a(t)),p=i(r),f=d.length,g=void 0===n?" ":s(n);return p<=f||""===g?d:((u=l(g,h((o=p-f)/g.length))).length>o&&(u=c(u,0,o)),e?d+u:u+d)}};e.exports={start:u(!1),end:u(!0)}},60563:(e,t,r)=>{const n=r(58556);function i(e,t,r){const i=[],s=r&&r.debug||!1,o=!r||"boolean"!=typeof r.nested||r.nested;let a,l=r&&r.startIndex||0;for(;a=n(e,t,{debug:s,startIndex:l});)l=o?a.start+1+t.length:a.end,i.push(a);return s&&console.log("findTagsByName found",i.length,"tags"),i}e.exports=i,e.exports.default=i},60605:(e,t,r)=>{r(46518)({target:"Math",stat:!0},{fround:r(15617)})},60706:(e,t,r)=>{var n=r(10350).PROPER,i=r(79039),s=r(47452);e.exports=function(e){return i((function(){return!!s[e]()||""!==""[e]()||n&&s[e].name!==e}))}},60739:(e,t,r)=>{var n=r(46518),i=r(79039),s=r(48981),o=r(72777);n({target:"Date",proto:!0,arity:1,forced:i((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}))},{toJSON:function(e){var t=s(this),r=o(t,"number");return"number"!=typeof r||isFinite(r)?t.toISOString():null}})},60788:(e,t,r)=>{var n=r(20034),i=r(22195),s=r(78227)("match");e.exports=function(e){var t;return n(e)&&(void 0!==(t=e[s])?!!t:"RegExp"===i(e))}},60825:(e,t,r)=>{var n=r(46518),i=r(97751),s=r(18745),o=r(30566),a=r(35548),l=r(28551),c=r(20034),h=r(2360),u=r(79039),d=i("Reflect","construct"),p=Object.prototype,f=[].push,g=u((function(){function e(){}return!(d((function(){}),[],e)instanceof e)})),A=!u((function(){d((function(){}))})),m=g||A;n({target:"Reflect",stat:!0,forced:m,sham:m},{construct:function(e,t){a(e),l(t);var r=arguments.length<3?e:a(arguments[2]);if(A&&!g)return d(e,t,r);if(e===r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return s(f,n,t),new(s(o,e,n))}var i=r.prototype,u=h(c(i)?i:p),m=s(e,u,t);return c(m)?m:u}})},61034:(e,t,r)=>{var n=r(69565),i=r(39297),s=r(1625),o=r(67979),a=RegExp.prototype;e.exports=function(e){var t=e.flags;return void 0!==t||"flags"in a||i(e,"flags")||!s(a,e)?t:n(o,e)}},61699:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(79039)((function(){return 120!==new Date(16e11).getYear()})),o=i(Date.prototype.getFullYear);n({target:"Date",proto:!0,forced:s},{getYear:function(){return o(this)-1900}})},61701:(e,t,r)=>{var n=r(46518),i=r(20713);n({target:"Iterator",proto:!0,real:!0,forced:r(96395)},{map:i})},61740:(e,t,r)=>{r(15823)("Uint32",(function(e){return function(t,r,n){return e(this,t,r,n)}}))},61806:(e,t,r)=>{var n=r(46518),i=r(28551),s=r(72652),o=r(1767),a=[].push;n({target:"Iterator",proto:!0,real:!0},{toArray:function(){var e=[];return s(o(i(this)),a,{that:e,IS_RECORD:!0}),e}})},61828:(e,t,r)=>{var n=r(79504),i=r(39297),s=r(25397),o=r(19617).indexOf,a=r(30421),l=n([].push);e.exports=function(e,t){var r,n=s(e),c=0,h=[];for(r in n)!i(a,r)&&i(n,r)&&l(h,r);for(;t.length>c;)i(n,r=t[c++])&&(~o(h,r)||l(h,r));return h}},61833:(e,t,r)=>{r(70511)("search")},61938:(e,t,r)=>{var n=r(46518),i=r(6469);n({target:"Array",proto:!0,forced:!0},{uniqueBy:r(79565)}),i("uniqueBy")},62010:(e,t,r)=>{var n=r(43724),i=r(10350).EXISTS,s=r(79504),o=r(62106),a=Function.prototype,l=s(a.toString),c=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,h=s(c.exec);n&&!i&&o(a,"name",{configurable:!0,get:function(){try{return h(c,l(this))[1]}catch(e){return""}}})},62062:(e,t,r)=>{var n=r(46518),i=r(59213).map;n({target:"Array",proto:!0,forced:!r(70597)("map")},{map:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},62106:(e,t,r)=>{var n=r(50283),i=r(24913);e.exports=function(e,t,r){return r.get&&n(r.get,t,{getter:!0}),r.set&&n(r.set,t,{setter:!0}),i.f(e,t,r)}},62337:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(91291),o=r(31240),a=r(72333),l=r(49340),c=r(79039),h=RangeError,u=String,d=isFinite,p=Math.abs,f=Math.floor,g=Math.pow,A=Math.round,m=i(1..toExponential),y=i(a),v=i("".slice),w="-6.9000e-11"===m(-69e-12,4)&&"1.25e+0"===m(1.255,2)&&"1.235e+4"===m(12345,3)&&"3e+1"===m(25,0);n({target:"Number",proto:!0,forced:!w||!(c((function(){m(1,1/0)}))&&c((function(){m(1,-1/0)})))||!!c((function(){m(1/0,1/0),m(NaN,1/0)}))},{toExponential:function(e){var t=o(this);if(void 0===e)return m(t);var r=s(e);if(!d(t))return String(t);if(r<0||r>20)throw new h("Incorrect fraction digits");if(w)return m(t,r);var n,i,a,c,b="";if(t<0&&(b="-",t=-t),0===t)i=0,n=y("0",r+1);else{var E=l(t);i=f(E);var x=g(10,i-r),C=A(t/x);2*t>=(2*C+1)*x&&(C+=1),C>=g(10,r+1)&&(C/=10,i+=1),n=u(C)}return 0!==r&&(n=v(n,0,1)+"."+v(n,1)),0===i?(a="+",c="0"):(a=i>0?"+":"-",c=u(p(i))),b+(n+"e")+a+c}})},62480:(e,t,r)=>{r(55081)},62529:e=>{e.exports=function(e,t){return{value:e,done:t}}},62953:(e,t,r)=>{var n=r(44576),i=r(67400),s=r(79296),o=r(23792),a=r(66699),l=r(10687),c=r(78227)("iterator"),h=o.values,u=function(e,t){if(e){if(e[c]!==h)try{a(e,c,h)}catch(t){e[c]=h}if(l(e,t,!0),i[t])for(var r in o)if(e[r]!==o[r])try{a(e,r,o[r])}catch(t){e[r]=o[r]}}};for(var d in i)u(n[d]&&n[d].prototype,d);u(s,"DOMTokenList")},62996:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Thread=void 0;const n=r(83682);function i(e){throw Error(e)}t.Thread={errors:e=>e[n.$errors]||i("Error observable not found. Make sure to pass a thread instance as returned by the spawn() promise."),events:e=>e[n.$events]||i("Events observable not found. Make sure to pass a thread instance as returned by the spawn() promise."),terminate:e=>e[n.$terminate]()}},63463:e=>{var t=TypeError;e.exports=function(e){if("string"==typeof e)return e;throw new t("Argument is not a string")}},63548:(e,t,r)=>{var n=r(43724),i=r(62106),s=r(20034),o=r(13925),a=r(48981),l=r(67750),c=Object.getPrototypeOf,h=Object.setPrototypeOf,u=Object.prototype,d="__proto__";if(n&&c&&h&&!(d in u))try{i(u,d,{configurable:!0,get:function(){return c(a(this))},set:function(e){var t=l(this);o(e)&&s(t)&&h(t,e)}})}catch(e){}},64117:e=>{e.exports=function(e){return null==e}},64304:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default={isWorkerRuntime:function(){const e="undefined"!=typeof self&&"undefined"!=typeof Window&&self instanceof Window;return!("undefined"==typeof self||!self.postMessage||e)},postMessageToMaster:function(e,t){self.postMessage(e,t)},subscribeToMasterMessages:function(e){const t=t=>{e(t.data)};return self.addEventListener("message",t),()=>{self.removeEventListener("message",t)}}}},64346:(e,t,r)=>{r(46518)({target:"Array",stat:!0},{isArray:r(34376)})},64377:(e,t,r)=>{var n=r(46518),i=r(76080),s=r(97080),o=r(38469);n({target:"Set",proto:!0,real:!0,forced:!0},{find:function(e){var t=s(this),r=i(e,arguments.length>1?arguments[1]:void 0),n=o(t,(function(e){if(r(e,e,t))return{value:e}}),!0);return n&&n.value}})},64444:(e,t,r)=>{var n=r(46518),i=r(77782),s=Math.abs,o=Math.pow;n({target:"Math",stat:!0},{cbrt:function(e){var t=+e;return i(t)*o(s(t),1/3)}})},64449:(e,t,r)=>{var n=r(97080),i=r(94402).has,s=r(25170),o=r(83789),a=r(38469),l=r(40507),c=r(9539);e.exports=function(e){var t=n(this),r=o(e);if(s(t)<=r.size)return!1!==a(t,(function(e){if(r.includes(e))return!1}),!0);var h=r.getIterator();return!1!==l(h,(function(e){if(i(t,e))return c(h,"normal",!1)}))}},64457:(e,t,r)=>{r.d(t,{Li:()=>aE,cG:()=>gE,om:()=>Sg,t$:()=>Yh,tb:()=>QC,hA:()=>_E,VG:()=>ME,Lq:()=>BE,s9:()=>PE,he:()=>Wh,uU:()=>Vx,DR:()=>zx,vw:()=>kE,VF:()=>Gx,h9:()=>Hh,HI:()=>SE,df:()=>E,WZ:()=>Tm,tC:()=>i.tC,Bo:()=>VE,TU:()=>HA,FD:()=>F,MY:()=>cg,nt:()=>oC,to:()=>Bb,C9:()=>V,E$:()=>i.E$,pD:()=>sx,fK:()=>tC,wk:()=>u,pM:()=>Pb,C1:()=>i.C1,CQ:()=>ex,kc:()=>eC,zR:()=>i.zR,Xs:()=>Vi,Xj:()=>Yi,as:()=>ob,ZC:()=>ts,fj:()=>qi,mV:()=>Rb,Sv:()=>dv,H_:()=>Oh,eI:()=>sc,_n:()=>ox,WF:()=>rw,oj:()=>qv,T8:()=>po,SF:()=>yy,J_:()=>ho,Zn:()=>ds,zi:()=>l,kP:()=>Tc,Q2:()=>_c,wA:()=>co,UP:()=>zm,jw:()=>Ch,Nx:()=>vy,hg:()=>fo,$1:()=>go,p8:()=>n,Qd:()=>oo,GS:()=>Zx,JU:()=>Wg,QG:()=>AA,Wd:()=>uc,n7:()=>M,Wz:()=>ch,uj:()=>mg,co:()=>Wx,TA:()=>Hx,xG:()=>Eg,vZ:()=>qx,cq:()=>Cc,SZ:()=>i.SZ,nL:()=>kv,j6:()=>$E,b_:()=>_x,w7:()=>tv,qW:()=>sg,cn:()=>og,qU:()=>ag,pZ:()=>nv,ko:()=>av,_i:()=>lv,lt:()=>Gb,BH:()=>pg,kY:()=>nE,J5:()=>Qx,$Z:()=>Xb,VS:()=>Tx,sP:()=>GC,fZ:()=>bv,a0:()=>vv,Uv:()=>yv,oN:()=>wv,vx:()=>cb,zQ:()=>UC,kL:()=>cc,Q5:()=>dw,OF:()=>aA,Od:()=>lx,qO:()=>yh,GQ:()=>mA,Pm:()=>fy,Xc:()=>gy,we:()=>Cx,Ss:()=>TA,AZ:()=>hx,nw:()=>px,jV:()=>fx,Ll:()=>ye,Ql:()=>i.Ql,YC:()=>yg,eU:()=>vg,Si:()=>wg,gL:()=>me,ar:()=>vf,oS:()=>fE,Ir:()=>Bv,v4:()=>Tv});var n={};r.r(n),r.d(n,{getColorLayersIdOrderedBySequence:()=>G,moveLayerDown:()=>U,moveLayerToIndex:()=>N,moveLayerUp:()=>Q});var i=r(84120),s=r(43070);const o=new i.E$("EPSG:4326"),a=new s.Vector2,l=class{constructor(e,t,r){i.tC.isGeographic(e.crs),this.extent=e,this.step=new s.Vector2(t.x,t.y||t.x),this.dimensions=this.extent.planarDimensions(),this.dataSize=(new s.Vector2).addVectors(this.step,this.dimensions).divide(this.step).round(),this.getData=r}getHeightAtCoordinates(e){return e.as(this.extent.crs,o),a.set((this.dataSize.x-1)*(o.x-this.extent.west)/this.dimensions.x,(this.dataSize.y-1)*(o.y-this.extent.south)/this.dimensions.y),a.x<0||a.x>=this.dataSize.x-1||a.y<0||a.y>=this.dataSize.y-1?0:function(e,t){const r=Math.floor(e.x),n=Math.floor(e.y),i=e.x-r,s=e.y-n;return(1-i)*((1-s)*t(n,r)+s*t(n+1,r))+i*((1-s)*t(n,r+1)+s*t(n+1,r+1))}(a,this.getData)}},c={v:new s.Vector3,coord1:new i.E$("EPSG:4978"),coord2:new i.E$("EPSG:4978"),offset:new s.Vector2};function h(e,t,r,n,s,o){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},l=arguments.length>8?arguments[8]:void 0;const h=(arguments.length>7?arguments[7]:void 0)||new i.E$(n);a.worldFromLocal?h.setFromVector3(c.v.copy(s).applyMatrix4(a.worldFromLocal)):h.setFromVector3(s);const d=u.getTerrainObjectAt(e,h,t,r,l);if(d)return d.coord.z+=o,d.coord.as(n,c.coord2).toVector3(s),a.localFromWorld&&s.applyMatrix4(a.localFromWorld),{id:d.texture.id,version:d.texture.version,tile:d.tile}}const u={getElevationValueAt(e,t){const r=b(e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t,(arguments.length>3?arguments[3]:void 0)||e.level0Nodes);if(r)return r.coord.z},getTerrainObjectAt(e,t){let r=arguments.length>4?arguments[4]:void 0;return b(e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t,(arguments.length>3?arguments[3]:void 0)||e.level0Nodes,r)},FAST_READ_Z:0,PRECISE_READ_Z:1,placeObjectOnGround:function(e,t,r){let n,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4?arguments[4]:void 0;if(console.warn("placeObjectOnGround has been deprecated because it needs review and test"),n=a?a.concat(e.level0Nodes):e.level0Nodes,o.modifyGeometry){const a={worldFromLocal:r.matrixWorld,localFromWorld:(new s.Matrix4).copy(r.matrixWorld).invert()},l=r.geometry;if(l.vertices){o.cache&&(o.cache.length=l.vertices.length);let r=!0;const s=new i.E$(t);for(let i=0;i<l.vertices.length;i++){const c=o.cache?o.cache[i]:void 0,d=h(e,o.method||u.FAST_READ_Z,n,t,l.vertices[i],o.offset||0,a,s,c);o.cache&&(o.cache[i]=d),d||(r=!1)}return l.verticesNeedUpdate=!0,r}if(l.isBufferGeometry){o.cache&&(o.cache.length=l.attributes.position.count);let r=!0;const c=new s.Vector3,d=new i.E$(t);for(let i=0;i<l.attributes.position.count;i++){const s=o.cache?o.cache[i]:void 0;c.fromBufferAttribute(l.attributes.position,i);const p=c.z,f=h(e,o.method||u.FAST_READ_Z,n,t,c,o.offset||0,a,d,s);o.cache&&(o.cache[i]=f),f||(r=!1),p!=c.z&&(l.attributes.position.needsUpdate=!0),l.attributes.position.setXYZ(i,c.x,c.y,c.z)}return r}}else{o.cache&&(o.cache.length=1);const i={worldFromLocal:r.parent?r.parent.matrixWorld:void 0,localFromWorld:r.parent?(new s.Matrix4).copy(r.parent.matrixWorld).invert():void 0},a=h(e,o.method||u.FAST_READ_Z,n,t,r.position,o.offset||0,i,void 0,o.cache?o.cache[0]:void 0);if(a)return o.cache&&(o.cache[0]=a),r.updateMatrix(),r.updateMatrixWorld(),!0}}};function d(e,t){if(t.extent){if(!t.extent.isPointInside(e))return;for(let r=0;r<t.children.length;r++){const n=d(e,t.children[r]);if(n)return n}const r=t.material.getElevationTile();return r&&r.level>=0?t:void 0}}let p;function f(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];for(let e=0;e<n.length;e+=2)n[e]=s.MathUtils.clamp(n[e],0,t.image.width-1),n[e+1]=s.MathUtils.clamp(n[e+1],0,t.image.height-1);if(t.image.data){if(2===n.length){const r=t.image.data[n[1]*t.image.width+n[0]];return r!=e.noDataValue?r:void 0}const r=[];for(let i=0;i<n.length;i+=2){const s=t.image.data[n[i+1]*t.image.width+n[i]];r.push(s!=e.noDataValue?s:void 0)}return r}{p||(p=document.createElement("canvas"),p.width=2,p.height=2);let r=1/0,i=1/0,o=-1/0,a=-1/0;for(let e=0;e<n.length;e+=2)r=Math.min(n[e],r),i=Math.min(n[e+1],i),o=Math.max(n[e],o),a=Math.max(n[e+1],a);const l=o-r+1,c=a-i+1;p.width=Math.max(p.width,l),p.height=Math.max(p.height,c);const h=p.getContext("2d",{willReadFrequently:!0});h.drawImage(t.image,r,i,l,c,0,0,l,c);const u=h.getImageData(0,0,l,c),d=[];for(let t=0;t<n.length;t+=2){const o=n[t]-r,a=n[t+1]-i,c=s.MathUtils.lerp(e.colorTextureElevationMinZ,e.colorTextureElevationMaxZ,u.data[4*a*l+4*o]/255);d.push(c!=e.noDataValue?c:void 0)}return 2===n.length?d[0]:d}}function g(e,t,r){const n=e.image.width,i=e.image.height,s=Math.max(0,t*n-.5),o=Math.max(0,r*i-.5),a=Math.floor(s),l=Math.ceil(s),c=Math.floor(o);return{u1:a,u2:l,v1:c,v2:Math.ceil(o),wu:s-a,wv:o-c}}function A(e,t,r){return null==e?t:null==t?e:s.MathUtils.lerp(e,t,r)}function m(e,t,r,n){const i=g(t,r,n),[s,o,a,l]=f(e,t,i.u1,i.v1,i.u2,i.v1,i.u1,i.v2,i.u2,i.v2),c=A(s,o,i.wu),h=A(a,l,i.wu);return A(c,h,i.wv)}const y=new s.Vector3,v={v:new s.Vector3,coord1:new i.E$("EPSG:4978"),coord2:new i.E$("EPSG:4978"),offset:new s.Vector2},w=new s.Vector2;function b(e,t,r,n,i){const o=r.as(e.extent.crs,v.coord1);let a=null;i?.tile?.material&&(a=d(o,i.tile));for(let e=0;!a&&e<n.length;e++)a=d(o,n[e]);if(!a)return;const l=a,c=l.material.getElevationTile(),h=c.textures[0];if(i&&i.id===h.id&&i.version===h.version)return{coord:o,texture:h,tile:l};const u=Math.round(Math.log2(1/c.offsetScales[0].z));for(let e=0;e<u;e++)a=a.parent;return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.Vector2;if(e.crs!=t.crs)throw new Error(`Unsupported mix: ${e.crs} and ${t.crs}`);t.planarDimensions(w);const n=(e.x-t.west)/w.x,i=(t.north-e.y)/w.y;r.set(n,i)}(o,a.extent,v.offset),o.z=1==t?function(e,t,r,n,i){const o=n.x/i.x/16;let a=Math.floor(r.x/o)*o,l=Math.floor(r.y/o)*o;1==a&&(a-=o),1==l&&(l-=o);const c=a,h=a+o,u=l,d=l+o,p=(r.x-a)/o,f=(r.y-l)/o,g=new s.Triangle(new s.Vector3(c,d),new s.Vector3(h,u),1==f||p/(1-f)>=1?new s.Vector3(h,d):new s.Vector3(c,u));g.getBarycoord(new s.Vector3(r.x,r.y),y);const A=e.attachedLayers.filter((e=>e.isElevationLayer))[0],v=m(A,t,g.a.x,g.a.y),w=m(A,t,g.b.x,g.b.y),b=m(A,t,g.c.x,g.c.y);return v*y.x+w*y.y+b*y.z}(e,h,v.offset,l.extent.planarDimensions(),a.extent.planarDimensions()):function(e,t,r){return function(e,t,r,n){const i=g(t,r,n);return f(e,t,i.wu<=0?i.u1:i.u2,i.wv<=0?i.v1:i.v2)}(e.attachedLayers.filter((e=>e.isElevationLayer))[0],t,r.x,r.y)}(e,h,v.offset),null!=o.z?{coord:o,texture:h,tile:l}:void 0}const E={PERSPECTIVE:0,ORTHOGRAPHIC:1},x={frustum:new s.Frustum,matrix:new s.Matrix4,box3:new s.Box3},C=new s.Box3(new s.Vector3(-1,-1,-1),new s.Vector3(1,1,1));function _(e,t,r){if(e.camera3D.isOrthographicCamera)e._preSSE=t;else{const n=s.MathUtils.degToRad(r);e._preSSE=t/(2*Math.tan(.5*n))}}const I=[new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3],S=class{#e=!0;#t=(()=>new s.Matrix4)();constructor(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(this.crs=e,n.isCamera)console.warn("options.camera parameter is deprecated. Use options.camera.cameraThree to place a custom camera as a parameter. See the documentation of Camera."),this.camera3D=n;else if(n.cameraThree)this.camera3D=n.cameraThree;else switch(n.type){case E.ORTHOGRAPHIC:this.camera3D=new s.OrthographicCamera;break;case E.PERSPECTIVE:default:this.camera3D=new s.PerspectiveCamera(30)}if(this.camera3D.aspect=this.camera3D.aspect??1,this.width=t,this.height=r,this.resize(t,r),this._preSSE=1/0,this.camera3D.isPerspectiveCamera){let e=this.camera3D.fov;Object.defineProperty(this.camera3D,"fov",{get:()=>e,set:t=>{e=t,_(this,this.height,e)}})}}resize(e,t){if(!e||e<=0||!t||t<=0)return void console.warn(`Trying to resize the Camera with invalid height (${t}) or width (${e}). Skipping resize.`);const r=e/t;if(this.camera3D.aspect!==r){if(this.camera3D.isOrthographicCamera){this.camera3D.zoom*=this.width/e;const t=this.camera3D.top*this.camera3D.aspect/r;this.camera3D.bottom=-t,this.camera3D.top=t}else this.camera3D.isPerspectiveCamera&&(this.camera3D.fov=2*s.MathUtils.radToDeg(Math.atan(t/this.height*Math.tan(s.MathUtils.degToRad(this.camera3D.fov)/2))));this.camera3D.aspect=r}this.width=e,this.height=t,_(this,this.height,this.camera3D.fov),this.camera3D.updateProjectionMatrix&&(this.camera3D.updateProjectionMatrix(),this.#e=!0)}update(){this.camera3D.updateMatrixWorld(),this.#e=!0}position(e){return new i.E$(this.crs).setFromVector3(this.camera3D.position).as(e||this.crs)}setPosition(e){this.camera3D.position.copy(e.as(this.crs))}isBox3Visible(e,t){return this.box3SizeOnScreen(e,t).intersectsBox(C)}isSphereVisible(e,t){return this.#e&&(this.#t.multiplyMatrices(this.camera3D.projectionMatrix,this.camera3D.matrixWorldInverse),this.#e=!1),t?(x.matrix.multiplyMatrices(this.#t,t),x.frustum.setFromProjectionMatrix(x.matrix)):x.frustum.setFromProjectionMatrix(this.#t),x.frustum.intersectsSphere(e)}box3SizeOnScreen(e,t){const r=function(e,t,r){let n=e.camera3D.matrixWorldInverse;r&&(n=x.matrix.multiplyMatrices(e.camera3D.matrixWorldInverse,r)),I[0].set(t.min.x,t.min.y,t.min.z).applyMatrix4(n),I[1].set(t.min.x,t.min.y,t.max.z).applyMatrix4(n),I[2].set(t.min.x,t.max.y,t.min.z).applyMatrix4(n),I[3].set(t.min.x,t.max.y,t.max.z).applyMatrix4(n),I[4].set(t.max.x,t.min.y,t.min.z).applyMatrix4(n),I[5].set(t.max.x,t.min.y,t.max.z).applyMatrix4(n),I[6].set(t.max.x,t.max.y,t.min.z).applyMatrix4(n),I[7].set(t.max.x,t.max.y,t.max.z).applyMatrix4(n);let i=!1;for(let t=0;t<8;t++)I[t].z<=-e.camera3D.near?i=!0:I[t].z=-e.camera3D.near;return i?I:void 0}(this,e,t);if(!r)return x.box3.makeEmpty();for(let e=0;e<8;e++)r[e].applyMatrix4(this.camera3D.projectionMatrix);return x.box3.setFromPoints(r)}adjustAltitudeToAvoidCollisionWithLayer(e,t,r){const n=e.camera.position().as("EPSG:4326");if(void 0!==t){const i=u.getElevationValueAt(t,n);void 0!==i&&n.altitude-(i+r)<0&&(n.altitude=i+r,e.camera3D.position.copy(n.as(e.referenceCrs)),e.notifyChange(this.camera3D))}}},M={UPDATE_START:"update_start",BEFORE_CAMERA_UPDATE:"before_camera_update",AFTER_CAMERA_UPDATE:"after_camera_update",BEFORE_LAYER_UPDATE:"before_layer_update",AFTER_LAYER_UPDATE:"after_layer_update",BEFORE_RENDER:"before_render",AFTER_RENDER:"after_render",UPDATE_END:"update_end"};function T(e,t,r){if(r)for(const n of r){const r=t.update(e,t,n),i=t.getObjectToUpdateForAttachedLayers(n);if(i)if(i.element)for(const r of t.attachedLayers)r.ready&&r.update(e,r,i.element,i.parent);else if(i.elements)for(let r=0;r<i.elements.length;r++){if(!i.elements[r].isObject3D)throw new Error("\n                            Invalid object for attached layer to update.\n                            Must be a THREE.Object and have a THREE.Material");for(const n of t.attachedLayers)n.ready&&n.update(e,n,i.elements[r],i.parent)}T(e,t,r)}}function B(e,t){let r=!1;const n=new Set;return e.forEach((e=>{e===t||e.isCamera?(t.info.clear(),r=!0):e.layer===t&&n.add(e)})),r?new Set([t]):n}class P extends s.EventDispatcher{#r=!1;#n=!0;#i=0;constructor(e,t){super(),this.renderingState=0,this.scheduler=e,this.gfxEngine=t}scheduleViewUpdate(e,t){this.#r|=t,1!==this.renderingState&&(this.renderingState=1,this.gfxEngine.renderer.xr.isPresenting||requestAnimationFrame((t=>{this.step(e,t)})))}#s(e,t,r){const n={camera:e.camera,engine:this.gfxEngine,scheduler:this.scheduler,view:e};t.forEach((e=>{const r=e.layer||e;r.isLayer&&r.parent&&t.add(r.parent)}));for(const i of e.getLayers(((e,t)=>!t)))if(n.geometryLayer=i,i.ready&&i.visible&&!i.frozen){e.execFrameRequesters(M.BEFORE_LAYER_UPDATE,r,this.#n,i);const s=B(t,i);if(s.size>0){for(const e of i.attachedLayers)e.ready&&e.preUpdate&&e.preUpdate(n,s);const e=i.preUpdate(n,s);T(n,i,e),i.postUpdate(n,i,t)}e.execFrameRequesters(M.AFTER_LAYER_UPDATE,r,this.#n,i)}}step(e,t){const r=t-this.#i;e._executeFrameRequestersRemovals(),e.execFrameRequesters(M.UPDATE_START,r,this.#n);const n=this.#r;this.#i=t,this.#r=!1,this.renderingState=0;const i=new Set(e._changeSources);e._changeSources.clear();const s=this.gfxEngine.getWindowSize();e.execFrameRequesters(M.BEFORE_CAMERA_UPDATE,r,this.#n),e.camera.update(s.x,s.y),e.execFrameRequesters(M.AFTER_CAMERA_UPDATE,r,this.#n);const o=e.camera3D.matrixAutoUpdate;e.camera3D.matrixAutoUpdate=!1,this.#s(e,i,r),0==this.scheduler.commandsWaitingExecutionCount()&&this.dispatchEvent({type:"command-queue-empty"}),n&&this.#o(e,r),this.#n=0===this.renderingState,e.camera3D.matrixAutoUpdate=o,e.execFrameRequesters(M.UPDATE_END,r,this.#n)}#o(e,t){e.execFrameRequesters(M.BEFORE_RENDER,t,this.#n),e.render?e.render():this.gfxEngine.renderView(e),e.execFrameRequesters(M.AFTER_RENDER,t,this.#n)}}const R=P;let D=!1,L=8,k=4096;function O(e,t,r){const n=e.getContext(),i=n.createShader(t);return n.shaderSource(i,r),n.compileShader(i),i}const F={isLogDepthBufferSupported:()=>D,getMaxTextureUnitsCount:()=>L,getMaxTextureSize:()=>k,updateCapabilities(e){const t=e.getContext();L=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),k=t.getParameter(t.MAX_TEXTURE_SIZE);const r=t.createProgram(),n=O(e,t.VERTEX_SHADER,"void main() {\n    gl_Position = vec4( 0.0, 0.0, 0.0, 1.0 );\n}");let i=`#define SAMPLE ${L}\n`;i+="uniform sampler2D uni[SAMPLE];\nvoid main() {\n    gl_FragColor += texture2D(uni[SAMPLE-1], vec2(0));\n}";const s=O(e,t.FRAGMENT_SHADER,i);if(t.attachShader(r,n),t.attachShader(r,s),t.linkProgram(r),!1===t.getProgramParameter(r,t.LINK_STATUS))throw new Error(`The GPU capabilities could not be determined accurately.\n                Impossible to link a shader with the Maximum texture units ${L}`);t.deleteProgram(r),t.deleteShader(n),t.deleteShader(s),D=e.capabilities.logarithmicDepthBuffer}};function N(e,t,r){t=Math.min(t,r.length-1),t=Math.max(t,0);const n=e.sequence;for(const i of r)i.id===e.id?i.sequence=t:i.sequence>n&&i.sequence<=t?i.sequence--:i.sequence>=t&&i.sequence<n&&i.sequence++}function U(e,t){e.sequence>0&&N(e,e.sequence-1,t)}function Q(e,t){const r=t.length-1;e.sequence<r&&N(e,e.sequence+1,t)}function G(e){const t=Array.from(e);return t.sort(((e,t)=>e.sequence-t.sequence)),t.map((e=>e.id))}function z(e,t){const r=G(t),n=function(e){e.material?.setColorTileIds&&e.material.setColorTileIds(r)};for(const t of e.level0Nodes)t.traverse(n)}const j="layers-order-changed",V={moveLayerUp(e,t){const r=e.getLayers((e=>e.isColorLayer)),n=e.getLayerById(t);if(!n)throw new Error(`${t} isn't color layer`);{const t=G(r);Q(n,r),z(e.tileLayer,r),e.dispatchEvent({type:j,previous:{sequence:t},new:{sequence:G(r)}}),e.notifyChange(e.tileLayer)}},moveLayerDown(e,t){const r=e.getLayers((e=>e.isColorLayer)),n=e.getLayerById(t);if(!n)throw new Error(`${t} isn't color layer`);{const t=G(r);U(n,r),z(e.tileLayer,r),e.dispatchEvent({type:j,previous:{sequence:t},new:{sequence:G(r)}}),e.notifyChange(e.tileLayer)}},moveLayerToIndex(e,t,r){const n=e.getLayers((e=>e.isColorLayer)),i=e.getLayerById(t);if(!i)throw new Error(`${t} isn't color layer`);{const t=G(n);N(i,r,n),z(e.tileLayer,n),e.dispatchEvent({type:j,previous:{sequence:t},new:{sequence:G(n)}}),e.notifyChange(e.tileLayer)}}},q=new RegExp("gl_Position.*(?![^]*gl_Position)"),H=new RegExp("[^\\w]*main[^\\w]*(void)?[^\\w]*{"),W={patchMaterialForLogDepthSupport(e){if(e.vertexShader.includes("USE_LOGDEPTHBUF")||e.vertexShader.includes("logdepthbuf_pars_vertex"))return;e.vertexShader=`#include <logdepthbuf_pars_vertex>\n#define EPSILON 1e-6\n${e.vertexShader}`;let t=q.exec(e.vertexShader),r=t[0].length+t.index;e.vertexShader=`${e.vertexShader.slice(0,r)}\n#include <logdepthbuf_vertex>\n${e.vertexShader.slice(r)}`,e.fragmentShader=`#include <itowns/precision_qualifier\n${e.fragmentShader}`,e.fragmentShader=`#include <logdepthbuf_pars_fragment>\n${e.fragmentShader}`,t=H.exec(e.fragmentShader),r=t[0].length+t.index,e.fragmentShader=`${e.fragmentShader.slice(0,r)}\n#include <logdepthbuf_fragment>\n${e.fragmentShader.slice(r)}`,e.defines={USE_LOGDEPTHBUF:1,USE_LOGDEPTHBUF_EXT:1}},unrollLoops:(e,t)=>e.replace(/#pragma unroll_loop\s+for\s*\(\s*int\s+i\s*=\s*([\w\d]+);\s*i\s+<\s+([\w\d]+);\s*i\s*\+\+\s*\)\s*\{\n([^}]*)\}/g,(function(e,r,n,i){let s="";r=r in t?t[r]:parseInt(r,10),n=n in t?t[n]:parseInt(n,10);for(let e=r;e<n;e++)s+=i.replace(/\bi\b/g,` ${e} `);return s}))},$={FINAL:0,DEPTH:1,ID:2},Y={MODES:$,push:function(e,t){const r=e.mode??$.FINAL;if(r==t)return()=>{};const n=e=>t=>{const r=t.material;r&&(r.mode=e)};return e.traverse(n(t)),()=>{e.traverse(n(r))}}},K="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,J=new Set,X="object"==typeof process&&process?process:{},Z=(e,t,r,n)=>{"function"==typeof X.emitWarning?X.emitWarning(e,t,r,n):console.error(`[${r}] ${t}: ${e}`)};let ee=globalThis.AbortController,te=globalThis.AbortSignal;if(void 0===ee){te=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(e,t){this._onabort.push(t)}},ee=class{constructor(){t()}signal=new te;abort(e){if(!this.signal.aborted){this.signal.reason=e,this.signal.aborted=!0;for(const t of this.signal._onabort)t(e);this.signal.onabort?.(e)}}};let e="1"!==X.env?.LRU_CACHE_IGNORE_AC_WARNING;const t=()=>{e&&(e=!1,Z("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}Symbol("type");const re=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),ne=e=>re(e)?e<=Math.pow(2,8)?Uint8Array:e<=Math.pow(2,16)?Uint16Array:e<=Math.pow(2,32)?Uint32Array:e<=Number.MAX_SAFE_INTEGER?ie:null:null;class ie extends Array{constructor(e){super(e),this.fill(0)}}class se{heap;length;static#a=!1;static create(e){const t=ne(e);if(!t)return[];se.#a=!0;const r=new se(e,t);return se.#a=!1,r}constructor(e,t){if(!se.#a)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}}class oe{#l;#c;#h;#u;#d;#p;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#f;#g;#A;#m;#y;#v;#w;#b;#E;#x;#C;#_;#I;#S;#M;#T;#B;static unsafeExposeInternals(e){return{starts:e.#I,ttls:e.#S,sizes:e.#_,keyMap:e.#A,keyList:e.#m,valList:e.#y,next:e.#v,prev:e.#w,get head(){return e.#b},get tail(){return e.#E},free:e.#x,isBackgroundFetch:t=>e.#P(t),backgroundFetch:(t,r,n,i)=>e.#R(t,r,n,i),moveToTail:t=>e.#D(t),indexes:t=>e.#L(t),rindexes:t=>e.#k(t),isStale:t=>e.#O(t)}}get max(){return this.#l}get maxSize(){return this.#c}get calculatedSize(){return this.#g}get size(){return this.#f}get fetchMethod(){return this.#d}get memoMethod(){return this.#p}get dispose(){return this.#h}get disposeAfter(){return this.#u}constructor(e){const{max:t=0,ttl:r,ttlResolution:n=1,ttlAutopurge:i,updateAgeOnGet:s,updateAgeOnHas:o,allowStale:a,dispose:l,disposeAfter:c,noDisposeOnSet:h,noUpdateTTL:u,maxSize:d=0,maxEntrySize:p=0,sizeCalculation:f,fetchMethod:g,memoMethod:A,noDeleteOnFetchRejection:m,noDeleteOnStaleGet:y,allowStaleOnFetchRejection:v,allowStaleOnFetchAbort:w,ignoreFetchAbort:b}=e;if(0!==t&&!re(t))throw new TypeError("max option must be a nonnegative integer");const E=t?ne(t):Array;if(!E)throw new Error("invalid max value: "+t);if(this.#l=t,this.#c=d,this.maxEntrySize=p||this.#c,this.sizeCalculation=f,this.sizeCalculation){if(!this.#c&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(void 0!==A&&"function"!=typeof A)throw new TypeError("memoMethod must be a function if defined");if(this.#p=A,void 0!==g&&"function"!=typeof g)throw new TypeError("fetchMethod must be a function if specified");if(this.#d=g,this.#T=!!g,this.#A=new Map,this.#m=new Array(t).fill(void 0),this.#y=new Array(t).fill(void 0),this.#v=new E(t),this.#w=new E(t),this.#b=0,this.#E=0,this.#x=se.create(t),this.#f=0,this.#g=0,"function"==typeof l&&(this.#h=l),"function"==typeof c?(this.#u=c,this.#C=[]):(this.#u=void 0,this.#C=void 0),this.#M=!!this.#h,this.#B=!!this.#u,this.noDisposeOnSet=!!h,this.noUpdateTTL=!!u,this.noDeleteOnFetchRejection=!!m,this.allowStaleOnFetchRejection=!!v,this.allowStaleOnFetchAbort=!!w,this.ignoreFetchAbort=!!b,0!==this.maxEntrySize){if(0!==this.#c&&!re(this.#c))throw new TypeError("maxSize must be a positive integer if specified");if(!re(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#F()}if(this.allowStale=!!a,this.noDeleteOnStaleGet=!!y,this.updateAgeOnGet=!!s,this.updateAgeOnHas=!!o,this.ttlResolution=re(n)||0===n?n:1,this.ttlAutopurge=!!i,this.ttl=r||0,this.ttl){if(!re(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#N()}if(0===this.#l&&0===this.ttl&&0===this.#c)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#l&&!this.#c){const e="LRU_CACHE_UNBOUNDED";(e=>!J.has(e))(e)&&(J.add(e),Z("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",e,oe))}}getRemainingTTL(e){return this.#A.has(e)?1/0:0}#N(){const e=new ie(this.#l),t=new ie(this.#l);this.#S=e,this.#I=t,this.#U=(r,n,i=K.now())=>{if(t[r]=0!==n?i:0,e[r]=n,0!==n&&this.ttlAutopurge){const e=setTimeout((()=>{this.#O(r)&&this.#Q(this.#m[r],"expire")}),n+1);e.unref&&e.unref()}},this.#G=r=>{t[r]=0!==e[r]?K.now():0},this.#z=(i,s)=>{if(e[s]){const o=e[s],a=t[s];if(!o||!a)return;i.ttl=o,i.start=a,i.now=r||n();const l=i.now-a;i.remainingTTL=o-l}};let r=0;const n=()=>{const e=K.now();if(this.ttlResolution>0){r=e;const t=setTimeout((()=>r=0),this.ttlResolution);t.unref&&t.unref()}return e};this.getRemainingTTL=i=>{const s=this.#A.get(i);if(void 0===s)return 0;const o=e[s],a=t[s];return o&&a?o-((r||n())-a):1/0},this.#O=i=>{const s=t[i],o=e[i];return!!o&&!!s&&(r||n())-s>o}}#G=()=>{};#z=()=>{};#U=()=>{};#O=()=>!1;#F(){const e=new ie(this.#l);this.#g=0,this.#_=e,this.#j=t=>{this.#g-=e[t],e[t]=0},this.#V=(e,t,r,n)=>{if(this.#P(t))return 0;if(!re(r)){if(!n)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if("function"!=typeof n)throw new TypeError("sizeCalculation must be a function");if(r=n(t,e),!re(r))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return r},this.#q=(t,r,n)=>{if(e[t]=r,this.#c){const r=this.#c-e[t];for(;this.#g>r;)this.#H(!0)}this.#g+=e[t],n&&(n.entrySize=r,n.totalCalculatedSize=this.#g)}}#j=e=>{};#q=(e,t,r)=>{};#V=(e,t,r,n)=>{if(r||n)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#L({allowStale:e=this.allowStale}={}){if(this.#f)for(let t=this.#E;this.#W(t)&&(!e&&this.#O(t)||(yield t),t!==this.#b);)t=this.#w[t]}*#k({allowStale:e=this.allowStale}={}){if(this.#f)for(let t=this.#b;this.#W(t)&&(!e&&this.#O(t)||(yield t),t!==this.#E);)t=this.#v[t]}#W(e){return void 0!==e&&this.#A.get(this.#m[e])===e}*entries(){for(const e of this.#L())void 0===this.#y[e]||void 0===this.#m[e]||this.#P(this.#y[e])||(yield[this.#m[e],this.#y[e]])}*rentries(){for(const e of this.#k())void 0===this.#y[e]||void 0===this.#m[e]||this.#P(this.#y[e])||(yield[this.#m[e],this.#y[e]])}*keys(){for(const e of this.#L()){const t=this.#m[e];void 0===t||this.#P(this.#y[e])||(yield t)}}*rkeys(){for(const e of this.#k()){const t=this.#m[e];void 0===t||this.#P(this.#y[e])||(yield t)}}*values(){for(const e of this.#L())void 0===this.#y[e]||this.#P(this.#y[e])||(yield this.#y[e])}*rvalues(){for(const e of this.#k())void 0===this.#y[e]||this.#P(this.#y[e])||(yield this.#y[e])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(e,t={}){for(const r of this.#L()){const n=this.#y[r],i=this.#P(n)?n.__staleWhileFetching:n;if(void 0!==i&&e(i,this.#m[r],this))return this.get(this.#m[r],t)}}forEach(e,t=this){for(const r of this.#L()){const n=this.#y[r],i=this.#P(n)?n.__staleWhileFetching:n;void 0!==i&&e.call(t,i,this.#m[r],this)}}rforEach(e,t=this){for(const r of this.#k()){const n=this.#y[r],i=this.#P(n)?n.__staleWhileFetching:n;void 0!==i&&e.call(t,i,this.#m[r],this)}}purgeStale(){let e=!1;for(const t of this.#k({allowStale:!0}))this.#O(t)&&(this.#Q(this.#m[t],"expire"),e=!0);return e}info(e){const t=this.#A.get(e);if(void 0===t)return;const r=this.#y[t],n=this.#P(r)?r.__staleWhileFetching:r;if(void 0===n)return;const i={value:n};if(this.#S&&this.#I){const e=this.#S[t],r=this.#I[t];if(e&&r){const t=e-(K.now()-r);i.ttl=t,i.start=Date.now()}}return this.#_&&(i.size=this.#_[t]),i}dump(){const e=[];for(const t of this.#L({allowStale:!0})){const r=this.#m[t],n=this.#y[t],i=this.#P(n)?n.__staleWhileFetching:n;if(void 0===i||void 0===r)continue;const s={value:i};if(this.#S&&this.#I){s.ttl=this.#S[t];const e=K.now()-this.#I[t];s.start=Math.floor(Date.now()-e)}this.#_&&(s.size=this.#_[t]),e.unshift([r,s])}return e}load(e){this.clear();for(const[t,r]of e){if(r.start){const e=Date.now()-r.start;r.start=K.now()-e}this.set(t,r.value,r)}}set(e,t,r={}){if(void 0===t)return this.delete(e),this;const{ttl:n=this.ttl,start:i,noDisposeOnSet:s=this.noDisposeOnSet,sizeCalculation:o=this.sizeCalculation,status:a}=r;let{noUpdateTTL:l=this.noUpdateTTL}=r;const c=this.#V(e,t,r.size||0,o);if(this.maxEntrySize&&c>this.maxEntrySize)return a&&(a.set="miss",a.maxEntrySizeExceeded=!0),this.#Q(e,"set"),this;let h=0===this.#f?void 0:this.#A.get(e);if(void 0===h)h=0===this.#f?this.#E:0!==this.#x.length?this.#x.pop():this.#f===this.#l?this.#H(!1):this.#f,this.#m[h]=e,this.#y[h]=t,this.#A.set(e,h),this.#v[this.#E]=h,this.#w[h]=this.#E,this.#E=h,this.#f++,this.#q(h,c,a),a&&(a.set="add"),l=!1;else{this.#D(h);const r=this.#y[h];if(t!==r){if(this.#T&&this.#P(r)){r.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:t}=r;void 0===t||s||(this.#M&&this.#h?.(t,e,"set"),this.#B&&this.#C?.push([t,e,"set"]))}else s||(this.#M&&this.#h?.(r,e,"set"),this.#B&&this.#C?.push([r,e,"set"]));if(this.#j(h),this.#q(h,c,a),this.#y[h]=t,a){a.set="replace";const e=r&&this.#P(r)?r.__staleWhileFetching:r;void 0!==e&&(a.oldValue=e)}}else a&&(a.set="update")}if(0===n||this.#S||this.#N(),this.#S&&(l||this.#U(h,n,i),a&&this.#z(a,h)),!s&&this.#B&&this.#C){const e=this.#C;let t;for(;t=e?.shift();)this.#u?.(...t)}return this}pop(){try{for(;this.#f;){const e=this.#y[this.#b];if(this.#H(!0),this.#P(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(void 0!==e)return e}}finally{if(this.#B&&this.#C){const e=this.#C;let t;for(;t=e?.shift();)this.#u?.(...t)}}}#H(e){const t=this.#b,r=this.#m[t],n=this.#y[t];return this.#T&&this.#P(n)?n.__abortController.abort(new Error("evicted")):(this.#M||this.#B)&&(this.#M&&this.#h?.(n,r,"evict"),this.#B&&this.#C?.push([n,r,"evict"])),this.#j(t),e&&(this.#m[t]=void 0,this.#y[t]=void 0,this.#x.push(t)),1===this.#f?(this.#b=this.#E=0,this.#x.length=0):this.#b=this.#v[t],this.#A.delete(r),this.#f--,t}has(e,t={}){const{updateAgeOnHas:r=this.updateAgeOnHas,status:n}=t,i=this.#A.get(e);if(void 0!==i){const e=this.#y[i];if(this.#P(e)&&void 0===e.__staleWhileFetching)return!1;if(!this.#O(i))return r&&this.#G(i),n&&(n.has="hit",this.#z(n,i)),!0;n&&(n.has="stale",this.#z(n,i))}else n&&(n.has="miss");return!1}peek(e,t={}){const{allowStale:r=this.allowStale}=t,n=this.#A.get(e);if(void 0===n||!r&&this.#O(n))return;const i=this.#y[n];return this.#P(i)?i.__staleWhileFetching:i}#R(e,t,r,n){const i=void 0===t?void 0:this.#y[t];if(this.#P(i))return i;const s=new ee,{signal:o}=r;o?.addEventListener("abort",(()=>s.abort(o.reason)),{signal:s.signal});const a={signal:s.signal,options:r,context:n},l=(n,i=!1)=>{const{aborted:o}=s.signal,l=r.ignoreFetchAbort&&void 0!==n;if(r.status&&(o&&!i?(r.status.fetchAborted=!0,r.status.fetchError=s.signal.reason,l&&(r.status.fetchAbortIgnored=!0)):r.status.fetchResolved=!0),o&&!l&&!i)return c(s.signal.reason);const u=h;return this.#y[t]===h&&(void 0===n?u.__staleWhileFetching?this.#y[t]=u.__staleWhileFetching:this.#Q(e,"fetch"):(r.status&&(r.status.fetchUpdated=!0),this.set(e,n,a.options))),n},c=n=>{const{aborted:i}=s.signal,o=i&&r.allowStaleOnFetchAbort,a=o||r.allowStaleOnFetchRejection,l=a||r.noDeleteOnFetchRejection,c=h;if(this.#y[t]===h&&(l&&void 0!==c.__staleWhileFetching?o||(this.#y[t]=c.__staleWhileFetching):this.#Q(e,"fetch")),a)return r.status&&void 0!==c.__staleWhileFetching&&(r.status.returnedStale=!0),c.__staleWhileFetching;if(c.__returned===c)throw n};r.status&&(r.status.fetchDispatched=!0);const h=new Promise(((t,n)=>{const o=this.#d?.(e,i,a);o&&o instanceof Promise&&o.then((e=>t(void 0===e?void 0:e)),n),s.signal.addEventListener("abort",(()=>{r.ignoreFetchAbort&&!r.allowStaleOnFetchAbort||(t(void 0),r.allowStaleOnFetchAbort&&(t=e=>l(e,!0)))}))})).then(l,(e=>(r.status&&(r.status.fetchRejected=!0,r.status.fetchError=e),c(e)))),u=Object.assign(h,{__abortController:s,__staleWhileFetching:i,__returned:void 0});return void 0===t?(this.set(e,u,{...a.options,status:void 0}),t=this.#A.get(e)):this.#y[t]=u,u}#P(e){if(!this.#T)return!1;const t=e;return!!t&&t instanceof Promise&&t.hasOwnProperty("__staleWhileFetching")&&t.__abortController instanceof ee}async fetch(e,t={}){const{allowStale:r=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,ttl:s=this.ttl,noDisposeOnSet:o=this.noDisposeOnSet,size:a=0,sizeCalculation:l=this.sizeCalculation,noUpdateTTL:c=this.noUpdateTTL,noDeleteOnFetchRejection:h=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:u=this.allowStaleOnFetchRejection,ignoreFetchAbort:d=this.ignoreFetchAbort,allowStaleOnFetchAbort:p=this.allowStaleOnFetchAbort,context:f,forceRefresh:g=!1,status:A,signal:m}=t;if(!this.#T)return A&&(A.fetch="get"),this.get(e,{allowStale:r,updateAgeOnGet:n,noDeleteOnStaleGet:i,status:A});const y={allowStale:r,updateAgeOnGet:n,noDeleteOnStaleGet:i,ttl:s,noDisposeOnSet:o,size:a,sizeCalculation:l,noUpdateTTL:c,noDeleteOnFetchRejection:h,allowStaleOnFetchRejection:u,allowStaleOnFetchAbort:p,ignoreFetchAbort:d,status:A,signal:m};let v=this.#A.get(e);if(void 0===v){A&&(A.fetch="miss");const t=this.#R(e,v,y,f);return t.__returned=t}{const t=this.#y[v];if(this.#P(t)){const e=r&&void 0!==t.__staleWhileFetching;return A&&(A.fetch="inflight",e&&(A.returnedStale=!0)),e?t.__staleWhileFetching:t.__returned=t}const i=this.#O(v);if(!g&&!i)return A&&(A.fetch="hit"),this.#D(v),n&&this.#G(v),A&&this.#z(A,v),t;const s=this.#R(e,v,y,f),o=void 0!==s.__staleWhileFetching&&r;return A&&(A.fetch=i?"stale":"refresh",o&&i&&(A.returnedStale=!0)),o?s.__staleWhileFetching:s.__returned=s}}async forceFetch(e,t={}){const r=await this.fetch(e,t);if(void 0===r)throw new Error("fetch() returned undefined");return r}memo(e,t={}){const r=this.#p;if(!r)throw new Error("no memoMethod provided to constructor");const{context:n,forceRefresh:i,...s}=t,o=this.get(e,s);if(!i&&void 0!==o)return o;const a=r(e,o,{options:s,context:n});return this.set(e,a,s),a}get(e,t={}){const{allowStale:r=this.allowStale,updateAgeOnGet:n=this.updateAgeOnGet,noDeleteOnStaleGet:i=this.noDeleteOnStaleGet,status:s}=t,o=this.#A.get(e);if(void 0!==o){const t=this.#y[o],a=this.#P(t);return s&&this.#z(s,o),this.#O(o)?(s&&(s.get="stale"),a?(s&&r&&void 0!==t.__staleWhileFetching&&(s.returnedStale=!0),r?t.__staleWhileFetching:void 0):(i||this.#Q(e,"expire"),s&&r&&(s.returnedStale=!0),r?t:void 0)):(s&&(s.get="hit"),a?t.__staleWhileFetching:(this.#D(o),n&&this.#G(o),t))}s&&(s.get="miss")}#$(e,t){this.#w[t]=e,this.#v[e]=t}#D(e){e!==this.#E&&(e===this.#b?this.#b=this.#v[e]:this.#$(this.#w[e],this.#v[e]),this.#$(this.#E,e),this.#E=e)}delete(e){return this.#Q(e,"delete")}#Q(e,t){let r=!1;if(0!==this.#f){const n=this.#A.get(e);if(void 0!==n)if(r=!0,1===this.#f)this.#Y(t);else{this.#j(n);const r=this.#y[n];if(this.#P(r)?r.__abortController.abort(new Error("deleted")):(this.#M||this.#B)&&(this.#M&&this.#h?.(r,e,t),this.#B&&this.#C?.push([r,e,t])),this.#A.delete(e),this.#m[n]=void 0,this.#y[n]=void 0,n===this.#E)this.#E=this.#w[n];else if(n===this.#b)this.#b=this.#v[n];else{const e=this.#w[n];this.#v[e]=this.#v[n];const t=this.#v[n];this.#w[t]=this.#w[n]}this.#f--,this.#x.push(n)}}if(this.#B&&this.#C?.length){const e=this.#C;let t;for(;t=e?.shift();)this.#u?.(...t)}return r}clear(){return this.#Y("delete")}#Y(e){for(const t of this.#k({allowStale:!0})){const r=this.#y[t];if(this.#P(r))r.__abortController.abort(new Error("deleted"));else{const n=this.#m[t];this.#M&&this.#h?.(r,n,e),this.#B&&this.#C?.push([r,n,e])}}if(this.#A.clear(),this.#y.fill(void 0),this.#m.fill(void 0),this.#S&&this.#I&&(this.#S.fill(0),this.#I.fill(0)),this.#_&&this.#_.fill(0),this.#b=0,this.#E=0,this.#x.length=0,this.#g=0,this.#f=0,this.#B&&this.#C){const e=this.#C;let t;for(;t=e?.shift();)this.#u?.(...t)}}}const ae="\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n    ",le="\n        precision highp float;\n        uniform sampler2D sourceTexture;\n        varying vec2 vUv;\n        void main() {\n            gl_FragColor = texture2D(sourceTexture, vUv);\n        }\n    ";let ce=null,he=null;const ue=new s.OrthographicCamera(-1,1,1,-1,0,1),de=new s.Vector4(0,0,1,1),pe=255/256,fe=new s.Vector4(pe,.0038909912109375,pe/65536,5.9371814131736755e-8);function ge(e,t){return t?fe.dot(e)*t:fe.dot(e)}const Ae=1;function me(){return F.getMaxTextureUnitsCount()-Ae}const ye={noEffect:0,removeLightColor:1,removeWhiteColor:2,customEffect:3},ve={color:{textureOffset:0,crs:0,opacity:0,effect_parameter:0,effect_type:ye.noEffect,transparent:!1},elevation:{scale:0,bias:0,mode:0,zmin:0,zmax:0}},we=new oe({max:200,dispose:e=>{e.dispose()}});function be(e,t,r,n,i){const o=e.layers.value,a=e.textures,l=e.offsetScales.value,c=e.textureCount;let h=0,u=0,d=0,p=n;for(const e of t){e.textureOffset=h;for(let t=0;t<e.textures.length&&h<r;++t,++h){const r=e.textures[t];if(!r)continue;p+=`${r.id}.`,l[h]=e.offsetScales[t],o[h]=e;const n=r.image;if(!n||n.width<=0||n.height<=0)return console.error("Texture image not loaded or has zero dimensions"),void(c.value=0);if(0==h)u=n.width,d=n.height;else if(u!==n.width||d!==n.height)return console.error("Texture dimensions mismatch"),void(c.value=0)}}const f=we.get(p);if(f)return a.value=f.texture,void(c.value=h);const g=function(e,t,r,n,i,o){if(0===r)return null;const a=new s.WebGLArrayRenderTarget(e,t,r,{depthBuffer:!1}),l=a.texture;if(!he){const e=new s.PlaneGeometry(2,2);ce=new s.ShaderMaterial({uniforms:{sourceTexture:{value:null}},vertexShader:ae,fragmentShader:le}),he=new s.Mesh(e,ce)}let c=0;const h=o.getRenderTarget();for(const e of n)for(let t=0;t<e.textures.length&&c<i;++t,++c){const r=e.textures[t];r&&(ce.uniforms.sourceTexture.value=r,c||(l.magFilter=r.magFilter,l.minFilter=r.minFilter,l.wrapS=r.wrapS,l.wrapT=r.wrapT,l.format=r.format,l.type=r.type,l.internalFormat=r.internalFormat,l.anisotropy=r.anisotropy,l.premultiplyAlpha=r.premultiplyAlpha),o.setRenderTarget(a,c),o.render(he,ue))}return o.setRenderTarget(h),a}(u,d,h,t,r,i);g?(we.set(p,g),e.textures.value=g.texture,h>r&&console.warn(`LayeredMaterial: Not enough texture units (${r} < ${h}), excess textures have been discarded.`),c.value=h):c.value=0}const Ee={RGBA:0,COLOR:1,DATA:2};let xe;const Ce=[];function _e(e,t,r){void 0===e[t]&&(e[t]=r)}class Ie extends s.ShaderMaterial{_visible=!0;constructor(){let e=arguments.length>1?arguments[1]:void 0;super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),xe??=[Ae,me()];const t={};_e(t,"NUM_VS_TEXTURES",xe[0]),_e(t,"NUM_FS_TEXTURES",xe[1]),_e(t,"NUM_CRS",e),function(e){Object.keys(Ee).forEach((t=>_e(e,`ELEVATION_${t}`,Ee[t]))),Object.keys(Y.MODES).forEach((t=>_e(e,`MODE_${t}`,Y.MODES[t])))}(t),_e(t,"MODE",Y.MODES.FINAL),_e(t,"DEBUG",0),this.defines=t,this.fog=!0,this.vertexShader="#include <itowns/precision_qualifier>\n#include <common>\n#include <itowns/elevation_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#if NUM_CRS > 1\nattribute float     uv_1;\n#endif\n\nuniform bool lightingEnabled;\nvarying vec2 vHighPrecisionZW;\n\n#if MODE == MODE_FINAL\n#include <fog_pars_vertex>\nvarying vec3        vUv;\nvarying vec3        vNormal;\n#endif\nvoid main() {\n        #include <begin_vertex>\n        #include <itowns/elevation_vertex>\n        #include <itowns/geoid_vertex>\n        #include <project_vertex>\n        #include <logdepthbuf_vertex>\n        vHighPrecisionZW = gl_Position.zw;\n#if MODE == MODE_FINAL\n        #include <fog_vertex>\n        #if NUM_CRS > 1\n        vUv = vec3(uv, (uv_1 > 0.) ? uv_1 : uv.y); // set uv_1 = uv if uv_1 is undefined\n        #else\n        vUv = vec3(uv, 0.0);\n        #endif\n        vNormal = normalize ( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );\n#endif\n}\n",Ce[e]??=W.unrollLoops("#include <itowns/precision_qualifier>\n#include <logdepthbuf_pars_fragment>\n#include <itowns/pitUV>\n#include <itowns/color_layers_pars_fragment>\n#if MODE == MODE_FINAL\n#include <fog_pars_fragment>\n#include <itowns/overlay_pars_fragment>\n#include <itowns/lighting_pars_fragment>\n#endif\n#include <itowns/mode_pars_fragment>\n\nuniform vec3        diffuse;\nuniform float       opacity;\nvarying vec3        vUv; // uv.x/uv_1.x, uv.y, uv_1.y\nvarying vec2        vHighPrecisionZW;\n\nvoid main() {\n    #include <logdepthbuf_fragment>\n\n#if MODE == MODE_ID\n\n    #include <itowns/mode_id_fragment>\n\n#elif MODE == MODE_DEPTH\n\n    #include <itowns/mode_depth_fragment>\n\n#else\n\n    gl_FragColor = vec4(diffuse, opacity);\n\n    uvs[0] = vec3(vUv.xy, 0.);\n\n#if NUM_CRS > 1\n    uvs[1] = vec3(vUv.x, fract(vUv.z), floor(vUv.z));\n#endif\n\n    vec4 color;\n    #pragma unroll_loop\n    for ( int i = 0; i < NUM_FS_TEXTURES; i ++ ) {\n        color = getLayerColor( i , colorTextures, colorOffsetScales[ i ], colorLayers[ i ]);\n        gl_FragColor.rgb = mix(gl_FragColor.rgb, color.rgb, color.a);\n    }\n\n  #if DEBUG == 1\n    if (showOutline) {\n        #pragma unroll_loop\n        for ( int i = 0; i < NUM_CRS; i ++) {\n            color = getOutlineColor( outlineColors[ i ], uvs[ i ].xy);\n            gl_FragColor.rgb = mix(gl_FragColor.rgb, color.rgb, color.a);\n        }\n    }\n  #endif\n\n    #include <fog_fragment>\n    #include <itowns/lighting_fragment>\n    #include <itowns/overlay_fragment>\n\n#endif\n}\n",t),this.fragmentShader=Ce[e],this.initUniforms({diffuse:new s.Color(.04,.23,.35),opacity:this.opacity,lightingEnabled:!1,lightPosition:new s.Vector3(-.5,0,1),fogNear:1,fogFar:1e3,fogColor:new s.Color(.76,.85,1),fogDensity:25e-5,overlayAlpha:0,overlayColor:new s.Color(1,.3,0),objectId:0,geoidHeight:0,minBorderDistance:-.01}),this.colorTiles=[],this.colorTileIds=[],this.layersNeedUpdate=!1,this.initUniforms({elevationLayers:new Array(xe[0]).fill(ve.elevation),elevationTextures:null,elevationOffsetScales:new Array(xe[0]).fill(de),elevationTextureCount:0,colorLayers:new Array(xe[1]).fill(ve.color),colorTextures:null,colorOffsetScales:new Array(xe[1]).fill(de),colorTextureCount:0}),Object.defineProperty(this,"visible",{get(){return this._visible},set(e){this._visible!=e&&(this._visible=e,this.dispatchEvent({type:e?"shown":"hidden"}))}})}get mode(){return this.defines.MODE}set mode(e){this.defines.MODE!=e&&(this.defines.MODE=e,this.needsUpdate=!0)}getUniform(e){return this.uniforms[e]?.value}setUniform(e,t){const r=this.uniforms[e];void 0!==r&&r.value!==t&&(r.value=t)}initUniforms(e){for(const[t,r]of Object.entries(e))void 0===this.uniforms[t]&&(this.uniforms[t]={value:r})}setUniforms(e){for(const[t,r]of Object.entries(e))this.setUniform(t,r)}getLayerUniforms(e){return{layers:this.uniforms[`${e}Layers`],textures:this.uniforms[`${e}Textures`],offsetScales:this.uniforms[`${e}OffsetScales`],textureCount:this.uniforms[`${e}TextureCount`]}}updateLayersUniforms(e){const t=this.colorTiles.filter((e=>e.visible&&e.opacity>0));t.sort(((e,t)=>this.colorTileIds.indexOf(e.id)-this.colorTileIds.indexOf(t.id))),be(this.getLayerUniforms("color"),t,this.defines.NUM_FS_TEXTURES,"c",e),void 0!==this.elevationTileId&&this.getElevationTile()&&void 0!==this.elevationTile&&be(this.getLayerUniforms("elevation"),[this.elevationTile],this.defines.NUM_VS_TEXTURES,"e",e),this.layersNeedUpdate=!1}dispose(){this.dispatchEvent({type:"dispose"}),this.colorTiles.forEach((e=>e.dispose(!0))),this.colorTiles.length=0,this.elevationTile?.dispose(!0),this.layersNeedUpdate=!0}setColorTileIds(e){this.colorTileIds=e,this.layersNeedUpdate=!0}setElevationTileId(e){this.elevationTileId=e,this.layersNeedUpdate=!0}removeTile(e){const t=this.colorTiles.findIndex((t=>t.id===e));if(t>-1){this.colorTiles[t].dispose(),this.colorTiles.splice(t,1);const r=this.colorTileIds.indexOf(e);r>-1&&this.colorTileIds.splice(r,1)}else this.elevationTileId===e&&(this.elevationTile?.dispose(),this.elevationTileId=void 0,this.elevationTile=void 0)}addColorTile(e){e.layer.id in this.colorTiles&&console.warn('Layer "{layer.id}" already present in material, overwriting.'),this.colorTiles.push(e)}setElevationTile(e){const t=this.elevationTile;void 0!==t&&t.dispose(),this.elevationTile=e}getColorTile(e){return this.colorTiles.find((t=>t.id===e))}getElevationTile(){return this.elevationTile}getTile(e){return this.elevationTile?.id===e?this.elevationTile:this.colorTiles.find((t=>t.id===e))}getTiles(e){const t=this.colorTiles.filter((t=>e.includes(t.id)));return void 0!==this.elevationTile&&e.includes(this.elevationTile?.id)&&t.push(this.elevationTile),t}}class Se{constructor(e){this.layer=e}clear(){}update(){}}class Me extends Se{constructor(e){super(e),this.displayed={tiles:new Set},Object.defineProperty(this.displayed,"layers",{get:()=>{let e=[];return this.displayed.tiles.forEach((t=>{const r=t.material;e=[...new Set([...e,...r.colorTileIds.filter((e=>r.getColorTile(e))),r.elevationTileId])]})),this.layer.attachedLayers.filter((t=>e.includes(t.id)))}}),Object.defineProperty(this.displayed,"extent",{get:()=>{const e=new i.zR(this.layer.extent.crs,1/0,-1/0,1/0,-1/0);return e.min=1/0,e.max=-1/0,this.displayed.tiles.forEach((t=>{e.union(t.extent),e.min=Math.min(t.obb.z.min,e.min),e.max=Math.max(t.obb.z.max,e.max)})),e}})}clear(){this.displayed.tiles.clear()}update(e){e.material.visible?this.displayed.tiles.add(e):this.displayed.tiles.delete(e)}}var Te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Be{constructor(e,t,r,n){this.message=(e?`${e}: `:"")+r,n&&(this.identifier=n),null!=t&&t.__line__&&(this.line=t.__line__)}}function Pe(e,...t){for(const r of t)for(const t in r)e[t]=r[t];return e}class Re extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class De{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[e,r]of t)this.bindings[e]=r}concat(e){return new De(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Le={kind:"null"},ke={kind:"number"},Oe={kind:"string"},Fe={kind:"boolean"},Ne={kind:"color"},Ue={kind:"projectionDefinition"},Qe={kind:"object"},Ge={kind:"value"},ze={kind:"collator"},je={kind:"formatted"},Ve={kind:"padding"},qe={kind:"resolvedImage"},He={kind:"variableAnchorOffsetCollection"};function We(e,t){return{kind:"array",itemType:e,N:t}}function $e(e){if("array"===e.kind){const t=$e(e.itemType);return"number"==typeof e.N?`array<${t}, ${e.N}>`:"value"===e.itemType.kind?"array":`array<${t}>`}return e.kind}const Ye=[Le,ke,Oe,Fe,Ne,Ue,je,Qe,We(Ge),Ve,qe,He];function Ke(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Ke(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Ye)if(!Ke(e,t))return null}return`Expected ${$e(e)} but found ${$e(t)} instead.`}function Je(e,t){return t.some((t=>t.kind===e.kind))}function Xe(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}function Ze(e,t){return"array"===e.kind&&"array"===t.kind?e.itemType.kind===t.itemType.kind&&"number"==typeof e.N:e.kind===t.kind}const et=.96422,tt=.82521,rt=4/29,nt=6/29,it=3*nt*nt,st=nt*nt*nt,ot=Math.PI/180,at=180/Math.PI;function lt(e){return(e%=360)<0&&(e+=360),e}function ct([e,t,r,n]){let i,s;const o=ut((.2225045*(e=ht(e))+.7168786*(t=ht(t))+.0606169*(r=ht(r)))/1);e===t&&t===r?i=s=o:(i=ut((.4360747*e+.3850649*t+.1430804*r)/et),s=ut((.0139322*e+.0971045*t+.7141733*r)/tt));const a=116*o-16;return[a<0?0:a,500*(i-o),200*(o-s),n]}function ht(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function ut(e){return e>st?Math.pow(e,1/3):e/it+rt}function dt([e,t,r,n]){let i=(e+16)/116,s=isNaN(t)?i:i+t/500,o=isNaN(r)?i:i-r/200;return i=1*ft(i),s=et*ft(s),o=tt*ft(o),[pt(3.1338561*s-1.6168667*i-.4906146*o),pt(-.9787684*s+1.9161415*i+.033454*o),pt(.0719453*s-.2289914*i+1.4052427*o),n]}function pt(e){return(e=e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055)<0?0:e>1?1:e}function ft(e){return e>nt?e*e*e:it*(e-rt)}function gt(e){return parseInt(e.padEnd(2,e),16)/255}function At(e,t){return mt(t?e/100:e,0,1)}function mt(e,t,r){return Math.min(Math.max(t,e),r)}function yt(e){return!e.some(Number.isNaN)}const vt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function wt(e,t,r){return e+r*(t-e)}function bt(e,t,r){return e.map(((e,n)=>wt(e,t[n],r)))}class Et{constructor(e,t,r,n=1,i=!0){this.r=e,this.g=t,this.b=r,this.a=n,i||(this.r*=n,this.g*=n,this.b*=n,n||this.overwriteGetter("rgb",[e,t,r,n]))}static parse(e){if(e instanceof Et)return e;if("string"!=typeof e)return;const t=function(e){if("transparent"===(e=e.toLowerCase().trim()))return[0,0,0,0];const t=vt[e];if(t){const[e,r,n]=t;return[e/255,r/255,n/255,1]}if(e.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(e)){const t=e.length<6?1:2;let r=1;return[gt(e.slice(r,r+=t)),gt(e.slice(r,r+=t)),gt(e.slice(r,r+=t)),gt(e.slice(r,r+t)||"ff")]}if(e.startsWith("rgb")){const t=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,r=e.match(t);if(r){const[e,t,n,i,s,o,a,l,c,h,u,d]=r,p=[i||" ",a||" ",h].join("");if("  "===p||"  /"===p||",,"===p||",,,"===p){const e=[n,o,c].join(""),r="%%%"===e?100:""===e?255:0;if(r){const e=[mt(+t/r,0,1),mt(+s/r,0,1),mt(+l/r,0,1),u?At(+u,d):1];if(yt(e))return e}}return}}const r=e.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(r){const[e,t,n,i,s,o,a,l,c]=r,h=[n||" ",s||" ",a].join("");if("  "===h||"  /"===h||",,"===h||",,,"===h){const e=[+t,mt(+i,0,100),mt(+o,0,100),l?At(+l,c):1];if(yt(e))return function([e,t,r,n]){function i(n){const i=(n+e/30)%12,s=t*Math.min(r,1-r);return r-s*Math.max(-1,Math.min(i-3,9-i,1))}return e=lt(e),t/=100,r/=100,[i(0),i(8),i(4),n]}(e)}}}(e);return t?new Et(...t,!1):void 0}get rgb(){const{r:e,g:t,b:r,a:n}=this,i=n||1/0;return this.overwriteGetter("rgb",[e/i,t/i,r/i,n])}get hcl(){return this.overwriteGetter("hcl",function(e){const[t,r,n,i]=ct(e),s=Math.sqrt(r*r+n*n);return[Math.round(1e4*s)?lt(Math.atan2(n,r)*at):NaN,s,t,i]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ct(this.rgb))}overwriteGetter(e,t){return Object.defineProperty(this,e,{value:t}),t}toString(){const[e,t,r,n]=this.rgb;return`rgba(${[e,t,r].map((e=>Math.round(255*e))).join(",")},${n})`}static interpolate(e,t,r,n="rgb"){switch(n){case"rgb":{const[n,i,s,o]=bt(e.rgb,t.rgb,r);return new Et(n,i,s,o,!1)}case"hcl":{const[n,i,s,o]=e.hcl,[a,l,c,h]=t.hcl;let u,d;if(isNaN(n)||isNaN(a))isNaN(n)?isNaN(a)?u=NaN:(u=a,1!==s&&0!==s||(d=l)):(u=n,1!==c&&0!==c||(d=i));else{let e=a-n;a>n&&e>180?e-=360:a<n&&n-a>180&&(e+=360),u=n+r*e}const[p,f,g,A]=function([e,t,r,n]){return e=isNaN(e)?0:e*ot,dt([r,Math.cos(e)*t,Math.sin(e)*t,n])}([u,null!=d?d:wt(i,l,r),wt(s,c,r),wt(o,h,r)]);return new Et(p,f,g,A,!1)}case"lab":{const[n,i,s,o]=dt(bt(e.lab,t.lab,r));return new Et(n,i,s,o,!1)}}}}Et.black=new Et(0,0,0,1),Et.white=new Et(1,1,1,1),Et.transparent=new Et(0,0,0,0),Et.red=new Et(1,0,0,1);class xt{constructor(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Ct=["bottom","center","top"];class _t{constructor(e,t,r,n,i,s){this.text=e,this.image=t,this.scale=r,this.fontStack=n,this.textColor=i,this.verticalAlign=s}}class It{constructor(e){this.sections=e}static fromString(e){return new It([new _t(e,null,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.name.length))}static factory(e){return e instanceof It?e:It.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}}class St{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof St)return e;if("number"==typeof e)return new St([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const t of e)if("number"!=typeof t)return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new St(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,r){return new St(bt(e.values,t.values,r))}}class Mt{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Tt=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Bt{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Bt)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let t=0;t<e.length;t+=2){const r=e[t],n=e[t+1];if("string"!=typeof r||!Tt.has(r))return;if(!Array.isArray(n)||2!==n.length||"number"!=typeof n[0]||"number"!=typeof n[1])return}return new Bt(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,t,r){const n=e.values,i=t.values;if(n.length!==i.length)throw new Mt(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${t.toString()}`);const s=[];for(let e=0;e<n.length;e+=2){if(n[e]!==i[e])throw new Mt(`Cannot interpolate values containing mismatched anchors. from[${e}]: ${n[e]}, to[${e}]: ${i[e]}`);s.push(n[e]);const[t,o]=n[e+1],[a,l]=i[e+1];s.push([wt(t,a,r),wt(o,l,r)])}return new Bt(s)}}class Pt{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Pt({name:e,available:!1}):null}}class Rt{constructor(e,t,r){this.from=e,this.to=t,this.transition=r}static interpolate(e,t,r){return new Rt(e,t,r)}static parse(e){return e instanceof Rt?e:Array.isArray(e)&&3===e.length&&"string"==typeof e[0]&&"string"==typeof e[1]&&"number"==typeof e[2]?new Rt(e[0],e[1],e[2]):"object"==typeof e&&"string"==typeof e.from&&"string"==typeof e.to&&"number"==typeof e.transition?new Rt(e.from,e.to,e.transition):"string"==typeof e?new Rt(e,e,1):void 0}}function Dt(e,t,r,n){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[e,t,r,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[e,t,r,n]:[e,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Lt(e){if(null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e||e instanceof Rt||e instanceof Et||e instanceof xt||e instanceof It||e instanceof St||e instanceof Bt||e instanceof Pt)return!0;if(Array.isArray(e)){for(const t of e)if(!Lt(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!Lt(e[t]))return!1;return!0}return!1}function kt(e){if(null===e)return Le;if("string"==typeof e)return Oe;if("boolean"==typeof e)return Fe;if("number"==typeof e)return ke;if(e instanceof Et)return Ne;if(e instanceof Rt)return Ue;if(e instanceof xt)return ze;if(e instanceof It)return je;if(e instanceof St)return Ve;if(e instanceof Bt)return He;if(e instanceof Pt)return qe;if(Array.isArray(e)){const t=e.length;let r;for(const t of e){const e=kt(t);if(r){if(r===e)continue;r=Ge;break}r=e}return We(r||Ge,t)}return Qe}function Ot(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Et||e instanceof Rt||e instanceof It||e instanceof St||e instanceof Bt||e instanceof Pt?e.toString():JSON.stringify(e)}class Ft{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Lt(e[1]))return t.error("invalid value");const r=e[1];let n=kt(r);const i=t.expectedType;return"array"!==n.kind||0!==n.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(n=i),new Ft(n,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Nt={string:Oe,number:ke,boolean:Fe,object:Qe};class Ut{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let r,n=1;const i=e[0];if("array"===i){let i,s;if(e.length>2){const r=e[1];if("string"!=typeof r||!(r in Nt)||"object"===r)return t.error('The item type argument of "array" must be one of string, number, boolean',1);i=Nt[r],n++}else i=Ge;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);s=e[2],n++}r=We(i,s)}else{if(!Nt[i])throw new Error(`Types doesn't contain name = ${i}`);r=Nt[i]}const s=[];for(;n<e.length;n++){const r=t.parse(e[n],n,Ge);if(!r)return null;s.push(r)}return new Ut(r,s)}evaluate(e){for(let t=0;t<this.args.length;t++){const r=this.args[t].evaluate(e);if(!Ke(this.type,kt(r)))return r;if(t===this.args.length-1)throw new Mt(`Expected value to be of type ${$e(this.type)}, but found ${$e(kt(r))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Qt={"to-boolean":Fe,"to-color":Ne,"to-number":ke,"to-string":Oe};class Gt{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[0];if(!Qt[r])throw new Error(`Can't parse ${r} as it is not part of the known types`);if(("to-boolean"===r||"to-string"===r)&&2!==e.length)return t.error("Expected one argument.");const n=Qt[r],i=[];for(let r=1;r<e.length;r++){const n=t.parse(e[r],r,Ge);if(!n)return null;i.push(n)}return new Gt(n,i)}evaluate(e){switch(this.type.kind){case"boolean":return Boolean(this.args[0].evaluate(e));case"color":{let t,r;for(const n of this.args){if(t=n.evaluate(e),r=null,t instanceof Et)return t;if("string"==typeof t){const r=e.parseColor(t);if(r)return r}else if(Array.isArray(t)&&(r=t.length<3||t.length>4?`Invalid rgba value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:Dt(t[0],t[1],t[2],t[3]),!r))return new Et(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Mt(r||`Could not parse color from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"padding":{let t;for(const r of this.args){t=r.evaluate(e);const n=St.parse(t);if(n)return n}throw new Mt(`Could not parse padding from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"variableAnchorOffsetCollection":{let t;for(const r of this.args){t=r.evaluate(e);const n=Bt.parse(t);if(n)return n}throw new Mt(`Could not parse variableAnchorOffsetCollection from value '${"string"==typeof t?t:JSON.stringify(t)}'`)}case"number":{let t=null;for(const r of this.args){if(t=r.evaluate(e),null===t)return 0;const n=Number(t);if(!isNaN(n))return n}throw new Mt(`Could not convert ${JSON.stringify(t)} to number.`)}case"formatted":return It.fromString(Ot(this.args[0].evaluate(e)));case"resolvedImage":return Pt.fromString(Ot(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Ot(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const zt=["Unknown","Point","LineString","Polygon"];class jt{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?zt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Et.parse(e)),t}}class Vt{constructor(e,t,r=[],n,i=new De,s=[]){this.registry=e,this.path=r,this.key=r.map((e=>`[${e}]`)).join(""),this.scope=i,this.errors=s,this.expectedType=n,this._isConstant=t}parse(e,t,r,n,i={}){return t?this.concat(t,r,n)._parse(e,i):this._parse(e,i)}_parse(e,t){function r(e,t,r){return"assert"===r?new Ut(t,[e]):"coerce"===r?new Gt(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n=e[0];if("string"!=typeof n)return this.error(`Expression name must be a string, but found ${typeof n} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const i=this.registry[n];if(i){let n=i.parse(e,this);if(!n)return null;if(this.expectedType){const e=this.expectedType,i=n.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==i.kind)if("projectionDefinition"!==e.kind||"string"!==i.kind&&"array"!==i.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==i.kind&&"string"!==i.kind)if("padding"!==e.kind||"value"!==i.kind&&"number"!==i.kind&&"array"!==i.kind)if("variableAnchorOffsetCollection"!==e.kind||"value"!==i.kind&&"array"!==i.kind){if(this.checkSubtype(e,i))return null}else n=r(n,e,t.typeAnnotation||"coerce");else n=r(n,e,t.typeAnnotation||"coerce");else n=r(n,e,t.typeAnnotation||"coerce");else n=r(n,e,t.typeAnnotation||"coerce");else n=r(n,e,t.typeAnnotation||"assert")}if(!(n instanceof Ft)&&"resolvedImage"!==n.type.kind&&this._isConstant(n)){const e=new jt;try{n=new Ft(n.type,n.evaluate(e))}catch(e){return this.error(e.message),null}}return n}return this.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0)}return void 0===e?this.error("'undefined' value invalid. Use null instead."):"object"==typeof e?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,t,r){const n="number"==typeof e?this.path.concat(e):this.path,i=r?this.scope.concat(r):this.scope;return new Vt(this.registry,this._isConstant,n,t||null,i,this.errors)}error(e,...t){const r=`${this.key}${t.map((e=>`[${e}]`)).join("")}`;this.errors.push(new Re(r,e))}checkSubtype(e,t){const r=Ke(e,t);return r&&this.error(r),r}}class qt{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let n=1;n<e.length-1;n+=2){const i=e[n];if("string"!=typeof i)return t.error(`Expected string, but found ${typeof i} instead.`,n);if(/[^a-zA-Z0-9_]/.test(i))return t.error("Variable names must contain only alphanumeric characters or '_'.",n);const s=t.parse(e[n+1],n+1);if(!s)return null;r.push([i,s])}const n=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return n?new qt(r,n):null}outputDefined(){return this.result.outputDefined()}}class Ht{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const r=e[1];return t.scope.has(r)?new Ht(r,t.scope.get(r)):t.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Wt{constructor(e,t,r){this.type=e,this.index=t,this.input=r}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,ke),n=t.parse(e[2],2,We(t.expectedType||Ge));if(!r||!n)return null;const i=n.type;return new Wt(i.itemType,r,n)}evaluate(e){const t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new Mt(`Array index out of bounds: ${t} < 0.`);if(t>=r.length)throw new Mt(`Array index out of bounds: ${t} > ${r.length-1}.`);if(t!==Math.floor(t))throw new Mt(`Array index must be an integer, but found ${t} instead.`);return r[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class $t{constructor(e,t){this.type=Fe,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,Ge),n=t.parse(e[2],2,Ge);return r&&n?Je(r.type,[Fe,Oe,ke,Le,Ge])?new $t(r,n):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${$e(r.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!Xe(t,["boolean","string","number","null"]))throw new Mt(`Expected first argument to be of type boolean, string, number or null, but found ${$e(kt(t))} instead.`);if(!Xe(r,["string","array"]))throw new Mt(`Expected second argument to be of type array or string, but found ${$e(kt(r))} instead.`);return r.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Yt{constructor(e,t,r){this.type=ke,this.needle=e,this.haystack=t,this.fromIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,Ge),n=t.parse(e[2],2,Ge);if(!r||!n)return null;if(!Je(r.type,[Fe,Oe,ke,Le,Ge]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${$e(r.type)} instead`);if(4===e.length){const i=t.parse(e[3],3,ke);return i?new Yt(r,n,i):null}return new Yt(r,n)}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Xe(t,["boolean","string","number","null"]))throw new Mt(`Expected first argument to be of type boolean, string, number or null, but found ${$e(kt(t))} instead.`);let n;if(this.fromIndex&&(n=this.fromIndex.evaluate(e)),Xe(r,["string"])){const e=r.indexOf(t,n);return-1===e?-1:[...r.slice(0,e)].length}if(Xe(r,["array"]))return r.indexOf(t,n);throw new Mt(`Expected second argument to be of type array or string, but found ${$e(kt(r))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Kt{constructor(e,t,r,n,i,s){this.inputType=e,this.type=t,this.input=r,this.cases=n,this.outputs=i,this.otherwise=s}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let r,n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const i={},s=[];for(let o=2;o<e.length-1;o+=2){let a=e[o];const l=e[o+1];Array.isArray(a)||(a=[a]);const c=t.concat(o);if(0===a.length)return c.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(r){if(c.checkSubtype(r,kt(e)))return null}else r=kt(e);if(void 0!==i[String(e)])return c.error("Branch labels must be unique.");i[String(e)]=s.length}const h=t.parse(l,o,n);if(!h)return null;n=n||h.type,s.push(h)}const o=t.parse(e[1],1,Ge);if(!o)return null;const a=t.parse(e[e.length-1],e.length-1,n);return a?"value"!==o.type.kind&&t.concat(1).checkSubtype(r,o.type)?null:new Kt(r,n,o,i,s,a):null}evaluate(e){const t=this.input.evaluate(e);return(kt(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class Jt{constructor(e,t,r){this.type=e,this.branches=t,this.otherwise=r}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const n=[];for(let i=1;i<e.length-1;i+=2){const s=t.parse(e[i],i,Fe);if(!s)return null;const o=t.parse(e[i+1],i+1,r);if(!o)return null;n.push([s,o]),r=r||o.type}const i=t.parse(e[e.length-1],e.length-1,r);if(!i)return null;if(!r)throw new Error("Can't infer output type");return new Jt(r,n,i)}evaluate(e){for(const[t,r]of this.branches)if(t.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,r]of this.branches)e(t),e(r);e(this.otherwise)}outputDefined(){return this.branches.every((([e,t])=>t.outputDefined()))&&this.otherwise.outputDefined()}}class Xt{constructor(e,t,r,n){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=t.parse(e[1],1,Ge),n=t.parse(e[2],2,ke);if(!r||!n)return null;if(!Je(r.type,[We(Ge),Oe,Ge]))return t.error(`Expected first argument to be of type array or string, but found ${$e(r.type)} instead`);if(4===e.length){const i=t.parse(e[3],3,ke);return i?new Xt(r.type,r,n,i):null}return new Xt(r.type,r,n)}evaluate(e){const t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);let n;if(this.endIndex&&(n=this.endIndex.evaluate(e)),Xe(t,["string"]))return[...t].slice(r,n).join("");if(Xe(t,["array"]))return t.slice(r,n);throw new Mt(`Expected first argument to be of type array or string, but found ${$e(kt(t))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Zt(e,t){const r=e.length-1;let n,i,s=0,o=r,a=0;for(;s<=o;)if(a=Math.floor((s+o)/2),n=e[a],i=e[a+1],n<=t){if(a===r||t<i)return a;s=a+1}else{if(!(n>t))throw new Mt("Input is not a number.");o=a-1}return 0}class er{constructor(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[e,t]of r)this.labels.push(e),this.outputs.push(t)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const r=t.parse(e[1],1,ke);if(!r)return null;const n=[];let i=null;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);for(let r=1;r<e.length;r+=2){const s=1===r?-1/0:e[r],o=e[r+1],a=r,l=r+1;if("number"!=typeof s)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(n.length&&n[n.length-1][0]>=s)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=t.parse(o,l,i);if(!c)return null;i=i||c.type,n.push([s,c])}return new er(i,r,n)}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return r[0].evaluate(e);const i=t.length;return n>=t[i-1]?r[i-1].evaluate(e):r[Zt(t,n)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function tr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var rr,nr,ir=function(){if(nr)return rr;function e(e,t,r,n){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=r,this.p2y=n}return nr=1,rr=e,e.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var r=e,n=0;n<8;n++){var i=this.sampleCurveX(r)-e;if(Math.abs(i)<t)return r;var s=this.sampleCurveDerivativeX(r);if(Math.abs(s)<1e-6)break;r-=i/s}var o=0,a=1;for(r=e,n=0;n<20&&(i=this.sampleCurveX(r),!(Math.abs(i-e)<t));n++)e>i?o=r:a=r,r=.5*(a-o)+o;return r},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},rr}(),sr=tr(ir);class or{constructor(e,t,r,n,i){this.type=e,this.operator=t,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(const[e,t]of i)this.labels.push(e),this.outputs.push(t)}static interpolationFactor(e,t,r,n){let i=0;if("exponential"===e.name)i=ar(t,e.base,r,n);else if("linear"===e.name)i=ar(t,1,r,n);else if("cubic-bezier"===e.name){const s=e.controlPoints;i=new sr(s[0],s[1],s[2],s[3]).solve(ar(t,1,r,n))}return i}static parse(e,t){let[r,n,i,...s]=e;if(!Array.isArray(n)||0===n.length)return t.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const e=n[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:e}}else{if("cubic-bezier"!==n[0])return t.error(`Unknown interpolation type ${String(n[0])}`,1,0);{const e=n.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(i=t.parse(i,2,ke),!i)return null;const o=[];let a=null;"interpolate-hcl"===r||"interpolate-lab"===r?a=Ne:t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let e=0;e<s.length;e+=2){const r=s[e],n=s[e+1],i=e+3,l=e+4;if("number"!=typeof r)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(o.length&&o[o.length-1][0]>=r)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const c=t.parse(n,l,a);if(!c)return null;a=a||c.type,o.push([r,c])}return Ze(a,ke)||Ze(a,Ue)||Ze(a,Ne)||Ze(a,Ve)||Ze(a,He)||Ze(a,We(ke))?new or(a,r,n,i,o):t.error(`Type ${$e(a)} is not interpolatable.`)}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return r[0].evaluate(e);const i=t.length;if(n>=t[i-1])return r[i-1].evaluate(e);const s=Zt(t,n),o=t[s],a=t[s+1],l=or.interpolationFactor(this.interpolation,n,o,a),c=r[s].evaluate(e),h=r[s+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return wt(c,h,l);case"color":return Et.interpolate(c,h,l);case"padding":return St.interpolate(c,h,l);case"variableAnchorOffsetCollection":return Bt.interpolate(c,h,l);case"array":return bt(c,h,l);case"projectionDefinition":return Rt.interpolate(c,h,l)}case"interpolate-hcl":return Et.interpolate(c,h,l,"hcl");case"interpolate-lab":return Et.interpolate(c,h,l,"lab")}}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function ar(e,t,r,n){const i=n-r,s=e-r;return 0===i?0:1===t?s/i:(Math.pow(t,s)-1)/(Math.pow(t,i)-1)}const lr={color:Et.interpolate,number:wt,padding:St.interpolate,variableAnchorOffsetCollection:Bt.interpolate,array:bt};class cr{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let r=null;const n=t.expectedType;n&&"value"!==n.kind&&(r=n);const i=[];for(const n of e.slice(1)){const e=t.parse(n,1+i.length,r,void 0,{typeAnnotation:"omit"});if(!e)return null;r=r||e.type,i.push(e)}if(!r)throw new Error("No output type");const s=n&&i.some((e=>Ke(n,e.type)));return new cr(s?Ge:r,i)}evaluate(e){let t,r=null,n=0;for(const i of this.args)if(n++,r=i.evaluate(e),r&&r instanceof Pt&&!r.available&&(t||(t=r.name),r=null,n===this.args.length&&(r=t)),null!==r)break;return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function hr(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function ur(e,t,r,n){return 0===n.compare(t,r)}function dr(e,t,r){const n="=="!==e&&"!="!==e;return class i{constructor(e,t,r){this.type=Fe,this.lhs=e,this.rhs=t,this.collator=r,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const r=e[0];let s=t.parse(e[1],1,Ge);if(!s)return null;if(!hr(r,s.type))return t.concat(1).error(`"${r}" comparisons are not supported for type '${$e(s.type)}'.`);let o=t.parse(e[2],2,Ge);if(!o)return null;if(!hr(r,o.type))return t.concat(2).error(`"${r}" comparisons are not supported for type '${$e(o.type)}'.`);if(s.type.kind!==o.type.kind&&"value"!==s.type.kind&&"value"!==o.type.kind)return t.error(`Cannot compare types '${$e(s.type)}' and '${$e(o.type)}'.`);n&&("value"===s.type.kind&&"value"!==o.type.kind?s=new Ut(o.type,[s]):"value"!==s.type.kind&&"value"===o.type.kind&&(o=new Ut(s.type,[o])));let a=null;if(4===e.length){if("string"!==s.type.kind&&"string"!==o.type.kind&&"value"!==s.type.kind&&"value"!==o.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,ze),!a)return null}return new i(s,o,a)}evaluate(i){const s=this.lhs.evaluate(i),o=this.rhs.evaluate(i);if(n&&this.hasUntypedArgument){const t=kt(s),r=kt(o);if(t.kind!==r.kind||"string"!==t.kind&&"number"!==t.kind)throw new Mt(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${t.kind}, ${r.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const e=kt(s),r=kt(o);if("string"!==e.kind||"string"!==r.kind)return t(i,s,o)}return this.collator?r(i,s,o,this.collator.evaluate(i)):t(i,s,o)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}}}const pr=dr("==",(function(e,t,r){return t===r}),ur),fr=dr("!=",(function(e,t,r){return t!==r}),(function(e,t,r,n){return!ur(0,t,r,n)})),gr=dr("<",(function(e,t,r){return t<r}),(function(e,t,r,n){return n.compare(t,r)<0})),Ar=dr(">",(function(e,t,r){return t>r}),(function(e,t,r,n){return n.compare(t,r)>0})),mr=dr("<=",(function(e,t,r){return t<=r}),(function(e,t,r,n){return n.compare(t,r)<=0})),yr=dr(">=",(function(e,t,r){return t>=r}),(function(e,t,r,n){return n.compare(t,r)>=0}));class vr{constructor(e,t,r){this.type=ze,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const r=e[1];if("object"!=typeof r||Array.isArray(r))return t.error("Collator options argument must be an object.");const n=t.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,Fe);if(!n)return null;const i=t.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,Fe);if(!i)return null;let s=null;return r.locale&&(s=t.parse(r.locale,1,Oe),!s)?null:new vr(n,i,s)}evaluate(e){return new xt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class wr{constructor(e,t,r,n,i){this.type=Oe,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=n,this.maxFractionDigits=i}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const r=t.parse(e[1],1,ke);if(!r)return null;const n=e[2];if("object"!=typeof n||Array.isArray(n))return t.error("NumberFormat options argument must be an object.");let i=null;if(n.locale&&(i=t.parse(n.locale,1,Oe),!i))return null;let s=null;if(n.currency&&(s=t.parse(n.currency,1,Oe),!s))return null;let o=null;if(n["min-fraction-digits"]&&(o=t.parse(n["min-fraction-digits"],1,ke),!o))return null;let a=null;return n["max-fraction-digits"]&&(a=t.parse(n["max-fraction-digits"],1,ke),!a)?null:new wr(r,i,s,o,a)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class br{constructor(e){this.type=je,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&"object"==typeof r)return t.error("First argument must be an image or text section.");const n=[];let i=!1;for(let r=1;r<=e.length-1;++r){const s=e[r];if(i&&"object"==typeof s&&!Array.isArray(s)){i=!1;let e=null;if(s["font-scale"]&&(e=t.parse(s["font-scale"],1,ke),!e))return null;let r=null;if(s["text-font"]&&(r=t.parse(s["text-font"],1,We(Oe)),!r))return null;let o=null;if(s["text-color"]&&(o=t.parse(s["text-color"],1,Ne),!o))return null;let a=null;if(s["vertical-align"]){if("string"==typeof s["vertical-align"]&&!Ct.includes(s["vertical-align"]))return t.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${s["vertical-align"]}' instead.`);if(a=t.parse(s["vertical-align"],1,Oe),!a)return null}const l=n[n.length-1];l.scale=e,l.font=r,l.textColor=o,l.verticalAlign=a}else{const s=t.parse(e[r],1,Ge);if(!s)return null;const o=s.type.kind;if("string"!==o&&"value"!==o&&"null"!==o&&"resolvedImage"!==o)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,n.push({content:s,scale:null,font:null,textColor:null,verticalAlign:null})}}return new br(n)}evaluate(e){return new It(this.sections.map((t=>{const r=t.content.evaluate(e);return kt(r)===qe?new _t("",r,null,null,null,t.verticalAlign?t.verticalAlign.evaluate(e):null):new _t(Ot(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null,t.verticalAlign?t.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor),t.verticalAlign&&e(t.verticalAlign)}outputDefined(){return!1}}class Er{constructor(e){this.type=qe,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const r=t.parse(e[1],1,Oe);return r?new Er(r):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),r=Pt.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}}class xr{constructor(e){this.type=ke,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=t.parse(e[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?t.error(`Expected argument of type string or array, but found ${$e(r.type)} instead.`):new xr(r):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return[...t].length;if(Array.isArray(t))return t.length;throw new Mt(`Expected value to be of type string or array, but found ${$e(kt(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Cr=8192;function _r(e,t){const r=(180+e[0])/360,n=(i=e[1],(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360);var i;const s=Math.pow(2,t.z);return[Math.round(r*s*Cr),Math.round(n*s*Cr)]}function Ir(e,t){const r=Math.pow(2,t.z);return[(i=(e[0]/Cr+t.x)/r,360*i-180),(n=(e[1]/Cr+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90)];var n,i}function Sr(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Mr(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Tr(e,t,r){const n=e[0]-t[0],i=e[1]-t[1],s=e[0]-r[0],o=e[1]-r[1];return n*o-s*i==0&&n*s<=0&&i*o<=0}function Br(e,t,r,n){const i=[t[0]-e[0],t[1]-e[1]];return 0!=(s=[n[0]-r[0],n[1]-r[1]])[0]*(o=i)[1]-s[1]*o[0]&&!(!Or(e,t,r,n)||!Or(r,n,e,t));var s,o}function Pr(e,t,r){for(const n of r)for(let r=0;r<n.length-1;++r)if(Br(e,t,n[r],n[r+1]))return!0;return!1}function Rr(e,t,r=!1){let n=!1;for(const a of t)for(let t=0;t<a.length-1;t++){if(Tr(e,a[t],a[t+1]))return r;i=e,s=a[t],o=a[t+1],s[1]>i[1]!=o[1]>i[1]&&i[0]<(o[0]-s[0])*(i[1]-s[1])/(o[1]-s[1])+s[0]&&(n=!n)}var i,s,o;return n}function Dr(e,t){for(const r of t)if(Rr(e,r))return!0;return!1}function Lr(e,t){for(const r of e)if(!Rr(r,t))return!1;for(let r=0;r<e.length-1;++r)if(Pr(e[r],e[r+1],t))return!1;return!0}function kr(e,t){for(const r of t)if(Lr(e,r))return!0;return!1}function Or(e,t,r,n){const i=e[0]-r[0],s=e[1]-r[1],o=t[0]-r[0],a=t[1]-r[1],l=n[0]-r[0],c=n[1]-r[1],h=i*c-l*s,u=o*c-l*a;return h>0&&u<0||h<0&&u>0}function Fr(e,t,r){const n=[];for(let i=0;i<e.length;i++){const s=[];for(let n=0;n<e[i].length;n++){const o=_r(e[i][n],r);Sr(t,o),s.push(o)}n.push(s)}return n}function Nr(e,t,r){const n=[];for(let i=0;i<e.length;i++){const s=Fr(e[i],t,r);n.push(s)}return n}function Ur(e,t,r,n){if(e[0]<r[0]||e[0]>r[2]){const t=.5*n;let i=e[0]-r[0]>t?-n:r[0]-e[0]>t?n:0;0===i&&(i=e[0]-r[2]>t?-n:r[2]-e[0]>t?n:0),e[0]+=i}Sr(t,e)}function Qr(e,t,r,n){const i=Math.pow(2,n.z)*Cr,s=[n.x*Cr,n.y*Cr],o=[];for(const n of e)for(const e of n){const n=[e.x+s[0],e.y+s[1]];Ur(n,t,r,i),o.push(n)}return o}function Gr(e,t,r,n){const i=Math.pow(2,n.z)*Cr,s=[n.x*Cr,n.y*Cr],o=[];for(const r of e){const e=[];for(const n of r){const r=[n.x+s[0],n.y+s[1]];Sr(t,r),e.push(r)}o.push(e)}if(t[2]-t[0]<=i/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const e of o)for(const n of e)Ur(n,t,r,i)}var a;return o}class zr{constructor(e,t){this.type=Fe,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Lt(e[1])){const t=e[1];if("FeatureCollection"===t.type){const e=[];for(const r of t.features){const{type:t,coordinates:n}=r.geometry;"Polygon"===t&&e.push(n),"MultiPolygon"===t&&e.push(...n)}if(e.length)return new zr(t,{type:"MultiPolygon",coordinates:e})}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new zr(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new zr(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if("Polygon"===t.type){const s=Fr(t.coordinates,n,i),o=Qr(e.geometry(),r,n,i);if(!Mr(r,n))return!1;for(const e of o)if(!Rr(e,s))return!1}if("MultiPolygon"===t.type){const s=Nr(t.coordinates,n,i),o=Qr(e.geometry(),r,n,i);if(!Mr(r,n))return!1;for(const e of o)if(!Dr(e,s))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if("Polygon"===t.type){const s=Fr(t.coordinates,n,i),o=Gr(e.geometry(),r,n,i);if(!Mr(r,n))return!1;for(const e of o)if(!Lr(e,s))return!1}if("MultiPolygon"===t.type){const s=Nr(t.coordinates,n,i),o=Gr(e.geometry(),r,n,i);if(!Mr(r,n))return!1;for(const e of o)if(!kr(e,s))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class jr{constructor(e=[],t=(e,t)=>e<t?-1:e>t?1:0){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:r}=this,n=t[e];for(;e>0;){const i=e-1>>1,s=t[i];if(r(n,s)>=0)break;t[e]=s,e=i}t[e]=n}_down(e){const{data:t,compare:r}=this,n=this.length>>1,i=t[e];for(;e<n;){let n=1+(e<<1);const s=n+1;if(s<this.length&&r(t[s],t[n])<0&&(n=s),r(t[n],i)>=0)break;t[e]=t[n],e=n}t[e]=i}}function Vr(e){let t=0;for(let r,n,i=0,s=e.length,o=s-1;i<s;o=i++)r=e[i],n=e[o],t+=(n.x-r.x)*(r.y+n.y);return t}const qr=1/298.257223563,Hr=qr*(2-qr),Wr=Math.PI/180;class $r{constructor(e){const t=6378.137*Wr*1e3,r=Math.cos(e*Wr),n=1/(1-Hr*(1-r*r)),i=Math.sqrt(n);this.kx=t*i*r,this.ky=t*i*n*(1-Hr)}distance(e,t){const r=this.wrap(e[0]-t[0])*this.kx,n=(e[1]-t[1])*this.ky;return Math.sqrt(r*r+n*n)}pointOnLine(e,t){let r,n,i,s,o=1/0;for(let a=0;a<e.length-1;a++){let l=e[a][0],c=e[a][1],h=this.wrap(e[a+1][0]-l)*this.kx,u=(e[a+1][1]-c)*this.ky,d=0;0===h&&0===u||(d=(this.wrap(t[0]-l)*this.kx*h+(t[1]-c)*this.ky*u)/(h*h+u*u),d>1?(l=e[a+1][0],c=e[a+1][1]):d>0&&(l+=h/this.kx*d,c+=u/this.ky*d)),h=this.wrap(t[0]-l)*this.kx,u=(t[1]-c)*this.ky;const p=h*h+u*u;p<o&&(o=p,r=l,n=c,i=a,s=d)}return{point:[r,n],index:i,t:Math.max(0,Math.min(1,s))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function Yr(e,t){return t[0]-e[0]}function Kr(e){return e[1]-e[0]+1}function Jr(e,t){return e[1]>=e[0]&&e[1]<t}function Xr(e,t){if(e[0]>e[1])return[null,null];const r=Kr(e);if(t){if(2===r)return[e,null];const t=Math.floor(r/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}if(1===r)return[e,null];const n=Math.floor(r/2)-1;return[[e[0],e[0]+n],[e[0]+n+1,e[1]]]}function Zr(e,t){if(!Jr(t,e.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let n=t[0];n<=t[1];++n)Sr(r,e[n]);return r}function en(e){const t=[1/0,1/0,-1/0,-1/0];for(const r of e)for(const e of r)Sr(t,e);return t}function tn(e){return e[0]!==-1/0&&e[1]!==-1/0&&e[2]!==1/0&&e[3]!==1/0}function rn(e,t,r){if(!tn(e)||!tn(t))return NaN;let n=0,i=0;return e[2]<t[0]&&(n=t[0]-e[2]),e[0]>t[2]&&(n=e[0]-t[2]),e[1]>t[3]&&(i=e[1]-t[3]),e[3]<t[1]&&(i=t[1]-e[3]),r.distance([0,0],[n,i])}function nn(e,t,r){const n=r.pointOnLine(t,e);return r.distance(e,n.point)}function sn(e,t,r,n,i){const s=Math.min(nn(e,[r,n],i),nn(t,[r,n],i)),o=Math.min(nn(r,[e,t],i),nn(n,[e,t],i));return Math.min(s,o)}function on(e,t,r,n,i){if(!Jr(t,e.length)||!Jr(n,r.length))return 1/0;let s=1/0;for(let o=t[0];o<t[1];++o){const t=e[o],a=e[o+1];for(let e=n[0];e<n[1];++e){const n=r[e],o=r[e+1];if(Br(t,a,n,o))return 0;s=Math.min(s,sn(t,a,n,o,i))}}return s}function an(e,t,r,n,i){if(!Jr(t,e.length)||!Jr(n,r.length))return NaN;let s=1/0;for(let o=t[0];o<=t[1];++o)for(let t=n[0];t<=n[1];++t)if(s=Math.min(s,i.distance(e[o],r[t])),0===s)return s;return s}function ln(e,t,r){if(Rr(e,t,!0))return 0;let n=1/0;for(const i of t){const t=i[0],s=i[i.length-1];if(t!==s&&(n=Math.min(n,nn(e,[s,t],r)),0===n))return n;const o=r.pointOnLine(i,e);if(n=Math.min(n,r.distance(e,o.point)),0===n)return n}return n}function cn(e,t,r,n){if(!Jr(t,e.length))return NaN;for(let n=t[0];n<=t[1];++n)if(Rr(e[n],r,!0))return 0;let i=1/0;for(let s=t[0];s<t[1];++s){const t=e[s],o=e[s+1];for(const e of r)for(let r=0,s=e.length,a=s-1;r<s;a=r++){const s=e[a],l=e[r];if(Br(t,o,s,l))return 0;i=Math.min(i,sn(t,o,s,l,n))}}return i}function hn(e,t){for(const r of e)for(const e of r)if(Rr(e,t,!0))return!0;return!1}function un(e,t,r,n=1/0){const i=en(e),s=en(t);if(n!==1/0&&rn(i,s,r)>=n)return n;if(Mr(i,s)){if(hn(e,t))return 0}else if(hn(t,e))return 0;let o=1/0;for(const n of e)for(let e=0,i=n.length,s=i-1;e<i;s=e++){const i=n[s],a=n[e];for(const e of t)for(let t=0,n=e.length,s=n-1;t<n;s=t++){const n=e[s],l=e[t];if(Br(i,a,n,l))return 0;o=Math.min(o,sn(i,a,n,l,r))}}return o}function dn(e,t,r,n,i,s){if(!s)return;const o=rn(Zr(n,s),i,r);o<t&&e.push([o,s,[0,0]])}function pn(e,t,r,n,i,s,o){if(!s||!o)return;const a=rn(Zr(n,s),Zr(i,o),r);a<t&&e.push([a,s,o])}function fn(e,t,r,n,i=1/0){let s=Math.min(n.distance(e[0],r[0][0]),i);if(0===s)return s;const o=new jr([[0,[0,e.length-1],[0,0]]],Yr),a=en(r);for(;o.length>0;){const i=o.pop();if(i[0]>=s)continue;const l=i[1],c=t?50:100;if(Kr(l)<=c){if(!Jr(l,e.length))return NaN;if(t){const t=cn(e,l,r,n);if(isNaN(t)||0===t)return t;s=Math.min(s,t)}else for(let t=l[0];t<=l[1];++t){const i=ln(e[t],r,n);if(s=Math.min(s,i),0===s)return 0}}else{const r=Xr(l,t);dn(o,s,n,e,a,r[0]),dn(o,s,n,e,a,r[1])}}return s}function gn(e,t,r,n,i,s=1/0){let o=Math.min(s,i.distance(e[0],r[0]));if(0===o)return o;const a=new jr([[0,[0,e.length-1],[0,r.length-1]]],Yr);for(;a.length>0;){const s=a.pop();if(s[0]>=o)continue;const l=s[1],c=s[2],h=t?50:100,u=n?50:100;if(Kr(l)<=h&&Kr(c)<=u){if(!Jr(l,e.length)&&Jr(c,r.length))return NaN;let s;if(t&&n)s=on(e,l,r,c,i),o=Math.min(o,s);else if(t&&!n){const t=e.slice(l[0],l[1]+1);for(let e=c[0];e<=c[1];++e)if(s=nn(r[e],t,i),o=Math.min(o,s),0===o)return o}else if(!t&&n){const t=r.slice(c[0],c[1]+1);for(let r=l[0];r<=l[1];++r)if(s=nn(e[r],t,i),o=Math.min(o,s),0===o)return o}else s=an(e,l,r,c,i),o=Math.min(o,s)}else{const s=Xr(l,t),h=Xr(c,n);pn(a,o,i,e,r,s[0],h[0]),pn(a,o,i,e,r,s[0],h[1]),pn(a,o,i,e,r,s[1],h[0]),pn(a,o,i,e,r,s[1],h[1])}}return o}function An(e){return"MultiPolygon"===e.type?e.coordinates.map((e=>({type:"Polygon",coordinates:e}))):"MultiLineString"===e.type?e.coordinates.map((e=>({type:"LineString",coordinates:e}))):"MultiPoint"===e.type?e.coordinates.map((e=>({type:"Point",coordinates:e}))):[e]}class mn{constructor(e,t){this.type=ke,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Lt(e[1])){const t=e[1];if("FeatureCollection"===t.type)return new mn(t,t.features.map((e=>An(e.geometry))).flat());if("Feature"===t.type)return new mn(t,An(t.geometry));if("type"in t&&"coordinates"in t)return new mn(t,An(t))}return t.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const r=e.geometry(),n=r.flat().map((t=>Ir([t.x,t.y],e.canonical)));if(0===r.length)return NaN;const i=new $r(n[0][1]);let s=1/0;for(const e of t){switch(e.type){case"Point":s=Math.min(s,gn(n,!1,[e.coordinates],!1,i,s));break;case"LineString":s=Math.min(s,gn(n,!1,e.coordinates,!0,i,s));break;case"Polygon":s=Math.min(s,fn(n,!1,e.coordinates,i,s))}if(0===s)return s}return s}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const r=e.geometry(),n=r.flat().map((t=>Ir([t.x,t.y],e.canonical)));if(0===r.length)return NaN;const i=new $r(n[0][1]);let s=1/0;for(const e of t){switch(e.type){case"Point":s=Math.min(s,gn(n,!0,[e.coordinates],!1,i,s));break;case"LineString":s=Math.min(s,gn(n,!0,e.coordinates,!0,i,s));break;case"Polygon":s=Math.min(s,fn(n,!0,e.coordinates,i,s))}if(0===s)return s}return s}(e,this.geometries);if("Polygon"===e.geometryType())return function(e,t){const r=e.geometry();if(0===r.length||0===r[0].length)return NaN;const n=function(e){if(e.length<=1)return[e];const t=[];let r,n;for(const i of e){const e=Vr(i);0!==e&&(i.area=Math.abs(e),void 0===n&&(n=e<0),n===e<0?(r&&t.push(r),r=[i]):r.push(i))}return r&&t.push(r),t}(r).map((t=>t.map((t=>t.map((t=>Ir([t.x,t.y],e.canonical))))))),i=new $r(n[0][0][0][1]);let s=1/0;for(const e of t)for(const t of n){switch(e.type){case"Point":s=Math.min(s,fn([e.coordinates],!1,t,i,s));break;case"LineString":s=Math.min(s,fn(e.coordinates,!0,t,i,s));break;case"Polygon":s=Math.min(s,un(t,e.coordinates,i,s))}if(0===s)return s}return s}(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const yn={"==":pr,"!=":fr,">":Ar,"<":gr,">=":yr,"<=":mr,array:Ut,at:Wt,boolean:Ut,case:Jt,coalesce:cr,collator:vr,format:br,image:Er,in:$t,"index-of":Yt,interpolate:or,"interpolate-hcl":or,"interpolate-lab":or,length:xr,let:qt,literal:Ft,match:Kt,number:Ut,"number-format":wr,object:Ut,slice:Xt,step:er,string:Ut,"to-boolean":Gt,"to-color":Gt,"to-number":Gt,"to-string":Gt,var:Ht,within:zr,distance:mn};class vn{constructor(e,t,r,n){this.name=e,this.type=t,this._evaluate=r,this.args=n}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,t){const r=e[0],n=vn.definitions[r];if(!n)return t.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const i=Array.isArray(n)?n[0]:n.type,s=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,o=s.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let a=null;for(const[n,s]of o){a=new Vt(t.registry,Cn,t.path,null,t.scope);const o=[];let l=!1;for(let t=1;t<e.length;t++){const r=e[t],i=Array.isArray(n)?n[t-1]:n.type,s=a.parse(r,1+o.length,i);if(!s){l=!0;break}o.push(s)}if(!l)if(Array.isArray(n)&&n.length!==o.length)a.error(`Expected ${n.length} arguments, but found ${o.length} instead.`);else{for(let e=0;e<o.length;e++){const t=Array.isArray(n)?n[e]:n.type,r=o[e];a.concat(e+1).checkSubtype(t,r.type)}if(0===a.errors.length)return new vn(r,i,s,o)}}if(1===o.length)t.errors.push(...a.errors);else{const r=(o.length?o:s).map((([e])=>{return t=e,Array.isArray(t)?`(${t.map($e).join(", ")})`:`(${$e(t.type)}...)`;var t})).join(" | "),n=[];for(let r=1;r<e.length;r++){const i=t.parse(e[r],1+n.length);if(!i)return null;n.push($e(i.type))}t.error(`Expected arguments of type ${r}, but found (${n.join(", ")}) instead.`)}return null}static register(e,t){vn.definitions=t;for(const r in t)e[r]=vn}}function wn(e,[t,r,n,i]){t=t.evaluate(e),r=r.evaluate(e),n=n.evaluate(e);const s=i?i.evaluate(e):1,o=Dt(t,r,n,s);if(o)throw new Mt(o);return new Et(t/255,r/255,n/255,s,!1)}function bn(e,t){return e in t}function En(e,t){const r=t[e];return void 0===r?null:r}function xn(e){return{type:e}}function Cn(e){if(e instanceof Ht)return Cn(e.boundExpression);if(e instanceof vn&&"error"===e.name)return!1;if(e instanceof vr)return!1;if(e instanceof zr)return!1;if(e instanceof mn)return!1;const t=e instanceof Gt||e instanceof Ut;let r=!0;return e.eachChild((e=>{r=t?r&&Cn(e):r&&e instanceof Ft})),!!r&&_n(e)&&Sn(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function _n(e){if(e instanceof vn){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof zr)return!1;if(e instanceof mn)return!1;let t=!0;return e.eachChild((e=>{t&&!_n(e)&&(t=!1)})),t}function In(e){if(e instanceof vn&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!In(e)&&(t=!1)})),t}function Sn(e,t){if(e instanceof vn&&t.indexOf(e.name)>=0)return!1;let r=!0;return e.eachChild((e=>{r&&!Sn(e,t)&&(r=!1)})),r}function Mn(e){return{result:"success",value:e}}function Tn(e){return{result:"error",value:e}}function Bn(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function Pn(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Rn(e){return!!e.expression&&e.expression.interpolated}function Dn(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function Ln(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function kn(e){return e}function On(e,t){const r="color"===t.type,n=e.stops&&"object"==typeof e.stops[0][0],i=n||void 0!==e.property,s=n||!i,o=e.type||(Rn(t)?"exponential":"interval");if(r||"padding"===t.type){const n=r?Et.parse:St.parse;(e=Pe({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],n(e[1])]))),e.default?e.default=n(e.default):e.default=n(t.default)}if(e.colorSpace&&"rgb"!==(a=e.colorSpace)&&"hcl"!==a&&"lab"!==a)throw new Error(`Unknown color space: "${e.colorSpace}"`);var a;let l,c,h;if("exponential"===o)l=Qn;else if("interval"===o)l=Un;else if("categorical"===o){l=Nn,c=Object.create(null);for(const t of e.stops)c[t[0]]=t[1];h=typeof e.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);l=Gn}if(n){const r={},n=[];for(let t=0;t<e.stops.length;t++){const i=e.stops[t],s=i[0].zoom;void 0===r[s]&&(r[s]={zoom:s,type:e.type,property:e.property,default:e.default,stops:[]},n.push(s)),r[s].stops.push([i[0].value,i[1]])}const i=[];for(const e of n)i.push([r[e].zoom,On(r[e],t)]);const s={name:"linear"};return{kind:"composite",interpolationType:s,interpolationFactor:or.interpolationFactor.bind(void 0,s),zoomStops:i.map((e=>e[0])),evaluate:({zoom:r},n)=>Qn({stops:i,base:e.base},t,r).evaluate(r,n)}}if(s){const r="exponential"===o?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:r,interpolationFactor:or.interpolationFactor.bind(void 0,r),zoomStops:e.stops.map((e=>e[0])),evaluate:({zoom:r})=>l(e,t,r,c,h)}}return{kind:"source",evaluate(r,n){const i=n&&n.properties?n.properties[e.property]:void 0;return void 0===i?Fn(e.default,t.default):l(e,t,i,c,h)}}}function Fn(e,t,r){return void 0!==e?e:void 0!==t?t:void 0!==r?r:void 0}function Nn(e,t,r,n,i){return Fn(typeof r===i?n[r]:void 0,e.default,t.default)}function Un(e,t,r){if("number"!==Dn(r))return Fn(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[n-1][0])return e.stops[n-1][1];const i=Zt(e.stops.map((e=>e[0])),r);return e.stops[i][1]}function Qn(e,t,r){const n=void 0!==e.base?e.base:1;if("number"!==Dn(r))return Fn(e.default,t.default);const i=e.stops.length;if(1===i)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[i-1][0])return e.stops[i-1][1];const s=Zt(e.stops.map((e=>e[0])),r),o=function(e,t,r,n){const i=n-r,s=e-r;return 0===i?0:1===t?s/i:(Math.pow(t,s)-1)/(Math.pow(t,i)-1)}(r,n,e.stops[s][0],e.stops[s+1][0]),a=e.stops[s][1],l=e.stops[s+1][1],c=lr[t.type]||kn;return"function"==typeof a.evaluate?{evaluate(...t){const r=a.evaluate.apply(void 0,t),n=l.evaluate.apply(void 0,t);if(void 0!==r&&void 0!==n)return c(r,n,o,e.colorSpace)}}:c(a,l,o,e.colorSpace)}function Gn(e,t,r){switch(t.type){case"color":r=Et.parse(r);break;case"formatted":r=It.fromString(r.toString());break;case"resolvedImage":r=Pt.fromString(r.toString());break;case"padding":r=St.parse(r);break;default:Dn(r)===t.type||"enum"===t.type&&t.values[r]||(r=void 0)}return Fn(r,e.default,t.default)}vn.register(yn,{error:[{kind:"error"},[Oe],(e,[t])=>{throw new Mt(t.evaluate(e))}],typeof:[Oe,[Ge],(e,[t])=>$e(kt(t.evaluate(e)))],"to-rgba":[We(ke,4),[Ne],(e,[t])=>{const[r,n,i,s]=t.evaluate(e).rgb;return[255*r,255*n,255*i,s]}],rgb:[Ne,[ke,ke,ke],wn],rgba:[Ne,[ke,ke,ke,ke],wn],has:{type:Fe,overloads:[[[Oe],(e,[t])=>bn(t.evaluate(e),e.properties())],[[Oe,Qe],(e,[t,r])=>bn(t.evaluate(e),r.evaluate(e))]]},get:{type:Ge,overloads:[[[Oe],(e,[t])=>En(t.evaluate(e),e.properties())],[[Oe,Qe],(e,[t,r])=>En(t.evaluate(e),r.evaluate(e))]]},"feature-state":[Ge,[Oe],(e,[t])=>En(t.evaluate(e),e.featureState||{})],properties:[Qe,[],e=>e.properties()],"geometry-type":[Oe,[],e=>e.geometryType()],id:[Ge,[],e=>e.id()],zoom:[ke,[],e=>e.globals.zoom],"heatmap-density":[ke,[],e=>e.globals.heatmapDensity||0],"line-progress":[ke,[],e=>e.globals.lineProgress||0],accumulated:[Ge,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[ke,xn(ke),(e,t)=>{let r=0;for(const n of t)r+=n.evaluate(e);return r}],"*":[ke,xn(ke),(e,t)=>{let r=1;for(const n of t)r*=n.evaluate(e);return r}],"-":{type:ke,overloads:[[[ke,ke],(e,[t,r])=>t.evaluate(e)-r.evaluate(e)],[[ke],(e,[t])=>-t.evaluate(e)]]},"/":[ke,[ke,ke],(e,[t,r])=>t.evaluate(e)/r.evaluate(e)],"%":[ke,[ke,ke],(e,[t,r])=>t.evaluate(e)%r.evaluate(e)],ln2:[ke,[],()=>Math.LN2],pi:[ke,[],()=>Math.PI],e:[ke,[],()=>Math.E],"^":[ke,[ke,ke],(e,[t,r])=>Math.pow(t.evaluate(e),r.evaluate(e))],sqrt:[ke,[ke],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[ke,[ke],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[ke,[ke],(e,[t])=>Math.log(t.evaluate(e))],log2:[ke,[ke],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[ke,[ke],(e,[t])=>Math.sin(t.evaluate(e))],cos:[ke,[ke],(e,[t])=>Math.cos(t.evaluate(e))],tan:[ke,[ke],(e,[t])=>Math.tan(t.evaluate(e))],asin:[ke,[ke],(e,[t])=>Math.asin(t.evaluate(e))],acos:[ke,[ke],(e,[t])=>Math.acos(t.evaluate(e))],atan:[ke,[ke],(e,[t])=>Math.atan(t.evaluate(e))],min:[ke,xn(ke),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[ke,xn(ke),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[ke,[ke],(e,[t])=>Math.abs(t.evaluate(e))],round:[ke,[ke],(e,[t])=>{const r=t.evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[ke,[ke],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[ke,[ke],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Fe,[Oe,Ge],(e,[t,r])=>e.properties()[t.value]===r.value],"filter-id-==":[Fe,[Ge],(e,[t])=>e.id()===t.value],"filter-type-==":[Fe,[Oe],(e,[t])=>e.geometryType()===t.value],"filter-<":[Fe,[Oe,Ge],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n<i}],"filter-id-<":[Fe,[Ge],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r<n}],"filter->":[Fe,[Oe,Ge],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n>i}],"filter-id->":[Fe,[Ge],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r>n}],"filter-<=":[Fe,[Oe,Ge],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n<=i}],"filter-id-<=":[Fe,[Ge],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r<=n}],"filter->=":[Fe,[Oe,Ge],(e,[t,r])=>{const n=e.properties()[t.value],i=r.value;return typeof n==typeof i&&n>=i}],"filter-id->=":[Fe,[Ge],(e,[t])=>{const r=e.id(),n=t.value;return typeof r==typeof n&&r>=n}],"filter-has":[Fe,[Ge],(e,[t])=>t.value in e.properties()],"filter-has-id":[Fe,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[Fe,[We(Oe)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[Fe,[We(Ge)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Fe,[Oe,We(Ge)],(e,[t,r])=>r.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Fe,[Oe,We(Ge)],(e,[t,r])=>function(e,t,r,n){for(;r<=n;){const i=r+n>>1;if(t[i]===e)return!0;t[i]>e?n=i-1:r=i+1}return!1}(e.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Fe,overloads:[[[Fe,Fe],(e,[t,r])=>t.evaluate(e)&&r.evaluate(e)],[xn(Fe),(e,t)=>{for(const r of t)if(!r.evaluate(e))return!1;return!0}]]},any:{type:Fe,overloads:[[[Fe,Fe],(e,[t,r])=>t.evaluate(e)||r.evaluate(e)],[xn(Fe),(e,t)=>{for(const r of t)if(r.evaluate(e))return!0;return!1}]]},"!":[Fe,[Fe],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Fe,[Oe],(e,[t])=>{const r=e.globals&&e.globals.isSupportedScript;return!r||r(t.evaluate(e))}],upcase:[Oe,[Oe],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[Oe,[Oe],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[Oe,xn(Ge),(e,t)=>t.map((t=>Ot(t.evaluate(e)))).join("")],"resolved-locale":[Oe,[ze],(e,[t])=>t.evaluate(e).resolvedLocale()]});class zn{constructor(e,t){var r;this.expression=e,this._warningHistory={},this._evaluator=new jt,this._defaultValue=t?"color"===(r=t).type&&Ln(r.default)?new Et(0,0,0,0):"color"===r.type?Et.parse(r.default)||null:"padding"===r.type?St.parse(r.default)||null:"variableAnchorOffsetCollection"===r.type?Bt.parse(r.default)||null:"projectionDefinition"===r.type?Rt.parse(r.default)||null:void 0===r.default?null:r.default:null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,r,n,i,s){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=n,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=s,this.expression.evaluate(this._evaluator)}evaluate(e,t,r,n,i,s){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=s||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Mt(`Expected value to be one of ${Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", ")}, but found ${JSON.stringify(e)} instead.`);return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function jn(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in yn}function Vn(e,t){const r=new Vt(yn,Cn,[],t?function(e){const t={color:Ne,string:Oe,number:ke,enum:Oe,boolean:Fe,formatted:je,padding:Ve,projectionDefinition:Ue,resolvedImage:qe,variableAnchorOffsetCollection:He};return"array"===e.type?We(t[e.value]||Ge,e.length):t[e.type]}(t):void 0),n=r.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return n?Mn(new zn(n,t)):Tn(r.errors)}class qn{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!In(t.expression)}evaluateWithoutErrorHandling(e,t,r,n,i,s){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,n,i,s)}evaluate(e,t,r,n,i,s){return this._styleExpression.evaluate(e,t,r,n,i,s)}}class Hn{constructor(e,t,r,n){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent="camera"!==e&&!In(t.expression),this.interpolationType=n}evaluateWithoutErrorHandling(e,t,r,n,i,s){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,n,i,s)}evaluate(e,t,r,n,i,s){return this._styleExpression.evaluate(e,t,r,n,i,s)}interpolationFactor(e,t,r){return this.interpolationType?or.interpolationFactor(this.interpolationType,e,t,r):0}}function Wn(e,t){const r=Vn(e,t);if("error"===r.result)return r;const n=r.value.expression,i=_n(n);if(!i&&!Bn(t))return Tn([new Re("","data expressions not supported")]);const s=Sn(n,["zoom"]);if(!s&&!Pn(t))return Tn([new Re("","zoom expressions not supported")]);const o=Yn(n);if(!o&&!s)return Tn([new Re("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(o instanceof Re)return Tn([o]);if(o instanceof or&&!Rn(t))return Tn([new Re("",'"interpolate" expressions cannot be used with this property')]);if(!o)return Mn(new qn(i?"constant":"source",r.value));const a=o instanceof or?o.interpolation:void 0;return Mn(new Hn(i?"camera":"composite",r.value,o.labels,a))}class $n{constructor(e,t){this._parameters=e,this._specification=t,Pe(this,On(this._parameters,this._specification))}static deserialize(e){return new $n(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Yn(e){let t=null;if(e instanceof qt)t=Yn(e.result);else if(e instanceof cr){for(const r of e.args)if(t=Yn(r),t)break}else(e instanceof er||e instanceof or)&&e.input instanceof vn&&"zoom"===e.input.name&&(t=e);return t instanceof Re||e.eachChild((e=>{const r=Yn(e);r instanceof Re?t=r:!t&&r?t=new Re("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&r&&t!==r&&(t=new Re("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function Kn(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Kn(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}const Jn={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Xn(e){if(null==e)return{filter:()=>!0,needGeometry:!1};Kn(e)||(e=ti(e));const t=Vn(e,Jn);if("error"===t.result)throw new Error(t.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return{filter:(e,r,n)=>t.value.evaluate(e,r,{},n),needGeometry:ei(e)}}function Zn(e,t){return e<t?-1:e>t?1:0}function ei(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(ei(e[t]))return!0;return!1}function ti(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?ri(e[1],e[2],"=="):"!="===t?si(ri(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?ri(e[1],e[2],t):"any"===t?(r=e.slice(1),["any"].concat(r.map(ti))):"all"===t?["all"].concat(e.slice(1).map(ti)):"none"===t?["all"].concat(e.slice(1).map(ti).map(si)):"in"===t?ni(e[1],e.slice(2)):"!in"===t?si(ni(e[1],e.slice(2))):"has"===t?ii(e[1]):"!has"!==t||si(ii(e[1]));var r}function ri(e,t,r){switch(e){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,e,t]}}function ni(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(Zn)]]:["filter-in-small",e,["literal",t]]}}function ii(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function si(e){return["!",e]}function oi(e){const t=e.key,r=e.value;return r?[new Be(t,r,"constants have been deprecated as of v8")]:[]}function ai(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function li(e){if(Array.isArray(e))return e.map(li);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const r in e)t[r]=li(e[r]);return t}return ai(e)}function ci(e){const t=e.key,r=e.value,n=e.valueSpec||{},i=e.objectElementValidators||{},s=e.style,o=e.styleSpec,a=e.validateSpec;let l=[];const c=Dn(r);if("object"!==c)return[new Be(t,r,`object expected, ${c} found`)];for(const e in r){const c=e.split(".")[0],h=n[c]||n["*"];let u;if(i[c])u=i[c];else if(n[c])u=a;else if(i["*"])u=i["*"];else{if(!n["*"]){l.push(new Be(t,r[e],`unknown property "${e}"`));continue}u=a}l=l.concat(u({key:(t?`${t}.`:t)+e,value:r[e],valueSpec:h,style:s,styleSpec:o,object:r,objectKey:e,validateSpec:a},r))}for(const e in n)i[e]||n[e].required&&void 0===n[e].default&&void 0===r[e]&&l.push(new Be(t,r,`missing required property "${e}"`));return l}function hi(e){const t=e.value,r=e.valueSpec,n=e.validateSpec,i=e.style,s=e.styleSpec,o=e.key,a=e.arrayElementValidator||n;if("array"!==Dn(t))return[new Be(o,t,`array expected, ${Dn(t)} found`)];if(r.length&&t.length!==r.length)return[new Be(o,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new Be(o,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let l={type:r.value,values:r.values};s.$version<7&&(l.function=r.function),"object"===Dn(r.value)&&(l=r.value);let c=[];for(let r=0;r<t.length;r++)c=c.concat(a({array:t,arrayIndex:r,value:t[r],valueSpec:l,validateSpec:e.validateSpec,style:i,styleSpec:s,key:`${o}[${r}]`}));return c}function ui(e){const t=e.key,r=e.value,n=e.valueSpec;let i=Dn(r);return"number"===i&&r!=r&&(i="NaN"),"number"!==i?[new Be(t,r,`number expected, ${i} found`)]:"minimum"in n&&r<n.minimum?[new Be(t,r,`${r} is less than the minimum value ${n.minimum}`)]:"maximum"in n&&r>n.maximum?[new Be(t,r,`${r} is greater than the maximum value ${n.maximum}`)]:[]}function di(e){const t=e.valueSpec,r=ai(e.value.type);let n,i,s,o={};const a="categorical"!==r&&void 0===e.value.property,l=!a,c="array"===Dn(e.value.stops)&&"array"===Dn(e.value.stops[0])&&"object"===Dn(e.value.stops[0][0]),h=ci({key:e.key,value:e.value,valueSpec:e.styleSpec.function,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===r)return[new Be(e.key,e.value,'identity function may not have a "stops" property')];let t=[];const n=e.value;return t=t.concat(hi({key:e.key,value:n,valueSpec:e.valueSpec,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:u})),"array"===Dn(n)&&0===n.length&&t.push(new Be(e.key,n,"array must have at least one stop")),t},default:function(e){return e.validateSpec({key:e.key,value:e.value,valueSpec:t,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===r&&a&&h.push(new Be(e.key,e.value,'missing required property "property"')),"identity"===r||e.value.stops||h.push(new Be(e.key,e.value,'missing required property "stops"')),"exponential"===r&&e.valueSpec.expression&&!Rn(e.valueSpec)&&h.push(new Be(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!Bn(e.valueSpec)?h.push(new Be(e.key,e.value,"property functions not supported")):a&&!Pn(e.valueSpec)&&h.push(new Be(e.key,e.value,"zoom functions not supported"))),"categorical"!==r&&!c||void 0!==e.value.property||h.push(new Be(e.key,e.value,'"property" property is required')),h;function u(e){let r=[];const n=e.value,a=e.key;if("array"!==Dn(n))return[new Be(a,n,`array expected, ${Dn(n)} found`)];if(2!==n.length)return[new Be(a,n,`array length 2 expected, length ${n.length} found`)];if(c){if("object"!==Dn(n[0]))return[new Be(a,n,`object expected, ${Dn(n[0])} found`)];if(void 0===n[0].zoom)return[new Be(a,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new Be(a,n,"object stop key must have value")];if(s&&s>ai(n[0].zoom))return[new Be(a,n[0].zoom,"stop zoom values must appear in ascending order")];ai(n[0].zoom)!==s&&(s=ai(n[0].zoom),i=void 0,o={}),r=r.concat(ci({key:`${a}[0]`,value:n[0],valueSpec:{zoom:{}},validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:ui,value:d}}))}else r=r.concat(d({key:`${a}[0]`,value:n[0],valueSpec:{},validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec},n));return jn(li(n[1]))?r.concat([new Be(`${a}[1]`,n[1],"expressions are not allowed in function stops.")]):r.concat(e.validateSpec({key:`${a}[1]`,value:n[1],valueSpec:t,validateSpec:e.validateSpec,style:e.style,styleSpec:e.styleSpec}))}function d(e,s){const a=Dn(e.value),l=ai(e.value),c=null!==e.value?e.value:s;if(n){if(a!==n)return[new Be(e.key,c,`${a} stop domain type must match previous stop domain type ${n}`)]}else n=a;if("number"!==a&&"string"!==a&&"boolean"!==a)return[new Be(e.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==r){let n=`number expected, ${a} found`;return Bn(t)&&void 0===r&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Be(e.key,c,n)]}return"categorical"!==r||"number"!==a||isFinite(l)&&Math.floor(l)===l?"categorical"!==r&&"number"===a&&void 0!==i&&l<i?[new Be(e.key,c,"stop domain values must appear in ascending order")]:(i=l,"categorical"===r&&l in o?[new Be(e.key,c,"stop domain values must be unique")]:(o[l]=!0,[])):[new Be(e.key,c,`integer expected, found ${l}`)]}}function pi(e){const t=("property"===e.expressionContext?Wn:Vn)(li(e.value),e.valueSpec);if("error"===t.result)return t.value.map((t=>new Be(`${e.key}${t.key}`,e.value,t.message)));const r=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!r.outputDefined())return[new Be(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===e.expressionContext&&"layout"===e.propertyType&&!In(r))return[new Be(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext&&!In(r))return[new Be(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!Sn(r,["zoom","feature-state"]))return[new Be(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!_n(r))return[new Be(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function fi(e){const t=e.key,r=e.value,n=e.valueSpec,i=[];return Array.isArray(n.values)?-1===n.values.indexOf(ai(r))&&i.push(new Be(t,r,`expected one of [${n.values.join(", ")}], ${JSON.stringify(r)} found`)):-1===Object.keys(n.values).indexOf(ai(r))&&i.push(new Be(t,r,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(r)} found`)),i}function gi(e){return Kn(li(e.value))?pi(Pe({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ai(e)}function Ai(e){const t=e.value,r=e.key;if("array"!==Dn(t))return[new Be(r,t,`array expected, ${Dn(t)} found`)];const n=e.styleSpec;let i,s=[];if(t.length<1)return[new Be(r,t,"filter array must have at least 1 element")];switch(s=s.concat(fi({key:`${r}[0]`,value:t[0],valueSpec:n.filter_operator,style:e.style,styleSpec:e.styleSpec})),ai(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===ai(t[1])&&s.push(new Be(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":3!==t.length&&s.push(new Be(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(i=Dn(t[1]),"string"!==i&&s.push(new Be(`${r}[1]`,t[1],`string expected, ${i} found`)));for(let o=2;o<t.length;o++)i=Dn(t[o]),"$type"===ai(t[1])?s=s.concat(fi({key:`${r}[${o}]`,value:t[o],valueSpec:n.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&s.push(new Be(`${r}[${o}]`,t[o],`string, number, or boolean expected, ${i} found`));break;case"any":case"all":case"none":for(let n=1;n<t.length;n++)s=s.concat(Ai({key:`${r}[${n}]`,value:t[n],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=Dn(t[1]),2!==t.length?s.push(new Be(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):"string"!==i&&s.push(new Be(`${r}[1]`,t[1],`string expected, ${i} found`))}return s}function mi(e,t){const r=e.key,n=e.validateSpec,i=e.style,s=e.styleSpec,o=e.value,a=e.objectKey,l=s[`${t}_${e.layerType}`];if(!l)return[];const c=a.match(/^(.*)-transition$/);if("paint"===t&&c&&l[c[1]]&&l[c[1]].transition)return n({key:r,value:o,valueSpec:s.transition,style:i,styleSpec:s});const h=e.valueSpec||l[a];if(!h)return[new Be(r,o,`unknown property "${a}"`)];let u;if("string"===Dn(o)&&Bn(h)&&!h.tokens&&(u=/^{([^}]+)}$/.exec(o)))return[new Be(r,o,`"${a}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(u[1])} }\`.`)];const d=[];return"symbol"===e.layerType&&("text-field"===a&&i&&!i.glyphs&&d.push(new Be(r,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&Ln(li(o))&&"identity"===ai(o.type)&&d.push(new Be(r,o,'"text-font" does not support identity functions'))),d.concat(n({key:e.key,value:o,valueSpec:h,style:i,styleSpec:s,expressionContext:"property",propertyType:t,propertyKey:a}))}function yi(e){return mi(e,"paint")}function vi(e){return mi(e,"layout")}function wi(e){let t=[];const r=e.value,n=e.key,i=e.style,s=e.styleSpec;r.type||r.ref||t.push(new Be(n,r,'either "type" or "ref" is required'));let o=ai(r.type);const a=ai(r.ref);if(r.id){const s=ai(r.id);for(let o=0;o<e.arrayIndex;o++){const e=i.layers[o];ai(e.id)===s&&t.push(new Be(n,r.id,`duplicate layer id "${r.id}", previously used at line ${e.id.__line__}`))}}if("ref"in r){let e;["type","source","source-layer","filter","layout"].forEach((e=>{e in r&&t.push(new Be(n,r[e],`"${e}" is prohibited for ref layers`))})),i.layers.forEach((t=>{ai(t.id)===a&&(e=t)})),e?e.ref?t.push(new Be(n,r.ref,"ref cannot reference another ref layer")):o=ai(e.type):t.push(new Be(n,r.ref,`ref layer "${a}" not found`))}else if("background"!==o)if(r.source){const e=i.sources&&i.sources[r.source],s=e&&ai(e.type);e?"vector"===s&&"raster"===o?t.push(new Be(n,r.source,`layer "${r.id}" requires a raster source`)):"raster-dem"!==s&&"hillshade"===o?t.push(new Be(n,r.source,`layer "${r.id}" requires a raster-dem source`)):"raster"===s&&"raster"!==o?t.push(new Be(n,r.source,`layer "${r.id}" requires a vector source`)):"vector"!==s||r["source-layer"]?"raster-dem"===s&&"hillshade"!==o?t.push(new Be(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==o||!r.paint||!r.paint["line-gradient"]||"geojson"===s&&e.lineMetrics||t.push(new Be(n,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Be(n,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new Be(n,r.source,`source "${r.source}" not found`))}else t.push(new Be(n,r,'missing required property "source"'));return t=t.concat(ci({key:n,value:r,valueSpec:s.layer,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":()=>[],type:()=>e.validateSpec({key:`${n}.type`,value:r.type,valueSpec:s.layer.type,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,object:r,objectKey:"type"}),filter:gi,layout:e=>ci({layer:r,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>vi(Pe({layerType:o},e))}}),paint:e=>ci({layer:r,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,validateSpec:e.validateSpec,objectElementValidators:{"*":e=>yi(Pe({layerType:o},e))}})}})),t}function bi(e){const t=e.value,r=e.key,n=Dn(t);return"string"!==n?[new Be(r,t,`string expected, ${n} found`)]:[]}const Ei={promoteId:function({key:e,value:t}){if("string"===Dn(t))return bi({key:e,value:t});{const r=[];for(const n in t)r.push(...bi({key:`${e}.${n}`,value:t[n]}));return r}}};function xi(e){const t=e.value,r=e.key,n=e.styleSpec,i=e.style,s=e.validateSpec;if(!t.type)return[new Be(r,t,'"type" is required')];const o=ai(t.type);let a;switch(o){case"vector":case"raster":return a=ci({key:r,value:t,valueSpec:n[`source_${o.replace("-","_")}`],style:e.style,styleSpec:n,objectElementValidators:Ei,validateSpec:s}),a;case"raster-dem":return a=function(e){var t;const r=null!==(t=e.sourceName)&&void 0!==t?t:"",n=e.value,i=e.styleSpec,s=i.source_raster_dem,o=e.style;let a=[];const l=Dn(n);if(void 0===n)return a;if("object"!==l)return a.push(new Be("source_raster_dem",n,`object expected, ${l} found`)),a;const c="custom"===ai(n.encoding),h=["redFactor","greenFactor","blueFactor","baseShift"],u=e.value.encoding?`"${e.value.encoding}"`:"Default";for(const t in n)!c&&h.includes(t)?a.push(new Be(t,n[t],`In "${r}": "${t}" is only valid when "encoding" is set to "custom". ${u} encoding found`)):s[t]?a=a.concat(e.validateSpec({key:t,value:n[t],valueSpec:s[t],validateSpec:e.validateSpec,style:o,styleSpec:i})):a.push(new Be(t,n[t],`unknown property "${t}"`));return a}({sourceName:r,value:t,style:e.style,styleSpec:n,validateSpec:s}),a;case"geojson":if(a=ci({key:r,value:t,valueSpec:n.source_geojson,style:i,styleSpec:n,validateSpec:s,objectElementValidators:Ei}),t.cluster)for(const e in t.clusterProperties){const[n,i]=t.clusterProperties[e],o="string"==typeof n?[n,["accumulated"],["get",e]]:n;a.push(...pi({key:`${r}.${e}.map`,value:i,validateSpec:s,expressionContext:"cluster-map"})),a.push(...pi({key:`${r}.${e}.reduce`,value:o,validateSpec:s,expressionContext:"cluster-reduce"}))}return a;case"video":return ci({key:r,value:t,valueSpec:n.source_video,style:i,validateSpec:s,styleSpec:n});case"image":return ci({key:r,value:t,valueSpec:n.source_image,style:i,validateSpec:s,styleSpec:n});case"canvas":return[new Be(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return fi({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,validateSpec:s,styleSpec:n})}}function Ci(e){const t=e.value,r=e.styleSpec,n=r.light,i=e.style;let s=[];const o=Dn(t);if(void 0===t)return s;if("object"!==o)return s=s.concat([new Be("light",t,`object expected, ${o} found`)]),s;for(const o in t){const a=o.match(/^(.*)-transition$/);s=a&&n[a[1]]&&n[a[1]].transition?s.concat(e.validateSpec({key:o,value:t[o],valueSpec:r.transition,validateSpec:e.validateSpec,style:i,styleSpec:r})):n[o]?s.concat(e.validateSpec({key:o,value:t[o],valueSpec:n[o],validateSpec:e.validateSpec,style:i,styleSpec:r})):s.concat([new Be(o,t[o],`unknown property "${o}"`)])}return s}function _i(e){const t=e.value,r=e.styleSpec,n=r.sky,i=e.style,s=Dn(t);if(void 0===t)return[];if("object"!==s)return[new Be("sky",t,`object expected, ${s} found`)];let o=[];for(const s in t)o=n[s]?o.concat(e.validateSpec({key:s,value:t[s],valueSpec:n[s],style:i,styleSpec:r})):o.concat([new Be(s,t[s],`unknown property "${s}"`)]);return o}function Ii(e){const t=e.value,r=e.styleSpec,n=r.terrain,i=e.style;let s=[];const o=Dn(t);if(void 0===t)return s;if("object"!==o)return s=s.concat([new Be("terrain",t,`object expected, ${o} found`)]),s;for(const o in t)s=n[o]?s.concat(e.validateSpec({key:o,value:t[o],valueSpec:n[o],validateSpec:e.validateSpec,style:i,styleSpec:r})):s.concat([new Be(o,t[o],`unknown property "${o}"`)]);return s}function Si(e){let t=[];const r=e.value,n=e.key;if(Array.isArray(r)){const i=[],s=[];for(const o in r){r[o].id&&i.includes(r[o].id)&&t.push(new Be(n,r,`all the sprites' ids must be unique, but ${r[o].id} is duplicated`)),i.push(r[o].id),r[o].url&&s.includes(r[o].url)&&t.push(new Be(n,r,`all the sprites' URLs must be unique, but ${r[o].url} is duplicated`)),s.push(r[o].url);const a={id:{type:"string",required:!0},url:{type:"string",required:!0}};t=t.concat(ci({key:`${n}[${o}]`,value:r[o],valueSpec:a,validateSpec:e.validateSpec}))}return t}return bi({key:n,value:r})}const Mi={"*":()=>[],array:hi,boolean:function(e){const t=e.value,r=e.key,n=Dn(t);return"boolean"!==n?[new Be(r,t,`boolean expected, ${n} found`)]:[]},number:ui,color:function(e){const t=e.key,r=e.value,n=Dn(r);return"string"!==n?[new Be(t,r,`color expected, ${n} found`)]:Et.parse(String(r))?[]:[new Be(t,r,`color expected, "${r}" found`)]},constants:oi,enum:fi,filter:gi,function:di,layer:wi,object:ci,source:xi,light:Ci,sky:_i,terrain:Ii,projection:function(e){const t=e.value,r=e.styleSpec,n=r.projection,i=e.style,s=Dn(t);if(void 0===t)return[];if("object"!==s)return[new Be("projection",t,`object expected, ${s} found`)];let o=[];for(const s in t)o=n[s]?o.concat(e.validateSpec({key:s,value:t[s],valueSpec:n[s],style:i,styleSpec:r})):o.concat([new Be(s,t[s],`unknown property "${s}"`)]);return o},projectionDefinition:function(e){const t=e.key;let r=e.value;r=r instanceof String?r.valueOf():r;const n=Dn(r);return"array"!==n||function(e){return Array.isArray(e)&&3===e.length&&"string"==typeof e[0]&&"string"==typeof e[1]&&"number"==typeof e[2]}(r)||function(e){return!!["interpolate","step","literal"].includes(e[0])}(r)?["array","string"].includes(n)?[]:[new Be(t,r,`projection expected, invalid type "${n}" found`)]:[new Be(t,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:bi,formatted:function(e){return 0===bi(e).length?[]:pi(e)},resolvedImage:function(e){return 0===bi(e).length?[]:pi(e)},padding:function(e){const t=e.key,r=e.value;if("array"===Dn(r)){if(r.length<1||r.length>4)return[new Be(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const n={type:"number"};let i=[];for(let s=0;s<r.length;s++)i=i.concat(e.validateSpec({key:`${t}[${s}]`,value:r[s],validateSpec:e.validateSpec,valueSpec:n}));return i}return ui({key:t,value:r,valueSpec:{}})},variableAnchorOffsetCollection:function(e){const t=e.key,r=e.value,n=Dn(r),i=e.styleSpec;if("array"!==n||r.length<1||r.length%2!=0)return[new Be(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let s=[];for(let n=0;n<r.length;n+=2)s=s.concat(fi({key:`${t}[${n}]`,value:r[n],valueSpec:i.layout_symbol["text-anchor"]})),s=s.concat(hi({key:`${t}[${n+1}]`,value:r[n+1],valueSpec:{length:2,value:"number"},validateSpec:e.validateSpec,style:e.style,styleSpec:i}));return s},sprite:Si};function Ti(e){const t=e.value,r=e.valueSpec,n=e.styleSpec;return e.validateSpec=Ti,r.expression&&Ln(ai(t))?di(e):r.expression&&jn(li(t))?pi(e):r.type&&Mi[r.type]?Mi[r.type](e):ci(Pe({},e,{valueSpec:r.type?n[r.type]:r}))}function Bi(e){const t=e.value,r=e.key,n=bi(e);return n.length||(-1===t.indexOf("{fontstack}")&&n.push(new Be(r,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&n.push(new Be(r,t,'"glyphs" url must include a "{range}" token'))),n}function Pi(e,t=Te){let r=[];return r=r.concat(Ti({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,validateSpec:Ti,objectElementValidators:{glyphs:Bi,"*":()=>[]}})),e.constants&&(r=r.concat(oi({key:"constants",value:e.constants,style:e,styleSpec:t,validateSpec:Ti}))),Di(r)}function Ri(e){return function(t){return e({...t,validateSpec:Ti})}}function Di(e){return[].concat(e).sort(((e,t)=>e.line-t.line))}function Li(e){return function(...t){return Di(e.apply(this,t))}}Pi.source=Li(Ri(xi)),Pi.sprite=Li(Ri(Si)),Pi.glyphs=Li(Ri(Bi)),Pi.light=Li(Ri(Ci)),Pi.sky=Li(Ri(_i)),Pi.terrain=Li(Ri(Ii)),Pi.layer=Li(Ri(wi)),Pi.filter=Li(Ri(gi)),Pi.paintProperty=Li(Ri(yi)),Pi.layoutProperty=Li(Ri(vi));const ki={StyleExpression:zn,StylePropertyFunction:$n,ZoomConstantExpression:qn,ZoomDependentExpression:Hn,createExpression:Vn,createPropertyExpression:Wn,isExpression:jn,isExpressionFilter:Kn,isZoomExpression:function(e){return void 0!==e._styleExpression},normalizePropertyExpression:function(e,t){if(Ln(e))return new $n(e,t);if(jn(e)){const r=Wn(e,t);if("error"===r.result)throw new Error(r.value.map((e=>`${e.key}: ${e.message}`)).join(", "));return r.value}{let r=e;return"color"===t.type&&"string"==typeof e?r=Et.parse(e):"padding"!==t.type||"number"!=typeof e&&!Array.isArray(e)?"variableAnchorOffsetCollection"===t.type&&Array.isArray(e)?r=Bt.parse(e):"projectionDefinition"===t.type&&"string"==typeof e&&(r=Rt.parse(e)):r=St.parse(e),{kind:"constant",evaluate:()=>r}}}};function Oi(e,t){if(null!=e)return ki.isExpression(e)?ki.createExpression(e,t).value:e}const Fi=1/255;function Ni(e){if(!e)return{};if(e.stops||e.expression)return{color:e};if("string"==typeof e){const t=e.match(/(?:((hsl|rgb)a? *\(([\d.%]+(?:deg|g?rad|turn)?)[ ,]*([\d.%]+)[ ,]*([\d.%]+)[ ,/]*([\d.%]*)\))|(#((?:[\d\w]{3}){1,2})([\d\w]{1,2})?))/i);if(null===t)return{color:e,opacity:1};if(t[7]){let e=1;return t[9]&&(e=parseInt(1==t[9].length?`${t[9]}${t[9]}`:t[9],16)*Fi),{color:`#${t[8]}`,opacity:e}}if(t[1])return{color:`${t[2]}(${t[3]},${t[4]},${t[5]})`,opacity:t[6]?Number(t[6]):1}}}const Ui=function(e,t){const r=t.type,n={};if(r===Vi.POINT){const t={...void 0!==e.fill&&{color:e.fill},...void 0!==e["fill-opacity"]&&{opacity:e["fill-opacity"]},...void 0!==e.stroke&&{line:e.stroke},...void 0!==e.radius&&{radius:e.radius}};Object.keys(t).length&&(n.point=t);const r={...void 0!==e["label-color"]&&{color:e["label-color"]},...void 0!==e["label-opacity"]&&{opacity:e["label-opacity"]},...void 0!==e["label-size"]&&{size:e["label-size"]}};Object.keys(t).length&&(n.text=r);const i={...void 0!==e.icon&&{source:e.icon},...void 0!==e["icon-scale"]&&{size:e["icon-scale"]},...void 0!==e["icon-opacity"]&&{opacity:e["icon-opacity"]},...void 0!==e["icon-color"]&&{color:e["icon-color"]}};Object.keys(i).length&&(n.icon=i)}else{const t={...void 0!==e.stroke&&{color:e.stroke},...void 0!==e["stroke-width"]&&{width:e["stroke-width"]},...void 0!==e["stroke-opacity"]&&{opacity:e["stroke-opacity"]}};if(Object.keys(t).length&&(n.stroke=t),r!==Vi.LINE){const t={...void 0!==e.fill&&{color:e.fill},...void 0!==e["fill-opacity"]&&{opacity:e["fill-opacity"]}};Object.keys(t).length&&(n.fill=t)}}return n},Qi=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n={fill:{},stroke:{},point:{},text:{},icon:{}};if(e.layout=e.layout||{},e.paint=e.paint||{},"fill"===e.type){const{color:r,opacity:i}=Ni(Oi(e.paint["fill-color"]||e.paint["fill-pattern"],{type:"color"}));if(n.fill.color=r,n.fill.opacity=Oi(e.paint["fill-opacity"])||i,e.paint["fill-pattern"])try{n.fill.pattern={id:e.paint["fill-pattern"],source:t.source,cropValues:t[e.paint["fill-pattern"]]}}catch(t){throw t.message=`VTlayer '${e.id}': argument sprites must not be null when using layer.paint['fill-pattern']`,t}if(e.paint["fill-outline-color"]){const{color:t,opacity:r}=Ni(Oi(e.paint["fill-outline-color"],{type:"color"}));n.stroke.color=t,n.stroke.opacity=r,n.stroke.width=1}else n.stroke.width=0}else if("line"===e.type){const t=Oi(e.paint["line-color"],{type:"color"}),{color:r,opacity:i}=Ni(t);n.stroke.dasharray=Oi(e.paint["line-dasharray"]),n.stroke.color=r,n.stroke.lineCap=e.layout["line-cap"],n.stroke.width=Oi(e.paint["line-width"]),n.stroke.opacity=Oi(e.paint["line-opacity"])||i}else if("circle"===e.type||r){const{color:t,opacity:r}=Ni(Oi(e.paint["circle-color"],{type:"color"}));n.point.color=t,n.point.opacity=r,n.point.radius=Oi(e.paint["circle-radius"])}else if("symbol"===e.type){n.stroke.width=0,n.text.zOrder=Oi(e.layout["symbol-z-order"]),"auto"==n.text.zOrder?n.text.zOrder=Oi(e.layout["symbol-sort-key"])||"Y":"viewport-y"==n.text.zOrder?n.text.zOrder="Y":"source"==n.text.zOrder&&(n.text.zOrder=0),n.text.anchor=Oi(e.layout["text-anchor"]),n.text.offset=Oi(e.layout["text-offset"]),n.text.padding=Oi(e.layout["text-padding"]),n.text.size=Oi(e.layout["text-size"]),n.text.placement=Oi(e.layout["symbol-placement"]),n.text.rotation=Oi(e.layout["text-rotation-alignment"]),n.text.field=Oi(e.layout["text-field"]),n.text.wrap=Oi(e.layout["text-max-width"]),n.text.spacing=Oi(e.layout["text-letter-spacing"]),n.text.transform=Oi(e.layout["text-transform"]),n.text.justify=Oi(e.layout["text-justify"]);const{color:r,opacity:i}=Ni(Oi(e.paint["text-color"],{type:"color"}));n.text.color=r,n.text.opacity=Oi(e.paint["text-opacity"])||void 0!==i&&i,n.text.font=Oi(e.layout["text-font"]);const s=Oi(e.paint["text-halo-color"],{type:"color"});s&&(n.text.haloColor=s.color||s,n.text.haloWidth=Oi(e.paint["text-halo-width"]),n.text.haloBlur=Oi(e.paint["text-halo-blur"]));const o=Oi(e.layout["icon-image"]);if(o){const r={x:0,y:0,width:1,height:1};try{if(n.icon.id=o,o.stops){const e={...void 0!==o.base&&{base:o.base},stops:o.stops.map((e=>{let n=t[e[1]];return e[1].includes("{")?n=function(i){const s=e[1].replace(/\{(.+?)\}/g,((e,t)=>i[t]||"")).trim();return void 0===n&&(t[s]=r),t[s]}:void 0===n&&(n=r),[e[0],n]}))};n.icon.cropValues=e}else n.icon.cropValues=t[o],o.includes("{")?n.icon.cropValues=function(e){const n=o.replace(/\{(.+?)\}/g,((t,r)=>e[r]||"")).trim();return void 0===t[n]&&(t[n]=r),t[n]}:void 0===t[o]&&(n.icon.cropValues=r);n.icon.source=t.source,n.icon.size=Oi(e.layout["icon-size"])??1;const{color:i,opacity:s}=Ni(Oi(e.paint["icon-color"],{type:"color"}));o.sdf&&(n.icon.color=i),n.icon.opacity=Oi(e.paint["icon-opacity"])??(void 0!==s&&s)}catch(t){throw t.message=`VTlayer '${e.id}': argument sprites must not be null when using layer.layout['icon-image']`,t}}}return n.zoom={min:e.minzoom||0,max:e.maxzoom||24},n};function Gi(e){return new i.zR(e,1/0,-1/0,1/0,-1/0)}function zi(e,t){e.normals&&t.geodesicNormal.toArray(e.normals,e._pos),e._pushValues(t.x,t.y,t.z)}const ji=new i.E$("EPSG:4326",0,0,0),Vi={POINT:0,LINE:1,POLYGON:2};class qi{#K;constructor(e){this.indices=[],this.properties={},this.size=e.size,e.extent&&(this.extent=Gi(e.extent.crs),this.#K=Gi(e.extent.crs))}startSubGeometry(e,t){const r=this.indices.length-1,n=this.extent?Gi(this.extent.crs):void 0,i=r>-1?this.indices[r].offset+this.indices[r].count:t.vertices.length/this.size;this.indices.push({offset:i,count:e,extent:n}),this.#K=n,function(e,t){e.vertices.length+=t*e.size,e.normals&&(e.normals.length=e.vertices.length)}(t,e)}closeSubGeometry(e,t){const r=this.indices.length-1,n=r>-1?this.indices[r].offset+this.indices[r].count:t.vertices.length/this.size-e;this.indices.push({offset:n,count:e,extent:this.#K}),this.extent&&(this.extent.union(this.#K),this.#K=Gi(this.extent.crs))}getLastSubGeometry(){const e=this.indices.length-1;return this.indices[e]}pushCoordinates(e,t){if(e.isCoordinates)return console.warn("Deprecated: change in arguments order, use pushCoordinates(feature, coordIn) instead"),void this.pushCoordinates(t,e);t.as(e.crs,ji),e.transformToLocalSystem(ji),zi(e,ji),this.#K&&this.#K.expandByCoordinates(e.useCrsOut?ji:t)}pushCoordinatesValues(e,t,r){if((arguments.length<=3?0:arguments.length-3)>0)return console.warn("Deprecated: change in arguments, use pushCoordinatesValues(feature, {x: long, y: lat, normal}, coordProj) instead"),void this.pushCoordinatesValues(e,{x:t,y:r,normal:arguments.length<=3?void 0:arguments[3]},arguments.length<=4?void 0:arguments[4]);zi(e,t),this.#K&&this.#K.expandByValuesCoordinates(t.x,t.y)}updateExtent(){if(this.extent){const e=this.indices[this.indices.length-1];e&&this.extent.union(e.extent)}}}function Hi(e,t){this.vertices[this._pos++]=e,this.vertices[this._pos++]=t}function Wi(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.vertices[this._pos++]=e,this.vertices[this._pos++]=t,this.vertices[this._pos++]=r}class $i{constructor(e,t){if(!Object.keys(Vi).find((t=>Vi[t]===e)))throw new Error(`Unsupported Feature type: ${e}`);this.type=e,this.geometries=[],this.vertices=[],this.crs=t.crs,this.size=t.size,this.normals="EPSG:4978"==t.crs?[]:void 0,this.hasRawElevationData=!1,this.transformToLocalSystem=t.transformToLocalSystem.bind(t),t.extent&&(this.extent=Gi(t.extent.crs),this.useCrsOut=this.extent.crs==this.crs),this._pos=0,this._pushValues=(3===this.size?Wi:Hi).bind(this),this.style=Ui}bindNewGeometry(){const e=new qi(this);return this.geometries.push(e),e}updateExtent(e){this.extent&&this.extent.union(e.extent)}get geometryCount(){return this.geometries.length}}const Yi=$i,Ki=()=>{},Ji=(e,t)=>(e.geodesicNormal.applyNormalMatrix(t.normalMatrixInverse),e.applyMatrix4(t.matrixWorldInverse)),Xi=(e,t)=>e.applyMatrix4(t.matrixWorldInverse),Zi=new s.Vector3(0,0,1),es=new s.Quaternion;class ts extends s.Object3D{#J=(()=>Xi)();#X=(()=>Ki)();constructor(e){super(),this.isFeatureCollection=!0,this.crs=e.accurate||!e.source?.crs?e.crs:e.source.crs,this.features=[],this.mergeFeatures=void 0===e.mergeFeatures||e.mergeFeatures,this.size="3d"==e.structure?3:2,this.filterExtent=e.filterExtent,this.style=e.style,this.isInverted=!1,this.matrixWorldInverse=new s.Matrix4,this.center=new i.E$("EPSG:4326",0,0),2==this.size?(this.extent=!1===e.buildExtent?void 0:Gi(e.forcedExtentCrs||this.crs),this.#X=e=>{e.as(this.crs,this.center),this.position.copy(e),this.updateMatrixWorld(),this.#X=Ki}):(this.extent=e.buildExtent?Gi(e.forcedExtentCrs||this.crs):void 0,this.#X=e=>{e.as("EPSG:4326",this.center),"EPSG:4978"==this.crs&&(this.quaternion.setFromUnitVectors(Zi,e.geodesicNormal),es.setFromAxisAngle(Zi,s.MathUtils.degToRad(90+this.center.longitude)),this.quaternion.multiply(es)),this.position.copy(e),this.updateMatrixWorld(),this.normalMatrix.getNormalMatrix(this.matrix),this.normalMatrixInverse=(new s.Matrix3).copy(this.normalMatrix).invert(),this.#X=Ki},this.#J=Ji)}transformToLocalSystem(e){return this.#X(e),this.#J(e,this)}updateExtent(e){if(this.extent){const t=e?[e]:this.features.map((e=>e.extent));for(const e of t)this.extent.union(e)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}removeEmptyFeature(){this.features=this.features.filter((e=>e.geometries.length))}pushFeature(e){this.features.push(e),this.updateExtent(e.extent)}requestFeature(e,t){const r=this.features.find(t);if(r&&this.mergeFeatures)return r;{const t=new $i(e,this);return this.features.push(t),t}}requestFeatureByType(e){return this.requestFeature(e,(t=>t.type===e))}requestFeatureById(e,t){return this.requestFeature(t,(t=>t.id===e))}newFeatureByReference(e){const t=new $i(e.type,this);return t.extent=e.extent,t.geometries=e.geometries,t.normals=e.normals,t.size=e.size,t.vertices=e.vertices,t._pos=e._pos,this.features.push(t),t}}const rs=e=>{if(e.crsOut||e.crsIn){console.warn("Parsing options with crsIn and crsOut are deprecated, use { in, out } structure.");const t={in:{},out:{}};return t.in.crs=e.crsIn,t.in.isInverted=e.isInverted,t.in.styles=e.styles,t.in.layers=e.layers,t.in.filter=e.filter,t.out.crs=e.crsOut,t.out.mergeFeatures=e.mergeFeatures,e.withAltitude&&e.withNormal?(console.warn("Parsing options withAltitude and withNormal is deprecated, use out.structure: 2d or 3d."),t.out.structure="3d"):t.out.structure="2d",t.out.filteringExtent=e.filteringExtent,t.out.style=e.style,void 0!==e.crsOut.overrideAltitudeInToZero&&console.error("Parsing options out.overrideAltitudeInToZero is removed, use Style.xxx.base_altitude instead"),t.out.filter=e.filter,t}return e.out&&(void 0===e.out.withAltitude&&void 0===e.out.withNormal||(console.warn("Parsing options out.withAltitude and out.withNormal is deprecated, use out.structure: 2d or 3d."),e.out.withAltitude&&e.out.withNormal?e.out.structure="3d":e.out.structure="2d"),void 0!==e.out.overrideAltitudeInToZero&&console.error("Parsing options out.overrideAltitudeInToZero is removed, use Style.xxx.base_altitude instead")),e},ns=new i.E$("EPSG:4978",0,0,0),is=new i.E$("EPSG:4978",0,0,0),ss=new i.E$("EPSG:4978",0,0,0),os=(e,t,r)=>(ns.crs=r,ns.setFromArray(t[0]),!e.isPointInside(ns)),as={populateGeometry(e,t,r,n){r.startSubGeometry(t.length,n),ns.crs=e;for(const e of t)ns.setFromValues(e[0],e[1],e[2]),r.pushCoordinates(n,ns);r.updateExtent()},populateGeometryWithCCW(e,t,r,n){r.startSubGeometry(t.length,n),ns.crs=e;let i=0;ss.setFromValues(t[0][0],t[0][1],t[0][2]),is.copy(ss);for(let e=0;e<t.length;e++)ns.setFromValues(t[e][0],t[e][1],t[e][2]),i+=(is.x-ns.x)*(is.y+ns.y),is.copy(ns),r.pushCoordinates(n,ns);i+=(is.x-ss.x)*(is.y+ss.y),r.getLastSubGeometry().ccw=i<0,r.updateExtent()},point(e,t,r,n,i){this.default(e,t,[r],n,i)},default(e,t,r,n,i){if(n.filterExtent&&os(n.filterExtent,r,t))return;const s=e.bindNewGeometry();s.properties=i,this.populateGeometry(t,r,s,e),e.updateExtent(s)},polygon(e,t,r,n,i){if(n.filterExtent&&os(n.filterExtent,r[0],t))return;const s=e.bindNewGeometry();s.properties=i;for(let n=0;n<r.length;n++)this.populateGeometryWithCCW(t,r[n],s,e);e.updateExtent(s)},multi(e,t,r,n,i,s){for(const o of n)this[e](t,r,o,i,s)}},ls=["type","geometry","properties"],cs=e=>void 0===e||Array.isArray(e)&&!isNaN(e[0])?e:cs(e[0]);function hs(e,t,r){if(!t.geometry?.type)return console.warn("No geometry provided"),null;const n=t.geometry.type.toLowerCase(),i=function(e){switch(e){case"point":case"multipoint":return Vi.POINT;case"linestring":case"multilinestring":return Vi.LINE;case"polygon":case"multipolygon":return Vi.POLYGON;default:throw new Error(`Unhandled geometry type ${e}`)}}(n),s=r.requestFeatureByType(i),o="point"!=n?t.geometry.coordinates:[t.geometry.coordinates],a=t.properties||{};s.hasRawElevationData=3===cs(o)?.length;for(const e of Object.keys(t))ls.includes(e.toLowerCase())||(a.geojson=a.geojson||{},a.geojson[e]=t[e]);return function(e,t,r,n,i,s){if(0!=n.length)switch(e){case"point":case"linestring":return as.default(t,r,n,i,s);case"multipoint":return as.multi("point",t,r,n,i,s);case"multilinestring":return as.multi("default",t,r,n,i,s);case"polygon":return as.polygon(t,r,n,i,s);case"multipolygon":return as.multi("polygon",t,r,n,i,s);default:throw new Error(`Unhandled geojson type ${t.type}`)}}(n,s,e,o,r,a),s}function us(e,t,r){const n=new ts(r),i=r.filter||(()=>!0);for(const r of t)i(r.properties,r.geometry)&&hs(e,r,n);return n.removeEmptyFeature(),n.updateExtent(),n}const ds={parse(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=rs(t),t.in=t.in||{};const r=t.out,n=t.in;switch("string"==typeof e&&(e=JSON.parse(e)),n.crs=n.crs||function(e){if(e.crs){if("epsg"==e.crs.type.toLowerCase())return`EPSG:${e.crs.properties.code}`;if("name"==e.crs.type.toLowerCase()){if(e.crs.properties.name.toLowerCase().includes("epsg:")){const t=e.crs.properties.name.lastIndexOf(":");if(t>0)return`EPSG:${e.crs.properties.name.substr(t+1)}`}throw new Error(`Unsupported CRS authority '${e.crs.properties.name}'`)}throw new Error(`Unsupported CRS type '${e.crs}'`)}return"EPSG:4326"}(e),r.filteringExtent&&("boolean"==typeof r.filteringExtent?r.filterExtent=t.extent.isExtent?t.extent.as(n.crs):t.extent.toExtent(n.crs):r.filteringExtent.isExtent&&(r.filterExtent=r.filteringExtent)),e.type.toLowerCase()){case"featurecollection":return Promise.resolve(us(n.crs,e.features,r));case"feature":return Promise.resolve(us(n.crs,[e],r));default:throw new Error(`Unsupported GeoJSON type: '${e.type}`)}}};function ps(e,t){return Array.from(e.getElementsByTagName(t))}function fs(e){return"#"===e[0]?e:`#${e}`}function gs(e){return e?.normalize(),e?.textContent||""}function As(e,t,r){const n=e.getElementsByTagName(t),i=n.length?n[0]:null;return i&&r&&r(i),i}function ms(e,t,r){const n={};if(!e)return n;const i=e.getElementsByTagName(t),s=i.length?i[0]:null;return s&&r?r(s,n):n}function ys(e,t,r){const n=gs(As(e,t));return n&&r&&r(n)||{}}function vs(e,t,r){const n=Number.parseFloat(gs(As(e,t)));if(!Number.isNaN(n))return n&&r&&r(n)||{}}function ws(e,t,r){const n=Number.parseFloat(gs(As(e,t)));if(!Number.isNaN(n))return r&&r(n),n}function bs(e,t){const r={};for(const n of t)ys(e,n,(e=>{r[n]=e}));return r}function Es(e){return 1===e?.nodeType}function xs(e){let t=[];if(null===e)return t;for(const r of Array.from(e.childNodes)){if(!Es(r))continue;const e=Cs(r.nodeName);if("gpxtpx:TrackPointExtension"===e)t=t.concat(xs(r));else{const n=gs(r);t.push([e,_s(n)])}}return t}function Cs(e){return["heart","gpxtpx:hr","hr"].includes(e)?"heart":e}function _s(e){const t=Number.parseFloat(e);return Number.isNaN(t)?e:t}function Is(e){const t=[Number.parseFloat(e.getAttribute("lon")||""),Number.parseFloat(e.getAttribute("lat")||"")];if(Number.isNaN(t[0])||Number.isNaN(t[1]))return null;ws(e,"ele",(e=>{t.push(e)}));const r=As(e,"time");return{coordinates:t,time:r?gs(r):null,extendedValues:xs(As(e,"extensions"))}}function Ss(e){return ms(e,"line",(e=>Object.assign({},ys(e,"color",(e=>({stroke:`#${e}`}))),vs(e,"opacity",(e=>({"stroke-opacity":e}))),vs(e,"width",(e=>({"stroke-width":96*e/25.4}))))))}function Ms(e,t){const r=bs(t,["name","cmt","desc","type","time","keywords"]);for(const[n,i]of e)for(const e of Array.from(t.getElementsByTagNameNS(i,"*")))r[e.tagName.replace(":","_")]=gs(e)?.trim();const n=ps(t,"link");return n.length&&(r.links=n.map((e=>Object.assign({href:e.getAttribute("href")},bs(e,["text","type"]))))),r}function Ts(e,t){const r=ps(e,t),n=[],i=[],s={};for(let e=0;e<r.length;e++){const t=Is(r[e]);if(t){n.push(t.coordinates),t.time&&i.push(t.time);for(const[n,i]of t.extendedValues){const t="heart"===n?n:`${n.replace("gpxtpx:","")}s`;s[t]||(s[t]=Array(r.length).fill(null)),s[t][e]=i}}}if(!(n.length<2))return{line:n,times:i,extendedValues:s}}function Bs(e,t){const r=Ts(t,"rtept");if(r)return{type:"Feature",properties:Object.assign({_gpxType:"rte"},Ms(e,t),Ss(As(t,"extensions"))),geometry:{type:"LineString",coordinates:r.line}}}function Ps(e,t){const r=ps(t,"trkseg"),n=[],i=[],s=[];for(const e of r){const t=Ts(e,"trkpt");t&&(s.push(t),t.times?.length&&i.push(t.times))}if(0===s.length)return null;const o=s.length>1,a=Object.assign({_gpxType:"trk"},Ms(e,t),Ss(As(t,"extensions")),i.length?{coordinateProperties:{times:o?i:i[0]}}:{});for(const e of s){n.push(e.line),a.coordinateProperties||(a.coordinateProperties={});const t=a.coordinateProperties,r=Object.entries(e.extendedValues);for(let e=0;e<r.length;e++){const[n,i]=r[e];o?(t[n]||(t[n]=s.map((e=>new Array(e.line.length).fill(null)))),t[n][e]=i):t[n]=i}}return{type:"Feature",properties:a,geometry:o?{type:"MultiLineString",coordinates:n}:{type:"LineString",coordinates:n[0]}}}function Rs(e,t){const r=Object.assign(Ms(e,t),bs(t,["sym"])),n=Is(t);return n?{type:"Feature",properties:r,geometry:{type:"Point",coordinates:n.coordinates}}:null}function*Ds(e){const t=e,r="http://www.garmin.com/xmlschemas/GpxExtensions/v3",n=[["gpxx",r]],i=t.getElementsByTagName("gpx")[0]?.attributes;if(i)for(const e of Array.from(i))e.name?.startsWith("xmlns:")&&e.value!==r&&n.push([e.name,e.value]);for(const e of ps(t,"trk")){const t=Ps(n,e);t&&(yield t)}for(const e of ps(t,"rte")){const t=Bs(n,e);t&&(yield t)}for(const e of ps(t,"wpt")){const t=Rs(n,e);t&&(yield t)}}function Ls(e,t){const r={},n="stroke"===t||"fill"===t?t:`${t}-color`;return"#"===e[0]&&(e=e.substring(1)),6===e.length||3===e.length?r[n]=`#${e}`:8===e.length&&(r[`${t}-opacity`]=Number.parseInt(e.substring(0,2),16)/255,r[n]=`#${e.substring(6,8)}${e.substring(4,6)}${e.substring(2,4)}`),r}function ks(e,t,r){const n={};return ws(e,t,(e=>{n[r]=e})),n}function Os(e,t){return ms(e,"color",(e=>Ls(gs(e),t)))}function Fs(e){return ms(e,"Icon",((e,t)=>(ys(e,"href",(e=>{t.icon=e})),t)))}function Ns(e){return Object.assign({},function(e){return ms(e,"PolyStyle",((e,t)=>Object.assign(t,ms(e,"color",(e=>Ls(gs(e),"fill"))),ys(e,"fill",(e=>{if("0"===e)return{"fill-opacity":0}})),ys(e,"outline",(e=>{if("0"===e)return{"stroke-opacity":0}})))))}(e),function(e){return ms(e,"LineStyle",(e=>Object.assign(Os(e,"stroke"),ks(e,"width","stroke-width"))))}(e),function(e){return ms(e,"LabelStyle",(e=>Object.assign(Os(e,"label"),ks(e,"scale","label-scale"))))}(e),function(e){return ms(e,"IconStyle",(e=>Object.assign(Os(e,"icon"),ks(e,"scale","icon-scale"),ks(e,"heading","icon-heading"),ms(e,"hotSpot",(e=>{const t=Number.parseFloat(e.getAttribute("x")||""),r=Number.parseFloat(e.getAttribute("y")||""),n=e.getAttribute("xunits")||"",i=e.getAttribute("yunits")||"";return Number.isNaN(t)||Number.isNaN(r)?{}:{"icon-offset":[t,r],"icon-offset-units":[n,i]}})),Fs(e))))}(e))}const Us=/\s*/g,Qs=/^\s*|\s*$/g,Gs=/\s+/;function zs(e){return e.replace(Us,"").split(",").map(Number.parseFloat).filter((e=>!Number.isNaN(e))).slice(0,3)}function js(e){return e.replace(Qs,"").split(Gs).map(zs).filter((e=>e.length>=2))}function Vs(e){let t=ps(e,"coord");var r;0===t.length&&(r=e,t=Array.from(r.getElementsByTagNameNS("*","coord")));const n=t.map((e=>gs(e).split(" ").map(Number.parseFloat)));return 0===n.length?null:{geometry:n.length>2?{type:"LineString",coordinates:n}:{type:"Point",coordinates:n[0]},times:ps(e,"when").map((e=>gs(e)))}}function qs(e){if(0===e.length)return e;const t=e[0],r=e[e.length-1];let n=!0;for(let e=0;e<Math.max(t.length,r.length);e++)if(t[e]!==r[e]){n=!1;break}return n?e:e.concat([e[0]])}function Hs(e){return gs(As(e,"coordinates"))}function Ws(e){let t=[],r=[];for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes.item(n);if(Es(i))switch(i.tagName){case"MultiGeometry":case"MultiTrack":case"gx:MultiTrack":{const e=Ws(i);t=t.concat(e.geometries),r=r.concat(e.coordTimes);break}case"Point":{const e=zs(Hs(i));e.length>=2&&t.push({type:"Point",coordinates:e});break}case"LinearRing":case"LineString":{const e=js(Hs(i));e.length>=2&&t.push({type:"LineString",coordinates:e});break}case"Polygon":{const e=[];for(const t of ps(i,"LinearRing")){const r=qs(js(Hs(t)));r.length>=4&&e.push(r)}e.length&&t.push({type:"Polygon",coordinates:e});break}case"Track":case"gx:Track":{const e=Vs(i);if(!e)break;const{times:n,geometry:s}=e;t.push(s),n.length&&r.push(n);break}}}return{geometries:t,coordTimes:r}}const $s=e=>Number(e),Ys={string:e=>e,int:$s,uint:$s,short:$s,ushort:$s,float:$s,double:$s,bool:e=>Boolean(e)};function Ks(e,t){return ms(e,"ExtendedData",((e,r)=>{for(const t of ps(e,"Data"))r[t.getAttribute("name")||""]=gs(As(t,"value"));for(const n of ps(e,"SimpleData")){const e=n.getAttribute("name")||"",i=t[e]||Ys.string;r[e]=i(gs(n))}return r}))}function Js(e){const t=As(e,"description");for(const e of Array.from(t?.childNodes||[]))if(4===e.nodeType)return{description:{"@type":"html",value:gs(e)}};return{}}function Xs(e){return ms(e,"TimeSpan",(e=>({timespan:{begin:gs(As(e,"begin")),end:gs(As(e,"end"))}})))}function Zs(e){return ms(e,"TimeStamp",(e=>({timestamp:gs(As(e,"when"))})))}function eo(e,t){return ys(e,"styleUrl",(e=>(e=fs(e),t[e]?Object.assign({styleUrl:e},t[e]):{styleUrl:e})))}const to=Math.PI/180;function ro(e,t,r,n){const i=function(e){return As(e,"gx:LatLonQuad")?{geometry:{type:"Polygon",coordinates:[qs(js(Hs(e)))]}}:function(e){const t=As(e,"LatLonBox");if(t){const e=ws(t,"north"),r=ws(t,"west"),n=ws(t,"east"),i=ws(t,"south"),s=ws(t,"rotation");if("number"==typeof e&&"number"==typeof i&&"number"==typeof r&&"number"==typeof n){const t=[r,i,n,e];let o=[[[r,e],[n,e],[n,i],[r,i],[r,e]]];return"number"==typeof s&&(o=function(e,t,r){const n=[(e[0]+e[2])/2,(e[1]+e[3])/2];return[t[0].map((e=>{const t=e[1]-n[1],i=e[0]-n[0],s=Math.sqrt(t**2+i**2),o=Math.atan2(t,i)+r*to;return[n[0]+Math.cos(o)*s,n[1]+Math.sin(o)*s]}))]}(t,o,s)),{bbox:t,geometry:{type:"Polygon",coordinates:o}}}}return null}(e)}(e),s=i?.geometry||null;if(!s&&n.skipNullGeometry)return null;const o={type:"Feature",geometry:s,properties:Object.assign({"@geometry-type":"groundoverlay"},bs(e,["name","address","visibility","open","phoneNumber","description"]),Js(e),eo(e,t),Ns(e),Fs(e),Ks(e,r),Xs(e),Zs(e))};i?.bbox&&(o.bbox=i.bbox),void 0!==o.properties?.visibility&&(o.properties.visibility="0"!==o.properties.visibility);const a=e.getAttribute("id");return null!==a&&""!==a&&(o.id=a),o}function no(e,t,r,n){const{coordTimes:i,geometries:s}=Ws(e),o=function(e){return 0===e.length?null:1===e.length?e[0]:{type:"GeometryCollection",geometries:e}}(s);if(!o&&n.skipNullGeometry)return null;const a={type:"Feature",geometry:o,properties:Object.assign(bs(e,["name","address","visibility","open","phoneNumber","description"]),Js(e),eo(e,t),Ns(e),Ks(e,r),Xs(e),Zs(e),i.length?{coordinateProperties:{times:1===i.length?i[0]:i}}:{})};void 0!==a.properties?.visibility&&(a.properties.visibility="0"!==a.properties.visibility);const l=e.getAttribute("id");return null!==l&&""!==l&&(a.id=l),a}function io(e){let t=e.getAttribute("id");const r=e.parentNode;return!t&&Es(r)&&"CascadingStyle"===r.localName&&(t=r.getAttribute("kml:id")||r.getAttribute("id")),fs(t||"")}function*so(e,t={skipNullGeometry:!1}){const r=e,n=function(e){const t={};for(const r of ps(e,"Style"))t[io(r)]=Ns(r);for(const r of ps(e,"StyleMap")){const e=fs(r.getAttribute("id")||"");ys(r,"styleUrl",(r=>{r=fs(r),t[r]&&(t[e]=t[r])}))}return t}(r),i=function(e){const t={};for(const r of ps(e,"SimpleField"))t[r.getAttribute("name")||""]=Ys[r.getAttribute("type")||""]||Ys.string;return t}(r);for(const e of ps(r,"Placemark")){const r=no(e,n,i,t);r&&(yield r)}for(const e of ps(r,"GroundOverlay")){const r=ro(e,n,i,t);r&&(yield r)}}const oo={parse:(e,t)=>(t=rs(t),ds.parse(function(e,t={skipNullGeometry:!1}){return{type:"FeatureCollection",features:Array.from(so(e,t))}}(e),t))};function ao(e,t){switch(e){case 1:if(t<=8)return s.UnsignedByteType;if(t<=16)return s.UnsignedShortType;if(t<=32)return s.UnsignedIntType;break;case 2:if(t<=8)return s.ByteType;if(t<=16)return s.ShortType;if(t<=32)return s.IntType;break;case 3:if(t<=16)return s.HalfFloatType;if(t<=32)return s.FloatType}throw Error("Unsuported data format/bitsPerSample combination")}class lo{constructor(e){const{image:t,resolution:r=t.getResolution(),origin:n=t.getOrigin(),dataType:i=ao(t.getSampleFormat(),t.getBitsPerSample())}=e;this.image=t,this.resolution=r,this.origin=n,this.dataType=i,this.width=t.getWidth(),this.height=t.getHeight(),this.samplesPerPixel=t.getSamplesPerPixel()}get reader(){return 3===this.samplesPerPixel?this.image.readRGB.bind(this.image):this.image.readRasters.bind(this.image)}async extractTexture(e){const{imageWindow:t,textureDimensions:r,defaultAlpha:n=255,resampleMethod:i="nearest",pool:o}=e;let a=await this.reader({window:t,pool:o,width:r.x,height:r.y,resampleMethod:i,interleave:!0});3===this.samplesPerPixel&&(a=function(e,t,r){const{width:n,height:i}=e,o=new(0,Object.getPrototypeOf(e).constructor)(n*i*4);let a;switch(t){case s.UnsignedByteType:a=r;break;case s.FloatType:a=r/255;break;case s.UnsignedShortType:case s.UnsignedIntType:case s.ByteType:case s.ShortType:case s.IntType:case s.HalfFloatType:default:throw new Error("unsupported data type")}o.width=n,o.height=i;for(let t=0;t<n*i;t++){const r=3*t,n=4*t;o[n+0]=e[r+0],o[n+1]=e[r+1],o[n+2]=e[r+2],o[n+3]=a}return o}(a,this.dataType,n));const l=new s.DataTexture(a,a.width,a.height,function(e){switch(e){case 1:return s.RedFormat;case 3:case 4:return s.RGBAFormat}throw Error(`GeoTIFF images with ${e} samples are not supported yet.`)}(this.samplesPerPixel),this.dataType);return l.flipY=!0,l.needsUpdate=!0,l}extentToImageWindow(e){const[t,r]=this.origin,[n,i]=this.resolution,s=[Math.round((e.west-t)/n),Math.round((e.north-r)/i),Math.round((e.east-t)/n),Math.round((e.south-r)/i)],o=Math.min(s[0],s[2]);let a=Math.max(s[0],s[2]);const l=Math.min(s[1],s[3]);let c=Math.max(s[1],s[3]);return a-o==0&&(a+=1),c-l==0&&(c+=1),[o,l,a,c]}}const co={parse:async function(e,t){const{in:{crs:r,defaultAlpha:n,resampleMethod:i},extent:o}=t,a=(o.isExtent?o.as(r):o.toExtent(r)).planarDimensions(),l=new s.Vector2(255,Math.round(255*a.y/a.x)),c=new lo({image:e}),h=await c.extractTexture({textureDimensions:l,resampleMethod:i,defaultAlpha:n});return h.extent=o,h}},ho={parse(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{in:{}};const r=t.in.dataType||"float";if(!["float","double"].includes(r))throw new Error("`dataType` parameter is incorrect for GTXParser.parse method. This parameter must be either `double` or `float`.");const n=new DataView(e,0,40),o={minX:n.getFloat64(8),minY:n.getFloat64(0),stepX:n.getFloat64(24),stepY:n.getFloat64(16),nColumns:n.getInt32(36),nRows:n.getInt32(32)},a=new DataView(e,40),c=o.minX+o.stepX*(o.nColumns-1),h=o.minY+o.stepY*(o.nRows-1),u=new i.zR(t.in.crs||"EPSG:4326",o.minX,c,o.minY,h),d=new s.Vector2(o.stepX,o.stepY);return Promise.resolve(new l(u,d,((e,t)=>"float"===r?a.getFloat32(4*(o.nColumns*e+t)):"double"===r?a.getFloat64(8*(o.nColumns*e+t)):void 0)))}};function uo(e,t){const r=e[e.indexOf(e.find((e=>e.includes(t))))].split(" ").filter((e=>""!==e));return parseFloat(r[r.length-1])}const po={parse(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{in:{}};const r=e.split("\n"),n=r.indexOf(r.find((e=>e.includes("end_of_head"))))+1,o=r.slice(0,n),a={minX:uo(o,"longlimit_west"),maxX:uo(o,"longlimit_east"),minY:uo(o,"latlimit_south"),maxY:uo(o,"latlimit_north"),stepX:uo(o,"gridstep"),stepY:uo(o,"gridstep"),nRows:uo(o,"latitude_parallels"),nColumns:uo(o,"longitude_parallels")},c=new DataView(new ArrayBuffer(8*a.nRows*a.nColumns));let h=0;for(let e of r.slice(n,r.length))e=e.split(" ").filter((e=>""!==e)),e.length&&(c.setFloat64(8*h,parseFloat(e[2])),h++);const u=new i.zR(t.in.crs||"EPSG:4326",a.minX,a.maxX,a.minY,a.maxY),d=new s.Vector2(a.stepX,a.stepY);return Promise.resolve(new l(u,d,((e,t)=>c.getFloat64(8*(a.nColumns*(a.nRows-e-1)+t)))))}},fo={parse(e,t){return t=rs(t),ds.parse((r=e,{type:"FeatureCollection",features:Array.from(Ds(r))}),t);var r}},go={parse(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{in:{}};const r=e.split("\n"),n=r.indexOf(r.find((e=>e.includes("end_of_head"))))+1,o=r.slice(0,n),a={minX:uo(o,"lon min"),maxX:uo(o,"lon max"),minY:uo(o,"lat min"),maxY:uo(o,"lat max"),stepX:uo(o,"delta lon"),stepY:uo(o,"delta lat"),nRows:uo(o,"nrows"),nColumns:uo(o,"ncols")},c=new DataView(new ArrayBuffer(8*a.nRows*a.nColumns));let h=0;for(let e of r.slice(n,r.length))if(e=e.split(" ").filter((e=>""!==e)),e.length)for(const t of e)c.setFloat64(8*h,parseFloat(t)),h++;const u=new i.zR(t.in.crs||"EPSG:4326",a.minX+a.stepX/2,a.maxX-a.stepX/2,a.minY+a.stepY/2,a.maxY-a.stepY/2),d=new s.Vector2(a.stepX,a.stepY);return Promise.resolve(new l(u,d,((e,t)=>c.getFloat64(8*(a.nColumns*e+t)))))}},Ao=4294967296,mo=1/Ao,yo="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");class vo{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,t,r=this.length){for(;this.pos<r;){const r=this.readVarint(),n=r>>3,i=this.pos;this.type=7&r,e(n,t,this),this.pos===i&&this.skip(r)}return t}readMessage(e,t){return this.readFields(e,t,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Ao;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Ao;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const t=this.buf;let r,n;return n=t[this.pos++],r=127&n,n<128?r:(n=t[this.pos++],r|=(127&n)<<7,n<128?r:(n=t[this.pos++],r|=(127&n)<<14,n<128?r:(n=t[this.pos++],r|=(127&n)<<21,n<128?r:(n=t[this.pos],r|=(15&n)<<28,function(e,t,r){const n=r.buf;let i,s;if(s=n[r.pos++],i=(112&s)>>4,s<128)return wo(e,i,t);if(s=n[r.pos++],i|=(127&s)<<3,s<128)return wo(e,i,t);if(s=n[r.pos++],i|=(127&s)<<10,s<128)return wo(e,i,t);if(s=n[r.pos++],i|=(127&s)<<17,s<128)return wo(e,i,t);if(s=n[r.pos++],i|=(127&s)<<24,s<128)return wo(e,i,t);if(s=n[r.pos++],i|=(1&s)<<31,s<128)return wo(e,i,t);throw new Error("Expected varint not more than 10 bytes")}(r,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return Boolean(this.readVarint())}readString(){const e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&yo?yo.decode(this.buf.subarray(t,e)):function(e,t,r){let n="",i=t;for(;i<r;){const t=e[i];let s,o,a,l=null,c=t>239?4:t>223?3:t>191?2:1;if(i+c>r)break;1===c?t<128&&(l=t):2===c?(s=e[i+1],128==(192&s)&&(l=(31&t)<<6|63&s,l<=127&&(l=null))):3===c?(s=e[i+1],o=e[i+2],128==(192&s)&&128==(192&o)&&(l=(15&t)<<12|(63&s)<<6|63&o,(l<=2047||l>=55296&&l<=57343)&&(l=null))):4===c&&(s=e[i+1],o=e[i+2],a=e[i+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(l=(15&t)<<18|(63&s)<<12|(63&o)<<6|63&a,(l<=65535||l>=1114112)&&(l=null))),null===l?(l=65533,c=1):l>65535&&(l-=65536,n+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),n+=String.fromCharCode(l),i+=c}return n}(this.buf,t,e)}readBytes(){const e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t}readPackedVarint(e=[],t){const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readVarint(t));return e}readPackedSVarint(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed64());return e}readPackedEnd(){return 2===this.type?this.readVarint()+this.pos:this.pos+1}skip(e){const t=7&e;if(0===t)for(;this.buf[this.pos++]>127;);else if(2===t)this.pos=this.readVarint()+this.pos;else if(5===t)this.pos+=4;else{if(1!==t)throw new Error(`Unimplemented type: ${t}`);this.pos+=8}}writeTag(e,t){this.writeVarint(e<<3|t)}realloc(e){let t=this.length||16;for(;t<this.pos+e;)t*=2;if(t!==this.length){const e=new Uint8Array(t);e.set(this.buf),this.buf=e,this.dataView=new DataView(e.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*mo),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*mo),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?function(e,t){let r,n;if(e>=0?(r=e%4294967296|0,n=e/4294967296|0):(r=~(-e%4294967296),n=~(-e/4294967296),4294967295^r?r=r+1|0:(r=0,n=n+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,r){r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos]=127&e}(r,0,t),function(e,t){const r=(7&e)<<4;t.buf[t.pos++]|=r|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(n,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const t=this.pos;this.pos=function(e,t,r){for(let n,i,s=0;s<t.length;s++){if(n=t.charCodeAt(s),n>55295&&n<57344){if(!i){n>56319||s+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):i=n;continue}if(n<56320){e[r++]=239,e[r++]=191,e[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(e[r++]=239,e[r++]=191,e[r++]=189,i=null);n<128?e[r++]=n:(n<2048?e[r++]=n>>6|192:(n<65536?e[r++]=n>>12|224:(e[r++]=n>>18|240,e[r++]=n>>12&63|128),e[r++]=n>>6&63|128),e[r++]=63&n|128)}return r}(this.buf,e,this.pos);const r=this.pos-t;r>=128&&bo(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const t=e.length;this.writeVarint(t),this.realloc(t);for(let r=0;r<t;r++)this.buf[this.pos++]=e[r]}writeRawMessage(e,t){this.pos++;const r=this.pos;e(t,this);const n=this.pos-r;n>=128&&bo(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n}writeMessage(e,t,r){this.writeTag(e,2),this.writeRawMessage(t,r)}writePackedVarint(e,t){t.length&&this.writeMessage(e,Eo,t)}writePackedSVarint(e,t){t.length&&this.writeMessage(e,xo,t)}writePackedBoolean(e,t){t.length&&this.writeMessage(e,Io,t)}writePackedFloat(e,t){t.length&&this.writeMessage(e,Co,t)}writePackedDouble(e,t){t.length&&this.writeMessage(e,_o,t)}writePackedFixed32(e,t){t.length&&this.writeMessage(e,So,t)}writePackedSFixed32(e,t){t.length&&this.writeMessage(e,Mo,t)}writePackedFixed64(e,t){t.length&&this.writeMessage(e,To,t)}writePackedSFixed64(e,t){t.length&&this.writeMessage(e,Bo,t)}writeBytesField(e,t){this.writeTag(e,2),this.writeBytes(t)}writeFixed32Field(e,t){this.writeTag(e,5),this.writeFixed32(t)}writeSFixed32Field(e,t){this.writeTag(e,5),this.writeSFixed32(t)}writeFixed64Field(e,t){this.writeTag(e,1),this.writeFixed64(t)}writeSFixed64Field(e,t){this.writeTag(e,1),this.writeSFixed64(t)}writeVarintField(e,t){this.writeTag(e,0),this.writeVarint(t)}writeSVarintField(e,t){this.writeTag(e,0),this.writeSVarint(t)}writeStringField(e,t){this.writeTag(e,2),this.writeString(t)}writeFloatField(e,t){this.writeTag(e,5),this.writeFloat(t)}writeDoubleField(e,t){this.writeTag(e,1),this.writeDouble(t)}writeBooleanField(e,t){this.writeVarintField(e,+t)}}function wo(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function bo(e,t,r){const n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(n);for(let t=r.pos-1;t>=e;t--)r.buf[t+n]=r.buf[t]}function Eo(e,t){for(let r=0;r<e.length;r++)t.writeVarint(e[r])}function xo(e,t){for(let r=0;r<e.length;r++)t.writeSVarint(e[r])}function Co(e,t){for(let r=0;r<e.length;r++)t.writeFloat(e[r])}function _o(e,t){for(let r=0;r<e.length;r++)t.writeDouble(e[r])}function Io(e,t){for(let r=0;r<e.length;r++)t.writeBoolean(e[r])}function So(e,t){for(let r=0;r<e.length;r++)t.writeFixed32(e[r])}function Mo(e,t){for(let r=0;r<e.length;r++)t.writeSFixed32(e[r])}function To(e,t){for(let r=0;r<e.length;r++)t.writeFixed64(e[r])}function Bo(e,t){for(let r=0;r<e.length;r++)t.writeSFixed64(e[r])}function Po(e,t){this.x=e,this.y=t}Po.prototype={clone(){return new Po(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,t){return this.clone()._rotateAround(e,t)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult(e){const t=e[0]*this.x+e[1]*this.y,r=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=r,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const t=Math.cos(e),r=Math.sin(e),n=t*this.x-r*this.y,i=r*this.x+t*this.y;return this.x=n,this.y=i,this},_rotateAround(e,t){const r=Math.cos(e),n=Math.sin(e),i=t.x+r*(this.x-t.x)-n*(this.y-t.y),s=t.y+n*(this.x-t.x)+r*(this.y-t.y);return this.x=i,this.y=s,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Po},Po.convert=function(e){if(e instanceof Po)return e;if(Array.isArray(e))return new Po(+e[0],+e[1]);if(void 0!==e.x&&void 0!==e.y)return new Po(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};class Ro{constructor(e,t,r,n,i){this.properties={},this.extent=r,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=i,e.readFields(Do,this,t)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const t=e.readVarint()+e.pos,r=[];let n,i=1,s=0,o=0,a=0;for(;e.pos<t;){if(s<=0){const t=e.readVarint();i=7&t,s=t>>3}if(s--,1===i||2===i)o+=e.readSVarint(),a+=e.readSVarint(),1===i&&(n&&r.push(n),n=[]),n&&n.push(new Po(o,a));else{if(7!==i)throw new Error(`unknown command ${i}`);n&&n.push(n[0].clone())}}return n&&r.push(n),r}bbox(){const e=this._pbf;e.pos=this._geometry;const t=e.readVarint()+e.pos;let r=1,n=0,i=0,s=0,o=1/0,a=-1/0,l=1/0,c=-1/0;for(;e.pos<t;){if(n<=0){const t=e.readVarint();r=7&t,n=t>>3}if(n--,1===r||2===r)i+=e.readSVarint(),s+=e.readSVarint(),i<o&&(o=i),i>a&&(a=i),s<l&&(l=s),s>c&&(c=s);else if(7!==r)throw new Error(`unknown command ${r}`)}return[o,l,a,c]}toGeoJSON(e,t,r){const n=this.extent*Math.pow(2,r),i=this.extent*e,s=this.extent*t,o=this.loadGeometry();function a(e){return[360*(e.x+i)/n-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+s)/n)*Math.PI))-90]}function l(e){return e.map(a)}let c;if(1===this.type){const e=[];for(const t of o)e.push(t[0]);const t=l(e);c=1===e.length?{type:"Point",coordinates:t[0]}:{type:"MultiPoint",coordinates:t}}else if(2===this.type){const e=o.map(l);c=1===e.length?{type:"LineString",coordinates:e[0]}:{type:"MultiLineString",coordinates:e}}else{if(3!==this.type)throw new Error("unknown feature type");{const e=function(e){const t=e.length;if(t<=1)return[e];const r=[];let n,i;for(let s=0;s<t;s++){const t=Lo(e[s]);0!==t&&(void 0===i&&(i=t<0),i===t<0?(n&&r.push(n),n=[e[s]]):n&&n.push(e[s]))}return n&&r.push(n),r}(o),t=[];for(const r of e)t.push(r.map(l));c=1===t.length?{type:"Polygon",coordinates:t[0]}:{type:"MultiPolygon",coordinates:t}}}const h={type:"Feature",geometry:c,properties:this.properties};return null!=this.id&&(h.id=this.id),h}}function Do(e,t,r){1===e?t.id=r.readVarint():2===e?function(e,t){const r=e.readVarint()+e.pos;for(;e.pos<r;){const r=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[r]=n}}(r,t):3===e?t.type=r.readVarint():4===e&&(t._geometry=r.pos)}function Lo(e){let t=0;for(let r,n,i=0,s=e.length,o=s-1;i<s;o=i++)r=e[i],n=e[o],t+=(n.x-r.x)*(r.y+n.y);return t}Ro.types=["Unknown","Point","LineString","Polygon"];class ko{constructor(e,t){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Oo,this,t),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const t=this._pbf.readVarint()+this._pbf.pos;return new Ro(this._pbf,t,this.extent,this._keys,this._values)}}function Oo(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(function(e){let t=null;const r=e.readVarint()+e.pos;for(;e.pos<r;){const r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}return t}(r))}class Fo{constructor(e,t){this.layers=e.readFields(No,{},t)}}function No(e,t,r){if(3===e){const e=new ko(r,r.readVarint()+r.pos);e.length&&(t[e.name]=e)}}const Uo=new s.Vector2,Qo=new s.Vector2,Go=new Map,zo=new Map,jo=new i.zR("EPSG:4326",-180,180,-90,90);Go.set("EPSG:4326",jo);const Vo=jo.as("EPSG:3857");Vo.clampSouthNorth(Vo.west,Vo.east),Go.set("EPSG:3857",Vo);const qo=new s.Vector2(1,1);function Ho(e){const t=Go.get(e);if(!t)throw new Error(`The tile matrix set ${e} is not defined.`);const r=t.planarDimensions(Qo),n=zo.get(e)??qo,i=!e.includes(":NI");return{epsg:e,globalExtent:t,globalDimension:r,sTs:n,isInverted:i}}function Wo(e,t){const r=zo.get(e)||qo,n=2**t;return Uo.set(n,n).multiply(r),Uo}zo.set("EPSG:3857",qo),zo.set("EPSG:4326",new s.Vector2(2,1));const $o=Go.get("EPSG:3857").planarDimensions(),Yo=new s.Vector3($o.x,$o.y,1),Ko=new s.Vector2,Jo=new s.Vector2;function Xo(e,t,r,n){const s=n*2**r.z,o=n*r.x,a=n*r.y;return new i.E$("EPSG:4326",360*(e+o)/s-180,360/Math.PI*Math.atan(Math.exp((180-360*(t+a)/s)*Math.PI/180))-90)}function Zo(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t.bindNewGeometry();const i=t.type===Vi.POLYGON;r=r&&i,n.properties=e.properties;const s=e._pbf;s.pos=e._geometry;const o=s.readVarint()+s.pos;let a=1,l=0,c=0,h=0,u=0,d=0;for(;s.pos<o;){if(l<=0){const e=s.readVarint();a=7&e,l=e>>3}if(l--,1===a||2===a){c+=s.readSVarint(),h+=s.readSVarint(),1===a&&(u&&(r&&d>0&&n.indices.length>0&&(t.updateExtent(n),n=t.bindNewGeometry(),n.properties=e.properties),n.closeSubGeometry(u,t),n.getLastSubGeometry().ccw=d<0),u=0,d=0),u++;const o=Xo(c,h,e.tileNumbers,e.extent);n.pushCoordinatesValues(t,{x:c,y:h},o),1==u?(Jo.set(c,h),Jo.coordProj=o,Ko.set(c,h)):i&&u>1&&(d+=(Ko.x-c)*(Ko.y+h),Ko.set(c,h))}else{if(7!==a)throw new Error(`unknown command ${a}`);u&&(u++,n.pushCoordinatesValues(t,{x:Jo.x,y:Jo.y},Jo.coordProj),i&&(d+=(Ko.x-Jo.x)*(Ko.y+Jo.y)))}}u&&(r&&d>0&&n.indices.length>0&&(t.updateExtent(n),n=t.bindNewGeometry(),n.properties=e.properties),n.closeSubGeometry(u,t),n.getLastSubGeometry().ccw=d<0),t.updateExtent(n)}const ea={parse:(e,t)=>(t=rs(t),Promise.resolve(function(e,t){t.out=t.out||{};const r=new Fo(new vo(e)),n=Object.keys(r.layers),i=new ts(t.out);if(n.length<1)return Promise.resolve(i);const s=t.extent.col,o=t.extent.zoom,a=t.in.isInverted?t.extent.row:(1<<o)-t.extent.row-1,l=r.layers[n[0]],c=l.extent*2**o,h=-.5*c;return i.scale.set(Yo.x/c,-Yo.y/c,1),i.position.set(l.extent*s+h,l.extent*a+h,0).multiply(i.scale),i.updateMatrixWorld(),n.forEach((e=>{if(!t.in.layers[e])return Promise.resolve(i);const n=r.layers[e];for(let r=n.length-1;r>=0;r--){const a=n.feature(r);a.tileNumbers={x:s,y:t.extent.row,z:o};const l=t.in.layers[e].filter((e=>e.filterExpression.filter({zoom:o},a)));for(const e of l){const r=i.requestFeatureById(e.id,a.type-1);r.id=e.id,r.order=e.order,r.style=t.in.styles[r.id],Zo(a,r)}}})),i.removeEmptyFeature(),i.features.sort(((e,t)=>e.order-t.order)),i.updateExtent(),i.extent=t.extent,i.isInverted=t.in.isInverted,Promise.resolve(i)}(e,t)))};function ta(e){return(t,...r)=>na(e,t,r)}function ra(e,t){return ta(aa(e,t).get)}const{apply:na,construct:ia,defineProperty:sa,get:oa,getOwnPropertyDescriptor:aa,getPrototypeOf:la,has:ca,ownKeys:ha,set:ua,setPrototypeOf:da}=Reflect,{EPSILON:pa,MAX_SAFE_INTEGER:fa,isFinite:ga,isNaN:Aa}=Number,{iterator:ma,species:ya,toStringTag:va,for:wa}=Symbol,ba=Object,{create:Ea,defineProperty:xa,freeze:Ca,is:_a}=ba,Ia=ba.prototype,Sa=(Ia.__lookupGetter__&&ta(Ia.__lookupGetter__),ba.hasOwn||ta(Ia.hasOwnProperty),Array),Ma=(Sa.isArray,Sa.prototype),Ta=(ta(Ma.join),ta(Ma.push),ta(Ma.toLocaleString),Ma[ma]),Ba=ta(Ta),{abs:Pa,trunc:Ra}=Math,Da=ArrayBuffer,La=(Da.isView,Da.prototype),ka=(ta(La.slice),ra(La,"byteLength"),"undefined"!=typeof SharedArrayBuffer?SharedArrayBuffer:null),Oa=(ka&&ra(ka.prototype,"byteLength"),la(Uint8Array)),Fa=(Oa.from,Oa.prototype),Na=(Fa[ma],ta(Fa.keys),ta(Fa.values),ta(Fa.entries),ta(Fa.set),ta(Fa.reverse),ta(Fa.fill),ta(Fa.copyWithin),ta(Fa.sort),ta(Fa.slice),ta(Fa.subarray),ra(Fa,"buffer"),ra(Fa,"byteOffset"),ra(Fa,"length"),ra(Fa,va),Uint8Array),Ua=Uint16Array,Qa=Uint32Array,Ga=Float32Array,za=la([][ma]()),ja=ta(za.next),Va=ta(function*(){}().next),qa=la(za),Ha=DataView.prototype,Wa=ta(Ha.getUint16),$a=(ta(Ha.setUint16),TypeError,WeakSet.prototype),Ya=(ta($a.add),ta($a.has),WeakMap),Ka=Ya.prototype,Ja=ta(Ka.get),Xa=(ta(Ka.has),ta(Ka.set)),Za=new Ya,el=Ea(null,{next:{value:function(){const e=Ja(Za,this);return ja(e)}},[ma]:{value:function(){return this}}}),tl=new Ya,rl=Ea(qa,{next:{value:function(){const e=Ja(tl,this);return Va(e)},writable:!0,configurable:!0}});for(const e of ha(za))"next"!==e&&xa(rl,e,aa(za,e));const nl=new Da(4),il=new Ga(nl),sl=new Qa(nl),ol=new Ua(512),al=new Na(512);for(let e=0;e<256;++e){const t=e-127;t<-24?(ol[e]=0,ol[256|e]=32768,al[e]=24,al[256|e]=24):t<-14?(ol[e]=1024>>-t-14,ol[256|e]=1024>>-t-14|32768,al[e]=-t-1,al[256|e]=-t-1):t<=15?(ol[e]=t+15<<10,ol[256|e]=t+15<<10|32768,al[e]=13,al[256|e]=13):t<128?(ol[e]=31744,ol[256|e]=64512,al[e]=24,al[256|e]=24):(ol[e]=31744,ol[256|e]=64512,al[e]=13,al[256|e]=13)}const ll=new Qa(2048);for(let e=1;e<1024;++e){let t=e<<13,r=0;for(;!(8388608&t);)t<<=1,r-=8388608;t&=-8388609,r+=947912704,ll[e]=t|r}for(let e=1024;e<2048;++e)ll[e]=939524096+(e-1024<<13);const cl=new Qa(64);for(let e=1;e<31;++e)cl[e]=e<<23;cl[31]=1199570944,cl[32]=2147483648;for(let e=33;e<63;++e)cl[e]=2147483648+(e-32<<23);cl[63]=3347054592;const hl=new Ua(64);for(let e=1;e<64;++e)32!==e&&(hl[e]=1024);function ul(e,t,...r){return function(e){const t=e>>10;return sl[0]=ll[hl[t]+(1023&e)]+cl[t],il[0]}(Wa(e,t,...function(e){if(e[ma]===Ta&&za.next===ja)return e;const t=Ea(el);return Xa(Za,t,Ba(e)),t}(r)))}var dl=r(27379),pl=r(60563),fl=r(98622);const gl=new Map;function Al(e,t){Array.isArray(e)||(e=[e]),e.forEach((e=>gl.set(e,t)))}async function ml(e){const t=gl.get(e.Compression);if(!t)throw new Error(`Unknown compression method identifier: ${e.Compression}`);return new(await t())(e)}function yl(e,t,r,n=1){return new(Object.getPrototypeOf(e).constructor)(t*r*n)}function vl(e,t,r){return(1-r)*e+r*t}function wl(e,t,r){let n=0;for(let i=t;i<r;++i)n+=e[i];return n}function bl(e,t,r){switch(e){case 1:if(t<=8)return new Uint8Array(r);if(t<=16)return new Uint16Array(r);if(t<=32)return new Uint32Array(r);break;case 2:if(8===t)return new Int8Array(r);if(16===t)return new Int16Array(r);if(32===t)return new Int32Array(r);break;case 3:switch(t){case 16:case 32:return new Float32Array(r);case 64:return new Float64Array(r)}}throw Error("Unsupported data format/bitsPerSample")}Al([void 0,1],(()=>r.e(121).then(r.bind(r,35121)).then((e=>e.default)))),Al(5,(()=>r.e(764).then(r.bind(r,12764)).then((e=>e.default)))),Al(6,(()=>{throw new Error("old style JPEG compression is not supported.")})),Al(7,(()=>r.e(457).then(r.bind(r,76457)).then((e=>e.default)))),Al([8,32946],(()=>Promise.all([r.e(148),r.e(424)]).then(r.bind(r,50424)).then((e=>e.default)))),Al(32773,(()=>r.e(30).then(r.bind(r,1030)).then((e=>e.default)))),Al(34887,(()=>Promise.all([r.e(148),r.e(414)]).then(r.bind(r,51414)).then((async e=>(await e.zstd.init(),e))).then((e=>e.default)))),Al(50001,(()=>r.e(568).then(r.bind(r,6568)).then((e=>e.default))));const El=class{constructor(e,t,r,n,i,s){this.fileDirectory=e,this.geoKeys=t,this.dataView=r,this.littleEndian=n,this.tiles=i?{}:null,this.isTiled=!e.StripOffsets;const o=e.PlanarConfiguration;if(this.planarConfiguration=void 0===o?1:o,1!==this.planarConfiguration&&2!==this.planarConfiguration)throw new Error("Invalid planar configuration.");this.source=s}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return void 0!==this.fileDirectory.SamplesPerPixel?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:void 0!==this.fileDirectory.RowsPerStrip?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,r=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(r<=8)return DataView.prototype.getUint8;if(r<=16)return DataView.prototype.getUint16;if(r<=32)return DataView.prototype.getUint32;break;case 2:if(r<=8)return DataView.prototype.getInt8;if(r<=16)return DataView.prototype.getInt16;if(r<=32)return DataView.prototype.getInt32;break;case 3:switch(r){case 16:return function(e,t){return ul(this,e,t)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){return bl(this.getSampleFormat(e),this.getBitsPerSample(e),t)}async getTileOrStrip(e,t,r,n,i){const s=Math.ceil(this.getWidth()/this.getTileWidth()),o=Math.ceil(this.getHeight()/this.getTileHeight());let a;const{tiles:l}=this;let c,h;1===this.planarConfiguration?a=t*s+e:2===this.planarConfiguration&&(a=r*s*o+t*s+e),this.isTiled?(c=this.fileDirectory.TileOffsets[a],h=this.fileDirectory.TileByteCounts[a]):(c=this.fileDirectory.StripOffsets[a],h=this.fileDirectory.StripByteCounts[a]);const u=(await this.source.fetch([{offset:c,length:h}],i))[0];let d;return null!==l&&l[a]?d=l[a]:(d=(async()=>{let e=await n.decode(this.fileDirectory,u);const r=this.getSampleFormat(),i=this.getBitsPerSample();return function(e,t){return(1!==e&&2!==e||!(t<=32)||t%8!=0)&&(3!==e||16!==t&&32!==t&&64!==t)}(r,i)&&(e=function(e,t,r,n,i,s,o){const a=new DataView(e),l=2===r?1:n,c=bl(t,i,2===r?o*s:o*s*n),h=parseInt("1".repeat(i),2);if(1===t){let e;e=1===r?n*i:i;let t=s*e;7&t&&(t=t+7&-8);for(let e=0;e<o;++e){const r=e*t;for(let t=0;t<s;++t){const n=r+t*l*i;for(let r=0;r<l;++r){const o=n+r*i,u=(e*s+t)*l+r,d=Math.floor(o/8),p=o%8;if(p+i<=8)c[u]=a.getUint8(d)>>8-i-p&h;else if(p+i<=16)c[u]=a.getUint16(d)>>16-i-p&h;else if(p+i<=24){const e=a.getUint16(d)<<8|a.getUint8(d+2);c[u]=e>>24-i-p&h}else c[u]=a.getUint32(d)>>32-i-p&h}}}}return c.buffer}(e,r,this.planarConfiguration,this.getSamplesPerPixel(),i,this.getTileWidth(),this.getBlockHeight(t))),e})(),null!==l&&(l[a]=d)),{x:e,y:t,sample:r,data:await d}}async _readRaster(e,t,r,n,i,s,o,a,l){const c=this.getTileWidth(),h=this.getTileHeight(),u=this.getWidth(),d=this.getHeight(),p=Math.max(Math.floor(e[0]/c),0),f=Math.min(Math.ceil(e[2]/c),Math.ceil(u/c)),g=Math.max(Math.floor(e[1]/h),0),A=Math.min(Math.ceil(e[3]/h),Math.ceil(d/h)),m=e[2]-e[0];let y=this.getBytesPerPixel();const v=[],w=[];for(let e=0;e<t.length;++e)1===this.planarConfiguration?v.push(wl(this.fileDirectory.BitsPerSample,0,t[e])/8):v.push(0),w.push(this.getReaderForSample(t[e]));const b=[],{littleEndian:E}=this;for(let s=g;s<A;++s)for(let o=p;o<f;++o){let a;1===this.planarConfiguration&&(a=this.getTileOrStrip(o,s,0,i,l));for(let p=0;p<t.length;++p){const f=p,g=t[p];2===this.planarConfiguration&&(y=this.getSampleByteSize(g),a=this.getTileOrStrip(o,s,g,i,l));const A=a.then((i=>{const s=i.data,o=new DataView(s),a=this.getBlockHeight(i.y),l=i.y*h,p=i.x*c,g=l+a,A=(i.x+1)*c,b=w[f],x=Math.min(a,a-(g-e[3]),d-l),C=Math.min(c,c-(A-e[2]),u-p);for(let i=Math.max(0,e[1]-l);i<x;++i)for(let s=Math.max(0,e[0]-p);s<C;++s){const a=(i*c+s)*y,h=b.call(o,a+v[f],E);let u;n?(u=(i+l-e[1])*m*t.length+(s+p-e[0])*t.length+f,r[u]=h):(u=(i+l-e[1])*m+s+p-e[0],r[f][u]=h)}}));b.push(A)}}if(await Promise.all(b),s&&e[2]-e[0]!==s||o&&e[3]-e[1]!==o){let i;return i=n?function(e,t,r,n,i,s,o="nearest"){switch(o.toLowerCase()){case"nearest":return function(e,t,r,n,i,s){const o=t/n,a=r/i,l=yl(e,n,i,s);for(let c=0;c<i;++c){const i=Math.min(Math.round(a*c),r-1);for(let r=0;r<n;++r){const a=Math.min(Math.round(o*r),t-1);for(let o=0;o<s;++o){const h=e[i*t*s+a*s+o];l[c*n*s+r*s+o]=h}}}return l}(e,t,r,n,i,s);case"bilinear":case"linear":return function(e,t,r,n,i,s){const o=t/n,a=r/i,l=yl(e,n,i,s);for(let c=0;c<i;++c){const i=a*c,h=Math.floor(i),u=Math.min(Math.ceil(i),r-1);for(let r=0;r<n;++r){const a=o*r,d=a%1,p=Math.floor(a),f=Math.min(Math.ceil(a),t-1);for(let o=0;o<s;++o){const a=e[h*t*s+p*s+o],g=e[h*t*s+f*s+o],A=e[u*t*s+p*s+o],m=e[u*t*s+f*s+o],y=vl(vl(a,g,d),vl(A,m,d),i%1);l[c*n*s+r*s+o]=y}}}return l}(e,t,r,n,i,s);default:throw new Error(`Unsupported resampling method: '${o}'`)}}(r,e[2]-e[0],e[3]-e[1],s,o,t.length,a):function(e,t,r,n,i,s="nearest"){switch(s.toLowerCase()){case"nearest":return function(e,t,r,n,i){const s=t/n,o=r/i;return e.map((e=>{const a=yl(e,n,i);for(let l=0;l<i;++l){const i=Math.min(Math.round(o*l),r-1);for(let r=0;r<n;++r){const o=Math.min(Math.round(s*r),t-1),c=e[i*t+o];a[l*n+r]=c}}return a}))}(e,t,r,n,i);case"bilinear":case"linear":return function(e,t,r,n,i){const s=t/n,o=r/i;return e.map((e=>{const a=yl(e,n,i);for(let l=0;l<i;++l){const i=o*l,c=Math.floor(i),h=Math.min(Math.ceil(i),r-1);for(let r=0;r<n;++r){const o=s*r,u=o%1,d=Math.floor(o),p=Math.min(Math.ceil(o),t-1),f=e[c*t+d],g=e[c*t+p],A=e[h*t+d],m=e[h*t+p],y=vl(vl(f,g,u),vl(A,m,u),i%1);a[l*n+r]=y}}return a}))}(e,t,r,n,i);default:throw new Error(`Unsupported resampling method: '${s}'`)}}(r,e[2]-e[0],e[3]-e[1],s,o,a),i.width=s,i.height=o,i}return r.width=s||e[2]-e[0],r.height=o||e[3]-e[1],r}async readRasters({window:e,samples:t=[],interleave:r,pool:n=null,width:i,height:s,resampleMethod:o,fillValue:a,signal:l}={}){const c=e||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const h=(c[2]-c[0])*(c[3]-c[1]),u=this.getSamplesPerPixel();if(t&&t.length){for(let e=0;e<t.length;++e)if(t[e]>=u)return Promise.reject(new RangeError(`Invalid sample index '${t[e]}'.`))}else for(let e=0;e<u;++e)t.push(e);let d;if(r)d=bl(this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,Math.max.apply(null,this.fileDirectory.BitsPerSample),h*t.length),a&&d.fill(a);else{d=[];for(let e=0;e<t.length;++e){const r=this.getArrayForSample(t[e],h);Array.isArray(a)&&e<a.length?r.fill(a[e]):a&&!Array.isArray(a)&&r.fill(a),d.push(r)}}const p=n||await ml(this.fileDirectory);return await this._readRaster(c,t,d,r,p,i,s,o,l)}async readRGB({window:e,interleave:t=!0,pool:r=null,width:n,height:i,resampleMethod:s,enableAlpha:o=!1,signal:a}={}){const l=e||[0,0,this.getWidth(),this.getHeight()];if(l[0]>l[2]||l[1]>l[3])throw new Error("Invalid subsets");const c=this.fileDirectory.PhotometricInterpretation;if(c===fl.ub.RGB){let l=[0,1,2];if(this.fileDirectory.ExtraSamples!==fl.AC.Unspecified&&o){l=[];for(let e=0;e<this.fileDirectory.BitsPerSample.length;e+=1)l.push(e)}return this.readRasters({window:e,interleave:t,samples:l,pool:r,width:n,height:i,resampleMethod:s,signal:a})}let h;switch(c){case fl.ub.WhiteIsZero:case fl.ub.BlackIsZero:case fl.ub.Palette:h=[0];break;case fl.ub.CMYK:h=[0,1,2,3];break;case fl.ub.YCbCr:case fl.ub.CIELab:h=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const u={window:l,interleave:!0,samples:h,pool:r,width:n,height:i,resampleMethod:s,signal:a},{fileDirectory:d}=this,p=await this.readRasters(u),f=2**this.fileDirectory.BitsPerSample[0];let g;switch(c){case fl.ub.WhiteIsZero:g=function(e,t){const{width:r,height:n}=e,i=new Uint8Array(r*n*3);let s;for(let r=0,n=0;r<e.length;++r,n+=3)s=256-e[r]/t*256,i[n]=s,i[n+1]=s,i[n+2]=s;return i}(p,f);break;case fl.ub.BlackIsZero:g=function(e,t){const{width:r,height:n}=e,i=new Uint8Array(r*n*3);let s;for(let r=0,n=0;r<e.length;++r,n+=3)s=e[r]/t*256,i[n]=s,i[n+1]=s,i[n+2]=s;return i}(p,f);break;case fl.ub.Palette:g=function(e,t){const{width:r,height:n}=e,i=new Uint8Array(r*n*3),s=t.length/3,o=t.length/3*2;for(let r=0,n=0;r<e.length;++r,n+=3){const a=e[r];i[n]=t[a]/65536*256,i[n+1]=t[a+s]/65536*256,i[n+2]=t[a+o]/65536*256}return i}(p,d.ColorMap);break;case fl.ub.CMYK:g=function(e){const{width:t,height:r}=e,n=new Uint8Array(t*r*3);for(let t=0,r=0;t<e.length;t+=4,r+=3){const i=e[t],s=e[t+1],o=e[t+2],a=e[t+3];n[r]=(255-i)/256*255*((255-a)/256),n[r+1]=(255-s)/256*255*((255-a)/256),n[r+2]=(255-o)/256*255*((255-a)/256)}return n}(p);break;case fl.ub.YCbCr:g=function(e){const{width:t,height:r}=e,n=new Uint8ClampedArray(t*r*3);for(let t=0,r=0;t<e.length;t+=3,r+=3){const i=e[t],s=e[t+1],o=e[t+2];n[r]=i+1.402*(o-128),n[r+1]=i-.34414*(s-128)-.71414*(o-128),n[r+2]=i+1.772*(s-128)}return n}(p);break;case fl.ub.CIELab:g=function(e){const{width:t,height:r}=e,n=new Uint8Array(t*r*3);for(let t=0,r=0;t<e.length;t+=3,r+=3){let i,s,o,a=(e[t+0]+16)/116,l=(e[t+1]<<24>>24)/500+a,c=a-(e[t+2]<<24>>24)/200;l=.95047*(l*l*l>.008856?l*l*l:(l-16/116)/7.787),a=1*(a*a*a>.008856?a*a*a:(a-16/116)/7.787),c=1.08883*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),i=3.2406*l+-1.5372*a+-.4986*c,s=-.9689*l+1.8758*a+.0415*c,o=.0557*l+-.204*a+1.057*c,i=i>.0031308?1.055*i**(1/2.4)-.055:12.92*i,s=s>.0031308?1.055*s**(1/2.4)-.055:12.92*s,o=o>.0031308?1.055*o**(1/2.4)-.055:12.92*o,n[r]=255*Math.max(0,Math.min(1,i)),n[r+1]=255*Math.max(0,Math.min(1,s)),n[r+2]=255*Math.max(0,Math.min(1,o))}return n}(p);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const e=new Uint8Array(g.length/3),t=new Uint8Array(g.length/3),r=new Uint8Array(g.length/3);for(let n=0,i=0;n<g.length;n+=3,++i)e[i]=g[n],t[i]=g[n+1],r[i]=g[n+2];g=[e,t,r]}return g.width=p.width,g.height=p.height,g}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const r=this.fileDirectory.GDAL_METADATA;let n=pl(r,"Item");n=null===e?n.filter((e=>void 0===dl(e,"sample"))):n.filter((t=>Number(dl(t,"sample"))===e));for(let e=0;e<n.length;++e){const r=n[e];t[dl(r,"name")]=r.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&6===e.length)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,r=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(r)return 0===r[1]&&0===r[4]?[r[0],-r[5],r[10]]:[Math.sqrt(r[0]*r[0]+r[4]*r[4]),-Math.sqrt(r[1]*r[1]+r[5]*r[5]),r[10]];if(e){const[t,r,n]=e.getResolution();return[t*e.getWidth()/this.getWidth(),r*e.getHeight()/this.getHeight(),n*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return 1===this.geoKeys.GTRasterTypeGeoKey}getBoundingBox(e=!1){const t=this.getHeight(),r=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[e,n,i,s,o,a,l,c]=this.fileDirectory.ModelTransformation,h=[[0,0],[0,t],[r,0],[r,t]].map((([t,r])=>[s+e*t+n*r,c+o*t+a*r])),u=h.map((e=>e[0])),d=h.map((e=>e[1]));return[Math.min(...u),Math.min(...d),Math.max(...u),Math.max(...d)]}{const e=this.getOrigin(),n=this.getResolution(),i=e[0],s=e[1],o=i+n[0]*r,a=s+n[1]*t;return[Math.min(i,o),Math.min(s,a),Math.max(i,o),Math.max(s,a)]}}};class xl{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const r=this.getUint32(e,t),n=this.getUint32(e+4,t);let i;if(t){if(i=r+2**32*n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}if(i=2**32*r+n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}getInt64(e,t){let r=0;const n=(128&this._dataView.getUint8(e+(t?7:0)))>0;let i=!0;for(let s=0;s<8;s++){let o=this._dataView.getUint8(e+(t?s:7-s));n&&(i?0!==o&&(o=255&~(o-1),i=!1):o=255&~o),r+=o*256**s}return n&&(r=-r),r}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return ul(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class Cl{constructor(e,t,r,n){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=r,this._bigTiff=n}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),r=this.readUint32(e+4);let n;if(this._littleEndian){if(n=t+2**32*r,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}if(n=2**32*t+r,!Number.isSafeInteger(n))throw new Error(`${n} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return n}readInt64(e){let t=0;const r=(128&this._dataView.getUint8(e+(this._littleEndian?7:0)))>0;let n=!0;for(let i=0;i<8;i++){let s=this._dataView.getUint8(e+(this._littleEndian?i:7-i));r&&(n?0!==s&&(s=255&~(s-1),n=!1):s=255&~s),t+=s*256**i}return r&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}function _l(e){if(void 0!==Object.fromEntries)return Object.fromEntries(e);const t={};for(const[r,n]of e)t[r.toLowerCase()]=n;return t}function Il(e){return _l(e.split("\r\n").map((e=>{const t=e.split(":").map((e=>e.trim()));return t[0]=t[0].toLowerCase(),t})))}function Sl(e){let t,r,n;return e&&([,t,r,n]=e.match(/bytes (\d+)-(\d+)\/(\d+)/),t=parseInt(t,10),r=parseInt(r,10),n=parseInt(n,10)),{start:t,end:r,total:n}}class Ml{async fetch(e,t=void 0){return Promise.all(e.map((e=>this.fetchSlice(e,t))))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class Tl extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if("number"==typeof e.maxAge&&0===e.maxAge)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if("function"==typeof this.onEviction)for(const[t,r]of e)this.onEviction(t,r.value)}_deleteIfExpired(e,t){return"number"==typeof t.expiry&&t.expiry<=Date.now()&&("function"==typeof this.onEviction&&this.onEviction(e,t.value),this.delete(e))}_getOrDeleteIfExpired(e,t){if(!1===this._deleteIfExpired(e,t))return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const r=t.get(e);return this._getItemValue(e,r)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,r]=e;this.cache.has(t)||!1===this._deleteIfExpired(t,r)&&(yield e)}for(const e of this.cache){const[t,r]=e;!1===this._deleteIfExpired(t,r)&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(!1===this._deleteIfExpired(e,t))return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:r=this.maxAge}={}){const n="number"==typeof r&&r!==Number.POSITIVE_INFINITY?Date.now()+r:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:n}):this._set(e,{value:t,expiry:n}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):!!this.oldCache.has(e)&&!this._deleteIfExpired(e,this.oldCache.get(e))}peek(e){return this.cache.has(e)?this._peek(e,this.cache):this.oldCache.has(e)?this._peek(e,this.oldCache):void 0}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],r=t.length-e;r<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(r>0&&this._emitEvictions(t.slice(0,r)),this.oldCache=new Map(t.slice(r)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,r]=e;!1===this._deleteIfExpired(t,r)&&(yield[t,r.value])}for(const e of this.oldCache){const[t,r]=e;this.cache.has(t)||!1===this._deleteIfExpired(t,r)&&(yield[t,r.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const r=e[t],[n,i]=r;!1===this._deleteIfExpired(n,i)&&(yield[n,i.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const r=e[t],[n,i]=r;this.cache.has(n)||!1===this._deleteIfExpired(n,i)&&(yield[n,i.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[r,n]of this.entriesAscending())e.call(t,n,r,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}class Bl extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,Bl),this.name="AbortError"}}class Pl extends Error{constructor(e,t){super(t),this.errors=e,this.message=t,this.name="AggregateError"}}const Rl=Pl;class Dl{constructor(e,t,r=null){this.offset=e,this.length=t,this.data=r}get top(){return this.offset+this.length}}class Ll{constructor(e,t,r){this.offset=e,this.length=t,this.blockIds=r}}class kl extends Ml{constructor(e,{blockSize:t=65536,cacheSize:r=100}={}){super(),this.source=e,this.blockSize=t,this.blockCache=new Tl({maxSize:r,onEviction:(e,t)=>{this.evictedBlocks.set(e,t)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,t){const r=[],n=[],i=[];this.evictedBlocks.clear();for(const{offset:t,length:s}of e){let e=t+s;const{fileSize:o}=this;null!==o&&(e=Math.min(e,o));for(let s=Math.floor(t/this.blockSize)*this.blockSize;s<e;s+=this.blockSize){const e=Math.floor(s/this.blockSize);this.blockCache.has(e)||this.blockRequests.has(e)||(this.blockIdsToFetch.add(e),n.push(e)),this.blockRequests.has(e)&&r.push(this.blockRequests.get(e)),i.push(e)}}await async function(){return new Promise((e=>setTimeout(e,undefined)))}(),this.fetchBlocks(t);const s=[];for(const e of n)this.blockRequests.has(e)&&s.push(this.blockRequests.get(e));await Promise.allSettled(r),await Promise.allSettled(s);const o=[],a=i.filter((e=>this.abortedBlockIds.has(e)||!this.blockCache.has(e)));if(a.forEach((e=>this.blockIdsToFetch.add(e))),a.length>0&&t&&!t.aborted){this.fetchBlocks(null);for(const e of a){const t=this.blockRequests.get(e);if(!t)throw new Error(`Block ${e} is not in the block requests`);o.push(t)}await Promise.allSettled(o)}if(t&&t.aborted)throw new Bl("Request was aborted");const l=i.map((e=>this.blockCache.get(e)||this.evictedBlocks.get(e))),c=l.filter((e=>!e));if(c.length)throw new Rl(c,"Request failed");const h=new Map(function(e,t){const r=Array.isArray(e)?e:Array.from(e),n=Array.isArray(t)?t:Array.from(t);return r.map(((e,t)=>[e,n[t]]))}(i,l));return this.readSliceData(e,h)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const t=this.groupBlocks(this.blockIdsToFetch),r=this.source.fetch(t,e);for(let n=0;n<t.length;++n){const i=t[n];for(const t of i.blockIds)this.blockRequests.set(t,(async()=>{try{const e=(await r)[n],i=t*this.blockSize,s=i-e.offset,o=Math.min(s+this.blockSize,e.data.byteLength),a=e.data.slice(s,o),l=new Dl(i,a.byteLength,a,t);this.blockCache.set(t,l),this.abortedBlockIds.delete(t)}catch(r){if("AbortError"!==r.name)throw r;r.signal=e,this.blockCache.delete(t),this.abortedBlockIds.add(t)}finally{this.blockRequests.delete(t)}})())}this.blockIdsToFetch.clear()}}groupBlocks(e){const t=Array.from(e).sort(((e,t)=>e-t));if(0===t.length)return[];let r=[],n=null;const i=[];for(const e of t)null===n||n+1===e?(r.push(e),n=e):(i.push(new Ll(r[0]*this.blockSize,r.length*this.blockSize,r)),r=[e],n=e);return i.push(new Ll(r[0]*this.blockSize,r.length*this.blockSize,r)),i}readSliceData(e,t){return e.map((e=>{let r=e.offset+e.length;null!==this.fileSize&&(r=Math.min(this.fileSize,r));const n=Math.floor(e.offset/this.blockSize),i=Math.floor(r/this.blockSize),s=new ArrayBuffer(e.length),o=new Uint8Array(s);for(let s=n;s<=i;++s){const n=t.get(s),i=n.offset-e.offset;let a,l=0,c=0;i<0?l=-i:i>0&&(c=i),a=n.top-r<0?n.length-l:r-n.offset-l;const h=new Uint8Array(n.data,l,a);o.set(h,c)}return s}))}}class Ol{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class Fl{constructor(e){this.url=e}async request({headers:e,signal:t}={}){throw new Error("request is not implemented")}}class Nl extends Ol{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class Ul extends Fl{constructor(e,t){super(e),this.credentials=t}async request({headers:e,signal:t}={}){const r=await fetch(this.url,{headers:e,credentials:this.credentials,signal:t});return new Nl(r)}}class Ql extends Ol{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class Gl extends Fl{constructRequest(e,t){return new Promise(((r,n)=>{const i=new XMLHttpRequest;i.open("GET",this.url),i.responseType="arraybuffer";for(const[t,r]of Object.entries(e))i.setRequestHeader(t,r);i.onload=()=>{const e=i.response;r(new Ql(i,e))},i.onerror=n,i.onabort=()=>n(new Bl("Request aborted")),i.send(),t&&(t.aborted&&i.abort(),t.addEventListener("abort",(()=>i.abort())))}))}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}var zl=r(28625),jl=r(56504),Vl=r(6580);class ql extends Ol{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class Hl extends Fl{constructor(e){super(e),this.parsedUrl=Vl.parse(this.url),this.httpApi="http:"===this.parsedUrl.protocol?zl:jl}constructRequest(e,t){return new Promise(((r,n)=>{const i=this.httpApi.get({...this.parsedUrl,headers:e},(e=>{const t=new Promise((t=>{const r=[];e.on("data",(e=>{r.push(e)})),e.on("end",(()=>{const e=Buffer.concat(r).buffer;t(e)})),e.on("error",n)}));r(new ql(e,t))}));i.on("error",n),t&&(t.aborted&&i.destroy(new Bl("Request aborted")),t.addEventListener("abort",(()=>i.destroy(new Bl("Request aborted")))))}))}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class Wl extends Ml{constructor(e,t,r,n){super(),this.client=e,this.headers=t,this.maxRanges=r,this.allowFullFile=n,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length,Promise.all(e.map((e=>this.fetchSlice(e,t)))))}async fetchSlices(e,t){const r=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map((({offset:e,length:t})=>`${e}-${e+t}`)).join(",")}`},signal:t});if(r.ok){if(206===r.status){const{type:n,params:i}=function(e){const[t,...r]=e.split(";").map((e=>e.trim()));return{type:t,params:_l(r.map((e=>e.split("="))))}}(r.getHeader("content-type"));if("multipart/byteranges"===n){const e=function(e,t){let r=null;const n=new TextDecoder("ascii"),i=[],s=`--${t}`,o=`${s}--`;for(let t=0;t<10;++t)n.decode(new Uint8Array(e,t,s.length))===s&&(r=t);if(null===r)throw new Error("Could not find initial boundary");for(;r<e.byteLength;){const t=n.decode(new Uint8Array(e,r,Math.min(s.length+1024,e.byteLength-r)));if(0===t.length||t.startsWith(o))break;if(!t.startsWith(s))throw new Error("Part does not start with boundary");const a=t.substr(s.length+2);if(0===a.length)break;const l=a.indexOf("\r\n\r\n"),c=Il(a.substr(0,l)),{start:h,end:u,total:d}=Sl(c["content-range"]),p=r+s.length+l+4,f=parseInt(u,10)+1-parseInt(h,10);i.push({headers:c,data:e.slice(p,p+f),offset:h,length:f,fileSize:d}),r=p+f+4}return i}(await r.getData(),i.boundary);return this._fileSize=e[0].fileSize||null,e}const s=await r.getData(),{start:o,end:a,total:l}=Sl(r.getHeader("content-range"));this._fileSize=l||null;const c=[{data:s,offset:o,length:a-o}];if(e.length>1){const r=await Promise.all(e.slice(1).map((e=>this.fetchSlice(e,t))));return c.concat(r)}return c}{if(!this.allowFullFile)throw new Error("Server responded with full file");const e=await r.getData();return this._fileSize=e.byteLength,[{data:e,offset:0,length:e.byteLength}]}}throw new Error("Error fetching data.")}async fetchSlice(e,t){const{offset:r,length:n}=e,i=await this.client.request({headers:{...this.headers,Range:`bytes=${r}-${r+n}`},signal:t});if(i.ok){if(206===i.status){const e=await i.getData(),{total:t}=Sl(i.getHeader("content-range"));return this._fileSize=t||null,{data:e,offset:r,length:n}}{if(!this.allowFullFile)throw new Error("Server responded with full file");const e=await i.getData();return this._fileSize=e.byteLength,{data:e,offset:0,length:e.byteLength}}}throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function $l(e,{blockSize:t,cacheSize:r}){return null===t?e:new kl(e,{blockSize:t,cacheSize:r})}function Yl(e){switch(e){case fl.s$.BYTE:case fl.s$.ASCII:case fl.s$.SBYTE:case fl.s$.UNDEFINED:return 1;case fl.s$.SHORT:case fl.s$.SSHORT:return 2;case fl.s$.LONG:case fl.s$.SLONG:case fl.s$.FLOAT:case fl.s$.IFD:return 4;case fl.s$.RATIONAL:case fl.s$.SRATIONAL:case fl.s$.DOUBLE:case fl.s$.LONG8:case fl.s$.SLONG8:case fl.s$.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${e}`)}}function Kl(e,t,r,n){let i=null,s=null;const o=Yl(t);switch(t){case fl.s$.BYTE:case fl.s$.ASCII:case fl.s$.UNDEFINED:i=new Uint8Array(r),s=e.readUint8;break;case fl.s$.SBYTE:i=new Int8Array(r),s=e.readInt8;break;case fl.s$.SHORT:i=new Uint16Array(r),s=e.readUint16;break;case fl.s$.SSHORT:i=new Int16Array(r),s=e.readInt16;break;case fl.s$.LONG:case fl.s$.IFD:i=new Uint32Array(r),s=e.readUint32;break;case fl.s$.SLONG:i=new Int32Array(r),s=e.readInt32;break;case fl.s$.LONG8:case fl.s$.IFD8:i=new Array(r),s=e.readUint64;break;case fl.s$.SLONG8:i=new Array(r),s=e.readInt64;break;case fl.s$.RATIONAL:i=new Uint32Array(2*r),s=e.readUint32;break;case fl.s$.SRATIONAL:i=new Int32Array(2*r),s=e.readInt32;break;case fl.s$.FLOAT:i=new Float32Array(r),s=e.readFloat32;break;case fl.s$.DOUBLE:i=new Float64Array(r),s=e.readFloat64;break;default:throw new RangeError(`Invalid field type: ${t}`)}if(t!==fl.s$.RATIONAL&&t!==fl.s$.SRATIONAL)for(let t=0;t<r;++t)i[t]=s.call(e,n+t*o);else for(let t=0;t<r;t+=2)i[t]=s.call(e,n+t*o),i[t+1]=s.call(e,n+(t*o+4));return t===fl.s$.ASCII?new TextDecoder("utf-8").decode(i):i}class Jl{constructor(e,t,r){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=r}}class Xl extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class Zl{async readRasters(e={}){const{window:t,width:r,height:n}=e;let{resX:i,resY:s,bbox:o}=e;const a=await this.getImage();let l=a;const c=await this.getImageCount(),h=a.getBoundingBox();if(t&&o)throw new Error('Both "bbox" and "window" passed.');if(r||n){if(t){const[e,r]=a.getOrigin(),[n,i]=a.getResolution();o=[e+t[0]*n,r+t[1]*i,e+t[2]*n,r+t[3]*i]}const e=o||h;if(r){if(i)throw new Error("Both width and resX passed");i=(e[2]-e[0])/r}if(n){if(s)throw new Error("Both width and resY passed");s=(e[3]-e[1])/n}}if(i||s){const e=[];for(let t=0;t<c;++t){const r=await this.getImage(t),{SubfileType:n,NewSubfileType:i}=r.fileDirectory;(0===t||2===n||1&i)&&e.push(r)}e.sort(((e,t)=>e.getWidth()-t.getWidth()));for(let t=0;t<e.length;++t){const r=e[t],n=(h[2]-h[0])/r.getWidth(),o=(h[3]-h[1])/r.getHeight();if(l=r,i&&i>n||s&&s>o)break}}let u=t;if(o){const[e,t]=a.getOrigin(),[r,n]=l.getResolution(a);u=[Math.round((o[0]-e)/r),Math.round((o[1]-t)/n),Math.round((o[2]-e)/r),Math.round((o[3]-t)/n)],u=[Math.min(u[0],u[2]),Math.min(u[1],u[3]),Math.max(u[0],u[2]),Math.max(u[1],u[3])]}return l.readRasters({...e,window:u})}}class ec extends Zl{constructor(e,t,r,n,i={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=r,this.firstIFDOffset=n,this.cache=i.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const r=this.bigTiff?4048:1024;return new Cl((await this.source.fetch([{offset:e,length:void 0!==t?t:r}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,r=this.bigTiff?8:2;let n=await this.getSlice(e);const i=this.bigTiff?n.readUint64(e):n.readUint16(e),s=i*t+(this.bigTiff?16:6);n.covers(e,s)||(n=await this.getSlice(e,s));const o={};let a=e+(this.bigTiff?8:2);for(let e=0;e<i;a+=t,++e){const e=n.readUint16(a),t=n.readUint16(a+2),r=this.bigTiff?n.readUint64(a+4):n.readUint32(a+4);let i,s;const l=Yl(t),c=a+(this.bigTiff?12:8);if(l*r<=(this.bigTiff?8:4))i=Kl(n,t,r,c);else{const e=n.readOffset(c),s=Yl(t)*r;i=n.covers(e,s)?Kl(n,t,r,e):Kl(await this.getSlice(e,s),t,r,e)}s=1===r&&-1===fl.NZ.indexOf(e)&&t!==fl.s$.RATIONAL&&t!==fl.s$.SRATIONAL?i[0]:i,o[fl.$[e]]=s}const l=function(e){const t=e.GeoKeyDirectory;if(!t)return null;const r={};for(let n=4;n<=4*t[3];n+=4){const i=fl.Hm[t[n]],s=t[n+1]?fl.$[t[n+1]]:null,o=t[n+2],a=t[n+3];let l=null;if(s){if(l=e[s],null==l)throw new Error(`Could not get value of geoKey '${i}'.`);"string"==typeof l?l=l.substring(a,a+o-1):l.subarray&&(l=l.subarray(a,a+o),1===o&&(l=l[0]))}else l=a;r[i]=l}return r}(o),c=n.readOffset(e+r+t*i);return new Jl(o,l,c)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(0===e)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){if(t instanceof Xl)throw new Xl(e);throw t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(0===t.nextIFDByteOffset)throw new Xl(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new El(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(e){if(!(e instanceof Xl))throw e;t=!1}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;let t=await this.getSlice(e,130);if("GDAL_STRUCTURAL_METADATA_SIZE="===Kl(t,fl.s$.ASCII,30,e)){const r=Kl(t,fl.s$.ASCII,130,e).split("\n")[0],n=Number(r.split("=")[1].split(" ")[0])+r.length;n>130&&(t=await this.getSlice(e,n));const i=Kl(t,fl.s$.ASCII,n,e);this.ghostValues={},i.split("\n").filter((e=>e.length>0)).map((e=>e.split("="))).forEach((([e,t])=>{this.ghostValues[e]=t}))}return this.ghostValues}static async fromSource(e,t,r){const n=(await e.fetch([{offset:0,length:1024}],r))[0],i=new xl(n),s=i.getUint16(0,0);let o;if(18761===s)o=!0;else{if(19789!==s)throw new TypeError("Invalid byte order value.");o=!1}const a=i.getUint16(2,o);let l;if(42===a)l=!1;else{if(43!==a)throw new TypeError("Invalid magic number.");if(l=!0,8!==i.getUint16(4,o))throw new Error("Unsupported offset byte-size.")}const c=l?i.getUint64(8,o):i.getUint32(4,o);return new ec(e,o,l,c,t)}close(){return"function"==typeof this.source.close&&this.source.close()}}async function tc(e,t={},r){return ec.fromSource(function(e,{forceXHR:t=!1,...r}={}){return"function"!=typeof fetch||t?"undefined"!=typeof XMLHttpRequest?function(e,{headers:t={},maxRanges:r=0,allowFullFile:n=!1,...i}={}){const s=new Gl(e);return $l(new Wl(s,t,r,n),i)}(e,r):function(e,{headers:t={},maxRanges:r=0,allowFullFile:n=!1,...i}={}){const s=new Hl(e);return $l(new Wl(s,t,r,n),i)}(e,r):function(e,{headers:t={},credentials:r,maxRanges:n=0,allowFullFile:i=!1,...s}={}){const o=new Ul(e,r);return $l(new Wl(o,t,n,i),s)}(e,r)}(e,t),r)}const rc=new s.TextureLoader;function nc(e){if(!e.ok){const t=new Error(`Error loading ${e.url}: status ${e.status}`);throw t.response=e,t}}const ic=function(e){return fetch(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).then((e=>(nc(e),e.arrayBuffer())))},sc={text(e){return fetch(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).then((e=>(nc(e),e.text())))},json(e){return fetch(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).then((e=>(nc(e),e.json())))},xml(e){return fetch(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).then((e=>(nc(e),e.text()))).then((e=>(new window.DOMParser).parseFromString(e,"text/xml")))},texture(e){let t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};rc.crossOrigin=n.crossOrigin;const i=new Promise(((e,n)=>{t=e,r=n}));return rc.load(e,t,(()=>{}),(t=>{const n=new Error(`Failed to load texture from URL: \`${e}\``);n.originalEvent=t,r(n)})),i},arrayBuffer:ic,textureFloat(e){return ic(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).then((t=>{if(t.byteLength!==65536*Float32Array.BYTES_PER_ELEMENT)throw new Error(`Invalid float data from URL: \`${e}\``);const r=new Float32Array(t),n=new s.DataTexture(r,256,256,s.RedFormat,s.FloatType);return n.internalFormat="R32F",n.needsUpdate=!0,n}))},geotiff:e=>tc(e,{allowFullFile:!0}).then((e=>e.getImage())),multiple(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=[];let i;for(const s in t){if(!this[s])throw new Error(`${s} is not a valid Fetcher method.`);for(const o of t[s])i=`${e}.${o}`,n.push(this[s](i,r).then((e=>({type:o,result:e}))))}return Promise.all(n).then((e=>{const t={};for(const r of e)t[r.type]=r.result;return Promise.resolve(t)}))},get(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const[t,r]=e.split("/");switch(t){case"application":switch(r){case"geo+json":case"json":return this.json;case"kml":case"gpx":return this.xml;case"x-protobuf;type=mapbox-vector":case"gtx":return this.arrayBuffer;default:return this.text}case"image":switch(r){case"geotiff":return this.geotiff;case"x-bil;bits=32":return this.textureFloat;default:return this.texture}default:return this.texture}}},oc=new Map([["application/geo+json",ds.parse],["application/json",ds.parse],["application/kml",oo.parse],["application/gpx",fo.parse],["application/x-protobuf;type=mapbox-vector",ea.parse],["application/gtx",ho.parse],["application/isg",go.parse],["application/gdf",po.parse],["image/geotiff",co.parse]]),ac={get:()=>{},set:e=>e,clear:()=>{}};let lc=0;const cc=class{constructor(e){if(e.projection&&(console.warn("Source projection parameter is deprecated, use crs instead."),e.crs=e.crs||e.projection),e.crs&&i.tC.isValid(e.crs),this.crs=e.crs,this.isSource=!0,!e.url)throw new Error("New Source: url is required");this.uid=lc++,this.url=e.url,this.format=e.format,this.fetcher=e.fetcher||sc.get(e.format),this.parser=e.parser||oc.get(e.format)||((e,t)=>(e.extent=t.extent,e)),this.isVectorSource=null!=(e.parser||oc.get(e.format)),this.networkOptions=e.networkOptions||{crossOrigin:"anonymous"},this.attribution=e.attribution,this.whenReady=Promise.resolve(),this._featuresCaches={},e.extent&&!e.extent.isExtent?this.extent=new i.zR(this.crs).setFromExtent(e.extent):this.extent=e.extent}handlingError(e){throw new Error(e)}urlFromExtent(){throw new Error("In extended Source, you have to implement the method urlFromExtent!")}getDataKey(e){return`z${e.zoom}r${e.row}c${e.col}`}loadData(e,t){const r=this._featuresCaches[t.crs],n=this.getDataKey(e);let i=r.get(n);return i||(i=this.fetcher(this.urlFromExtent(e),this.networkOptions).then((r=>this.parser(r,{out:t,in:this,extent:e}))).catch((e=>this.handlingError(e))),r.set(n,i)),i}onLayerAdded(e){this._featuresCaches[e.out.crs]||(this._featuresCaches[e.out.crs]=this.isVectorSource?new oe({max:500}):ac)}onLayerRemoved(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=this._featuresCaches[e.unusedCrs];t&&(t.clear(),delete this._featuresCaches[e.unusedCrs])}extentInsideLimit(){throw new Error("In extented Source, you have to implement the method extentInsideLimit!")}};class hc extends s.EventDispatcher{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{source:r,name:n,subdivisionThreshold:i=256,cacheLifeTime:s,options:o={},zoom:a,crs:l}=t;if(super(),this.isLayer=!0,this.id=e,Object.defineProperty(this,"id",{writable:!1}),this.name=n,void 0===r||!0===r)throw new Error(`Layer ${e} needs Source`);this.source=r||new cc({url:"none"}),this.crs=l,this.subdivisionThreshold=i,this.sizeDiagonalTexture=(this.subdivisionThreshold*this.subdivisionThreshold*2)**.5,this.options=o,this.defineLayerProperty("frozen",!1),this.zoom={min:a?.min??0,max:a?.max??1/0},this.info=new Se(this),this.ready=!1,this._promises=[],this.whenReady=new Promise(((e,t)=>{this._resolve=e,this._reject=t})).then((()=>(this.ready=!0,this.source.onLayerAdded({out:this}),this))),this._promises.push(this.source.whenReady),this.cache=new oe({max:500,...s!==1/0&&{ttl:s}})}addInitializationStep(){let e;return this._promises.push(new Promise((t=>{e=t}))),e}async startup(){try{await Promise.all(this._promises),this._resolve()}catch(e){this._reject(e)}}defineLayerProperty(e,t,r){const n=Object.getOwnPropertyDescriptor(this,e);if(!n||!n.set){let n=null==this[e]?t:this[e];Object.defineProperty(this,e,{get:()=>n,set:t=>{if(n!==t){const i={type:`${e}-property-changed`,previous:{},new:{}};i.previous[e]=n,i.new[e]=t,n=t,r&&r(this,e),this.dispatchEvent(i)}}})}}convert(e){return e}getData(e,t){const r=this.source.getDataKey(this.source.isVectorSource?t:e);let n=this.cache.get(r);return n||(n=this.source.loadData(e,this).then((e=>this.convert(e,t)),(e=>{throw e})),this.cache.set(r,n)),n}delete(){console.warn("Function delete doesn't exist for this layer")}}const uc=hc,dc=new s.Vector4;function pc(e,t){let r;for(let n=0;n<=e;n++){const e=n*n;for(let i=-n;i<=n;i++){const s=i*i;for(let o=-n;o<=n;o++){const n=s+o*o;if(!(n>e||n<=r||!1!==t(i,o)))return}}r=e}}function fc(e){return e.layer?e.layer:e.parent?fc(e.parent):void 0}const gc=new s.Raycaster,Ac=new s.Vector2,mc=new s.Vector3,yc=new i.E$("EPSG:4978"),vc=new s.Vector3,wc=new i.E$("EPSG:4978"),bc={pickTilesAt(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];const o=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const i=e.mainLoop.gfxEngine.getWindowSize();r=r||new s.Vector2(Math.floor(i.x/2),Math.floor(i.y/2));const o=t.level0Nodes.map((e=>Y.push(e,Y.MODES.ID))),a=e.mainLoop.gfxEngine.renderViewToBuffer({camera:e.camera,scene:t.object3d},{x:r.x-n,y:r.y-n,width:1+2*n,height:1+2*n});o.forEach((e=>e()));const l=[];return pc(n,((e,t)=>{const r=4*(2*t*n+e),i=a.slice(r,r+4||void 0);dc.fromArray(i).divideScalar(255);const s=ge(dc,256**3),o=Math.round(s);l.includes(o)||l.push(o)})),l}(e,n,t,r),a=e=>{o.includes(e.id)&&e.isTileMesh&&i.push({object:e,layer:n})};for(const e of n.level0Nodes)e.traverse(a);return i},pickPointsAt(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];if(!n.root)return;n.object3d.traverse((e=>{e.isPoints&&e.baseId&&e.material.enablePicking(!0)}));const s=e.mainLoop.gfxEngine.renderViewToBuffer({camera:e.camera,scene:n.object3d},{x:t.x-r,y:t.y-r,width:1+2*r,height:1+2*r}),o=[];return pc(r,((e,t)=>{const n=4*((t+r)*(2*r+1)+(e+r)),i=s.slice(n,n+4),a={objId:i[0]<<8|i[1],index:i[2]<<8|i[3]};for(let e=0;e<o.length;e++)if(o[e].objId==a.objId&&o[e].index==a.index)return;o.push(a)})),n.object3d.traverse((t=>{if(t.isPoints&&t.baseId){if(t.material.enablePicking(!1),!t.geometry||!t.geometry.attributes||!t.geometry.attributes.position)return;for(let r=0;r<o.length;r++)if(o[r].objId==t.baseId){mc.fromBufferAttribute(t.geometry.attributes.position,o[r].index),t.localToWorld(mc),yc.setCrs(e.referenceCrs),yc.setFromVector3(mc),e.camera3D.getWorldPosition(vc),wc.setCrs(e.referenceCrs),wc.setFromVector3(vc);const s=yc.spatialEuclideanDistanceTo(wc);i.push({object:t,point:mc.clone(),index:o[r].index,distance:s,layer:n})}}})),i},pickObjectsAt(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];if(e.viewToNormalizedCoords(t,Ac),r<0){gc.setFromCamera(Ac,e.camera3D);const t=gc.intersectObject(n,!0);for(const e of t)e.layer=fc(e.object),i.push(e);return i}const o={x:t.x-r,y:t.y-r,width:1+2*r,height:1+2*r},a=e.mainLoop.gfxEngine.renderViewToBuffer({scene:n,camera:e.camera},o),l=new s.Color;e.mainLoop.gfxEngine.renderer.getClearColor(l);const c=Math.round(255*l.r),h=Math.round(255*l.g),u=Math.round(255*l.b),d=Ac.clone();return pc(r,((t,s)=>{const o=4*((s+r)*(2*r+1)+(t+r)),l=a[o],p=a[o+1],f=a[o+2];if(Math.abs(c-l)<=1&&Math.abs(h-p)<=1&&Math.abs(u-f)<=1)return;d.setX(Ac.x+t/e.camera.width).setY(Ac.y+s/e.camera.height),gc.setFromCamera(d,e.camera3D);const g=gc.intersectObject(n,!0);for(const e of g)e.layer=fc(e.object),i.push(e);return 0==i.length})),i}},Ec={INFINITE:1/0,TEXTURE:9e5,GEOMETRY:9e5};function xc(e){e.dispose();for(const t of Object.keys(e)){const r=e[t];r&&r.isTexture&&r.dispose()}}const Cc={cleanup(e){if(e.layer=null,e.isScene||"function"!=typeof e.dispose){if(e.geometry&&e.geometry.dispose(),e.material)if(Array.isArray(e.material))for(const t of e.material)xc(t);else xc(e.material);e.dispatchEvent({type:"dispose"})}else e.dispose()},removeChildren(e,t){const r=t.children.filter((t=>(t.layer&&t.layer.id)===e.id));return t.remove(...r),r},removeChildrenAndCleanup(e,t){const r=t.children.filter((t=>(t.layer&&t.layer.id)===e.id));return t.remove(...r),t.layer===e&&this.cleanup(t),r},removeChildrenAndCleanupRecursively(e,t){let r=t.children.filter((t=>t.layer&&t.layer.id===e.id));const n=t.link&&t.link[e.id];n?.children.length&&(r=r.concat(n.children),delete t.link[e.id]);for(const t of r)this.removeChildrenAndCleanupRecursively(e,t);return t.remove(...r),t.layer&&t.layer.id===e.id&&this.cleanup(t),r}},_c=class extends uc{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{cacheLifeTime:n=Ec.GEOMETRY,visible:i=!0,opacity:s=1,...o}=r;if(super(e,{...o,cacheLifeTime:n}),this.isGeometryLayer=!0,!t||!t.isObject3D)throw new Error("Missing/Invalid object3d parameter (must be a\n                three.js Object3D instance)");"Group"===t.type&&""===t.name&&(t.name=e),this.object3d=t,Object.defineProperty(this,"object3d",{writable:!1,configurable:!0}),this.opacity=s,this.wireframe=!1,this.attachedLayers=[],this.visible=i,Object.defineProperty(this.zoom,"max",{value:1/0,writable:!1}),this.filteringExtent=!this.source.isFileSource,this.structure="3d"}get visible(){return this.object3d.visible}set visible(e){if(this.object3d.visible!==e){const t={type:"visible-property-changed",previous:{},new:{}};t.previous.visible=this.object3d.visible,t.new.visible=e,this.dispatchEvent(t),this.object3d.visible=e}}getObjectToUpdateForAttachedLayers(e){if(e.parent&&e.material)return{element:e,parent:e.parent}}postUpdate(){}culling(){return!0}attach(e){if(!e.update)throw new Error(`Missing 'update' function -> can't attach layer\n                ${e.id}`);this.attachedLayers.push(e),e.parent=this}detach(e){const t=this.attachedLayers.length;return this.attachedLayers=this.attachedLayers.filter((t=>t.id!=e.id)),e.parent=void 0,this.attachedLayers.length<t}delete(e){e&&this.cache.clear(),this.parent&&Cc.removeChildrenAndCleanupRecursively(this,this.parent.object3d),this.object3d.parent&&this.object3d.parent.remove(this.object3d),Cc.removeChildrenAndCleanupRecursively(this,this.object3d)}pickObjectsAt(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.defaultPickingRadius,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return bc.pickObjectsAt(e,t,r,this.object3d,n)}},Ic=[1,3,7,60],Sc=class{constructor(){this.state=0,this.lastErrorTimestamp=0,this.errorCount=0,this.failureParams={lowestLevelError:1/0}}hasFinished(){return 4==this.state}canTryUpdate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();switch(this.state){case 0:return!0;case 3:case 1:case 4:return!1;default:return 1e3*this.secondsUntilNextTry()<=e-this.lastErrorTimestamp}}secondsUntilNextTry(){if(2!==this.state)return 0;const e=Math.max(0,Math.min(this.errorCount,Ic.length)-1);return Ic[e]}newTry(){this.state=1}success(){this.lastErrorTimestamp=0,this.state=0}noMoreUpdatePossible(){this.state=4}noData(e){this.state=0,this.failureParams.lowestLevelError=Math.min(e.targetLevel,this.failureParams.lowestLevelError)}failure(e,t,r){r&&null!=r.targetLevel&&(this.failureParams.lowestLevelError=Math.min(r.targetLevel,this.failureParams.lowestLevelError)),this.lastErrorTimestamp=e,this.state=t?3:2,this.errorCount++}inError(){return 3==this.state||2==this.state}};function Mc(e){return e?.attachedLayers.filter((e=>e.isGeoidLayer))[0]?.visible}const Tc=class extends uc{constructor(e){super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.isGeoidLayer=!0,this.defineLayerProperty("visible",!0)}updateNodeZ(e){e.material.geoidHeight=this.visible?e.geoidHeight:0,e.obb.updateZ({geoidHeight:e.material.geoidHeight})}update(e,t,r,n){if(!n||!r.material)return;const i=r.getExtentsByProjection(t.crs),s=i[0].zoom;if(!(s>t.zoom.max||s<t.zoom.min)){if(void 0===r.layerUpdateState[t.id]){r.layerUpdateState[t.id]=new Sc;const e=()=>this.updateNodeZ(r);t.addEventListener("visible-property-changed",e),r.addEventListener("dispose",(()=>{t.removeEventListener("visible-property-changed",e)}))}if(!t.frozen&&t.visible&&r.material.visible&&r.layerUpdateState[t.id].canTryUpdate())return r.layerUpdateState[t.id].newTry(),this.getData(r.extent,i).then((e=>{r.geoidHeight=e.getHeightAtCoordinates(r.extent.center()),this.updateNodeZ(r),r.layerUpdateState[t.id].noMoreUpdatePossible()}))}}},Bc=new s.Vector2,Pc=new s.Vector2,Rc={row:0,col:0,invDiff:0};function Dc(e,t){const r=2**(e.zoom-t);return Rc.invDiff=1/r,Rc.row=(e.row-e.row%r)*Rc.invDiff,Rc.col=(e.col-e.col%r)*Rc.invDiff,Rc}const Lc=new i.zR("EPSG:4326"),kc=new i.zR("EPSG:4326"),Oc=new i.E$("EPSG:4326",0,0);class Fc{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.isTile=!0,this.crs=e,this.zoom=t,this.row=r,this.col=n}clone(){return new Fc(this.crs,this.zoom,this.row,this.col)}toExtent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new i.zR("EPSG:4326");i.tC.isValid(e);const{epsg:r,globalExtent:n,globalDimension:s}=Ho(this.crs),o=Wo(this.crs,this.zoom);return Pc.set(1,1).divide(o).multiply(s),t.west=n.west+(s.x-Pc.x*(o.x-this.col)),t.east=t.west+Pc.x,t.south=n.south+Pc.y*(o.y-this.row-1),t.north=t.south+Pc.y,t.crs=r,e==r?t:t.as(e,t)}isInside(e){if(this.zoom==e.zoom)return this.row==e.row&&this.col==e.col;if(this.zoom<e.zoom)return!1;{const t=Dc(this,e.zoom);return t.row==e.row&&t.col==e.col}}offsetToParent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Vector4;if(this.crs!=e.crs)throw new Error("unsupported mix");const r=Dc(this,e.zoom);return t.set(this.col*r.invDiff-r.col,this.row*r.invDiff-r.row,r.invDiff,r.invDiff)}tiledExtentParent(e){if(e&&e<this.zoom){const t=Dc(this,e);return new Fc(this.crs,e,t.row,t.col)}return this}set(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.zoom=e,this.row=t,this.col=r,this}copy(e){return this.crs=e.crs,this.set(e.zoom,e.row,e.col)}toString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.zoom}${e}${this.row}${e}${this.col}`}}function Nc(e,t){if("EPSG:4326"==e.crs&&"EPSG:3857"==t){const r=[],n=Lc.copy(e).as(t,kc),{globalExtent:i,globalDimension:s,sTs:o}=Ho(t);n.clampByExtent(i),n.planarDimensions(Pc);const a=Math.floor(Math.log2(Math.round(s.x/(Pc.x*o.x)))),l=Wo(t,a),c=n.center(Oc);Bc.x=c.x-i.west,Bc.y=i.north-n.north,Bc.divide(s).multiply(l).floor();for(let e=Math.ceil((i.north-n.south)/s.x*l.y)-1;e>=Bc.y;e--)r.push(new Fc(t,a,e,Bc.x));return r}{const r=new Fc(t,0,0,0),{globalExtent:n,globalDimension:i,sTs:s,isInverted:o}=Ho(e.crs),a=e.center(Oc);e.planarDimensions(Pc);const l=Math.floor(Math.log2(Math.round(i.x/(Pc.x*s.x)))),c=Wo(t,l);return Bc.x=a.x-n.west,Bc.y=o?n.north-a.y:a.y-n.south,Bc.divide(i).multiply(c).floor(),r.set(l,Bc.y,Bc.x),[r]}}const Uc=Fc;class Qc extends s.Mesh{_tms=(()=>new Map)();constructor(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(super(e,t),!n)throw new Error("extent is mandatory to build a TileMesh");this.layer=r,this.extent=n,this.level=i,this.material.setUniform("objectId",this.id),this.obb=this.geometry.OBB.clone(),this.boundingSphere=new s.Sphere,this.obb.box3D.getBoundingSphere(this.boundingSphere);for(const e of r.tileMatrixSets)this._tms.set(e,Nc(this.extent,e));this.frustumCulled=!1,this.matrixAutoUpdate=!1,this.layerUpdateState={},this.isTileMesh=!0,this.geoidHeight=0,this.link={};let o=!0;Object.defineProperty(this,"visible",{get:()=>o,set(e){o!=e&&(o=e,this.dispatchEvent({type:e?"shown":"hidden"}))}})}setBBoxZ(e){e.geoidHeight=Mc(this.layer)?this.geoidHeight:0,this.obb.updateZ(e),this.horizonCullingPointElevationScaled&&this.horizonCullingPoint&&this.horizonCullingPointElevationScaled.setLength(this.obb.z.delta+this.horizonCullingPoint.length()),this.obb.box3D.getBoundingSphere(this.boundingSphere)}getExtentsByProjection(e){return this._tms.get(e)}findCommonAncestor(e){if(e)return e.level==this.level?e.id==this.id?e:0!=e.level?this.parent?.findCommonAncestor(e.parent):void 0:e.level<this.level?this.parent?.findCommonAncestor(e):this.findCommonAncestor(e.parent)}onBeforeRender(e){this.material.layersNeedUpdate&&this.material.updateLayersUniforms(e)}}const Gc=Qc;function zc(e,t){return 3*(e*e*2+(t?0:4*e*2))}function jc(e,t,r,n){e[2*t+0]=r,e[2*t+1]=n}function Vc(e){return(t,r)=>{t[r]=e}}function qc(e,t,r){const n=Math.max(2,t.segments),i=n+1,o=i**2,a=o+(t.disableSkirt?0:4*n);if(a>2**32)throw new Error("Tile segments count is too big");const l=function(e,t,r,n,i){const{index:s,skirt:o}=function(e,t,r,n){const i=zc(t,r.disableSkirt),s=function(e){let t=null;if(e<256)t=Uint8Array;else if(e<65536)t=Uint16Array;else{if(!(e<2**32))throw new Error("Value is too high");t=Uint32Array}return t}(e),o=i,a=4*t;if(void 0!==n)return{index:n,skirt:n.subarray(o,o+a)};const l=new s(new ArrayBuffer((o+(r.disableSkirt?0:a))*s.BYTES_PER_ELEMENT)),c=r.disableSkirt?void 0:l.subarray(o,o+a);return{index:l,skirt:c}}(e,t,n,i?.index);return{index:s,skirt:o,position:new Float32Array(3*e),normal:new Float32Array(3*e),uvs:[i?.uv??new Float32Array(2*e),void 0!==r.computeExtraOffset?new Float32Array(e):void 0]}}(a,n,e,t,r),c=[void 0===r?jc:()=>{}],h=e.prepare(t);for(let r=0;r<=n;r++){const s=r/n;h.coordinates.y=e.vProject(s,t.extent),void 0!==e.computeExtraOffset&&(c[1]=Vc(e.computeExtraOffset(h)));for(let t=0;t<=n;t++){const o=t/n,a=3*(r*i+t);h.coordinates.x=e.uProject(o,h.extent);const u=e.vertexPosition(h.coordinates),d=e.vertexNormal();if(u.sub(h.center),"quatNormalToZ"in h){const e=h.quatNormalToZ;u.applyQuaternion(e),d.applyQuaternion(e)}u.toArray(l.position,a),d.toArray(l.normal,a);for(const[e,n]of c.entries())void 0!==n&&n(l.uvs[e],r*i+t,o,s)}}if(void 0===r&&!h.disableSkirt){for(let e=0;e<i;e++)l.skirt[e]=e,l.skirt[2*i-2+e]=i**2-(e+1);for(let e=1;e<i-1;e++)l.skirt[i-1+e]=e*i+(i-1),l.skirt[3*i-3+e]=i*(i-1-e)}function u(e,t,r,n){l.index[e+0]=t,l.index[e+1]=r,l.index[e+2]=n}if(void 0===r)for(let e=0;e<n;e++)for(let t=0;t<n;t++){const r=e*i+t,s=(e+1)*i+t,o=(e+1)*i+(t+1),a=6*(e*n+t);u(a,o,r,e*i+(t+1)),u(a+3,o,s,r)}if(!t.disableSkirt){const e=(new s.Vector3).fromArray(l.position).distanceTo((new s.Vector3).fromArray(l.position,3)),t=void 0===r?{index:(e,t,r,n,i)=>(u(e,t,r,n),u(e+3,t,n,i),e+6),uv:(e,t,r)=>{e[2*t+0]=e[2*r+0],e[2*t+1]=e[2*r+1]}}:{index:()=>{},uv:()=>{}},i=o;for(let r=0;r<l.skirt.length;r++){const s=l.skirt[r],o=3*(i+r),a=3*s;l.position[o+0]=l.position[a+0]-l.normal[a+0]*e,l.position[o+1]=l.position[a+1]-l.normal[a+1]*e,l.position[o+2]=l.position[a+2]-l.normal[a+2]*e,l.normal[o+0]=l.normal[a+0],l.normal[o+1]=l.normal[a+1],l.normal[o+2]=l.normal[a+2],t.uv(l.uvs[0],i+r,s),void 0!==l.uvs[1]&&(l.uvs[1][i+r]=l.uvs[1][s]);const c=(r+1)%l.skirt.length,h=i+r,u=0===c?i:i+r+1,d=l.skirt[c];t.index(6*n**2+6*r,s,h,u,d)}}return{index:l.index,position:l.position,uvs:l.uvs,normal:l.normal}}class Hc extends s.BufferGeometry{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){const r={disableSkirt:!1,hideSkirt:!1,buildIndexAndUv_0:!0,segments:16,coordinates:new i.E$(e.crs),center:e.center(t.extent).clone(),...t},n=qc(e,r);return{index:n.index?new s.BufferAttribute(n.index,1):null,uvs:[...n.uvs[0]?[new s.BufferAttribute(n.uvs[0],2)]:[],...n.uvs[1]?[new s.BufferAttribute(n.uvs[1],1)]:[]],position:new s.BufferAttribute(n.position,3),normal:new s.BufferAttribute(n.normal,3)}}(e,t);super(),this.extent=t.extent,this.segments=t.segments,this.setIndex(r.index),this.setAttribute("position",r.position),this.setAttribute("normal",r.normal),this.setAttribute("uv",r.uvs[0]);for(let e=1;e<r.uvs.length;e++)this.setAttribute(`uv_${e}`,r.uvs[e]);this.computeBoundingBox(),this.OBB=null,this.hideSkirt=t.hideSkirt??!1,this._refCount=null}set hideSkirt(e){this.setDrawRange(0,zc(this.segments,e))}initRefCount(e,t){null===this._refCount&&(this._refCount={count:0,fn:()=>{this._refCount.count--,this._refCount.count<=0&&(this.index=null,delete this.attributes.uv,e.delete(t),super.dispose())}})}increaseRefCount(){if(null===this._refCount)throw new Error("[TileGeometry::increaseRefCount] Tried to increment an unitialized reference count.");this._refCount.count++}get refCount(){return this._refCount?.count}dispose(){null==this._refCount?super.dispose():this._refCount.fn()}}const Wc=Math.PI/4,$c=1/(2*Math.PI),Yc=new s.Vector3(0,0,1),Kc=new s.Vector3(0,1,0),Jc=new s.Quaternion,Xc=new s.Quaternion,Zc=new s.Quaternion;function eh(e){return 1-(.5-Math.log(Math.tan(Wc+.5*s.MathUtils.degToRad(e)))*$c)}class th{static _crs="EPSG:4978";static _computeExtraOffset(e){const t=eh(e.coordinates.latitude)*e.nbRow;return(isFinite(t)?t:0)-e.deltaUV1}get crs(){return th._crs}constructor(e){this._transform={coords:[new i.E$("EPSG:4326",0,0),new i.E$("EPSG:4326",0,0)],position:new s.Vector3,dimension:new s.Vector2},e.uvCount>1&&(this.computeExtraOffset=th._computeExtraOffset)}prepare(e){const t=2**(e.level+1);let r=eh(e.extent.south);isFinite(r)||(r=0);const n={nbRow:t,deltaUV1:(r-r%(1/t))*t,quatNormalToZ:Zc.setFromAxisAngle(Kc,-(.5*Math.PI-s.MathUtils.degToRad(e.extent.center().latitude))),coordinates:new i.E$(this.crs)};return e.extent.planarDimensions(this._transform.dimension),{...e,...n}}center(e){return e.center(this._transform.coords[0]).as(this.crs,this._transform.coords[1]).toVector3()}vertexPosition(e){return this._transform.coords[0].setFromValues(e.x,e.y).as(this.crs,this._transform.coords[1]).toVector3(this._transform.position)}vertexNormal(){return this._transform.coords[1].geodesicNormal}uProject(e,t){return t.west+e*this._transform.dimension.x}vProject(e,t){return t.south+e*this._transform.dimension.y}computeShareableExtent(e){const t=Math.abs(e.west-e.east)/2,r=new i.zR(e.crs,-t,t,e.south,e.north),n=s.MathUtils.degToRad(e.west-r.west),o=s.MathUtils.degToRad(90-e.center(this._transform.coords[0]).latitude);return Jc.setFromAxisAngle(Yc,n),Xc.setFromAxisAngle(Kc,o),Jc.multiply(Xc),{shareableExtent:r,quaternion:Jc.clone(),position:this.center(e)}}}const rh=new th({uvCount:1}),nh=new s.Vector3,ih=new s.Vector2,sh=new s.Vector3,oh=new i.E$("EPSG:4326",0,0,0);let ah;class lh extends s.Object3D{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new s.Vector3(1/0,1/0,1/0),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Vector3(-1/0,-1/0,-1/0);super(),this.box3D=new s.Box3(e.clone(),t.clone()),this.natBox=this.box3D.clone(),this.z={min:0,max:0,scale:1,delta:0}}copy(e){return super.copy(e),this.box3D.copy(e.box3D),this.natBox.copy(e.natBox),this.z.min=e.z.min,this.z.max=e.z.max,this.z.scale=e.z.scale,this}updateZ(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.z.min=e.min??this.z.min,this.z.max=e.max??this.z.max,this.z.scale=e.scale&&e.scale>0?e.scale:this.z.scale,this.z.delta=Math.abs(this.z.max-this.z.min)*this.z.scale;const t=e.geoidHeight||0;this.box3D.min.z=this.natBox.min.z+this.z.min*this.z.scale+t,this.box3D.max.z=this.natBox.max.z+this.z.max*this.z.scale+t}isSphereAboveXYBox(e){const t=this.worldToLocal(e.center),r=Math.max(this.box3D.min.x,Math.min(t.x,this.box3D.max.x)),n=Math.max(this.box3D.min.y,Math.min(t.y,this.box3D.max.y));return Math.sqrt((r-t.x)*(r-t.x)+(n-t.y)*(n-t.y))<e.radius}setFromExtent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if("EPSG:4326"==e.crs){const{shareableExtent:n,quaternion:i,position:s}=rh.computeShareableExtent(e),o=Math.max(Math.floor(n.planarDimensions(ih).x/90+1),2),a=new Hc(rh,{extent:n,level:0,segments:o,disableSkirt:!0});a.boundingBox&&(ah.box3D.copy(a.boundingBox),ah.natBox.copy(a.boundingBox),this.copy(ah)),this.updateZ({min:t,max:r}),this.position.copy(s),this.quaternion.copy(i),this.updateMatrixWorld(!0)}else{if(!i.tC.isMetricUnit(e.crs))throw new Error("Unsupported extent crs");e.center(oh).toVector3(this.position),e.planarDimensions(ih),nh.set(ih.x,ih.y,Math.abs(r-t)),this.box3D.setFromCenterAndSize(sh,nh),this.updateMatrixWorld(!0)}return this}}ah=new lh;const ch=lh,hh=new Map,uh=new oe({max:500}),dh=function(e,t){if(t&&t.isGeometryLayer){let r;e.layer=t,e.uniforms&&null!=e.uniforms.opacity?(r=e.uniforms.opacity.value,Object.defineProperty(e.uniforms.opacity,"value",{get:()=>e.layer.opacity*r,set:e=>{r=e}})):null!=e.opacity&&(r=e.opacity,Object.defineProperty(e,"opacity",{get:()=>e.layer.opacity*r,set:e=>{r=e}})),e.uniforms&&null!=e.uniforms.mode&&Object.defineProperty(e.uniforms.mode,"value",{get:()=>e.layer.pntsMode}),e.uniforms&&null!=e.uniforms.shape&&Object.defineProperty(e.uniforms.shape,"value",{get:()=>e.layer.pntsShape}),e.uniforms&&null!=e.uniforms.sizeMode&&Object.defineProperty(e.uniforms.sizeMode,"value",{get:()=>e.layer.pntsSizeMode}),e.uniforms&&null!=e.uniforms.minAttenuatedSize&&Object.defineProperty(e.uniforms.minAttenuatedSize,"value",{get:()=>e.layer.pntsMinAttenuatedSize}),e.uniforms&&null!=e.uniforms.maxAttenuatedSize&&Object.defineProperty(e.uniforms.maxAttenuatedSize,"value",{get:()=>e.layer.pntsMaxAttenuatedSize}),e.uniforms&&null!=e.uniforms.scale&&Object.defineProperty(e.uniforms.scale,"value",{get:()=>e.layer.scale});let n=e.wireframe;Object.defineProperty(e,"wireframe",{get:()=>e.layer.wireframe||n,set:e=>{n=e}});let i=e.transparent,s=i;Object.defineProperty(e,"transparent",{get:()=>{const t=e.layer.opacity<1||i;return t!==s&&(e.needsUpdate=!0,s=t),t},set:e=>{i=e}})}return e},ph=new s.Vector2,fh={convert(e,t,r){const n=r.builder,i=e,o=void 0!==i?i.level+1:0,a={extent:t,level:o,segments:r.segments||16,disableSkirt:r.disableSkirt,hideSkirt:r.hideSkirt};return function(e,t){const{shareableExtent:r,quaternion:n,position:i}=e.computeShareableExtent(t.extent),o=r.south.toFixed(6),a=`${e.crs}_${t.disableSkirt?0:1}_${t.segments}`,l=`s${o}l${t.level}bK${a}`;let c=uh.get(l);if(!c){let o;c=new Promise((e=>{o=e})),uh.set(l,c),t.extent=r;const h=e.center(t.extent).clone();let u,d=hh.get(a);try{u=qc(e,{...t,center:h},void 0!==d?{index:d.index.array,uv:d.uv.array}:void 0)}catch(e){return Promise.reject(e)}d||(d={index:new s.BufferAttribute(u.index,1),uv:new s.BufferAttribute(u.uvs[0],2)},hh.set(a,d));const p={index:d.index,uvs:[d.uv,...void 0!==u.uvs[1]?[new s.BufferAttribute(u.uvs[1],1)]:[]],position:new s.BufferAttribute(u.position,3),normal:new s.BufferAttribute(u.normal,3)},f=new Hc(e,t,p);return f.OBB=new ch(f.boundingBox.min,f.boundingBox.max),f.initRefCount(uh,l),o(f),Promise.resolve({geometry:f,quaternion:n,position:i})}return c.then((e=>({geometry:e,quaternion:n,position:i})))}(n,a).then((e=>{e.geometry.increaseRefCount();const a=r.tileMatrixSets.length,l=new Ie(r.materialOptions,a);dh(l,r);const c=new Gc(e.geometry,l,r,t,o);if(i&&i.isTileMesh){const t=n.computeShareableExtent(i.extent);e.position.sub(t.position).applyQuaternion(t.quaternion.invert()),e.quaternion.premultiply(t.quaternion)}if(c.position.copy(e.position),c.quaternion.copy(e.quaternion),c.visible=!1,c.updateMatrix(),function(e,t){if(t.diffuse&&e.material.setUniform("diffuse",t.diffuse),t.isGlobeLayer){e.horizonCullingPoint=e.extent.center().as("EPSG:4978").toVector3(),e.extent.planarDimensions(ph).multiplyScalar(s.MathUtils.DEG2RAD);const t=ph.length(),r=Math.abs(1/Math.cos(.5*t));e.horizonCullingPoint.setLength(r*e.horizonCullingPoint.length()),e.horizonCullingPointElevationScaled=e.horizonCullingPoint.clone()}}(c,r),i){c.geoidHeight=i.geoidHeight;const e=Mc(r)?c.geoidHeight:0;c.setBBoxZ({min:i.obb.z.min,max:i.obb.z.max,geoidHeight:e}),c.material.setUniform("geoidHeight",e)}return c}))}},gh=new s.Vector3,Ah=new s.Vector3;class mh extends _c{constructor(e,t,r,n,i){const{sseSubdivisionThreshold:s=1,minSubdivisionLevel:o,maxSubdivisionLevel:a,maxDeltaElevationLevel:l,tileMatrixSets:c,diffuse:h,showOutline:u=!1,segments:d,disableSkirt:p=!1,materialOptions:f={},...g}=i;if(super(e,t,{...g,cacheLifeTime:Ec.INFINITE,source:!1}),this.isTiledGeometryLayer=!0,this.protocol="tile",this.object3d.geoidHeight=0,this.disableSkirt=p,this._hideSkirt=!!i.hideSkirt,this.sseSubdivisionThreshold=s,this.minSubdivisionLevel=o,this.maxSubdivisionLevel=a,this.maxDeltaElevationLevel=l,this.segments=d,this.schemeTile=r,this.builder=n,this.info=new Me(this),!this.schemeTile)throw new Error(`Cannot init tiled layer without schemeTile for layer ${this.id}`);if(!this.builder)throw new Error(`Cannot init tiled layer without builder for layer ${this.id}`);this.maxScreenSizeNode=this.sseSubdivisionThreshold*(2*this.sizeDiagonalTexture),this.tileMatrixSets=c,this.materialOptions=f,this.showOutline=u,this.diffuse=h,this.level0Nodes=[];const A=[];for(const e of this.schemeTile)A.push(this.convert(void 0,e));this._promises.push(Promise.all(A).then((e=>{this.level0Nodes=e,this.object3d.add(...e),this.object3d.updateMatrixWorld()})))}get hideSkirt(){return this._hideSkirt}set hideSkirt(e){if(this.level0Nodes){this._hideSkirt=e;for(const t of this.level0Nodes)t.traverse((t=>{t.isTileMesh&&(t.geometry.hideSkirt=e)}))}}pickObjectsAt(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.options.defaultPickingRadius,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return bc.pickTilesAt(e,t,r,this,n)}preUpdate(e,t){if(t.has(void 0)||0==t.size)return this.level0Nodes;e.colorLayers=e.view.getLayers(((e,t)=>t&&t.id==this.id&&e.isColorLayer)),e.elevationLayers=e.view.getLayers(((e,t)=>t&&t.id==this.id&&e.isElevationLayer)),e.maxElevationLevel=-1;for(const t of e.elevationLayers)e.maxElevationLevel=Math.max(t.source.zoom.max,e.maxElevationLevel);let r;-1==e.maxElevationLevel&&(e.maxElevationLevel=1/0),this.colorLayersOrder=G(e.colorLayers);for(const e of t.values()){if(e.isCamera)return this.level0Nodes;if(e.layer===this){if(r){if(r=e.findCommonAncestor(r),!r)return this.level0Nodes}else r=e;null==r.material&&(r=void 0)}}return r?[r]:this.level0Nodes}update(e,t,r){if(!r.parent)return Cc.removeChildrenAndCleanup(this,r);if(r.parent.pendingSubdivision)return r.visible=!1,r.material.visible=!1,void this.info.update(r);if(r.visible=!this.culling(r,e.camera),r.visible){let t=!1;return r.material.visible=!0,r.material.layersNeedUpdate=!0,this.info.update(r),(r.pendingSubdivision||mh.hasEnoughTexturesToSubdivide(e,r)&&this.subdivision(e,this,r))&&(this.subdivideNode(e,r),r.material.visible=r.pendingSubdivision,this.info.update(r),t=!0),r.material.visible&&!t?Cc.removeChildren(this,r):t?r.children.filter((e=>e.layer==this)):void 0}return r.material.visible=!1,this.info.update(r),Cc.removeChildren(this,r)}convert(e,t){return fh.convert(e,t,this)}culling(e,t){return!t.isBox3Visible(e.obb.box3D,e.matrixWorld)}static hasEnoughTexturesToSubdivide(e,t){const r=t.layerUpdateState||{};let n=t.material.getElevationTile();for(const i of e.elevationLayers){const e=t.getExtentsByProjection(i.crs)[0].zoom;if(!(e>i.zoom.max||e<i.zoom.min)&&!i.frozen&&i.ready&&i.source.extentInsideLimit(t.extent,e)&&(!n||n.level<0)){if(r[i.id]&&r[i.id].inError())continue;return!1}}for(const i of e.colorLayers){if(i.frozen||!i.visible||!i.ready)continue;const e=t.getExtentsByProjection(i.crs)[0].zoom;if(!(e>i.zoom.max||e<i.zoom.min)&&(!r[i.id]||!r[i.id].inError())&&(n=t.material.getColorTile(i.id),i.source.extentInsideLimit(t.extent,e)&&(!n||n.level<0)))return!1}return!0}subdivideNode(e,t){if(!t.pendingSubdivision&&!t.children.some((e=>e.layer==this))){const r=t.extent.subdivision();t.pendingSubdivision=!0;const n={view:e.view,requester:t,layer:this,priority:1e4,extentsSource:r,redraw:!1};return e.scheduler.execute(n).then((r=>{for(const e of r)t.add(e),e.updateMatrixWorld(!0);t.pendingSubdivision=!1,e.view.notifyChange(t,!1)}),(e=>{if(t.pendingSubdivision=!1,!e.isCancelledCommandException)throw new Error(e)}))}}subdivision(e,t,r){if(r.level<this.minSubdivisionLevel)return!0;if(this.maxSubdivisionLevel<=r.level)return!1;gh.setFromMatrixScale(r.matrixWorld),Ah.copy(r.boundingSphere.center).applyMatrix4(r.matrixWorld);const n=Math.max(0,e.camera.camera3D.position.distanceTo(Ah)-r.boundingSphere.radius*gh.x);if(e.camera.camera3D.isOrthographicCamera){const t=e.camera.camera3D,n=2*e.camera._preSSE*t.zoom/(t.top-t.bottom);r.screenSize=n*r.boundingSphere.radius*gh.x}else r.screenSize=e.camera._preSSE*(2*r.boundingSphere.radius*gh.x)/n;const i=r.screenSize/(2*this.sizeDiagonalTexture);return this.sseSubdivisionThreshold<i}}const yh=mh,vh=new s.Matrix4,wh=new s.Vector3;let bh=0;const Eh=new s.Vector3;class xh extends yh{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{minSubdivisionLevel:n=2,maxSubdivisionLevel:o=19,...a}=r,l=zo.get("EPSG:4326"),c=Go.get("EPSG:4326").subdivisionByScheme(l),h=["EPSG:4326","EPSG:3857"],u=new th({uvCount:h.length});super(e,t||new s.Group,c,u,{tileMatrixSets:h,...a}),this.isGlobeLayer=!0,this.options.defaultPickingRadius=5,this.minSubdivisionLevel=n,this.maxSubdivisionLevel=o,this.extent=this.schemeTile[0].clone();for(let e=1;e<this.schemeTile.length;e++)this.extent.union(this.schemeTile[e]);vh.copy(this.object3d.matrixWorld).invert(),vh.premultiply((new s.Matrix4).makeScale(1/i.Ql.x,1/i.Ql.y,1/i.Ql.z))}preUpdate(e,t){return wh.copy(e.camera.camera3D.position).applyMatrix4(vh),bh=wh.lengthSq()-1,super.preUpdate(e,t)}subdivision(e,t,r){if(5==r.level){const e=r.getExtentsByProjection("EPSG:4326")[0].row;if(31==e||0==e)return!1}return super.subdivision(e,t,r)}culling(e,t){return!!super.culling(e,t)||!(e.level<this.minSubdivisionLevel)&&xh.horizonCulling(e.horizonCullingPointElevationScaled)}static horizonCulling(e){Eh.copy(e).applyMatrix4(vh),Eh.sub(wh);const t=Eh.lengthSq(),r=-Eh.dot(wh);return bh<0?r>0:bh<r&&bh<r*r/t}computeTileZoomFromDistanceCamera(e,t){const r=this.sizeDiagonalTexture*(.5*this.sseSubdivisionThreshold)/t._preSSE/i.Ql.x;let n=e*r,s=Math.log(Math.PI/(2*Math.asin(n)))/Math.log(2);const o=Math.PI/2**s;return n=(e-2*i.Ql.x*Math.sin(.5*o)*.5)*r,s=Math.log(Math.PI/(2*Math.asin(n)))/Math.log(2),isNaN(s)?0:Math.round(s)}computeDistanceCameraFromTileZoom(e,t){const r=Math.PI/2**e,n=2*i.Ql.x*Math.sin(.5*r)*.5,s=n/this.sizeDiagonalTexture;return t._preSSE*s/(.5*this.sseSubdivisionThreshold)+n}}const Ch=xh;const _h=new s.Frustum;class Ih{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;this.x=e,this.y=t,this.grid=[],this.visible=[],this.resize(),this.reset(),this.width=r,this.height=n}reset(){for(let e=0;e<this.x;e++)for(let t=0;t<this.y;t++)this.grid[e][t].splice(0,this.grid[e][t].length);this.visible=[]}resize(){for(let e=0;e<this.x;e++){this.grid[e]||(this.grid[e]=[]);for(let t=0;t<this.y;t++)this.grid[e][t]||(this.grid[e][t]=[])}}insert(e){const t=Math.max(0,Math.floor(e.boundaries.left/this.width*this.x)),r=Math.min(this.x-1,Math.floor(e.boundaries.right/this.width*this.x)),n=Math.max(0,Math.floor(e.boundaries.top/this.height*this.y)),i=Math.min(this.y-1,Math.floor(e.boundaries.bottom/this.height*this.y));for(let s=t;s<=r;s++)for(let t=n;t<=i;t++)if(this.grid[s][t].length>0&&this.grid[s][t].some((t=>{return r=t.boundaries,n=e.boundaries,!(r.left>n.right||r.right<n.left||r.top>n.bottom||r.bottom<n.top);var r,n})))return e.visible=!1,!1;for(let s=t;s<=r;s++)for(let t=n;t<=i;t++)this.grid[s][t].push(e);return!0}}const Sh=new s.Vector3,Mh=class{constructor(){this.domElement=document.createElement("div"),this.domElement.style.overflow="hidden",this.domElement.style.position="absolute",this.domElement.style.top="0",this.domElement.style.height="100%",this.domElement.style.width="100%",this.domElement.style.zIndex=1,this.garbage=document.createElement("div"),this.garbage.style.display="none",this.domElement.appendChild(this.garbage),this.halfWidth=0,this.halfHeight=0,this.grid=new Ih,this.infoTileLayer=void 0}setSize(e,t){this.domElement.style.width=`${e}`,this.domElement.style.height=`${t}`,this.halfWidth=e/2,this.halfHeight=t/2,this.grid.width=e,this.grid.height=t,this.grid.x=Math.ceil(e/20),this.grid.y=Math.ceil(t/20),this.grid.resize()}registerLayer(e){this.domElement.appendChild(e.domElement.dom)}render(e,t){const r=this.infoTileLayer&&this.infoTileLayer.layer.attachedLayers.filter((e=>e.isLabelLayer&&e.visible));0!=r.length&&(this.grid.reset(),_h.setFromProjectionMatrix(t.projectionMatrix),r.forEach((e=>{e.submittedLabelNodes.forEach((e=>{e.labels.forEach((r=>{e.updatePosition(r),this.culling(r,t)})),e.domElements.labels.show(),e.needsUpdate=!1}))})),this.grid.visible.sort(((e,t)=>{const r=t.order-e.order;return 0==r?!e.visible&&t.visible?1:-1:r})),this.grid.visible.forEach((e=>{this.grid.insert(e)?(e.visible=!0,e.updateCSSPosition()):e.visible=!1})),r.forEach((e=>{e.toHide.children.forEach((e=>e.domElements?.labels.hide())),e.toHide.clear()})))}culling(e,t){e.getWorldPosition(Sh),!_h.containsPoint(Sh.applyMatrix4(t.matrixWorldInverse))||e.horizonCullingPoint&&Ch.horizonCulling(e.horizonCullingPoint)?e.visible=!1:(Sh.applyMatrix4(t.projectionMatrix),e.updateProjectedPosition(Sh.x*this.halfWidth+this.halfWidth,-Sh.y*this.halfHeight+this.halfHeight),this.grid.visible.push(e))}removeLabelDOM(e){this.garbage.appendChild(e.content),this.garbage.innerHTML=""}},Th=class{static isWebGL2Available(){try{const e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}}static isColorSpaceAvailable(e){try{const t=document.createElement("canvas"),r=window.WebGL2RenderingContext&&t.getContext("webgl2");return r.drawingBufferColorSpace=e,r.drawingBufferColorSpace===e}catch(e){return!1}}static getWebGL2ErrorMessage(){return this.getErrorMessage(2)}static getErrorMessage(e){const t={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext};let r='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>';const n=document.createElement("div");return n.id="webglmessage",n.style.fontFamily="monospace",n.style.fontSize="13px",n.style.fontWeight="normal",n.style.textAlign="center",n.style.background="#fff",n.style.color="#000",n.style.padding="1.5em",n.style.width="400px",n.style.margin="5em auto 0",r=t[e]?r.replace("$0","graphics card"):r.replace("$0","browser"),r=r.replace("$1",{1:"WebGL",2:"WebGL 2"}[e]),n.innerHTML=r,n}static isWebGLAvailable(){console.warn("isWebGLAvailable() has been deprecated and will be removed in r178. Use isWebGL2Available() instead.");try{const e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}static getWebGLErrorMessage(){return console.warn("getWebGLErrorMessage() has been deprecated and will be removed in r178. Use getWebGL2ErrorMessage() instead."),this.getErrorMessage(1)}},Bh=new s.Vector4,Ph=class{constructor(e){let t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(e=>{!1===e.isWebGL2&&console.error("WebGL1 support ended in 2.43.0. Falling-back to the WebGL2 renderer.")})(n),void 0===n.antialias&&(n.antialias=!0),void 0===n.alpha&&(n.alpha=!0),void 0===n.logarithmicDepthBuffer&&(n.logarithmicDepthBuffer=!0),e.domElement?(t=e,r=t.domElement instanceof HTMLDivElement?t.domElement:t.domElement.parentElement):r=e,this.width=r.clientWidth,this.height=r.clientHeight,this.positionBuffer=null,this._nextThreejsLayer=1,this.fullSizeRenderTarget=new s.WebGLRenderTarget(this.width,this.height),this.fullSizeRenderTarget.texture.minFilter=s.LinearFilter,this.fullSizeRenderTarget.texture.magFilter=s.NearestFilter,this.fullSizeRenderTarget.depthBuffer=!0,this.fullSizeRenderTarget.depthTexture=new s.DepthTexture,this.fullSizeRenderTarget.depthTexture.type=s.UnsignedShortType,this.renderView=function(e){this.renderer.clear(),e._camXR?this.renderer.render(e.scene,e._camXR):this.renderer.render(e.scene,e.camera3D),e.tileLayer&&this.label2dRenderer.render(e.tileLayer.object3d,e.camera3D)}.bind(this),this.onWindowResize=function(e,t){this.width=e,this.height=t,this.fullSizeRenderTarget.setSize(this.width,this.height),this.renderer.setSize(this.width,this.height),this.label2dRenderer.setSize(this.width,this.height)}.bind(this);try{this.label2dRenderer=new Mh,this.label2dRenderer.setSize(this.width,this.height),r.appendChild(this.label2dRenderer.domElement),this.renderer=t||new s.WebGLRenderer({canvas:document.createElement("canvas"),antialias:n.antialias,alpha:n.alpha,logarithmicDepthBuffer:n.logarithmicDepthBuffer}),this.renderer.domElement.style.position="relative",this.renderer.domElement.style.zIndex=0,this.renderer.domElement.style.top=0}catch(e){throw Th.isWebGL2Available()||r.appendChild(Th.getErrorMessage(2)),e}-1===this.renderer.domElement.tabIndex&&(this.renderer.domElement.tabIndex=-1),F.updateCapabilities(this.renderer),this.renderer.setClearColor(197896),this.renderer.autoClear=!1,this.renderer.sortObjects=!0,this.renderer.debug.checkShaderErrors=!1,t||(this.renderer.setPixelRatio(r.devicePixelRatio),this.renderer.setSize(r.clientWidth,r.clientHeight),r.appendChild(this.renderer.domElement))}getWindowSize(){return new s.Vector2(this.width,this.height)}getRenderer(){return this.renderer}renderViewToBuffer(e,t){return t||(t={x:0,y:0,width:this.width,height:this.height}),t.buffer=t.buffer||new Uint8Array(4*t.width*t.height),this.renderViewToRenderTarget(e,this.fullSizeRenderTarget,t),this.renderer.readRenderTargetPixels(this.fullSizeRenderTarget,t.x,this.height-(t.y+t.height),t.width,t.height,t.buffer),t.buffer}renderViewToRenderTarget(e,t,r){t||(t=this.fullSizeRenderTarget);const n=this.renderer.getRenderTarget();return r&&(this.fullSizeRenderTarget.scissor.set(r.x,t.height-(r.y+r.height),r.width,r.height),this.fullSizeRenderTarget.scissorTest=!0),this.renderer.setRenderTarget(t),this.renderer.clear(!0,!0,!1),this.renderer.render(e.scene,e.camera.camera3D),this.renderer.setRenderTarget(n),this.fullSizeRenderTarget.scissorTest=!1,t}bufferToImage(e,t,r){const n=document.createElement("canvas"),i=n.getContext("2d",{willReadFrequently:!0});n.width=t,n.height=r;const s=i.getImageData(0,0,t,r);s.data.set(e),i.putImageData(s,0,0);const o=new Image;return o.src=n.toDataURL(),o}depthBufferRGBAValueToOrthoZ(e,t){if(Bh.fromArray(e).divideScalar(255),F.isLogDepthBufferSupported()&&"PerspectiveCamera"==t.type)return 2**(2*ge(Bh)/(2/(Math.log(t.far+1)/Math.LN2)));{let e=ge(Bh);return e=2*e-1,e}}};function Rh(e,t,r,n,i,s){const o=e.x,a=e.y;for(let e=n+s,l=n;e<n+i;l=e,e+=s){const n=t[e],i=t[e+1],s=t[l],c=t[l+1],h=s-n,u=c-i,d=Math.sqrt(h*h+u*u),p=((o-n)*h+(a-i)*u)/d;if(p>=-r&&p<=d+r&&Math.abs(u*o-h*a+s*i-c*n)/d<=r)return!0}return!1}function Dh(e,t,r,n,i,s,o){if(t==Vi.LINE&&Rh(e,r,n,i,s,o))return!0;if(t==Vi.POLYGON&&function(e,t,r,n,i,s){const o=e.x,a=e.y;let l=!1;for(let c=n,h=n+i-s;c<n+i;h=c,c+=s){const n=t[c],i=t[c+1],s=t[h],u=t[h+1];if(Rh(e,[n,i,s,u],r,0,4,2))return!0;i>a!=u>a&&o<(s-n)*(a-i)/(u-i)+n&&(l=!l)}return l}(e,r,n,i,s,o))return!0;if(t==Vi.POINT){const t=function(e,t,r,n,i,s){const o=e.x,a=e.y;let l,c=r*r;for(let e=n;e<n+i;e+=s){const r=o-t[e],n=a-t[e+1],i=r*r+n*n;i<c&&(l=[t[e],t[e+1]],c=i)}return l}(e,r,n,i,s,o);if(t)return{coordinates:t}}}function Lh(e,t,r,n){const i=e.as(t.crs);for(const e of t.geometries)if(null==e.extent||e.extent.isPointInside(i,r)){const s=e.indices[0].offset*t.size,o=e.indices[0].count*t.size,a=Dh(i,t.type,t.vertices,r,s,o,t.size);a&&n.push({type:t.type,geometry:e,coordinates:a.coordinates,style:t.style})}}const kh=new i.E$("EPSG:4326",0,0,0),Oh={filterFeaturesUnderCoordinate(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const n=[];if(e.as(t.crs,kh),kh.applyMatrix4(t.matrixWorldInverse),t.extent.isPointInside(kh,r))if(t.isFeatureCollection){r*=Math.sqrt(t.scale.x**2+t.scale.y**2);for(const e of t.features)e.extent&&!e.extent.isPointInside(kh,r)||Lh(kh,e,r,n)}else t.geometries&&Lh(kh,t,r,n);return n}};var Fh=r(80061);const Nh={executeCommand(e){const t=e.layer,r=e.extentsSource,n=e.extentsDestination||r,i=r.map(((e,r)=>t.getData(e,n[r])));return e.partialLoading?Promise.allSettled(i).then((e=>e.find((e=>"fulfilled"===e.status))?e.map((e=>e.value?e.value:null)):Promise.reject(new Error("Failed to load any data")))):Promise.all(i)}},Uh=class{constructor(e){this.command=e,this.isCancelledCommandException=!0}toString(){return`Cancelled command ${this.command.requester.id}/${this.command.layer.id}`}},Qh={executeCommand(e){const t=[],r=e.layer,n=e.requester,i=e.extentsSource;if(n&&!n.material)return Promise.reject(new Uh(e));for(const e of i)t.push(r.convert(n,e));return Promise.all(t)}},Gh={BYTE:1,UNSIGNED_BYTE:1,SHORT:2,UNSIGNED_SHORT:2,INT:4,UNSIGNED_INT:4,FLOAT:4,DOUBLE:8},zh={BYTE:Int8Array,UNSIGNED_BYTE:Uint8Array,SHORT:Int16Array,UNSIGNED_SHORT:Uint16Array,INT:Int32Array,UNSIGNED_INT:Uint32Array,FLOAT:Float32Array,DOUBLE:Float64Array},jh={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},Vh={VEC2:s.Vector2,VEC3:s.Vector3,VEC4:s.Vector4},qh=function(e,t,r,n,i){if(!e)throw new Error("Buffer is mandatory to parse binary property.");if(null==t)throw new Error("batchLength is mandatory to parse binary property.");if(null==r)throw new Error("byteOffset is mandatory to parse binary property.");if(!Gh[n])throw new Error(`Uknown component type: ${n}. Cannot access binary property.`);if(!jh[i])throw new Error(`Uknown type: ${i}. Cannot access binary property.`);const s=jh[i],o=new zh[n](e,r,t*s);if("SCALAR"===i)return Array.from(o);{const e=[];for(let t=0;t<=o.length-s;t+=s){const r=new Vh[i];r.fromArray(o,t),e.push(r)}return e}},Hh={tileset:"tileset",batchtable:"batchtable",boundingVolume:"boundingVolume"},Wh={region:"region",box:"box",sphere:"sphere"},$h=new TextDecoder,Yh=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ArrayBuffer,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;4!==arguments.length||"object"!=typeof n||Array.isArray(n)||null===n||console.warn("You most likely used a deprecated constructor of C3DTBatchTable."),t+r!==e.byteLength&&console.error("3DTiles batch table json length and binary length are not consistent with total buffer length. The batch table may be wrong."),this.type=Hh.batchtable,this.batchLength=n;const s=e.slice(0,t),o=$h.decode(new Uint8Array(s)),a=""===o?null:JSON.parse(o);if(r>0){const n=e.slice(t,t+r);for(const e in a){if(!Object.prototype.hasOwnProperty.call(a,e))continue;const t=a[e];Array.isArray(t)||(void 0!==t?.byteOffset&&void 0!==t?.componentType&&void 0!==t?.type?a[e]=qh(n,this.batchLength,t.byteOffset,t.componentType,t.type):console.error("Invalid 3D Tiles batch table property that is neither a JSON array nor a valid accessor to a binary body"))}}a&&a.extensions&&(this.extensions=i.parseExtensions(a.extensions,this.type),delete a.extensions),this.content=a}getInfoById(e){if(e<0&&e<this.batchLength)throw new Error(`Batch Id (${e}) must be between 0 and\n            ${this.batchLength} to access feature properties from the batch\n            table.`);const t={batchTable:{}};for(const r in this.content)if(Object.prototype.hasOwnProperty.call(this.content,r)){const n=this.content[r][e];n&&(n.isVector2||n.isVector3||n.isVector4)?t.batchTable[r]=n.toArray():t.batchTable[r]=n}if(this.extensions){t.extensions={};for(const r in this.extensions)Object.prototype.hasOwnProperty.call(this.extensions,r)&&(t.extensions[r]=this.extensions[r].getInfoById(e))}return t}};function Kh(e){if(!e.geometry)return;e.geometry.groups.sort(((e,t)=>-1*(e.start-t.start)));const t=e.geometry.groups.length-1;let r=e.geometry.groups[t].materialIndex;const n=[r];for(let i=t-1;i>=0;i--){const t=e.geometry.groups[i];t.materialIndex===r?(e.geometry.groups[i+1].count+=t.count,e.geometry.groups.splice(i,1)):(r=t.materialIndex,n.push(r))}for(let t=e.material.length-1;t>=0;t--)n.includes(t)||(e.geometry.groups.forEach((e=>{e.materialIndex>t&&(e.materialIndex-=1)})),e.material.splice(t,1))}function Jh(e){if(!e)return null;const t=e.replace(/[a-z]+:\/\/[^/]+/i,"").replace(/\?.*$/i,"").replace(/.*\//g,""),r=t.lastIndexOf(".");return-1===r?null:t.substring(r+1)||null}class Xh{get unloadPriorityCallback(){return this._unloadPriorityCallback}set unloadPriorityCallback(e){1===e.length?(console.warn('LRUCache: "unloadPriorityCallback" function has been changed to take two arguments.'),this._unloadPriorityCallback=(t,r)=>{const n=e(t),i=e(r);return n<i?-1:n>i?1:0}):this._unloadPriorityCallback=e}constructor(){this.minSize=6e3,this.maxSize=8e3,this.minBytesSize=322122547.2,this.maxBytesSize=429496729.6,this.unloadPercent=.05,this.autoMarkUnused=!0,this.itemSet=new Map,this.itemList=[],this.usedSet=new Set,this.callbacks=new Map,this.unloadingHandle=-1,this.cachedBytes=0,this.bytesMap=new Map,this.loadedSet=new Set,this._unloadPriorityCallback=null,this.computeMemoryUsageCallback=()=>null;const e=this.itemSet;this.defaultPriorityCallback=t=>e.get(t)}isFull(){return this.itemSet.size>=this.maxSize||this.cachedBytes>=this.maxBytesSize}getMemoryUsage(e){return this.bytesMap.get(e)??null}add(e,t){const r=this.itemSet;if(r.has(e))return!1;if(this.isFull())return!1;const n=this.usedSet,i=this.itemList,s=this.callbacks,o=this.bytesMap;i.push(e),n.add(e),r.set(e,Date.now()),s.set(e,t);const a=this.computeMemoryUsageCallback(e);return this.cachedBytes+=a||0,o.set(e,a),!0}has(e){return this.itemSet.has(e)}remove(e){const t=this.usedSet,r=this.itemSet,n=this.itemList,i=this.bytesMap,s=this.callbacks,o=this.loadedSet;if(r.has(e)){this.cachedBytes-=i.get(e)||0,i.delete(e),s.get(e)(e);const a=n.indexOf(e);return n.splice(a,1),t.delete(e),r.delete(e),s.delete(e),o.delete(e),!0}return!1}setLoaded(e,t){const{itemSet:r,loadedSet:n}=this;r.has(e)&&(!0===t?n.add(e):n.delete(e))}updateMemoryUsage(e){const t=this.itemSet,r=this.bytesMap;if(!t.has(e))return;this.cachedBytes-=r.get(e)||0;const n=this.computeMemoryUsageCallback(e);r.set(e,n),this.cachedBytes+=n}markUsed(e){const t=this.itemSet,r=this.usedSet;t.has(e)&&!r.has(e)&&(t.set(e,Date.now()),r.add(e))}markUnused(e){this.usedSet.delete(e)}markAllUnused(){this.usedSet.clear()}unloadUnusedContent(){const{unloadPercent:e,minSize:t,maxSize:r,itemList:n,itemSet:i,usedSet:s,loadedSet:o,callbacks:a,bytesMap:l,minBytesSize:c,maxBytesSize:h}=this,u=n.length-s.size,d=n.length-o.size,p=Math.max(Math.min(n.length-t,u),0),f=this.cachedBytes-c,g=this.unloadPriorityCallback||this.defaultPriorityCallback;let A=!1;const m=p>0&&u>0||d&&n.length>r;if(u&&this.cachedBytes>c||d&&this.cachedBytes>h||m){n.sort(((e,t)=>{const r=s.has(e);if(r===s.has(t)){const r=o.has(e);return r===o.has(t)?-g(e,t):r?1:-1}return r?1:-1}));const d=Math.max(t*e,p*e),m=Math.ceil(Math.min(d,u,p)),y=Math.max(e*f,e*c),v=Math.min(y,f);let w=0,b=0;for(;this.cachedBytes-b>h||n.length-w>r;){const e=n[w],t=l.get(e)||0;if(s.has(e)&&o.has(e)||this.cachedBytes-b-t<h&&n.length-w<=r)break;b+=t,w++}for(;b<v||w<m;){const e=n[w],t=l.get(e)||0;if(s.has(e)||this.cachedBytes-b-t<c&&w>=m)break;b+=t,w++}n.splice(0,w).forEach((e=>{this.cachedBytes-=l.get(e)||0,a.get(e)(e),l.delete(e),i.delete(e),a.delete(e),o.delete(e),s.delete(e)})),A=w<p||b<f&&w<u,A=A&&w>0}A&&(this.unloadingHandle=requestAnimationFrame((()=>this.scheduleUnload())))}scheduleUnload(){cancelAnimationFrame(this.unloadingHandle),this.scheduled||(this.scheduled=!0,queueMicrotask((()=>{this.scheduled=!1,this.unloadUnusedContent()})))}}class Zh{constructor(){this.maxJobs=6,this.items=[],this.callbacks=new Map,this.currJobs=0,this.scheduled=!1,this.autoUpdate=!0,this.priorityCallback=()=>{throw new Error("PriorityQueue: PriorityCallback function not defined.")},this.schedulingCallback=e=>{requestAnimationFrame(e)},this._runjobs=()=>{this.tryRunJobs(),this.scheduled=!1}}sort(){const e=this.priorityCallback;this.items.sort(e)}add(e,t){return new Promise(((r,n)=>{const i=this.items,s=this.callbacks;i.push(e),s.set(e,((...e)=>t(...e).then(r).catch(n))),this.autoUpdate&&this.scheduleJobRun()}))}remove(e){const t=this.items,r=this.callbacks,n=t.indexOf(e);-1!==n&&(t.splice(n,1),r.delete(e))}tryRunJobs(){this.sort();const e=this.items,t=this.callbacks,r=this.maxJobs;let n=this.currJobs;for(;r>n&&e.length>0;){n++;const r=e.pop(),i=t.get(r);t.delete(r),i(r).then((()=>{this.currJobs--,this.autoUpdate&&this.scheduleJobRun()})).catch((()=>{this.currJobs--,this.autoUpdate&&this.scheduleJobRun()}))}this.currJobs=n}scheduleJobRun(){this.scheduled||(this.schedulingCallback(this._runjobs),this.scheduled=!0)}}var eu=r(79175),tu=r(96509);const ru=Symbol("PLUGIN_REGISTERED"),nu=(e,t)=>e.__depthFromRenderedParent!==t.__depthFromRenderedParent?e.__depthFromRenderedParent>t.__depthFromRenderedParent?-1:1:e.__inFrustum!==t.__inFrustum?e.__inFrustum?1:-1:e.__used!==t.__used?e.__used?1:-1:e.__error!==t.__error?e.__error>t.__error?1:-1:e.__distanceFromCamera!==t.__distanceFromCamera?e.__distanceFromCamera>t.__distanceFromCamera?-1:1:0,iu=(e,t)=>e.__depthFromRenderedParent!==t.__depthFromRenderedParent?e.__depthFromRenderedParent>t.__depthFromRenderedParent?1:-1:e.__loadingState!==t.__loadingState?e.__loadingState>t.__loadingState?-1:1:e.__lastFrameVisited!==t.__lastFrameVisited?e.__lastFrameVisited>t.__lastFrameVisited?-1:1:e.__hasUnrenderableContent!==t.__hasUnrenderableContent?e.__hasUnrenderableContent?-1:1:e.__error!==t.__error?e.__error>t.__error?-1:1:0;class su{get root(){const e=this.rootTileSet;return e?e.root:null}get loadProgress(){const e=this.stats,t=e.downloading+e.parsing,r=e.inCacheSinceLoad;return 0===r?1:1-t/r}get errorThreshold(){return this._errorThreshold}set errorThreshold(e){console.warn('TilesRenderer: The "errorThreshold" option has been deprecated.'),this._errorThreshold=e}constructor(e=null){this.rootLoadingState=tu.nk,this.rootTileSet=null,this.rootURL=e,this.fetchOptions={},this.plugins=[],this.queuedTiles=[],this.cachedSinceLoadComplete=new Set;const t=new Xh;t.unloadPriorityCallback=iu;const r=new Zh;r.maxJobs=10,r.priorityCallback=nu;const n=new Zh;n.maxJobs=1,n.priorityCallback=nu,this.visibleTiles=new Set,this.activeTiles=new Set,this.usedSet=new Set,this.lruCache=t,this.downloadQueue=r,this.parseQueue=n,this.stats={inCacheSinceLoad:0,inCache:0,parsing:0,downloading:0,failed:0,inFrustum:0,used:0,active:0,visible:0},this.frameCount=0,this.errorTarget=6,this._errorThreshold=1/0,this.displayActiveTiles=!1,this.maxDepth=1/0}registerPlugin(e){if(!0===e[ru])throw new Error("TilesRendererBase: A plugin can only be registered to a single tile set");const t=this.plugins,r=e.priority||0;let n=t.length;for(let e=0;e<t.length;e++)if((t[e].priority||0)>r){n=e;break}t.splice(n,0,e),e[ru]=!0,e.init&&e.init(this)}unregisterPlugin(e){const t=this.plugins;if("string"==typeof e&&(e=this.getPluginByName(name)),t.includes(e)){const r=t.indexOf(e);return t.splice(r,1),e.dispose&&e.dispose(),!0}return!1}getPluginByName(e){return this.plugins.find((t=>t.name===e))||null}traverse(e,t,r=!0){this.root&&(0,eu.R4)(this.root,((t,...n)=>(r&&this.ensureChildrenArePreprocessed(t),!!e&&e(t,...n))),t)}queueTileForDownload(e){e.__loadingState===tu.nk&&this.queuedTiles.push(e)}markTileUsed(e){this.usedSet.add(e),this.lruCache.markUsed(e)}update(){const{lruCache:e,usedSet:t,stats:r,root:n}=this;if(this.rootLoadingState===tu.nk&&(this.rootLoadingState=tu.F5,this.invokeOnePlugin((e=>e.loadRootTileSet&&e.loadRootTileSet())).then((e=>{this.rootLoadingState=tu.S2,this.rootTileSet=e,this.dispatchEvent({type:"load-tile-set",tileSet:e})})).catch((e=>{this.rootLoadingState=tu.Wk,console.error(e),this.rootTileSet=null,this.dispatchEvent({type:"load-error",tile:null,error:e})}))),!n)return;r.inFrustum=0,r.used=0,r.active=0,r.visible=0,this.frameCount++,t.forEach((t=>e.markUnused(t))),t.clear(),(0,eu.ME)(n,this),(0,eu.Fv)(n,this),(0,eu.$K)(n,this),(0,eu.ki)(n,this);const i=this.queuedTiles;i.sort(e.unloadPriorityCallback);for(let t=0,r=i.length;t<r&&!e.isFull();t++)this.requestTileContents(i[t]);i.length=0,e.scheduleUnload()}resetFailedTiles(){this.rootLoadingState===tu.Wk&&(this.rootLoadingState=tu.nk);const e=this.stats;0!==e.failed&&(this.traverse((e=>{e.__loadingState===tu.Wk&&(e.__loadingState=tu.nk)}),null,!1),e.failed=0)}dispose(){this.plugins.forEach((e=>{this.unregisterPlugin(e)}));const e=this.lruCache,t=[];this.traverse((e=>(t.push(e),!1)),null,!1);for(let r=0,n=t.length;r<n;r++)e.remove(t[r]);this.stats={parsing:0,downloading:0,failed:0,inFrustum:0,used:0,active:0,visible:0},this.frameCount=0}dispatchEvent(e){}fetchData(e,t){return fetch(e,t)}parseTile(e,t,r){return null}disposeTile(e){e.__visible&&(this.invokeOnePlugin((t=>t.setTileVisible&&t.setTileVisible(e,!1))),e.__visible=!1),e.__active&&(this.setTileActive(e,!1),e.__active=!1)}preprocessNode(e,t,r=null){if(e.content&&(!("uri"in e.content)&&"url"in e.content&&(e.content.uri=e.content.url,delete e.content.url),e.content.boundingVolume&&!("box"in e.content.boundingVolume||"sphere"in e.content.boundingVolume||"region"in e.content.boundingVolume)&&delete e.content.boundingVolume),e.parent=r,e.children=e.children||[],e.content?.uri){const t=Jh(e.content.uri);e.__hasContent=!0,e.__hasUnrenderableContent=Boolean(t&&/json$/.test(t)),e.__hasRenderableContent=!e.__hasUnrenderableContent}else e.__hasContent=!1,e.__hasUnrenderableContent=!1,e.__hasRenderableContent=!1;e.__distanceFromCamera=1/0,e.__error=1/0,e.__inFrustum=!1,e.__isLeaf=!1,e.__usedLastFrame=!1,e.__used=!1,e.__wasSetVisible=!1,e.__visible=!1,e.__childrenWereVisible=!1,e.__allChildrenLoaded=!1,e.__wasSetActive=!1,e.__active=!1,e.__loadingState=tu.nk,null===r?(e.__depth=0,e.__depthFromRenderedParent=e.__hasRenderableContent?1:0,e.refine=e.refine||"REPLACE"):(e.__depth=r.__depth+1,e.__depthFromRenderedParent=r.__depthFromRenderedParent+(e.__hasRenderableContent?1:0),e.refine=e.refine||r.refine),e.__basePath=t,e.__lastFrameVisited=-1,this.invokeAllPlugins((n=>{n!==this&&n.preprocessNode&&n.preprocessNode(e,t,r)}))}setTileActive(e,t){t?this.activeTiles.add(e):this.activeTiles.delete(e)}setTileVisible(e,t){t?this.visibleTiles.add(e):this.visibleTiles.delete(e)}calculateError(e){return 0}tileInView(e){return!0}ensureChildrenArePreprocessed(e){const t=e.children;for(let r=0,n=t.length;r<n;r++){const n=t[r];if("__depth"in n)break;this.preprocessNode(n,e.__basePath,e)}}preprocessTileSet(e,t,r=null){const n=e.asset.version,[i,s]=n.split(".").map((e=>parseInt(e)));console.assert(i<=1,"TilesRenderer: asset.version is expected to be a 1.x or a compatible version."),1===i&&s>0&&console.warn("TilesRenderer: tiles versions at 1.1 or higher have limited support. Some new extensions and features may not be supported.");let o=t.replace(/\/[^/]*\/?$/,"");o=new URL(o,window.location.href).toString(),this.preprocessNode(e.root,o,r)}loadRootTileSet(){let e=this.rootURL;return this.invokeAllPlugins((t=>e=t.preprocessURL?t.preprocessURL(e,null):e)),this.invokeOnePlugin((t=>t.fetchData&&t.fetchData(e,this.fetchOptions))).then((t=>{if(t.ok)return t.json();throw new Error(`TilesRenderer: Failed to load tileset "${e}" with status ${t.status} : ${t.statusText}`)})).then((t=>(this.preprocessTileSet(t,e),t)))}requestTileContents(e){if(e.__loadingState!==tu.nk)return;let t=!1,r=new URL(e.content.uri,e.__basePath+"/").toString();this.invokeAllPlugins((t=>r=t.preprocessURL?t.preprocessURL(r,e):r));const n=this.stats,i=this.lruCache,s=this.downloadQueue,o=this.parseQueue,a=Jh(r),l=new AbortController,c=l.signal;return i.add(e,(r=>{l.abort(),t?r.children.length=0:this.invokeAllPlugins((e=>{e.disposeTile&&e.disposeTile(r)})),n.inCache--,this.cachedSinceLoadComplete.has(e)&&(this.cachedSinceLoadComplete.delete(e),n.inCacheSinceLoad--),r.__loadingState===tu.F5?n.downloading--:r.__loadingState===tu.t$&&n.parsing--,r.__loadingState=tu.nk,o.remove(r),s.remove(r)}))?(0===n.parsing&&0===n.downloading&&this.dispatchEvent({type:"tiles-load-start"}),this.cachedSinceLoadComplete.add(e),n.inCacheSinceLoad++,n.inCache++,n.downloading++,e.__loadingState=tu.F5,s.add(e,(e=>c.aborted?Promise.resolve():this.invokeOnePlugin((e=>e.fetchData&&e.fetchData(r,{...this.fetchOptions,signal:c}))))).then((e=>{if(!c.aborted){if(e.ok)return"json"===a?e.json():e.arrayBuffer();throw new Error(`Failed to load model with error code ${e.status}`)}})).then((i=>{if(!c.aborted)return n.downloading--,n.parsing++,e.__loadingState=tu.t$,o.add(e,(n=>c.aborted?Promise.resolve():"json"===a&&i.root?(this.preprocessTileSet(i,r,e),e.children.push(i.root),t=!0,Promise.resolve()):this.invokeOnePlugin((e=>e.parseTile&&e.parseTile(i,n,a,r,c)))))})).then((()=>{c.aborted||(n.parsing--,e.__loadingState=tu.S2,i.setLoaded(e,!0),null===i.getMemoryUsage(e)&&(i.isFull()&&i.computeMemoryUsageCallback(e)>0?i.remove(e):i.updateMemoryUsage(e)),e.cached.scene&&this.dispatchEvent({type:"load-model",scene:e.cached.scene,tile:e}))})).catch((t=>{c.aborted||("AbortError"!==t.name?(o.remove(e),s.remove(e),e.__loadingState===tu.t$?n.parsing--:e.__loadingState===tu.F5&&n.downloading--,n.failed++,console.error(`TilesRenderer : Failed to load tile at url "${e.content.uri}".`),console.error(t),e.__loadingState=tu.Wk,i.setLoaded(e,!0),this.dispatchEvent({type:"load-error",tile:e,error:t,uri:r})):i.remove(e))})).finally((()=>{0===n.parsing&&0===n.downloading&&(this.cachedSinceLoadComplete.clear(),n.inCacheSinceLoad=0,this.dispatchEvent({type:"tiles-load-end"}))}))):void 0}getAttributions(e=[]){return this.invokeAllPlugins((t=>t!==this&&t.getAttributions&&t.getAttributions(e))),e}invokeOnePlugin(e){const t=[...this.plugins,this];for(let r=0;r<t.length;r++){const n=e(t[r]);if(n)return n}return null}invokeAllPlugins(e){const t=[...this.plugins,this],r=[];for(let n=0;n<t.length;n++){const i=e(t[n]);i&&r.push(i)}return 0===r.length?null:Promise.all(r)}}const ou=new TextDecoder;function au(e){return ou.decode(e)}function lu(e,t,r,n,i,s){let o,a;switch(n){case"SCALAR":o=1;break;case"VEC2":o=2;break;case"VEC3":o=3;break;case"VEC4":o=4;break;default:throw new Error(`FeatureTable : Feature type not provided for "${s}".`)}const l=r*o;switch(i){case"BYTE":a=new Int8Array(e,t,l);break;case"UNSIGNED_BYTE":a=new Uint8Array(e,t,l);break;case"SHORT":a=new Int16Array(e,t,l);break;case"UNSIGNED_SHORT":a=new Uint16Array(e,t,l);break;case"INT":a=new Int32Array(e,t,l);break;case"UNSIGNED_INT":a=new Uint32Array(e,t,l);break;case"FLOAT":a=new Float32Array(e,t,l);break;case"DOUBLE":a=new Float64Array(e,t,l);break;default:throw new Error(`FeatureTable : Feature component type not provided for "${s}".`)}return a}class cu{constructor(e,t,r,n){this.buffer=e,this.binOffset=t+r,this.binLength=n;let i=null;if(0!==r){const n=new Uint8Array(e,t,r);i=JSON.parse(au(n))}else i={};this.header=i}getKeys(){return Object.keys(this.header)}getData(e,t,r=null,n=null){const i=this.header;if(!(e in i))return null;const s=i[e];if(s instanceof Object){if(Array.isArray(s))return s;{const{buffer:i,binOffset:o,binLength:a}=this,l=s.byteOffset||0,c=s.type||n,h=s.componentType||r;if("type"in s&&n&&s.type!==n)throw new Error("FeatureTable: Specified type does not match expected type.");const u=o+l,d=lu(i,u,t,c,h,e);if(u+d.byteLength>o+a)throw new Error("FeatureTable: Feature data read outside binary body length.");return d}}return s}getBuffer(e,t){const{buffer:r,binOffset:n}=this;return r.slice(n+e,n+e+t)}}class hu{constructor(e){this.batchTable=e;const t=e.header.extensions["3DTILES_batch_table_hierarchy"];this.classes=t.classes;for(const e of this.classes){const t=e.instances;for(const r in t)e.instances[r]=this._parseProperty(t[r],e.length,r)}if(this.instancesLength=t.instancesLength,this.classIds=this._parseProperty(t.classIds,this.instancesLength,"classIds"),t.parentCounts?this.parentCounts=this._parseProperty(t.parentCounts,this.instancesLength,"parentCounts"):this.parentCounts=new Array(this.instancesLength).fill(1),t.parentIds){const e=this.parentCounts.reduce(((e,t)=>e+t),0);this.parentIds=this._parseProperty(t.parentIds,e,"parentIds")}else this.parentIds=null;this.instancesIds=[];const r={};for(const e of this.classIds)r[e]=r[e]??0,this.instancesIds.push(r[e]),r[e]++}_parseProperty(e,t,r){if(Array.isArray(e))return e;{const{buffer:n,binOffset:i}=this.batchTable;return lu(n,i+e.byteOffset,t,"SCALAR",e.componentType||"UNSIGNED_SHORT",r)}}getDataFromId(e,t={}){const r=this.parentCounts[e];if(this.parentIds&&r>0){let n=0;for(let t=0;t<e;t++)n+=this.parentCounts[t];for(let i=0;i<r;i++){const r=this.parentIds[n+i];r!==e&&this.getDataFromId(r,t)}}const n=this.classIds[e],i=this.classes[n].instances,s=this.classes[n].name,o=this.instancesIds[e];for(const e in i)t[s]=t[s]||{},t[s][e]=i[e][o];return t}}class uu extends cu{get batchSize(){return console.warn("BatchTable.batchSize has been deprecated and replaced with BatchTable.count."),this.count}constructor(e,t,r,n,i){super(e,r,n,i),this.count=t,this.extensions={};const s=this.header.extensions;s&&s["3DTILES_batch_table_hierarchy"]&&(this.extensions["3DTILES_batch_table_hierarchy"]=new hu(this))}getData(e,t=null,r=null){return console.warn("BatchTable: BatchTable.getData is deprecated. Use BatchTable.getDataFromId to get allproperties for an id or BatchTable.getPropertyArray for getting an array of value for a property."),super.getData(e,this.count,t,r)}getDataFromId(e,t={}){if(e<0||e>=this.count)throw new Error(`BatchTable: id value "${e}" out of bounds for "${this.count}" features number.`);for(const r of this.getKeys())"extensions"!==r&&(t[r]=super.getData(r,this.count)[e]);for(const r in this.extensions){const n=this.extensions[r];n.getDataFromId instanceof Function&&(t[r]=t[r]||{},n.getDataFromId(e,t[r]))}return t}getPropertyArray(e){return super.getData(e,this.count)}}class du{constructor(){this.fetchOptions={},this.workingPath=""}load(e){return console.warn('Loader: "load" function has been deprecated in favor of "loadAsync".'),this.loadAsync(e)}loadAsync(e){return fetch(e,this.fetchOptions).then((t=>{if(!t.ok)throw new Error(`Failed to load file "${e}" with status ${t.status} : ${t.statusText}`);return t.arrayBuffer()})).then((t=>(""===this.workingPath&&(this.workingPath=this.workingPathForURL(e)),this.parse(t))))}resolveExternalURL(e){return/^[^\\/]/.test(e)&&!/^http/.test(e)?this.workingPath+"/"+e:e}workingPathForURL(e){const t=e.split(/[\\/]/g);return t.pop(),t.join("/")+"/"}parse(e){throw new Error("LoaderBase: Parse not implemented.")}}function pu(e){let t;if(t=e instanceof DataView?e:new DataView(e),"{"===String.fromCharCode(t.getUint8(0)))return null;let r="";for(let e=0;e<4;e++)r+=String.fromCharCode(t.getUint8(e));return r}class fu extends du{parse(e){const t=new DataView(e),r=pu(t);console.assert("b3dm"===r);const n=t.getUint32(4,!0);console.assert(1===n);const i=t.getUint32(8,!0);console.assert(i===e.byteLength);const s=t.getUint32(12,!0),o=t.getUint32(16,!0),a=t.getUint32(20,!0),l=t.getUint32(24,!0),c=e.slice(28,28+s+o),h=new cu(c,0,s,o),u=28+s+o,d=e.slice(u,u+a+l),p=new uu(d,h.getData("BATCH_LENGTH"),0,a,l),f=u+a+l;return{version:n,featureTable:h,batchTable:p,glbBytes:new Uint8Array(e,f,i-f)}}}function gu(e,t){if(t===s.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===s.TriangleFanDrawMode||t===s.TriangleStripDrawMode){let r=e.getIndex();if(null===r){const t=[],n=e.getAttribute("position");if(void 0===n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<n.count;e++)t.push(e);e.setIndex(t),r=e.getIndex()}const n=r.count-2,i=[];if(t===s.TriangleFanDrawMode)for(let e=1;e<=n;e++)i.push(r.getX(0)),i.push(r.getX(e)),i.push(r.getX(e+1));else for(let e=0;e<n;e++)e%2==0?(i.push(r.getX(e)),i.push(r.getX(e+1)),i.push(r.getX(e+2))):(i.push(r.getX(e+2)),i.push(r.getX(e+1)),i.push(r.getX(e)));i.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=e.clone();return o.setIndex(i),o.clearGroups(),o}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}class Au extends s.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new Eu(e)})),this.register((function(e){return new xu(e)})),this.register((function(e){return new Ru(e)})),this.register((function(e){return new Du(e)})),this.register((function(e){return new Lu(e)})),this.register((function(e){return new _u(e)})),this.register((function(e){return new Iu(e)})),this.register((function(e){return new Su(e)})),this.register((function(e){return new Mu(e)})),this.register((function(e){return new bu(e)})),this.register((function(e){return new Tu(e)})),this.register((function(e){return new Cu(e)})),this.register((function(e){return new Pu(e)})),this.register((function(e){return new Bu(e)})),this.register((function(e){return new vu(e)})),this.register((function(e){return new ku(e)})),this.register((function(e){return new Ou(e)}))}load(e,t,r,n){const i=this;let o;if(""!==this.resourcePath)o=this.resourcePath;else if(""!==this.path){const t=s.LoaderUtils.extractUrlBase(e);o=s.LoaderUtils.resolveURL(t,this.path)}else o=s.LoaderUtils.extractUrlBase(e);this.manager.itemStart(e);const a=function(t){n?n(t):console.error(t),i.manager.itemError(e),i.manager.itemEnd(e)},l=new s.FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,(function(r){try{i.parse(r,o,(function(r){t(r),i.manager.itemEnd(e)}),a)}catch(e){a(e)}}),r,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,n){let i;const s={},o={},a=new TextDecoder;if("string"==typeof e)i=JSON.parse(e);else if(e instanceof ArrayBuffer)if(a.decode(new Uint8Array(e,0,4))===Fu){try{s[yu.KHR_BINARY_GLTF]=new Nu(e)}catch(e){return void(n&&n(e))}i=JSON.parse(s[yu.KHR_BINARY_GLTF].content)}else i=JSON.parse(a.decode(e));else i=e;if(void 0===i.asset||i.asset.version[0]<2)return void(n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new od(i,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){const t=this.pluginCallbacks[e](l);t.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[t.name]=t,s[t.name]=!0}if(i.extensionsUsed)for(let e=0;e<i.extensionsUsed.length;++e){const t=i.extensionsUsed[e],r=i.extensionsRequired||[];switch(t){case yu.KHR_MATERIALS_UNLIT:s[t]=new wu;break;case yu.KHR_DRACO_MESH_COMPRESSION:s[t]=new Uu(i,this.dracoLoader);break;case yu.KHR_TEXTURE_TRANSFORM:s[t]=new Qu;break;case yu.KHR_MESH_QUANTIZATION:s[t]=new Gu;break;default:r.indexOf(t)>=0&&void 0===o[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}l.setExtensions(s),l.setPlugins(o),l.parse(r,n)}parseAsync(e,t){const r=this;return new Promise((function(n,i){r.parse(e,t,n,i)}))}}function mu(){let e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const yu={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class vu{constructor(e){this.parser=e,this.name=yu.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let r=0,n=t.length;r<n;r++){const n=t[r];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&e._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(e){const t=this.parser,r="light:"+e;let n=t.cache.get(r);if(n)return n;const i=t.json,o=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let a;const l=new s.Color(16777215);void 0!==o.color&&l.setRGB(o.color[0],o.color[1],o.color[2],s.LinearSRGBColorSpace);const c=void 0!==o.range?o.range:0;switch(o.type){case"directional":a=new s.DirectionalLight(l),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new s.PointLight(l),a.distance=c;break;case"spot":a=new s.SpotLight(l),a.distance=c,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,a.angle=o.spot.outerConeAngle,a.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return a.position.set(0,0,0),ed(a,o),void 0!==o.intensity&&(a.intensity=o.intensity),a.name=t.createUniqueName(o.name||"light_"+e),n=Promise.resolve(a),t.cache.add(r,n),n}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){const t=this,r=this.parser,n=r.json.nodes[e],i=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(e){return r._getNodeRef(t.cache,i,e)}))}}class wu{constructor(){this.name=yu.KHR_MATERIALS_UNLIT}getMaterialType(){return s.MeshBasicMaterial}extendParams(e,t,r){const n=[];e.color=new s.Color(1,1,1),e.opacity=1;const i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const t=i.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],s.LinearSRGBColorSpace),e.opacity=t[3]}void 0!==i.baseColorTexture&&n.push(r.assignTexture(e,"map",i.baseColorTexture,s.SRGBColorSpace))}return Promise.all(n)}}class bu{constructor(e){this.parser=e,this.name=yu.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=r.extensions[this.name].emissiveStrength;return void 0!==n&&(t.emissiveIntensity=n),Promise.resolve()}}class Eu{constructor(e){this.parser=e,this.name=yu.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?s.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&i.push(r.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&i.push(r.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(i.push(r.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const e=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new s.Vector2(e,e)}return Promise.all(i)}}class xu{constructor(e){this.parser=e,this.name=yu.KHR_MATERIALS_DISPERSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?s.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=r.extensions[this.name];return t.dispersion=void 0!==n.dispersion?n.dispersion:0,Promise.resolve()}}class Cu{constructor(e){this.parser=e,this.name=yu.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?s.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],s=n.extensions[this.name];return void 0!==s.iridescenceFactor&&(t.iridescence=s.iridescenceFactor),void 0!==s.iridescenceTexture&&i.push(r.assignTexture(t,"iridescenceMap",s.iridescenceTexture)),void 0!==s.iridescenceIor&&(t.iridescenceIOR=s.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==s.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=s.iridescenceThicknessMinimum),void 0!==s.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=s.iridescenceThicknessMaximum),void 0!==s.iridescenceThicknessTexture&&i.push(r.assignTexture(t,"iridescenceThicknessMap",s.iridescenceThicknessTexture)),Promise.all(i)}}class _u{constructor(e){this.parser=e,this.name=yu.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?s.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[];t.sheenColor=new s.Color(0,0,0),t.sheenRoughness=0,t.sheen=1;const o=n.extensions[this.name];if(void 0!==o.sheenColorFactor){const e=o.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],s.LinearSRGBColorSpace)}return void 0!==o.sheenRoughnessFactor&&(t.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&i.push(r.assignTexture(t,"sheenColorMap",o.sheenColorTexture,s.SRGBColorSpace)),void 0!==o.sheenRoughnessTexture&&i.push(r.assignTexture(t,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(i)}}class Iu{constructor(e){this.parser=e,this.name=yu.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?s.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],s=n.extensions[this.name];return void 0!==s.transmissionFactor&&(t.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&i.push(r.assignTexture(t,"transmissionMap",s.transmissionTexture)),Promise.all(i)}}class Su{constructor(e){this.parser=e,this.name=yu.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?s.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];t.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&i.push(r.assignTexture(t,"thicknessMap",o.thicknessTexture)),t.attenuationDistance=o.attenuationDistance||1/0;const a=o.attenuationColor||[1,1,1];return t.attenuationColor=(new s.Color).setRGB(a[0],a[1],a[2],s.LinearSRGBColorSpace),Promise.all(i)}}class Mu{constructor(e){this.parser=e,this.name=yu.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?s.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const n=r.extensions[this.name];return t.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class Tu{constructor(e){this.parser=e,this.name=yu.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?s.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],o=n.extensions[this.name];t.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&i.push(r.assignTexture(t,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return t.specularColor=(new s.Color).setRGB(a[0],a[1],a[2],s.LinearSRGBColorSpace),void 0!==o.specularColorTexture&&i.push(r.assignTexture(t,"specularColorMap",o.specularColorTexture,s.SRGBColorSpace)),Promise.all(i)}}class Bu{constructor(e){this.parser=e,this.name=yu.EXT_MATERIALS_BUMP}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?s.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],s=n.extensions[this.name];return t.bumpScale=void 0!==s.bumpFactor?s.bumpFactor:1,void 0!==s.bumpTexture&&i.push(r.assignTexture(t,"bumpMap",s.bumpTexture)),Promise.all(i)}}class Pu{constructor(e){this.parser=e,this.name=yu.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?s.MeshPhysicalMaterial:null}extendMaterialParams(e,t){const r=this.parser,n=r.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],s=n.extensions[this.name];return void 0!==s.anisotropyStrength&&(t.anisotropy=s.anisotropyStrength),void 0!==s.anisotropyRotation&&(t.anisotropyRotation=s.anisotropyRotation),void 0!==s.anisotropyTexture&&i.push(r.assignTexture(t,"anisotropyMap",s.anisotropyTexture)),Promise.all(i)}}class Ru{constructor(e){this.parser=e,this.name=yu.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,r=t.json,n=r.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const i=n.extensions[this.name],s=t.options.ktx2Loader;if(!s){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,s)}}class Du{constructor(e){this.parser=e,this.name=yu.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,n=r.json,i=n.textures[e];if(!i.extensions||!i.extensions[t])return null;const s=i.extensions[t],o=n.images[s.source];let a=r.textureLoader;if(o.uri){const e=r.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then((function(i){if(i)return r.loadTextureImage(e,s.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class Lu{constructor(e){this.parser=e,this.name=yu.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,r=this.parser,n=r.json,i=n.textures[e];if(!i.extensions||!i.extensions[t])return null;const s=i.extensions[t],o=n.images[s.source];let a=r.textureLoader;if(o.uri){const e=r.options.manager.getHandler(o.uri);null!==e&&(a=e)}return this.detectSupport().then((function(i){if(i)return r.loadTextureImage(e,s.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported}}class ku{constructor(e){this.name=yu.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,r=t.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const e=r.extensions[this.name],n=this.parser.getDependency("buffer",e.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return n.then((function(t){const r=e.byteOffset||0,n=e.byteLength||0,s=e.count,o=e.byteStride,a=new Uint8Array(t,r,n);return i.decodeGltfBufferAsync?i.decodeGltfBufferAsync(s,o,a,e.mode,e.filter).then((function(e){return e.buffer})):i.ready.then((function(){const t=new ArrayBuffer(s*o);return i.decodeGltfBuffer(new Uint8Array(t),s,o,a,e.mode,e.filter),t}))}))}return null}}class Ou{constructor(e){this.name=yu.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,r=t.nodes[e];if(!r.extensions||!r.extensions[this.name]||void 0===r.mesh)return null;const n=t.meshes[r.mesh];for(const e of n.primitives)if(e.mode!==qu.TRIANGLES&&e.mode!==qu.TRIANGLE_STRIP&&e.mode!==qu.TRIANGLE_FAN&&void 0!==e.mode)return null;const i=r.extensions[this.name].attributes,o=[],a={};for(const e in i)o.push(this.parser.getDependency("accessor",i[e]).then((t=>(a[e]=t,a[e]))));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then((e=>{const t=e.pop(),r=t.isGroup?t.children:[t],n=e[0].count,i=[];for(const e of r){const t=new s.Matrix4,r=new s.Vector3,o=new s.Quaternion,l=new s.Vector3(1,1,1),c=new s.InstancedMesh(e.geometry,e.material,n);for(let e=0;e<n;e++)a.TRANSLATION&&r.fromBufferAttribute(a.TRANSLATION,e),a.ROTATION&&o.fromBufferAttribute(a.ROTATION,e),a.SCALE&&l.fromBufferAttribute(a.SCALE,e),c.setMatrixAt(e,t.compose(r,o,l));for(const t in a)if("_COLOR_0"===t){const e=a[t];c.instanceColor=new s.InstancedBufferAttribute(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,a[t]);s.Object3D.prototype.copy.call(c,e),this.parser.assignFinalMaterial(c),i.push(c)}return t.isGroup?(t.clear(),t.add(...i),t):i[0]})))}}const Fu="glTF";class Nu{constructor(e){this.name=yu.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12),r=new TextDecoder;if(this.header={magic:r.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Fu)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,i=new DataView(e,12);let s=0;for(;s<n;){const t=i.getUint32(s,!0);s+=4;const n=i.getUint32(s,!0);if(s+=4,1313821514===n){const n=new Uint8Array(e,12+s,t);this.content=r.decode(n)}else if(5130562===n){const r=12+s;this.body=e.slice(r,r+t)}s+=t}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Uu{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=yu.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const r=this.json,n=this.dracoLoader,i=e.extensions[this.name].bufferView,o=e.extensions[this.name].attributes,a={},l={},c={};for(const e in o){const t=Ku[e]||e.toLowerCase();a[t]=o[e]}for(const t in e.attributes){const n=Ku[t]||t.toLowerCase();if(void 0!==o[t]){const i=r.accessors[e.attributes[t]],s=Hu[i.componentType];c[n]=s.name,l[n]=!0===i.normalized}}return t.getDependency("bufferView",i).then((function(e){return new Promise((function(t,r){n.decodeDracoFile(e,(function(e){for(const t in e.attributes){const r=e.attributes[t],n=l[t];void 0!==n&&(r.normalized=n)}t(e)}),a,c,s.LinearSRGBColorSpace,r)}))}))}}class Qu{constructor(){this.name=yu.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return void 0!==t.texCoord&&t.texCoord!==e.channel||void 0!==t.offset||void 0!==t.rotation||void 0!==t.scale?(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0,e):e}}class Gu{constructor(){this.name=yu.KHR_MESH_QUANTIZATION}}class zu extends s.Interpolant{constructor(e,t,r,n){super(e,t,r,n)}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,n=this.valueSize,i=e*n*3+n;for(let e=0;e!==n;e++)t[e]=r[i+e];return t}interpolate_(e,t,r,n){const i=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,c=n-t,h=(r-t)/c,u=h*h,d=u*h,p=e*l,f=p-l,g=-2*d+3*u,A=d-u,m=1-g,y=A-u+h;for(let e=0;e!==o;e++){const t=s[f+e+o],r=s[f+e+a]*c,n=s[p+e+o],l=s[p+e]*c;i[e]=m*t+y*r+g*n+A*l}return i}}const ju=new s.Quaternion;class Vu extends zu{interpolate_(e,t,r,n){const i=super.interpolate_(e,t,r,n);return ju.fromArray(i).normalize().toArray(i),i}}const qu={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Hu={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Wu={9728:s.NearestFilter,9729:s.LinearFilter,9984:s.NearestMipmapNearestFilter,9985:s.LinearMipmapNearestFilter,9986:s.NearestMipmapLinearFilter,9987:s.LinearMipmapLinearFilter},$u={33071:s.ClampToEdgeWrapping,33648:s.MirroredRepeatWrapping,10497:s.RepeatWrapping},Yu={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ku={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ju={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Xu={CUBICSPLINE:void 0,LINEAR:s.InterpolateLinear,STEP:s.InterpolateDiscrete};function Zu(e,t,r){for(const n in r.extensions)void 0===e[n]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=r.extensions[n])}function ed(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function td(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let r=0,n=t.weights.length;r<n;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){const r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(let t=0,n=r.length;t<n;t++)e.morphTargetDictionary[r[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function rd(e){let t;const r=e.extensions&&e.extensions[yu.KHR_DRACO_MESH_COMPRESSION];if(t=r?"draco:"+r.bufferView+":"+r.indices+":"+nd(r.attributes):e.indices+":"+nd(e.attributes)+":"+e.mode,void 0!==e.targets)for(let r=0,n=e.targets.length;r<n;r++)t+=":"+nd(e.targets[r]);return t}function nd(e){let t="";const r=Object.keys(e).sort();for(let n=0,i=r.length;n<i;n++)t+=r[n]+":"+e[r[n]]+";";return t}function id(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const sd=new s.Matrix4;class od{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new mu,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,n=-1,i=!1,o=-1;if("undefined"!=typeof navigator){const e=navigator.userAgent;r=!0===/^((?!chrome|android).)*safari/i.test(e);const t=e.match(/Version\/(\d+)/);n=r&&t?parseInt(t[1],10):-1,i=e.indexOf("Firefox")>-1,o=i?e.match(/Firefox\/([0-9]+)\./)[1]:-1}"undefined"==typeof createImageBitmap||r&&n<17||i&&o<98?this.textureLoader=new s.TextureLoader(this.options.manager):this.textureLoader=new s.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new s.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const r=this,n=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])})).then((function(t){const s={scene:t[0][n.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:n.asset,parser:r,userData:{}};return Zu(i,s,n),ed(s,n),Promise.all(r._invokeAll((function(e){return e.afterRoot&&e.afterRoot(s)}))).then((function(){for(const e of s.scenes)e.updateMatrixWorld();e(s)}))})).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let r=0,n=t.length;r<n;r++){const n=t[r].joints;for(let t=0,r=n.length;t<r;t++)e[n[t]].isBone=!0}for(let t=0,n=e.length;t<n;t++){const n=e[t];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(r[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;const n=r.clone(),i=(e,t)=>{const r=this.associations.get(e);null!=r&&this.associations.set(t,r);for(const[r,n]of e.children.entries())i(n,t.children[r])};return i(r,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){const n=e(t[r]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const r=[];for(let n=0;n<t.length;n++){const i=e(t[n]);i&&r.push(i)}return r}getDependency(e,t){const r=e+":"+t;let n=this.cache.get(r);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne((function(e){return e.loadNode&&e.loadNode(t)}));break;case"mesh":n=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":n=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne((function(e){return e.loadAnimation&&e.loadAnimation(t)}));break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne((function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)})),!n)throw new Error("Unknown type: "+e)}this.cache.add(r,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const r=this,n=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(n.map((function(t,n){return r.getDependency(e,n)}))),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[yu.KHR_BINARY_GLTF].body);const n=this.options;return new Promise((function(e,i){r.load(s.LoaderUtils.resolveURL(t.uri,n.path),e,void 0,(function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){const r=t.byteLength||0,n=t.byteOffset||0;return e.slice(n,n+r)}))}loadAccessor(e){const t=this,r=this.json,n=this.json.accessors[e];if(void 0===n.bufferView&&void 0===n.sparse){const e=Yu[n.type],t=Hu[n.componentType],r=!0===n.normalized,i=new t(n.count*e);return Promise.resolve(new s.BufferAttribute(i,e,r))}const i=[];return void 0!==n.bufferView?i.push(this.getDependency("bufferView",n.bufferView)):i.push(null),void 0!==n.sparse&&(i.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(i).then((function(e){const i=e[0],o=Yu[n.type],a=Hu[n.componentType],l=a.BYTES_PER_ELEMENT,c=l*o,h=n.byteOffset||0,u=void 0!==n.bufferView?r.bufferViews[n.bufferView].byteStride:void 0,d=!0===n.normalized;let p,f;if(u&&u!==c){const e=Math.floor(h/u),r="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+e+":"+n.count;let c=t.cache.get(r);c||(p=new a(i,e*u,n.count*u/l),c=new s.InterleavedBuffer(p,u/l),t.cache.add(r,c)),f=new s.InterleavedBufferAttribute(c,o,h%u/l,d)}else p=null===i?new a(n.count*o):new a(i,h,n.count*o),f=new s.BufferAttribute(p,o,d);if(void 0!==n.sparse){const t=Yu.SCALAR,r=Hu[n.sparse.indices.componentType],l=n.sparse.indices.byteOffset||0,c=n.sparse.values.byteOffset||0,h=new r(e[1],l,n.sparse.count*t),u=new a(e[2],c,n.sparse.count*o);null!==i&&(f=new s.BufferAttribute(f.array.slice(),f.itemSize,f.normalized)),f.normalized=!1;for(let e=0,t=h.length;e<t;e++){const t=h[e];if(f.setX(t,u[e*o]),o>=2&&f.setY(t,u[e*o+1]),o>=3&&f.setZ(t,u[e*o+2]),o>=4&&f.setW(t,u[e*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}f.normalized=d}return f}))}loadTexture(e){const t=this.json,r=this.options,n=t.textures[e].source,i=t.images[n];let s=this.textureLoader;if(i.uri){const e=r.manager.getHandler(i.uri);null!==e&&(s=e)}return this.loadTextureImage(e,n,s)}loadTextureImage(e,t,r){const n=this,i=this.json,o=i.textures[e],a=i.images[t],l=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,r).then((function(t){t.flipY=!1,t.name=o.name||a.name||"",""===t.name&&"string"==typeof a.uri&&!1===a.uri.startsWith("data:image/")&&(t.name=a.uri);const r=(i.samplers||{})[o.sampler]||{};return t.magFilter=Wu[r.magFilter]||s.LinearFilter,t.minFilter=Wu[r.minFilter]||s.LinearMipmapLinearFilter,t.wrapS=$u[r.wrapS]||s.RepeatWrapping,t.wrapT=$u[r.wrapT]||s.RepeatWrapping,t.generateMipmaps=!t.isCompressedTexture&&t.minFilter!==s.NearestFilter&&t.minFilter!==s.LinearFilter,n.associations.set(t,{textures:e}),t})).catch((function(){return null}));return this.textureCache[l]=c,c}loadImageSource(e,t){const r=this.json,n=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then((e=>e.clone()));const i=r.images[e],o=self.URL||self.webkitURL;let a=i.uri||"",l=!1;if(void 0!==i.bufferView)a=this.getDependency("bufferView",i.bufferView).then((function(e){l=!0;const t=new Blob([e],{type:i.mimeType});return a=o.createObjectURL(t),a}));else if(void 0===i.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const c=Promise.resolve(a).then((function(e){return new Promise((function(r,i){let o=r;!0===t.isImageBitmapLoader&&(o=function(e){const t=new s.Texture(e);t.needsUpdate=!0,r(t)}),t.load(s.LoaderUtils.resolveURL(e,n.path),o,void 0,i)}))})).then((function(e){var t;return!0===l&&o.revokeObjectURL(a),ed(e,i),e.userData.mimeType=i.mimeType||((t=i.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":t.search(/\.ktx2($|\?)/i)>0||0===t.search(/^data\:image\/ktx2/)?"image/ktx2":"image/png"),e})).catch((function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),e}));return this.sourceCache[e]=c,c}assignTexture(e,t,r,n){const i=this;return this.getDependency("texture",r.index).then((function(s){if(!s)return null;if(void 0!==r.texCoord&&r.texCoord>0&&((s=s.clone()).channel=r.texCoord),i.extensions[yu.KHR_TEXTURE_TRANSFORM]){const e=void 0!==r.extensions?r.extensions[yu.KHR_TEXTURE_TRANSFORM]:void 0;if(e){const t=i.associations.get(s);s=i.extensions[yu.KHR_TEXTURE_TRANSFORM].extendTexture(s,e),i.associations.set(s,t)}}return void 0!==n&&(s.colorSpace=n),e[t]=s,s}))}assignFinalMaterial(e){const t=e.geometry;let r=e.material;const n=void 0===t.attributes.tangent,i=void 0!==t.attributes.color,o=void 0===t.attributes.normal;if(e.isPoints){const e="PointsMaterial:"+r.uuid;let t=this.cache.get(e);t||(t=new s.PointsMaterial,s.Material.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,t.sizeAttenuation=!1,this.cache.add(e,t)),r=t}else if(e.isLine){const e="LineBasicMaterial:"+r.uuid;let t=this.cache.get(e);t||(t=new s.LineBasicMaterial,s.Material.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,this.cache.add(e,t)),r=t}if(n||i||o){let e="ClonedMaterial:"+r.uuid+":";n&&(e+="derivative-tangents:"),i&&(e+="vertex-colors:"),o&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=r.clone(),i&&(t.vertexColors=!0),o&&(t.flatShading=!0),n&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(r))),r=t}e.material=r}getMaterialType(){return s.MeshStandardMaterial}loadMaterial(e){const t=this,r=this.json,n=this.extensions,i=r.materials[e];let o;const a={},l=[];if((i.extensions||{})[yu.KHR_MATERIALS_UNLIT]){const e=n[yu.KHR_MATERIALS_UNLIT];o=e.getMaterialType(),l.push(e.extendParams(a,i,t))}else{const r=i.pbrMetallicRoughness||{};if(a.color=new s.Color(1,1,1),a.opacity=1,Array.isArray(r.baseColorFactor)){const e=r.baseColorFactor;a.color.setRGB(e[0],e[1],e[2],s.LinearSRGBColorSpace),a.opacity=e[3]}void 0!==r.baseColorTexture&&l.push(t.assignTexture(a,"map",r.baseColorTexture,s.SRGBColorSpace)),a.metalness=void 0!==r.metallicFactor?r.metallicFactor:1,a.roughness=void 0!==r.roughnessFactor?r.roughnessFactor:1,void 0!==r.metallicRoughnessTexture&&(l.push(t.assignTexture(a,"metalnessMap",r.metallicRoughnessTexture)),l.push(t.assignTexture(a,"roughnessMap",r.metallicRoughnessTexture))),o=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),l.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)}))))}!0===i.doubleSided&&(a.side=s.DoubleSide);const c=i.alphaMode||"OPAQUE";if("BLEND"===c?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,"MASK"===c&&(a.alphaTest=void 0!==i.alphaCutoff?i.alphaCutoff:.5)),void 0!==i.normalTexture&&o!==s.MeshBasicMaterial&&(l.push(t.assignTexture(a,"normalMap",i.normalTexture)),a.normalScale=new s.Vector2(1,1),void 0!==i.normalTexture.scale)){const e=i.normalTexture.scale;a.normalScale.set(e,e)}if(void 0!==i.occlusionTexture&&o!==s.MeshBasicMaterial&&(l.push(t.assignTexture(a,"aoMap",i.occlusionTexture)),void 0!==i.occlusionTexture.strength&&(a.aoMapIntensity=i.occlusionTexture.strength)),void 0!==i.emissiveFactor&&o!==s.MeshBasicMaterial){const e=i.emissiveFactor;a.emissive=(new s.Color).setRGB(e[0],e[1],e[2],s.LinearSRGBColorSpace)}return void 0!==i.emissiveTexture&&o!==s.MeshBasicMaterial&&l.push(t.assignTexture(a,"emissiveMap",i.emissiveTexture,s.SRGBColorSpace)),Promise.all(l).then((function(){const r=new o(a);return i.name&&(r.name=i.name),ed(r,i),t.associations.set(r,{materials:e}),i.extensions&&Zu(n,r,i),r}))}createUniqueName(e){const t=s.PropertyBinding.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,r=this.extensions,n=this.primitiveCache;function i(e){return r[yu.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(r){return ad(r,e,t)}))}const o=[];for(let r=0,a=e.length;r<a;r++){const a=e[r],l=rd(a),c=n[l];if(c)o.push(c.promise);else{let e;e=a.extensions&&a.extensions[yu.KHR_DRACO_MESH_COMPRESSION]?i(a):ad(new s.BufferGeometry,a,t),n[l]={primitive:a,promise:e},o.push(e)}}return Promise.all(o)}loadMesh(e){const t=this,r=this.json,n=this.extensions,i=r.meshes[e],o=i.primitives,a=[];for(let e=0,t=o.length;e<t;e++){const t=void 0===o[e].material?(void 0===(l=this.cache).DefaultMaterial&&(l.DefaultMaterial=new s.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:s.FrontSide})),l.DefaultMaterial):this.getDependency("material",o[e].material);a.push(t)}var l;return a.push(t.loadGeometries(o)),Promise.all(a).then((function(r){const a=r.slice(0,r.length-1),l=r[r.length-1],c=[];for(let r=0,h=l.length;r<h;r++){const h=l[r],u=o[r];let d;const p=a[r];if(u.mode===qu.TRIANGLES||u.mode===qu.TRIANGLE_STRIP||u.mode===qu.TRIANGLE_FAN||void 0===u.mode)d=!0===i.isSkinnedMesh?new s.SkinnedMesh(h,p):new s.Mesh(h,p),!0===d.isSkinnedMesh&&d.normalizeSkinWeights(),u.mode===qu.TRIANGLE_STRIP?d.geometry=gu(d.geometry,s.TriangleStripDrawMode):u.mode===qu.TRIANGLE_FAN&&(d.geometry=gu(d.geometry,s.TriangleFanDrawMode));else if(u.mode===qu.LINES)d=new s.LineSegments(h,p);else if(u.mode===qu.LINE_STRIP)d=new s.Line(h,p);else if(u.mode===qu.LINE_LOOP)d=new s.LineLoop(h,p);else{if(u.mode!==qu.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);d=new s.Points(h,p)}Object.keys(d.geometry.morphAttributes).length>0&&td(d,i),d.name=t.createUniqueName(i.name||"mesh_"+e),ed(d,i),u.extensions&&Zu(n,d,u),t.assignFinalMaterial(d),c.push(d)}for(let r=0,n=c.length;r<n;r++)t.associations.set(c[r],{meshes:e,primitives:r});if(1===c.length)return i.extensions&&Zu(n,c[0],i),c[0];const h=new s.Group;i.extensions&&Zu(n,h,i),t.associations.set(h,{meshes:e});for(let e=0,t=c.length;e<t;e++)h.add(c[e]);return h}))}loadCamera(e){let t;const r=this.json.cameras[e],n=r[r.type];if(n)return"perspective"===r.type?t=new s.PerspectiveCamera(s.MathUtils.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===r.type&&(t=new s.OrthographicCamera(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),ed(t,r),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],r=[];for(let e=0,n=t.joints.length;e<n;e++)r.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?r.push(this.getDependency("accessor",t.inverseBindMatrices)):r.push(null),Promise.all(r).then((function(e){const r=e.pop(),n=e,i=[],o=[];for(let e=0,a=n.length;e<a;e++){const a=n[e];if(a){i.push(a);const t=new s.Matrix4;null!==r&&t.fromArray(r.array,16*e),o.push(t)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[e])}return new s.Skeleton(i,o)}))}loadAnimation(e){const t=this.json,r=this,n=t.animations[e],i=n.name?n.name:"animation_"+e,o=[],a=[],l=[],c=[],h=[];for(let e=0,t=n.channels.length;e<t;e++){const t=n.channels[e],r=n.samplers[t.sampler],i=t.target,s=i.node,u=void 0!==n.parameters?n.parameters[r.input]:r.input,d=void 0!==n.parameters?n.parameters[r.output]:r.output;void 0!==i.node&&(o.push(this.getDependency("node",s)),a.push(this.getDependency("accessor",u)),l.push(this.getDependency("accessor",d)),c.push(r),h.push(i))}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(h)]).then((function(e){const t=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=[];for(let e=0,i=t.length;e<i;e++){const i=t[e],s=n[e],h=o[e],u=a[e],d=l[e];if(void 0===i)continue;i.updateMatrix&&i.updateMatrix();const p=r._createAnimationTracks(i,s,h,u,d);if(p)for(let e=0;e<p.length;e++)c.push(p[e])}return new s.AnimationClip(i,void 0,c)}))}createNodeMesh(e){const t=this.json,r=this,n=t.nodes[e];return void 0===n.mesh?null:r.getDependency("mesh",n.mesh).then((function(e){const t=r._getNodeRef(r.meshCache,n.mesh,e);return void 0!==n.weights&&t.traverse((function(e){if(e.isMesh)for(let t=0,r=n.weights.length;t<r;t++)e.morphTargetInfluences[t]=n.weights[t]})),t}))}loadNode(e){const t=this,r=this.json.nodes[e],n=t._loadNodeShallow(e),i=[],s=r.children||[];for(let e=0,r=s.length;e<r;e++)i.push(t.getDependency("node",s[e]));const o=void 0===r.skin?Promise.resolve(null):t.getDependency("skin",r.skin);return Promise.all([n,Promise.all(i),o]).then((function(e){const t=e[0],r=e[1],n=e[2];null!==n&&t.traverse((function(e){e.isSkinnedMesh&&e.bind(n,sd)}));for(let e=0,n=r.length;e<n;e++)t.add(r[e]);return t}))}_loadNodeShallow(e){const t=this.json,r=this.extensions,n=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];const i=t.nodes[e],o=i.name?n.createUniqueName(i.name):"",a=[],l=n._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)}));return l&&a.push(l),void 0!==i.camera&&a.push(n.getDependency("camera",i.camera).then((function(e){return n._getNodeRef(n.cameraCache,i.camera,e)}))),n._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){a.push(e)})),this.nodeCache[e]=Promise.all(a).then((function(t){let a;if(a=!0===i.isBone?new s.Bone:t.length>1?new s.Group:1===t.length?t[0]:new s.Object3D,a!==t[0])for(let e=0,r=t.length;e<r;e++)a.add(t[e]);if(i.name&&(a.userData.name=i.name,a.name=o),ed(a,i),i.extensions&&Zu(r,a,i),void 0!==i.matrix){const e=new s.Matrix4;e.fromArray(i.matrix),a.applyMatrix4(e)}else void 0!==i.translation&&a.position.fromArray(i.translation),void 0!==i.rotation&&a.quaternion.fromArray(i.rotation),void 0!==i.scale&&a.scale.fromArray(i.scale);return n.associations.has(a)||n.associations.set(a,{}),n.associations.get(a).nodes=e,a})),this.nodeCache[e]}loadScene(e){const t=this.extensions,r=this.json.scenes[e],n=this,i=new s.Group;r.name&&(i.name=n.createUniqueName(r.name)),ed(i,r),r.extensions&&Zu(t,i,r);const o=r.nodes||[],a=[];for(let e=0,t=o.length;e<t;e++)a.push(n.getDependency("node",o[e]));return Promise.all(a).then((function(e){for(let t=0,r=e.length;t<r;t++)i.add(e[t]);return n.associations=(e=>{const t=new Map;for(const[e,r]of n.associations)(e instanceof s.Material||e instanceof s.Texture)&&t.set(e,r);return e.traverse((e=>{const r=n.associations.get(e);null!=r&&t.set(e,r)})),t})(i),i}))}_createAnimationTracks(e,t,r,n,i){const o=[],a=e.name?e.name:e.uuid,l=[];let c;switch(Ju[i.path]===Ju.weights?e.traverse((function(e){e.morphTargetInfluences&&l.push(e.name?e.name:e.uuid)})):l.push(a),Ju[i.path]){case Ju.weights:c=s.NumberKeyframeTrack;break;case Ju.rotation:c=s.QuaternionKeyframeTrack;break;case Ju.position:case Ju.scale:c=s.VectorKeyframeTrack;break;default:c=1===r.itemSize?s.NumberKeyframeTrack:s.VectorKeyframeTrack}const h=void 0!==n.interpolation?Xu[n.interpolation]:s.InterpolateLinear,u=this._getArrayFromAccessor(r);for(let e=0,r=l.length;e<r;e++){const r=new c(l[e]+"."+Ju[i.path],t.array,u,h);"CUBICSPLINE"===n.interpolation&&this._createCubicSplineTrackInterpolant(r),o.push(r)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const e=id(t.constructor),r=new Float32Array(t.length);for(let n=0,i=t.length;n<i;n++)r[n]=t[n]*e;t=r}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof s.QuaternionKeyframeTrack?Vu:zu)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function ad(e,t,r){const n=t.attributes,i=[];function o(t,n){return r.getDependency("accessor",t).then((function(t){e.setAttribute(n,t)}))}for(const t in n){const r=Ku[t]||t.toLowerCase();r in e.attributes||i.push(o(n[t],r))}if(void 0!==t.indices&&!e.index){const n=r.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));i.push(n)}return s.ColorManagement.workingColorSpace!==s.LinearSRGBColorSpace&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${s.ColorManagement.workingColorSpace}" not supported.`),ed(e,t),function(e,t,r){const n=t.attributes,i=new s.Box3;if(void 0===n.POSITION)return;{const e=r.json.accessors[n.POSITION],t=e.min,o=e.max;if(void 0===t||void 0===o)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(i.set(new s.Vector3(t[0],t[1],t[2]),new s.Vector3(o[0],o[1],o[2])),e.normalized){const t=id(Hu[e.componentType]);i.min.multiplyScalar(t),i.max.multiplyScalar(t)}}const o=t.targets;if(void 0!==o){const e=new s.Vector3,t=new s.Vector3;for(let n=0,i=o.length;n<i;n++){const i=o[n];if(void 0!==i.POSITION){const n=r.json.accessors[i.POSITION],s=n.min,o=n.max;if(void 0!==s&&void 0!==o){if(t.setX(Math.max(Math.abs(s[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(s[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(s[2]),Math.abs(o[2]))),n.normalized){const e=id(Hu[n.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(e)}e.boundingBox=i;const a=new s.Sphere;i.getCenter(a.center),a.radius=i.min.distanceTo(i.max)/2,e.boundingSphere=a}(e,t,r),Promise.all(i).then((function(){return void 0!==t.targets?function(e,t,r){let n=!1,i=!1,s=!1;for(let e=0,r=t.length;e<r;e++){const r=t[e];if(void 0!==r.POSITION&&(n=!0),void 0!==r.NORMAL&&(i=!0),void 0!==r.COLOR_0&&(s=!0),n&&i&&s)break}if(!n&&!i&&!s)return Promise.resolve(e);const o=[],a=[],l=[];for(let c=0,h=t.length;c<h;c++){const h=t[c];if(n){const t=void 0!==h.POSITION?r.getDependency("accessor",h.POSITION):e.attributes.position;o.push(t)}if(i){const t=void 0!==h.NORMAL?r.getDependency("accessor",h.NORMAL):e.attributes.normal;a.push(t)}if(s){const t=void 0!==h.COLOR_0?r.getDependency("accessor",h.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(l)]).then((function(t){const r=t[0],o=t[1],a=t[2];return n&&(e.morphAttributes.position=r),i&&(e.morphAttributes.normal=o),s&&(e.morphAttributes.color=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,r):e}))}class ld extends fu{constructor(e=s.DefaultLoadingManager){super(),this.manager=e,this.adjustmentTransform=new s.Matrix4}parse(e){const t=super.parse(e),r=t.glbBytes.slice().buffer;return new Promise(((e,n)=>{const i=this.manager,s=this.fetchOptions,o=i.getHandler("path.gltf")||new Au(i);"include"===s.credentials&&"cors"===s.mode&&o.setCrossOrigin("use-credentials"),"credentials"in s&&o.setWithCredentials("include"===s.credentials),s.headers&&o.setRequestHeader(s.headers);let a=this.workingPath;!/[\\/]$/.test(a)&&a.length&&(a+="/");const l=this.adjustmentTransform;o.parse(r,a,(r=>{const{batchTable:n,featureTable:i}=t,{scene:s}=r,o=i.getData("RTC_CENTER");o&&(s.position.x+=o[0],s.position.y+=o[1],s.position.z+=o[2]),r.scene.updateMatrix(),r.scene.matrix.multiply(l),r.scene.matrix.decompose(r.scene.position,r.scene.quaternion,r.scene.scale),r.batchTable=n,r.featureTable=i,s.batchTable=n,s.featureTable=i,e(r)}),n)}))}}class cd extends du{parse(e){const t=new DataView(e),r=pu(t);console.assert("pnts"===r);const n=t.getUint32(4,!0);console.assert(1===n);const i=t.getUint32(8,!0);console.assert(i===e.byteLength);const s=t.getUint32(12,!0),o=t.getUint32(16,!0),a=t.getUint32(20,!0),l=t.getUint32(24,!0),c=e.slice(28,28+s+o),h=new cu(c,0,s,o),u=28+s+o,d=e.slice(u,u+a+l),p=new uu(d,h.getData("BATCH_LENGTH")||h.getData("POINTS_LENGTH"),0,a,l);return Promise.resolve({version:n,featureTable:h,batchTable:p})}}function hd(e){const t=e>>11,r=e>>5&63,n=31&e;return[Math.round(t/31*255),Math.round(r/63*255),Math.round(n/31*255)]}const ud=new s.Vector2;function dd(e,t,r=new s.Vector3){ud.set(e,t).divideScalar(256).multiplyScalar(2).subScalar(1),r.set(ud.x,ud.y,1-Math.abs(ud.x)-Math.abs(ud.y));const n=s.MathUtils.clamp(-r.z,0,1);return r.x>=0?r.setX(r.x-n):r.setX(r.x+n),r.y>=0?r.setY(r.y-n):r.setY(r.y+n),r.normalize(),r}const pd={RGB:"color",POSITION:"position"};class fd extends cd{constructor(e=s.DefaultLoadingManager){super(),this.manager=e}parse(e){return super.parse(e).then((async e=>{const{featureTable:t,batchTable:r}=e,n=new s.PointsMaterial,i=t.header.extensions,o=new s.Vector3;let a;if(i&&i["3DTILES_draco_point_compression"]){const{byteOffset:e,byteLength:r,properties:s}=i["3DTILES_draco_point_compression"],o=this.manager.getHandler("draco.drc");if(null==o)throw new Error("PNTSLoader: dracoLoader not available.");const l={};for(const e in s)e in pd&&e in s&&(l[pd[e]]=s[e]);const c={attributeIDs:l,attributeTypes:{position:"Float32Array",color:"Uint8Array"},useUniqueIDs:!0},h=t.getBuffer(e,r);a=await o.decodeGeometry(h,c),a.attributes.color&&(n.vertexColors=!0)}else{const e=t.getData("POINTS_LENGTH"),r=t.getData("POSITION",e,"FLOAT","VEC3"),i=t.getData("NORMAL",e,"FLOAT","VEC3"),l=t.getData("NORMAL",e,"UNSIGNED_BYTE","VEC2"),c=t.getData("RGB",e,"UNSIGNED_BYTE","VEC3"),h=t.getData("RGBA",e,"UNSIGNED_BYTE","VEC4"),u=t.getData("RGB565",e,"UNSIGNED_SHORT","SCALAR"),d=t.getData("CONSTANT_RGBA",e,"UNSIGNED_BYTE","VEC4"),p=t.getData("POSITION_QUANTIZED",e,"UNSIGNED_SHORT","VEC3"),f=t.getData("QUANTIZED_VOLUME_SCALE",e,"FLOAT","VEC3"),g=t.getData("QUANTIZED_VOLUME_OFFSET",e,"FLOAT","VEC3");if(a=new s.BufferGeometry,p){const t=new Float32Array(3*e);for(let r=0;r<e;r++)for(let e=0;e<3;e++){const n=3*r+e;t[n]=p[n]/65535*f[e]}o.x=g[0],o.y=g[1],o.z=g[2],a.setAttribute("position",new s.BufferAttribute(t,3,!1))}else a.setAttribute("position",new s.BufferAttribute(r,3,!1));if(null!==i)a.setAttribute("normal",new s.BufferAttribute(i,3,!1));else if(null!==l){const t=new Float32Array(3*e),r=new s.Vector3;for(let n=0;n<e;n++){const e=dd(l[2*n],l[2*n+1],r);t[3*n]=e.x,t[3*n+1]=e.y,t[3*n+2]=e.z}a.setAttribute("normal",new s.BufferAttribute(t,3,!1))}if(null!==h)a.setAttribute("color",new s.BufferAttribute(h,4,!0)),n.vertexColors=!0,n.transparent=!0,n.depthWrite=!1;else if(null!==c)a.setAttribute("color",new s.BufferAttribute(c,3,!0)),n.vertexColors=!0;else if(null!==u){const t=new Uint8Array(3*e);for(let r=0;r<e;r++){const e=hd(u[r]);for(let n=0;n<3;n++)t[3*r+n]=e[n]}a.setAttribute("color",new s.BufferAttribute(t,3,!0)),n.vertexColors=!0}else if(null!==d){const e=new s.Color(d[0],d[1],d[2]);n.color=e;const t=d[3]/255;t<1&&(n.opacity=t,n.transparent=!0,n.depthWrite=!1)}}const l=new s.Points(a,n);l.position.copy(o),e.scene=l,e.scene.featureTable=t,e.scene.batchTable=r;const c=t.getData("RTC_CENTER");return c&&(e.scene.position.x+=c[0],e.scene.position.y+=c[1],e.scene.position.z+=c[2]),e}))}}class gd extends du{parse(e){const t=new DataView(e),r=pu(t);console.assert("i3dm"===r);const n=t.getUint32(4,!0);console.assert(1===n);const i=t.getUint32(8,!0);console.assert(i===e.byteLength);const s=t.getUint32(12,!0),o=t.getUint32(16,!0),a=t.getUint32(20,!0),l=t.getUint32(24,!0),c=t.getUint32(28,!0),h=e.slice(32,32+s+o),u=new cu(h,0,s,o),d=32+s+o,p=e.slice(d,d+a+l),f=new uu(p,u.getData("INSTANCES_LENGTH"),0,a,l),g=d+a+l,A=new Uint8Array(e,g,i-g);let m=null,y=null,v=null;if(c)m=A,y=Promise.resolve();else{const e=this.resolveExternalURL(au(A)),t=e.split(/[\\/]/g);t.pop(),v=t.join("/"),y=fetch(e,this.fetchOptions).then((t=>{if(!t.ok)throw new Error(`I3DMLoaderBase : Failed to load file "${e}" with status ${t.status} : ${t.statusText}`);return t.arrayBuffer()})).then((e=>{m=new Uint8Array(e)}))}return y.then((()=>({version:n,featureTable:u,batchTable:f,glbBytes:m,gltfWorkingPath:v})))}}const Ad=new(r(52219).C1)(tu.hb,tu.hb,tu.O3);Ad.name="WGS84 Earth";const md=new s.Vector3,yd=new s.Vector3,vd=new s.Vector3,wd=new s.Vector3,bd=new s.Quaternion,Ed=new s.Vector3,xd=new s.Matrix4,Cd=new s.Matrix4,_d=new s.Vector3,Id=new s.Matrix4,Sd=new s.Quaternion,Md={};class Td extends gd{constructor(e=s.DefaultLoadingManager){super(),this.manager=e,this.adjustmentTransform=new s.Matrix4,this.ellipsoid=Ad.clone()}resolveExternalURL(e){return this.manager.resolveURL(super.resolveExternalURL(e))}parse(e){return super.parse(e).then((e=>{const{featureTable:t,batchTable:r}=e,n=e.glbBytes.slice().buffer;return new Promise(((i,o)=>{const a=this.fetchOptions,l=this.manager,c=l.getHandler("path.gltf")||new Au(l);"include"===a.credentials&&"cors"===a.mode&&c.setCrossOrigin("use-credentials"),"credentials"in a&&c.setWithCredentials("include"===a.credentials),a.headers&&c.setRequestHeader(a.headers);let h=e.gltfWorkingPath??this.workingPath;/[\\/]$/.test(h)||(h+="/");const u=this.adjustmentTransform;c.parse(n,h,(e=>{const n=t.getData("INSTANCES_LENGTH"),o=t.getData("POSITION",n,"FLOAT","VEC3"),a=t.getData("NORMAL_UP",n,"FLOAT","VEC3"),l=t.getData("NORMAL_RIGHT",n,"FLOAT","VEC3"),c=t.getData("SCALE_NON_UNIFORM",n,"FLOAT","VEC3"),h=t.getData("SCALE",n,"FLOAT","SCALAR"),d=t.getData("RTC_CENTER"),p=t.getData("EAST_NORTH_UP");["QUANTIZED_VOLUME_OFFSET","QUANTIZED_VOLUME_SCALE","POSITION_QUANTIZED","NORMAL_UP_OCT32P","NORMAL_RIGHT_OCT32P"].forEach((e=>{e in t.header&&console.warn(`I3DMLoader: Unsupported FeatureTable feature "${e}" detected.`)}));const f=new s.Vector3;for(let e=0;e<n;e++)f.x+=o[3*e+0]/n,f.y+=o[3*e+1]/n,f.z+=o[3*e+2]/n;const g=[],A=[];e.scene.updateMatrixWorld(),e.scene.traverse((e=>{if(e.isMesh){A.push(e);const{geometry:t,material:r}=e,i=new s.InstancedMesh(t,r,n);i.position.copy(f),d&&(i.position.x+=d[0],i.position.y+=d[1],i.position.z+=d[2]),g.push(i)}}));for(let e=0;e<n;e++){wd.set(o[3*e+0]-f.x,o[3*e+1]-f.y,o[3*e+2]-f.z),bd.identity(),a&&(yd.set(a[3*e+0],a[3*e+1],a[3*e+2]),vd.set(l[3*e+0],l[3*e+1],l[3*e+2]),md.crossVectors(vd,yd).normalize(),xd.makeBasis(vd,yd,md),bd.setFromRotationMatrix(xd)),Ed.set(1,1,1),c&&Ed.set(c[3*e+0],c[3*e+1],c[3*e+2]),h&&Ed.multiplyScalar(h[e]);for(let t=0,r=g.length;t<r;t++){const r=g[t];Sd.copy(bd),p&&(r.updateMatrixWorld(),_d.copy(wd).applyMatrix4(r.matrixWorld),this.ellipsoid.getPositionToCartographic(_d,Md),this.ellipsoid.getEastNorthUpFrame(Md.lat,Md.lon,Id),Sd.setFromRotationMatrix(Id)),xd.compose(wd,Sd,Ed).multiply(u);const n=A[t];Cd.multiplyMatrices(xd,n.matrixWorld),r.setMatrixAt(e,Cd)}}e.scene.clear(),e.scene.add(...g),e.batchTable=r,e.featureTable=t,e.scene.batchTable=r,e.scene.featureTable=t,i(e)}),o)}))}))}}class Bd extends du{parse(e){const t=new DataView(e),r=pu(t);console.assert("cmpt"===r,'CMPTLoader: The magic bytes equal "cmpt".');const n=t.getUint32(4,!0);console.assert(1===n,'CMPTLoader: The version listed in the header is "1".');const i=t.getUint32(8,!0);console.assert(i===e.byteLength,"CMPTLoader: The contents buffer length listed in the header matches the file.");const s=t.getUint32(12,!0),o=[];let a=16;for(let t=0;t<s;t++){const t=new DataView(e,a,12),r=pu(t),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=new Uint8Array(e,a,i);o.push({type:r,buffer:s,version:n}),a+=i}return{version:n,tiles:o}}}class Pd extends Bd{constructor(e=s.DefaultLoadingManager){super(),this.manager=e,this.adjustmentTransform=new s.Matrix4,this.ellipsoid=Ad.clone()}parse(e){const t=super.parse(e),{manager:r,ellipsoid:n,adjustmentTransform:i}=this,o=[];for(const e in t.tiles){const{type:s,buffer:a}=t.tiles[e];switch(s){case"b3dm":{const e=a.slice(),t=new ld(r);t.workingPath=this.workingPath,t.fetchOptions=this.fetchOptions,t.adjustmentTransform.copy(i);const n=t.parse(e.buffer);o.push(n);break}case"pnts":{const e=a.slice(),t=new fd(r);t.workingPath=this.workingPath,t.fetchOptions=this.fetchOptions;const n=t.parse(e.buffer);o.push(n);break}case"i3dm":{const e=a.slice(),t=new Td(r);t.workingPath=this.workingPath,t.fetchOptions=this.fetchOptions,t.ellipsoid.copy(n),t.adjustmentTransform.copy(i);const s=t.parse(e.buffer);o.push(s);break}}}return Promise.all(o).then((e=>{const t=new s.Group;return e.forEach((e=>{t.add(e.scene)})),{tiles:e,scene:t}}))}}const Rd=new s.Matrix4;class Dd extends s.Group{constructor(e){super(),this.isTilesGroup=!0,this.name="TilesRenderer.TilesGroup",this.tilesRenderer=e,this.matrixWorldInverse=new s.Matrix4}raycast(e,t){return!this.tilesRenderer.optimizeRaycast||(this.tilesRenderer.raycast(e,t),!1)}updateMatrixWorld(e){if(this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldNeedsUpdate||e){null===this.parent?Rd.copy(this.matrix):Rd.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1;const e=Rd.elements,t=this.matrixWorld.elements;let r=!1;for(let n=0;n<16;n++){const i=e[n],s=t[n];if(Math.abs(i-s)>Number.EPSILON){r=!0;break}}if(r){this.matrixWorld.copy(Rd),this.matrixWorldInverse.copy(Rd).invert();const e=this.children;for(let t=0,r=e.length;t<r;t++)e[t].updateMatrixWorld()}}}}const Ld=new s.Ray,kd=new s.Vector3,Od=[];function Fd(e,t){return e.distance-t.distance}function Nd(e,t,r,n){const{scene:i}=e.cached;r.invokeOnePlugin((r=>r.raycastTile&&r.raycastTile(e,i,t,n)))||t.intersectObject(i,!0,n)}function Ud(e,t,r,n=null){const{group:i,activeTiles:s}=e;e.ensureChildrenArePreprocessed(t),null===n&&(n=Ld).copy(r.ray).applyMatrix4(i.matrixWorldInverse);const o=[],a=t.children;for(let e=0,t=a.length;e<t;e++){const t=a[e];t.__used&&(null!==t.cached.boundingVolume.intersectRay(n,kd)&&(kd.applyMatrix4(i.matrixWorld),o.push({distance:kd.distanceToSquared(r.ray.origin),tile:t})))}o.sort(Fd);let l=null,c=1/0;if(s.has(t)){const n=function(e,t,r){Nd(e,t,r,Od),Od.sort(Fd);const n=Od[0]||null;return Od.length=0,n}(t,r,e);n&&(l=n,c=n.distance*n.distance)}for(let t=0,i=o.length;t<i;t++){const i=o[t],s=i.distance,a=i.tile;if(s>c)break;const h=Ud(e,a,r,n);if(h){const e=h.distance*h.distance;e<c&&(l=h,c=e)}}return l}function Qd(e,t,r,n,i=null){const{group:s,activeTiles:o}=e,{boundingVolume:a}=t.cached;if(e.ensureChildrenArePreprocessed(t),null===i&&(i=Ld).copy(r.ray).applyMatrix4(s.matrixWorldInverse),!t.__used||!a.intersectsRay(i))return;o.has(t)&&Nd(t,r,e,n);const l=t.children;for(let t=0,s=l.length;t<s;t++)Qd(e,l[t],r,n,i)}const Gd=new s.Matrix3;class zd extends s.Frustum{constructor(){super(),this.points=Array(8).fill().map((()=>new s.Vector3))}setFromProjectionMatrix(e,t){return super.setFromProjectionMatrix(e,t),this.calculateFrustumPoints(),this}calculateFrustumPoints(){const{planes:e,points:t}=this;[[e[0],e[3],e[4]],[e[1],e[3],e[4]],[e[0],e[2],e[4]],[e[1],e[2],e[4]],[e[0],e[3],e[5]],[e[1],e[3],e[5]],[e[0],e[2],e[5]],[e[1],e[2],e[5]]].forEach(((e,r)=>{!function(e,t,r,n){const i=Gd.set(e.normal.x,e.normal.y,e.normal.z,t.normal.x,t.normal.y,t.normal.z,r.normal.x,r.normal.y,r.normal.z);n.set(-e.constant,-t.constant,-r.constant),n.applyMatrix3(i.invert())}(e[0],e[1],e[2],t[r])}))}}const jd=new s.Vector3,Vd=new s.Vector3,qd=new s.Vector3,Hd=new s.Ray,Wd=new zd;class $d{constructor(e=new s.Box3,t=new s.Matrix4){this.box=e.clone(),this.transform=t.clone(),this.inverseTransform=new s.Matrix4,this.points=new Array(8).fill().map((()=>new s.Vector3)),this.planes=new Array(6).fill().map((()=>new s.Plane))}copy(e){return this.box.copy(e.box),this.transform.copy(e.transform),this.update(),this}clone(){return(new this.constructor).copy(this)}clampPoint(e,t){return t.copy(e).applyMatrix4(this.inverseTransform).clamp(this.box.min,this.box.max).applyMatrix4(this.transform)}distanceToPoint(e){return this.clampPoint(e,qd).distanceTo(e)}containsPoint(e){return qd.copy(e).applyMatrix4(this.inverseTransform),this.box.containsPoint(qd)}intersectsRay(e){return Hd.copy(e).applyMatrix4(this.inverseTransform),Hd.intersectsBox(this.box)}intersectRay(e,t){return Hd.copy(e).applyMatrix4(this.inverseTransform),Hd.intersectBox(this.box,t)?(t.applyMatrix4(this.transform),t):null}update(){const{points:e,inverseTransform:t,transform:r,box:n}=this;t.copy(r).invert();const{min:i,max:s}=n;let o=0;for(let t=-1;t<=1;t+=2)for(let n=-1;n<=1;n+=2)for(let a=-1;a<=1;a+=2)e[o].set(t<0?i.x:s.x,n<0?i.y:s.y,a<0?i.z:s.z).applyMatrix4(r),o++;this.updatePlanes()}updatePlanes(){jd.copy(this.box.min).applyMatrix4(this.transform),Vd.copy(this.box.max).applyMatrix4(this.transform),qd.set(0,0,1).transformDirection(this.transform),this.planes[0].setFromNormalAndCoplanarPoint(qd,jd),this.planes[1].setFromNormalAndCoplanarPoint(qd,Vd).negate(),qd.set(0,1,0).transformDirection(this.transform),this.planes[2].setFromNormalAndCoplanarPoint(qd,jd),this.planes[3].setFromNormalAndCoplanarPoint(qd,Vd).negate(),qd.set(1,0,0).transformDirection(this.transform),this.planes[4].setFromNormalAndCoplanarPoint(qd,jd),this.planes[5].setFromNormalAndCoplanarPoint(qd,Vd).negate()}intersectsFrustum(e){const{points:t}=this,{planes:r}=e;for(let e=0;e<6;e++){const n=r[e];let i=-1/0;for(let e=0;e<8;e++){const r=t[e],s=n.distanceToPoint(r);i=i<s?s:i}if(i<0)return!1}for(let t=0;t<6;t++){const r=this.planes[t];let n=-1/0;for(let t=0;t<8;t++){const i=e.points[t],s=r.distanceToPoint(i);n=n<s?s:n}if(n<0)return!1}return!0}intersectsSphere(e){return this.clampPoint(e.center,qd),qd.distanceToSquared(e.center)<=e.radius*e.radius}intersectsOBB(e){return Wd.set(...e.planes),Wd.calculateFrustumPoints(),this.intersectsFrustum(Wd)}}var Yd=r(5247);const Kd=new s.Vector3,Jd=new s.Vector3,Xd=new s.Vector3,Zd=new s.Vector3,ep=new s.Vector3;class tp{constructor(){this.sphere=null,this.obb=null,this.region=null,this.regionObb=null}intersectsRay(e){const t=this.sphere,r=this.obb||this.regionObb;return!(t&&!e.intersectsSphere(t)||r&&!r.intersectsRay(e))}intersectRay(e,t=null){const r=this.sphere,n=this.obb||this.regionObb;let i=-1/0,s=-1/0;r&&e.intersectSphere(r,Zd)&&(i=r.containsPoint(e.origin)?0:e.origin.distanceToSquared(Zd)),n&&n.intersectRay(e,ep)&&(s=n.containsPoint(e.origin)?0:e.origin.distanceToSquared(ep));const o=Math.max(i,s);return o===-1/0?null:(e.at(Math.sqrt(o),t),t)}distanceToPoint(e){const t=this.sphere,r=this.obb||this.regionObb;let n=-1/0,i=-1/0;return t&&(n=Math.max(t.distanceToPoint(e),0)),r&&(i=r.distanceToPoint(e)),n>i?n:i}intersectsFrustum(e){const t=this.obb||this.regionObb,r=this.sphere;return!(r&&!e.intersectsSphere(r))&&!(t&&!t.intersectsFrustum(e))&&Boolean(r||t)}intersectsSphere(e){const t=this.obb||this.regionObb,r=this.sphere;return!(r&&!r.intersectsSphere(e))&&!(t&&!t.intersectsSphere(e))&&Boolean(r||t)}intersectsOBB(e){const t=this.obb||this.regionObb,r=this.sphere;return!(r&&!e.intersectsSphere(r))&&!(t&&!t.intersectsOBB(e))&&Boolean(r||t)}getOBB(e,t){const r=this.obb||this.regionObb;r?(e.copy(r.box),t.copy(r.transform)):(this.getAABB(e),t.identity())}getAABB(e){if(this.sphere)this.sphere.getBoundingBox(e);else{const t=this.obb||this.regionObb;e.copy(t.box).applyMatrix4(t.transform)}}getSphere(e){if(this.sphere)e.copy(this.sphere);else if(this.region)this.region.getBoundingSphere(e);else{const t=this.obb||this.regionObb;t.box.getBoundingSphere(e),e.applyMatrix4(t.transform)}}setObbData(e,t){const r=new $d;Kd.set(e[3],e[4],e[5]),Jd.set(e[6],e[7],e[8]),Xd.set(e[9],e[10],e[11]);const n=Kd.length(),i=Jd.length(),s=Xd.length();Kd.normalize(),Jd.normalize(),Xd.normalize(),0===n&&Kd.crossVectors(Jd,Xd),0===i&&Jd.crossVectors(Kd,Xd),0===s&&Xd.crossVectors(Kd,Jd),r.transform.set(Kd.x,Jd.x,Xd.x,e[0],Kd.y,Jd.y,Xd.y,e[1],Kd.z,Jd.z,Xd.z,e[2],0,0,0,1).premultiply(t),r.box.min.set(-n,-i,-s),r.box.max.set(n,i,s),r.update(),this.obb=r}setSphereData(e,t,r,n,i){const o=new s.Sphere;o.center.set(e,t,r),o.radius=n,o.applyMatrix4(i),this.sphere=o}setRegionData(e,t,r,n,i,s,o){const a=new Yd.M(...e.radius,r,i,t,n,s,o),l=new $d;a.getBoundingBox(l.box,l.transform),l.update(),this.region=a,this.regionObb=l}}const rp=new s.Matrix4,np=new s.Euler,ip=Symbol("INITIAL_FRUSTUM_CULLED"),sp=new s.Matrix4,op=new s.Vector3,ap=new s.Vector2,lp=new s.Vector3(1,0,0),cp=new s.Vector3(0,1,0);function hp(e,t){e.traverse((e=>{e.frustumCulled=e[ip]&&t}))}class up extends su{get autoDisableRendererCulling(){return this._autoDisableRendererCulling}set autoDisableRendererCulling(e){this._autoDisableRendererCulling!==e&&(super._autoDisableRendererCulling=e,this.forEachLoadedModel((t=>{hp(t,!e)})))}get optimizeRaycast(){return this._optimizeRaycast}set optimizeRaycast(e){console.warn('TilesRenderer: The "optimizeRaycast" option has been deprecated.'),this._optimizeRaycast=e}constructor(...e){super(...e),this.group=new Dd(this),this.ellipsoid=Ad.clone(),this.cameras=[],this.cameraMap=new Map,this.cameraInfo=[],this._optimizeRaycast=!0,this._upRotationMatrix=new s.Matrix4,this.lruCache.computeMemoryUsageCallback=e=>e.cached.bytesUsed??null,this._autoDisableRendererCulling=!0;const t=new s.LoadingManager;t.setURLModifier((e=>this.preprocessURL?this.preprocessURL(e):e)),this.manager=t,this._listeners={}}addEventListener(...e){s.EventDispatcher.prototype.addEventListener.call(this,...e)}hasEventListener(...e){s.EventDispatcher.prototype.hasEventListener.call(this,...e)}removeEventListener(...e){s.EventDispatcher.prototype.removeEventListener.call(this,...e)}dispatchEvent(...e){s.EventDispatcher.prototype.dispatchEvent.call(this,...e)}getBoundingBox(e){if(!this.root)return!1;const t=this.root.cached.boundingVolume;return!!t&&(t.getAABB(e),!0)}getOrientedBoundingBox(e,t){if(!this.root)return!1;const r=this.root.cached.boundingVolume;return!!r&&(r.getOBB(e,t),!0)}getBoundingSphere(e){if(!this.root)return!1;const t=this.root.cached.boundingVolume;return!!t&&(t.getSphere(e),!0)}forEachLoadedModel(e){this.traverse((t=>{const r=t.cached&&t.cached.scene;r&&e(r,t)}),null,!1)}raycast(e,t){if(this.root)if(e.firstHitOnly){const r=Ud(this,this.root,e);r&&t.push(r)}else Qd(this,this.root,e,t)}hasCamera(e){return this.cameraMap.has(e)}setCamera(e){const t=this.cameras,r=this.cameraMap;return!r.has(e)&&(r.set(e,new s.Vector2),t.push(e),this.dispatchEvent({type:"add-camera",camera:e}),!0)}setResolution(e,t,r){const n=this.cameraMap;if(!n.has(e))return!1;const i=t.isVector2?t.x:t,s=t.isVector2?t.y:r,o=n.get(e);return o.width===i&&o.height===s||(o.set(i,s),this.dispatchEvent({type:"camera-resolution-change"})),!0}setResolutionFromRenderer(e,t){return t.getSize(ap).multiplyScalar(t.getPixelRatio()),this.setResolution(e,ap.x,ap.y)}deleteCamera(e){const t=this.cameras,r=this.cameraMap;if(r.has(e)){const n=t.indexOf(e);return t.splice(n,1),r.delete(e),this.dispatchEvent({type:"delete-camera",camera:e}),!0}return!1}loadRootTileSet(...e){return super.loadRootTileSet(...e).then((e=>{const{asset:t,extensions:r={}}=e;switch((t&&t.gltfUpAxis||"y").toLowerCase()){case"x":this._upRotationMatrix.makeRotationAxis(cp,-Math.PI/2);break;case"y":this._upRotationMatrix.makeRotationAxis(lp,Math.PI/2)}if("3DTILES_ellipsoid"in r){const e=r["3DTILES_ellipsoid"],{ellipsoid:t}=this;t.name=e.body,e.radii?t.radius.set(...e.radii):t.radius.set(1,1,1)}return this.dispatchEvent({type:"load-content"}),e}))}update(){let e=null;if(this.invokeAllPlugins((t=>{if(t.doTilesNeedUpdate){const r=t.doTilesNeedUpdate();e=null===e?r:e||r}})),!1===e)return this.dispatchEvent({type:"update-before"}),void this.dispatchEvent({type:"update-after"});this.dispatchEvent({type:"update-before"});const t=this.group,r=this.cameras,n=this.cameraMap,i=this.cameraInfo;if(0!==r.length){for(;i.length>r.length;)i.pop();for(;i.length<r.length;)i.push({frustum:new zd,isOrthographic:!1,sseDenominator:-1,position:new s.Vector3,invScale:-1,pixelSize:0});op.setFromMatrixScale(t.matrixWorldInverse),Math.abs(Math.max(op.x-op.y,op.x-op.z))>1e-6&&console.warn("ThreeTilesRenderer : Non uniform scale used for tile which may cause issues when calculating screen space error.");for(let e=0,s=i.length;e<s;e++){const s=r[e],o=i[e],a=o.frustum,l=o.position,c=n.get(s);0!==c.width&&0!==c.height||console.warn("TilesRenderer: resolution for camera error calculation is not set.");const h=s.projectionMatrix.elements;if(o.isOrthographic=1===h[15],o.isOrthographic){const e=2/h[0],t=2/h[5];o.pixelSize=Math.max(t/c.height,e/c.width)}else o.sseDenominator=2/h[5]/c.height;sp.copy(t.matrixWorld),sp.premultiply(s.matrixWorldInverse),sp.premultiply(s.projectionMatrix),a.setFromProjectionMatrix(sp),l.set(0,0,0),l.applyMatrix4(s.matrixWorld),l.applyMatrix4(t.matrixWorldInverse)}super.update(),this.dispatchEvent({type:"update-after"})}else console.warn("TilesRenderer: no cameras defined. Cannot update 3d tiles.")}preprocessNode(e,t,r=null){super.preprocessNode(e,t,r);const n=new s.Matrix4;if(e.transform){const t=e.transform;for(let e=0;e<16;e++)n.elements[e]=t[e]}r&&n.premultiply(r.cached.transform);const i=(new s.Matrix4).copy(n).invert(),o=new tp;"sphere"in e.boundingVolume&&o.setSphereData(...e.boundingVolume.sphere,n),"box"in e.boundingVolume&&o.setObbData(e.boundingVolume.box,n),"region"in e.boundingVolume&&o.setRegionData(this.ellipsoid,...e.boundingVolume.region),e.cached={transform:n,transformInverse:i,active:!1,boundingVolume:o,metadata:null,scene:null,geometry:null,materials:null,textures:null}}async requestTileContents(...e){await super.requestTileContents(...e),this.dispatchEvent({type:"load-content"})}async parseTile(e,t,r,n,i){const o=t.cached,a=n.split(/[\\/]/g);a.pop();const l=a.join("/"),c=this.fetchOptions,h=this.manager;let u=null;const d=o.transform,p=this._upRotationMatrix,f=(pu(e)||r).toLowerCase();switch(f){case"b3dm":{const t=new ld(h);t.workingPath=l,t.fetchOptions=c,t.adjustmentTransform.copy(p),u=t.parse(e);break}case"pnts":{const t=new fd(h);t.workingPath=l,t.fetchOptions=c,u=t.parse(e);break}case"i3dm":{const t=new Td(h);t.workingPath=l,t.fetchOptions=c,t.adjustmentTransform.copy(p),t.ellipsoid.copy(this.ellipsoid),u=t.parse(e);break}case"cmpt":{const t=new Pd(h);t.workingPath=l,t.fetchOptions=c,t.adjustmentTransform.copy(p),t.ellipsoid.copy(this.ellipsoid),u=t.parse(e).then((e=>e.scene));break}case"gltf":case"glb":{const t=h.getHandler("path.gltf")||h.getHandler("path.glb")||new Au(h);t.setWithCredentials("include"===c.credentials),t.setRequestHeader(c.headers||{}),"include"===c.credentials&&"cors"===c.mode&&t.setCrossOrigin("use-credentials");let r=t.resourcePath||t.path||l;!/[\\/]$/.test(r)&&r.length&&(r+="/"),u=t.parseAsync(e,r).then((e=>{const{scene:t}=e;return t.updateMatrix(),t.matrix.multiply(p).decompose(t.position,t.quaternion,t.scale),e}));break}default:u=this.invokeOnePlugin((s=>s.parseToMesh&&s.parseToMesh(e,t,r,n,i)))}const g=await u;if(null===g)throw new Error(`TilesRenderer: Content type "${f}" not supported.`);let A,m;g.isObject3D?(A=g,m=null):(A=g.scene,m=g),await this.invokeAllPlugins((e=>e.processTileModel&&e.processTileModel(A,t))),A.updateMatrix(),A.matrix.premultiply(d),A.matrix.decompose(A.position,A.quaternion,A.scale),A.traverse((e=>{e[ip]=e.frustumCulled})),hp(A,!this.autoDisableRendererCulling);const y=[],v=[],w=[];if(A.traverse((e=>{if(e.geometry&&v.push(e.geometry),e.material){const t=e.material;y.push(e.material);for(const e in t){const r=t[e];r&&r.isTexture&&w.push(r)}}})),i.aborted)for(let e=0,t=w.length;e<t;e++){const t=w[e];t.image instanceof ImageBitmap&&t.image.close(),t.dispose()}else o.materials=y,o.geometry=v,o.textures=w,o.scene=A,o.metadata=m,o.bytesUsed=function(e){const{TextureUtils:t}=s;if(!t)return 0;const r=new Set;let n=0;return e.traverse((e=>{if(e.geometry&&!r.has(e.geometry)&&(n+=function(e){let t=0;for(const r in e.attributes){const n=e.getAttribute(r);t+=n.count*n.itemSize*n.array.BYTES_PER_ELEMENT}const r=e.getIndex();return t+=r?r.count*r.itemSize*r.array.BYTES_PER_ELEMENT:0,t}(e.geometry),r.add(e.geometry)),e.material){const i=e.material;for(const e in i){const s=i[e];if(s&&s.isTexture&&!r.has(s)){const{format:e,type:i,image:o}=s,{width:a,height:l}=o,c=t.getByteLength(a,l,e,i);n+=s.generateMipmaps?4*c/3:c,r.add(s)}}}})),n}(A)}disposeTile(e){super.disposeTile(e);const t=e.cached;if(t.scene){const r=t.materials,n=t.geometry,i=t.textures,s=t.scene.parent;t.scene.traverse((e=>{e.userData.meshFeatures&&e.userData.meshFeatures.dispose(),e.userData.structuralMetadata&&e.userData.structuralMetadata.dispose()}));for(let e=0,t=n.length;e<t;e++)n[e].dispose();for(let e=0,t=r.length;e<t;e++)r[e].dispose();for(let e=0,t=i.length;e<t;e++){const t=i[e];t.image instanceof ImageBitmap&&t.image.close(),t.dispose()}s&&s.remove(t.scene),this.dispatchEvent({type:"dispose-model",scene:t.scene,tile:e}),t.scene=null,t.materials=null,t.textures=null,t.geometry=null,t.metadata=null}}setTileVisible(e,t){const r=e.cached.scene,n=this.group;t?r&&(n.add(r),r.updateMatrixWorld(!0)):r&&n.remove(r),super.setTileVisible(e,t),this.dispatchEvent({type:"tile-visibility-change",scene:r,tile:e,visible:t})}calculateError(e){const t=e.cached,r=this.cameras,n=this.cameraInfo,i=t.boundingVolume;let s=-1/0,o=1/0;for(let t=0,a=r.length;t<a;t++){const r=n[t];let a;if(r.isOrthographic){const t=r.pixelSize;a=e.geometricError/t}else{const t=i.distanceToPoint(r.position),n=r.sseDenominator;a=e.geometricError/(t*n),o=Math.min(o,t)}s=Math.max(s,a)}this.invokeAllPlugins((t=>{t!==this&&t.calculateError&&(s=Math.max(s,t.calculateError(e)||0))})),e.__distanceFromCamera=o,e.__error=s}tileInView(e){let t=!1;if(this.invokeAllPlugins((r=>{t=t||r!==this&&r.tileInView&&r.tileInView(e)})),t)return!0;const r=e.cached.boundingVolume,n=this.cameraInfo;for(let e=0,t=n.length;e<t;e++){const t=n[e].frustum;if(r.intersectsFrustum(t))return!0}return!1}setLatLonToYUp(e,t){console.warn("TilesRenderer: setLatLonToYUp is deprecated. Use the ReorientationPlugin, instead.");const{ellipsoid:r,group:n}=this;np.set(Math.PI/2,Math.PI/2,0),rp.makeRotationFromEuler(np),r.getEastNorthUpFrame(e,t,n.matrix).multiply(rp).invert().decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld(!0)}dispose(){super.dispose(),this.group.removeFromParent()}}const dp=new s.OrthographicCamera(-1,1,1,-1,0,1);class pp extends s.BufferGeometry{constructor(){super(),this.setAttribute("position",new s.Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new s.Float32BufferAttribute([0,2,0,0,2,0],2))}}const fp=new pp;class gp{constructor(e){this._mesh=new s.Mesh(fp,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,dp)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}const Ap=new s.Box2;class mp{constructor(){this._renderer=new s.WebGLRenderer,this._target=new s.WebGLRenderTarget(1,1),this._texTarget=new s.WebGLRenderTarget,this._quad=new gp(new s.ShaderMaterial({blending:s.CustomBlending,blendDst:s.ZeroFactor,blendSrc:s.OneFactor,uniforms:{map:{value:null},pixel:{value:new s.Vector2}},vertexShader:"\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\t\t\t\tuniform sampler2D map;\n\t\t\t\tuniform ivec2 pixel;\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tgl_FragColor = texelFetch( map, pixel, 0 );\n\n\t\t\t\t}\n\t\t\t"}))}increaseSizeTo(e){this._target.setSize(Math.max(this._target.width,e),1)}readDataAsync(e){const{_renderer:t,_target:r}=this;return t.readRenderTargetPixelsAsync(r,0,0,e.length/4,1,e)}readData(e){const{_renderer:t,_target:r}=this;t.readRenderTargetPixels(r,0,0,e.length/4,1,e)}renderPixelToTarget(e,t,r){const{_renderer:n,_target:i}=this;Ap.min.copy(t),Ap.max.copy(t),Ap.max.x+=1,Ap.max.y+=1,n.initRenderTarget(i),n.copyTextureToTexture(e,i.texture,Ap,r,0)}}const yp=new class{constructor(){let e=null;Object.getOwnPropertyNames(mp.prototype).forEach((t=>{"constructor"!==t&&(this[t]=(...r)=>(e=e||new mp,e[t](...r)))}))}},vp=new s.Vector2,wp=new s.Vector2,bp=new s.Vector2;function Ep(e,t,r=new Array(3)){let n=3*t,i=3*t+1,s=3*t+2;return e.index&&(n=e.index.getX(n),i=e.index.getX(i),s=e.index.getX(s)),r[0]=n,r[1]=i,r[2]=s,r}function xp(e,t,r,n,i){const[s,o,a]=n,l=function(e,t){return 0===t?e.getAttribute("uv"):e.getAttribute(`uv${t}`)}(e,t);vp.fromBufferAttribute(l,s),wp.fromBufferAttribute(l,o),bp.fromBufferAttribute(l,a),i.set(0,0,0).addScaledVector(vp,r.x).addScaledVector(wp,r.y).addScaledVector(bp,r.z)}function Cp(e,t,r,n){const i=e.x-Math.floor(e.x),s=e.y-Math.floor(e.y),o=Math.floor(i*t%t),a=Math.floor(s*r%r);return n.set(o,a),n}const _p=new s.Vector2,Ip=new s.Vector2,Sp=new s.Vector2;class Mp{constructor(e,t,r){this.geometry=e,this.textures=t,this.data=r,this._asyncRead=!1,this.featureIds=r.featureIds.map((e=>{const{texture:t,...r}=e,n={label:null,propertyTable:null,nullFeatureId:null,...r};return t&&(n.texture={texCoord:0,channels:[0],...t}),n}))}getTextures(){return this.textures}getFeatureInfo(){return this.featureIds}getFeaturesAsync(...e){this._asyncRead=!0;const t=this.getFeatures(...e);return this._asyncRead=!1,t}getFeatures(e,t){const{geometry:r,textures:n,featureIds:i}=this,s=new Array(i.length).fill(null),o=i.length;yp.increaseSizeTo(o);const a=Ep(r,e),l=a[function(e){return e.x>e.y&&e.x>e.z?0:e.y>e.z?1:2}(t)];for(let e=0,o=i.length;e<o;e++){const o=i[e],c="nullFeatureId"in o?o.nullFeatureId:null;if("texture"in o){const i=n[o.texture.index];xp(r,o.texture.texCoord,t,a,_p),Cp(_p,i.image.width,i.image.height,Ip),Sp.set(e,0),yp.renderPixelToTarget(n[o.texture.index],Ip,Sp)}else if("attribute"in o){const t=r.getAttribute(`_feature_id_${o.attribute}`).getX(l);t!==c&&(s[e]=t)}else{const t=l;t!==c&&(s[e]=t)}}const c=new Uint8Array(4*o);return this._asyncRead?yp.readDataAsync(c).then((()=>(h(),s))):(yp.readData(c),h(),s);function h(){const e=new Uint32Array(1);for(let t=0,r=i.length;t<r;t++){const r=i[t],n="nullFeatureId"in r?r.nullFeatureId:null;if("texture"in r){const{channels:i}=r.texture,o=i.map((e=>c[4*t+e]));new Uint8Array(e.buffer).set(o);const a=e[0];a!==n&&(s[t]=a)}}}}dispose(){this.textures.forEach((e=>{e&&(e.dispose(),e.image instanceof ImageBitmap&&e.image.close())}))}}const Tp="EXT_mesh_features";function Bp(e,t,r){e.traverse((e=>{if(t.associations.has(e)){const{meshes:n,primitives:i}=t.associations.get(e),s=t.json.meshes[n].primitives[i];s&&s.extensions&&s.extensions[Tp]&&r(e,s.extensions[Tp])}}))}class Pp{constructor(e){this.parser=e,this.name=Tp}async afterRoot({scene:e,parser:t}){const r=t.json.extensionsUsed;if(!r||!r.includes(Tp))return;const n=t.json.textures?.length||0,i=new Array(n).fill(null);Bp(e,t,((e,{featureIds:r})=>{r.forEach((e=>{if(e.texture&&null===i[e.texture.index]){const r=e.texture.index;i[r]=t.loadTexture(r)}}))}));const s=await Promise.all(i);Bp(e,t,((e,t)=>{e.userData.meshFeatures=new Mp(e.geometry,s,t)}))}}function Rp(e,t,r){return e&&t in e?e[t]:r}function Dp(e){return"BOOLEAN"!==e&&"STRING"!==e&&"ENUM"!==e}function Lp(e){return/^VEC/.test(e)}function kp(e){return/^MAT/.test(e)}function Op(e,t,r,n=null){return kp(r)||Lp(r)?n.fromArray(e,t):e[t]}function Fp(e){const{type:t,componentType:r}=e;switch(t){case"SCALAR":return"INT64"===r?0n:0;case"VEC2":return new s.Vector2;case"VEC3":return new s.Vector3;case"VEC4":return new s.Vector4;case"MAT2":return new s.Matrix2;case"MAT3":return new s.Matrix3;case"MAT4":return new s.Matrix4;case"BOOLEAN":return!1;case"STRING":return"";case"ENUM":return 0}}function Np(e,t){if(null==t)return!1;switch(e){case"SCALAR":case"ENUM":return"number"==typeof t||"bigint"==typeof t;case"VEC2":return t.isVector2;case"VEC3":return t.isVector3;case"VEC4":return t.isVector4;case"MAT2":return t.isMatrix2;case"MAT3":return t.isMatrix3;case"MAT4":return t.isMatrix4;case"BOOLEAN":return"boolean"==typeof t;case"STRING":return"string"==typeof t}throw new Error("ClassProperty: invalid type.")}function Up(e,t=null){switch(e){case"INT8":return Int8Array;case"INT16":return Int16Array;case"INT32":return Int32Array;case"INT64":return BigInt64Array;case"UINT8":return Uint8Array;case"UINT16":return Uint16Array;case"UINT32":return Uint32Array;case"UINT64":return BigUint64Array;case"FLOAT32":return Float32Array;case"FLOAT64":return Float64Array}switch(t){case"BOOLEAN":case"STRING":return Uint8Array}throw new Error("ClassProperty: invalid type.")}function Qp(e,t=null){const r=e.default,n=e.type;if(t=t||Fp(e),null===r){switch(n){case"SCALAR":return 0;case"VEC2":return t.set(0,0);case"VEC3":return t.set(0,0,0);case"VEC4":return t.set(0,0,0,0);case"MAT2":case"MAT3":case"MAT4":return t.identity();case"BOOLEAN":return!1;case"STRING":case"ENUM":return""}throw new Error("ClassProperty: invalid type.")}if(kp(n))t.fromArray(r);else{if(!Lp(n))return r;t.fromArray(r)}}function Gp(e,t,r=null){if(e.array){Array.isArray(t)||(t=new Array(e.count||0)),t.length=null!==r?r:e.count;for(let r=0,n=t.length;r<n;r++)Np(e.type,t[r])||(t[r]=Fp(e))}else Np(e.type,t)||(t=Fp(e));return t}function zp(e,t){for(const r in t)r in e||delete t[r];for(const r in e){const n=e[r];t[r]=Gp(n,t[r])}}class jp{constructor(e,t,r=null){this.name=t.name||null,this.description=t.description||null,this.type=t.type,this.componentType=t.componentType||null,this.enumType=t.enumType||null,this.array=t.array||!1,this.count=t.count||0,this.normalized=t.normalized||!1,this.offset=t.offset||0,this.scale=Rp(t,"scale",1),this.max=Rp(t,"max",1/0),this.min=Rp(t,"min",-1/0),this.required=t.required||!1,this.noData=Rp(t,"noData",null),this.default=Rp(t,"default",null),this.semantic=Rp(t,"semantic",null),this.enumSet=null,this.accessorProperty=r,r&&(this.offset=Rp(r,"offset",this.offset),this.scale=Rp(r,"scale",this.scale),this.max=Rp(r,"max",this.max),this.min=Rp(r,"min",this.min)),"ENUM"===t.type&&(this.enumSet=e[this.enumType],null===this.componentType&&(this.componentType=Rp(this.enumSet,"valueType","UINT16")))}shapeToProperty(e,t=null){return Gp(this,e,t)}resolveDefaultElement(e){return Qp(this,e)}resolveDefault(e){return function(e,t=null){if(e.array){(t=t&&Array.isArray(t)?t:[]).length=e.count;for(let r=0,n=t.length;r<n;r++)t[r]=Qp(e,t[r])}else t=Qp(e,t);return t}(this,e)}resolveNoData(e){return function(e,t){if(null===e.noData)return t;const r=e.noData,n=e.type;if(Array.isArray(t))for(let e=0,r=t.length;e<r;e++)t[e]=i(t[e]);else t=i(t);return t;function i(t){return function(e){if(kp(n)){const t=e.elements;for(let e=0,n=r.length;e<n;e++)if(r[e]!==t[e])return!1;return!0}if(Lp(n)){for(let t=0,n=r.length;t<n;t++)if(r[t]!==e.getComponent(t))return!1;return!0}return r===e}(t)&&(t=Qp(e,t)),t}}(this,e)}resolveEnumsToStrings(e){const t=this.enumSet;if("ENUM"===this.type)if(Array.isArray(e))for(let t=0,n=e.length;t<n;t++)e[t]=r(e[t]);else e=r(e);return e;function r(e){const r=t.values.find((t=>t.value===e));return null===r?"":r.name}}adjustValueScaleOffset(e){return Dp(this.type)?function(e,t){const{type:r,componentType:n,scale:i,offset:s,normalized:o}=e;if(Array.isArray(t))for(let e=0,r=t.length;e<r;e++)t[e]=a(t[e]);else t=a(t);return t;function a(e){return kp(r)?function(e){const t=e.elements;for(let e=0,r=t.length;e<r;e++)t[e]=l(t[e]);return e}(e):Lp(r)?function(e){return e.x=l(e.x),e.y=l(e.y),"z"in e&&(e.z=l(e.z)),"w"in e&&(e.w=l(e.w)),e}(e):l(e)}function l(e){return o&&(e=function(e,t){switch(e){case"INT8":return Math.max(t/127,-1);case"INT16":return Math.max(t,32767,-1);case"INT32":return Math.max(t/2147483647,-1);case"INT64":return Math.max(Number(t)/0x8000000000000000,-1);case"UINT8":return t/255;case"UINT16":return t/65535;case"UINT32":return t/4294967295;case"UINT64":return Number(t)/0x10000000000000000}}(n,e)),(o||function(e){return/^FLOAT/.test(e)}(n))&&(e=e*i+s),e}}(this,e):e}}class Vp{constructor(e,t={},r={},n=null){this.definition=e,this.class=t[e.class],this.className=e.class,this.enums=r,this.data=n,this.name="name"in e?e.name:null,this.properties=null}getPropertyNames(){return Object.keys(this.class.properties)}includesData(e){return Boolean(this.definition.properties[e])}dispose(){}_initProperties(e=jp){const t={};for(const r in this.class.properties)t[r]=new e(this.enums,this.class.properties[r],this.definition.properties[r]);this.properties=t}}class qp extends jp{constructor(e,t,r=null){super(e,t,r),this.attribute=r.attribute}}class Hp extends Vp{constructor(...e){super(...e),this.isPropertyAttributeAccessor=!0,this._initProperties(qp)}getData(e,t,r={}){const n=this.properties;zp(n,r);for(const i in n)r[i]=this.getPropertyValue(i,e,t,r[i]);return r}getPropertyValue(e,t,r,n=null){if(t>=this.count)throw new Error("PropertyAttributeAccessor: Requested index is outside the range of the buffer.");const i=this.properties[e],s=i.type;if(!i)throw new Error("PropertyAttributeAccessor: Requested class property does not exist.");if(!this.definition.properties[e])return i.resolveDefault(n);n=i.shapeToProperty(n);const o=r.getAttribute(i.attribute.toLowerCase());if(kp(s)){const e=n.elements;for(let r=0,n=e.length;r<n;r<n)e[r]=o.getComponent(t,r)}else if(Lp(s))n.fromBufferAttribute(o,t);else{if("SCALAR"!==s&&"ENUM"!==s)throw new Error("StructuredMetadata.PropertyAttributeAccessor: BOOLEAN and STRING types are not supported by property attributes.");n=o.getX(t)}return n=i.adjustValueScaleOffset(n),n=i.resolveEnumsToStrings(n),i.resolveNoData(n)}}class Wp extends jp{constructor(e,t,r=null){super(e,t,r),this.values=r.values,this.valueLength=function(e){switch(e){case"ENUM":case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:return-1}}(this.type),this.arrayOffsets=Rp(r,"arrayOffsets",null),this.stringOffsets=Rp(r,"stringOffsets",null),this.arrayOffsetType=Rp(r,"arrayOffsetType","UINT32"),this.stringOffsetType=Rp(r,"stringOffsetType","UINT32")}getArrayLengthFromId(e,t){let r=this.count;if(null!==this.arrayOffsets){const{arrayOffsets:n,arrayOffsetType:i}=this,s=new(Up(i))(e[n]);r=s[t+1]-s[t]}return r}getIndexOffsetFromId(e,t){let r=t;if(this.arrayOffsets){const{arrayOffsets:t,arrayOffsetType:n}=this;r=new(Up(n))(e[t])[r]}else this.array&&(r*=this.count);return r}}class $p extends Vp{constructor(...e){super(...e),this.isPropertyTableAccessor=!0,this.count=this.definition.count,this._initProperties(Wp)}getData(e,t={}){const r=this.properties;zp(r,t);for(const n in r)t[n]=this.getPropertyValue(n,e,t[n]);return t}_readValueAtIndex(e,t,r,n=null){const i=this.properties[e],{componentType:s,type:o}=i,a=this.data,l=a[i.values],c=new(Up(s,o))(l),h=i.getIndexOffsetFromId(a,t);if(Dp(o)||"ENUM"===o)return Op(c,(h+r)*i.valueLength,o,n);if("STRING"===o){let e=h+r,t=0;if(null!==i.stringOffsets){const{stringOffsets:r,stringOffsetType:n}=i,s=new(Up(n))(a[r]);t=s[e+1]-s[e],e=s[e]}const s=new Uint8Array(c.buffer,e,t);n=(new TextDecoder).decode(s)}else if("BOOLEAN"===o){const e=h+r,t=e%8;n=1==(c[Math.floor(e/8)]>>t&1)}return n}getPropertyValue(e,t,r=null){if(t>=this.count)throw new Error("PropertyTableAccessor: Requested index is outside the range of the table.");const n=this.properties[e];if(!n)throw new Error("PropertyTableAccessor: Requested property does not exist.");if(!this.definition.properties[e])return n.resolveDefault(r);const i=n.array,s=this.data,o=n.getArrayLengthFromId(s,t);if(r=n.shapeToProperty(r,o),i)for(let n=0,i=r.length;n<i;n++)r[n]=this._readValueAtIndex(e,t,n,r[n]);else r=this._readValueAtIndex(e,t,0,r);return r=n.adjustValueScaleOffset(r),r=n.resolveEnumsToStrings(r),n.resolveNoData(r)}}const Yp=new s.Vector2,Kp=new s.Vector2,Jp=new s.Vector2;class Xp extends jp{constructor(e,t,r=null){super(e,t,r),this.channels=Rp(r,"channels",[0]),this.index=Rp(r,"index",null),this.texCoord=Rp(r,"texCoord",null),this.valueLength=parseInt(this.type.replace(/[^0-9]/g,""))||1}readDataFromBuffer(e,t,r=null){const n=this.type;if("BOOLEAN"===n||"STRING"===n)throw new Error("PropertyTextureAccessor: BOOLEAN and STRING types not supported.");return Op(e,t*this.valueLength,n,r)}}class Zp extends Vp{constructor(...e){super(...e),this.isPropertyTextureAccessor=!0,this._asyncRead=!1,this._initProperties(Xp)}getData(e,t,r,n={}){const i=this.properties;zp(i,n);const s=Object.keys(i),o=s.map((e=>n[e]));return this.getPropertyValuesAtTexel(s,e,t,r,o),s.forEach(((e,t)=>n[e]=o[t])),n}async getDataAsync(e,t,r,n={}){const i=this.properties;zp(i,n);const s=Object.keys(i),o=s.map((e=>n[e]));return await this.getPropertyValuesAtTexelAsync(s,e,t,r,o),s.forEach(((e,t)=>n[e]=o[t])),n}getPropertyValuesAtTexelAsync(...e){this._asyncRead=!0;const t=this.getPropertyValuesAtTexel(...e);return this._asyncRead=!1,t}getPropertyValuesAtTexel(e,t,r,n,i=[]){for(;i.length<e.length;)i.push(null);i.length=e.length,yp.increaseSizeTo(i.length);const s=this.data,o=this.definition.properties,a=this.properties,l=Ep(n,t);for(let t=0,i=e.length;t<i;t++){const i=e[t];if(!o[i])continue;const c=a[i],h=s[c.index];xp(n,c.texCoord,r,l,Yp),Cp(Yp,h.image.width,h.image.height,Kp),Jp.set(t,0),yp.renderPixelToTarget(h,Kp,Jp)}const c=new Uint8Array(4*e.length);return this._asyncRead?yp.readDataAsync(c).then((()=>(h.call(this),i))):(yp.readData(c),h.call(this),i);function h(){for(let t=0,r=e.length;t<r;t++){const r=e[t],n=a[r],s=n.type;if(i[t]=Gp(n,i[t]),!n)throw new Error("PropertyTextureAccessor: Requested property does not exist.");if(!o[r]){i[t]=n.resolveDefault(i);continue}const l=n.valueLength*(n.count||1),h=n.channels.map((e=>c[4*t+e])),u=new(Up(n.componentType,s))(l);if(new Uint8Array(u.buffer).set(h),n.array){const e=i[t];for(let t=0,r=e.length;t<r;t++)e[t]=n.readDataFromBuffer(u,t,e[t])}else i[t]=n.readDataFromBuffer(u,0,i[t]);i[t]=n.adjustValueScaleOffset(i[t]),i[t]=n.resolveEnumsToStrings(i[t]),i[t]=n.resolveNoData(i[t])}}}dispose(){this.data.forEach((e=>{e&&(e.dispose(),e.image instanceof ImageBitmap&&e.image.close())}))}}class ef{constructor(e,t,r,n=null,i=null){const{schema:s,propertyTables:o=[],propertyTextures:a=[],propertyAttributes:l=[]}=e,{enums:c,classes:h}=s,u=o.map((e=>new $p(e,h,c,r)));let d=[],p=[];n&&(n.propertyTextures&&(d=n.propertyTextures.map((e=>new Zp(a[e],h,c,t)))),n.propertyAttributes&&(p=n.propertyAttributes.map((e=>new Hp(l[e],h,c))))),this.schema=s,this.tableAccessors=u,this.textureAccessors=d,this.attributeAccessors=p,this.object=i,this.textures=t,this.nodeMetadata=n}getPropertyTableData(e,t,r=null){if(Array.isArray(e)&&Array.isArray(t)){r=r||[];const n=Math.min(e.length,t.length);r.length=n;for(let i=0;i<n;i++){const n=this.tableAccessors[e[i]];r[i]=n.getData(t[i],r[i])}}else r=r||{},r=this.tableAccessors[e].getData(t,r);return r}getPropertyTableInfo(e=null){if(null===e&&(e=this.tableAccessors.map(((e,t)=>t))),Array.isArray(e))return e.map((e=>{const t=this.tableAccessors[e];return{name:t.name,className:t.definition.class}}));{const t=this.tableAccessors[e];return{name:t.name,className:t.definition.class}}}getPropertyTextureData(e,t,r=[]){const n=this.textureAccessors;r.length=n.length;for(let i=0;i<n.length;i++){const s=n[i];r[i]=s.getData(e,t,this.object.geometry,r[i])}return r}async getPropertyTextureDataAsync(e,t,r=[]){const n=this.textureAccessors;r.length=n.length;const i=[];for(let s=0;s<n.length;s++){const o=n[s].getDataAsync(e,t,this.object.geometry,r[s]).then((e=>{r[s]=e}));i.push(o)}return await Promise.all(i),r}getPropertyTextureInfo(){return this.textureAccessors}getPropertyAttributeData(e,t=[]){const r=this.attributeAccessors;t.length=r.length;for(let n=0;n<r.length;n++){const i=r[n];t[n]=i.getData(e,this.object.geometry,t[n])}return t}getPropertyAttributeInfo(){return this.attributeAccessors.map((e=>({name:e.name,className:e.definition.class})))}dispose(){this.textureAccessors.forEach((e=>e.dispose())),this.tableAccessors.forEach((e=>e.dispose())),this.attributeAccessors.forEach((e=>e.dispose()))}}const tf="EXT_structural_metadata";function rf(e,t=[]){const r=e.json.textures?.length||0,n=new Array(r).fill(null);return t.forEach((({properties:t})=>{for(const r in t){const{index:i}=t[r];null===n[i]&&(n[i]=e.loadTexture(i))}})),Promise.all(n)}function nf(e,t=[]){const r=e.json.bufferViews?.length||0,n=new Array(r).fill(null);return t.forEach((({properties:t})=>{for(const r in t){const{values:i,arrayOffsets:s,stringOffsets:o}=t[r];null===n[i]&&(n[i]=e.loadBufferView(i)),null===n[s]&&(n[s]=e.loadBufferView(s)),null===n[o]&&(n[o]=e.loadBufferView(o))}})),Promise.all(n)}class sf{constructor(e){this.parser=e,this.name=tf}async afterRoot({scene:e,parser:t}){const r=t.json.extensionsUsed;if(!r||!r.includes(tf))return;let n=null,i=t.json.extensions[tf];if(i.schemaUri){const{manager:e,path:r,requestHeader:o,crossOrigin:a}=t.options,l=new URL(i.schemaUri,r).toString(),c=new s.FileLoader(e);c.setCrossOrigin(a),c.setResponseType("json"),c.setRequestHeader(o),n=c.loadAsync(l).then((e=>{i={...i,schema:e}}))}const[o,a]=await Promise.all([rf(t,i.propertyTextures),nf(t,i.propertyTables),n]),l=new ef(i,o,a);e.userData.structuralMetadata=l,e.traverse((e=>{if(t.associations.has(e)){const{meshes:r,primitives:n}=t.associations.get(e),s=t.json.meshes[r].primitives[n];if(s&&s.extensions&&s.extensions[tf]){const t=s.extensions[tf];e.userData.structuralMetadata=new ef(i,o,a,t,e)}else e.userData.structuralMetadata=l}}))}}class of{constructor(){this.name="CESIUM_RTC"}afterRoot(e){if(e.parser.json.extensions&&e.parser.json.extensions.CESIUM_RTC){const{center:t}=e.parser.json.extensions.CESIUM_RTC;t&&(e.scene.position.x+=t[0],e.scene.position.y+=t[1],e.scene.position.z+=t[2])}}}class af{constructor(){this.creditsCount={}}_adjustAttributions(e,t){const r=this.creditsCount,n=e.split(/;/g);for(let e=0,i=n.length;e<i;e++){const i=n[e];i in r||(r[i]=0),r[i]+=t?1:-1,r[i]<=0&&delete r[i]}}addAttributions(e){this._adjustAttributions(e,!0)}removeAttributions(e){this._adjustAttributions(e,!1)}toString(){return Object.entries(this.creditsCount).sort(((e,t)=>{const r=e[1];return t[1]-r})).map((e=>e[0])).join("; ")}}function lf(e){let t=null;return(0,eu.R4)(e,(e=>{if(e.content&&e.content.uri){const[,r]=e.content.uri.split("?");return t=new URLSearchParams(r).get("session"),!0}return!1})),t}class cf{constructor({apiToken:e,autoRefreshToken:t=!1,logoUrl:r=null,useRecommendedSettings:n=!0}){this.name="GOOGLE_CLOUD_AUTH_PLUGIN",this.priority=-1/0,this.apiToken=e,this.autoRefreshToken=t,this.useRecommendedSettings=n,this.logoUrl=r,this.sessionToken=null,this.tiles=null,this._onLoadCallback=null,this._visibilityChangeCallback=null,this._tokenRefreshPromise=null,this._attributionsManager=new af,this._logoAttribution={value:"",type:"image",collapsible:!1},this._attribution={value:"",type:"string",collapsible:!0}}init(e){null!=e&&(e.resetFailedTiles(),null==e.rootURL&&(e.rootURL="https://tile.googleapis.com/v1/3dtiles/root.json"),this.useRecommendedSettings&&(e.parseQueue.maxJobs=10,e.downloadQueue.maxJobs=30,e.errorTarget=40),this.tiles=e,this._onLoadCallback=({tileSet:t})=>{this.sessionToken=lf(t.root),e.removeEventListener("load-tile-set",this._onLoadCallback)},this._visibilityChangeCallback=({tile:e,visible:t})=>{const r=e.cached.metadata.asset.copyright||"";t?this._attributionsManager.addAttributions(r):this._attributionsManager.removeAttributions(r)},e.addEventListener("load-tile-set",this._onLoadCallback),e.addEventListener("tile-visibility-change",this._visibilityChangeCallback))}getAttributions(e){this.tiles.visibleTiles.size>0&&(this.logoUrl&&(this._logoAttribution.value=this.logoUrl,e.push(this._logoAttribution)),this._attribution.value=this._attributionsManager.toString(),e.push(this._attribution))}preprocessURL(e){return e=new URL(e),/^http/.test(e.protocol)&&(e.searchParams.append("key",this.apiToken),null!==this.sessionToken&&e.searchParams.append("session",this.sessionToken)),e.toString()}dispose(){const{tiles:e}=this;e.removeEventListener("load-tile-set",this._onLoadCallback),e.removeEventListener("tile-visibility-change",this._visibilityChangeCallback)}async fetchData(e,t){null!==this._tokenRefreshPromise&&(await this._tokenRefreshPromise,e=this.preprocessURL(e));const r=await fetch(e,t);return r.status>=400&&r.status<=499&&this.autoRefreshToken?(await this._refreshToken(t),fetch(this.preprocessURL(e),t)):r}_refreshToken(e){if(null===this._tokenRefreshPromise){const t=new URL(this.tiles.rootURL);t.searchParams.append("key",this.apiToken),this._tokenRefreshPromise=fetch(t,e).then((e=>e.json())).then((e=>{this.sessionToken=lf(e.root),this._tokenRefreshPromise=null})),this._tokenRefreshPromise.catch((e=>{this.tiles.dispatchEvent({type:"load-error",tile:null,error:e,rootURL:t})}))}return this._tokenRefreshPromise}}class hf{constructor({apiToken:e,assetId:t=null,autoRefreshToken:r=!1}){this.name="CESIUM_ION_AUTH_PLUGIN",this.priority=-1/0,this.apiToken=e,this.assetId=t,this.autoRefreshToken=r,this.tiles=null,this.endpointURL=null,this._bearerToken=null,this._tileSetVersion=-1,this._tokenRefreshPromise=null,this._attributions=[],this._disposed=!1}init(e){null!==this.assetId&&(e.rootURL=`https://api.cesium.com/v1/assets/${this.assetId}/endpoint`),this.tiles=e,this.endpointURL=e.rootURL,e.resetFailedTiles()}loadRootTileSet(){return this._refreshToken().then((()=>this.tiles.invokeOnePlugin((e=>e!==this&&e.loadRootTileSet&&e.loadRootTileSet()))))}preprocessURL(e){return e=new URL(e),/^http/.test(e.protocol)&&-1!=this._tileSetVersion&&e.searchParams.append("v",this._tileSetVersion),e.toString()}fetchData(e,t){return null!==this.tiles.getPluginByName("GOOGLE_CLOUD_AUTH_PLUGIN")?null:Promise.resolve().then((async()=>{null!==this._tokenRefreshPromise&&(await this._tokenRefreshPromise,e=this.preprocessURL(e));const r=await fetch(e,t);return r.status>=400&&r.status<=499&&this.autoRefreshToken?(await this._refreshToken(t),fetch(this.preprocessURL(e),t)):r}))}getAttributions(e){this.tiles.visibleTiles.size>0&&e.push(...this._attributions)}_refreshToken(e){if(null===this._tokenRefreshPromise){const t=new URL(this.endpointURL);t.searchParams.append("access_token",this.apiToken),this._tokenRefreshPromise=fetch(t,e).then((e=>{if(this._disposed)return null;if(!e.ok)throw new Error(`CesiumIonAuthPlugin: Failed to load data with error code ${e.status}`);return e.json()})).then((e=>{if(this._disposed)return null;const r=this.tiles;if("externalType"in e){const t=new URL(e.options.url);r.rootURL=e.options.url,r.registerPlugin(new cf({apiToken:t.searchParams.get("key")}))}else{if(r.rootURL=e.url,r.fetchOptions.headers=r.fetchOptions.headers||{},r.fetchOptions.headers.Authorization=`Bearer ${e.accessToken}`,t.searchParams.has("v")&&-1===this._tileSetVersion){const t=new URL(e.url);this._tileSetVersion=t.searchParams.get("v")}this._bearerToken=e.accessToken,e.attributions&&(this._attributions=e.attributions.map((e=>({value:e.html,type:"html",collapsible:e.collapsible}))))}return this._tokenRefreshPromise=null,e})),this._tokenRefreshPromise.catch((e=>{this.tiles.dispatchEvent({type:"load-error",tile:null,error:e,url:t})}))}return this._tokenRefreshPromise}dispose(){this._disposed=!0}}function uf(e){return"OCTREE"===e.__implicitRoot.implicitTiling.subdivisionScheme}function df(e){return uf(e)?8:4}class pf{constructor(e,t){this.parent=e,this.children=[],this.__level=e.__level+1,this.__implicitRoot=e.__implicitRoot,this.__subtreeIdx=t,[this.__x,this.__y,this.__z]=function(e,t){return t?[2*t.__x+e.__subtreeIdx%2,2*t.__y+Math.floor(e.__subtreeIdx/2)%2,uf(e)?2*t.__z+Math.floor(e.__subtreeIdx/4)%2:0]:[0,0,0]}(this,e)}static copy(e){const t={children:[]};return t.__level=e.__level,t.__implicitRoot=e.__implicitRoot,t.__subtreeIdx=e.__subtreeIdx,[t.__x,t.__y,t.__z]=[e.__x,e.__y,e.__z],t.boundingVolume=e.boundingVolume,t.geometricError=e.geometricError,t}}class ff extends du{constructor(e){super(),this.tile=e,this.rootTile=e.__implicitRoot}parseBuffer(e){const t=new DataView(e);let r=0;const n=pu(t);console.assert("subt"===n,'SUBTREELoader: The magic bytes equal "subt".'),r+=4;const i=t.getUint32(r,!0);console.assert(1===i,'SUBTREELoader: The version listed in the header is "1".'),r+=4;const s=t.getUint32(r,!0);r+=8;const o=t.getUint32(r,!0);r+=8;const a=JSON.parse(au(new Uint8Array(e,r,s)));return r+=s,{version:i,subtreeJson:a,subtreeByte:e.slice(r,r+o)}}parse(e){const t=this.parseBuffer(e),r=t.subtreeJson;r.contentAvailabilityHeaders=[].concat(r.contentAvailability);const n=this.preprocessBuffers(r.buffers),i=this.preprocessBufferViews(r.bufferViews,n);this.markActiveBufferViews(r,i);const s=this.requestActiveBuffers(n,t.subtreeByte),o=this.parseActiveBufferViews(i,s);this.parseAvailability(t,r,o),this.expandSubtree(this.tile,t)}markActiveBufferViews(e,t){let r;const n=e.tileAvailability;isNaN(n.bitstream)?isNaN(n.bufferView)||(r=t[n.bufferView]):r=t[n.bitstream],r&&(r.isActive=!0,r.bufferHeader.isActive=!0);const i=e.contentAvailabilityHeaders;for(let e=0;e<i.length;e++)r=void 0,isNaN(i[e].bitstream)?isNaN(i[e].bufferView)||(r=t[i[e].bufferView]):r=t[i[e].bitstream],r&&(r.isActive=!0,r.bufferHeader.isActive=!0);r=void 0;const s=e.childSubtreeAvailability;isNaN(s.bitstream)?isNaN(s.bufferView)||(r=t[s.bufferView]):r=t[s.bitstream],r&&(r.isActive=!0,r.bufferHeader.isActive=!0)}requestActiveBuffers(e,t){const r=[];for(let n=0;n<e.length;n++)e[n].isActive?r.push(t):r.push(void 0);const n={};for(let e=0;e<r.length;e++){const t=r[e];t&&(n[e]=t)}return n}parseActiveBufferViews(e,t){const r={};for(let n=0;n<e.length;n++){const i=e[n];if(!i.isActive)continue;const s=i.byteOffset,o=s+i.byteLength,a=t[i.buffer];r[n]=a.slice(s,o)}return r}preprocessBuffers(e=[]){for(let t=0;t<e.length;t++)e[t].isActive=!1;return e}preprocessBufferViews(e=[],t){for(let r=0;r<e.length;r++){const n=e[r];n.bufferHeader=t[n.buffer],n.isActive=!1}return e}parseAvailability(e,t,r){const n=df(this.rootTile),i=this.rootTile.implicitTiling.subtreeLevels,s=(Math.pow(n,i)-1)/(n-1),o=Math.pow(n,i);e._tileAvailability=this.parseAvailabilityBitstream(t.tileAvailability,r,s),e._contentAvailabilityBitstreams=[];for(let n=0;n<t.contentAvailabilityHeaders.length;n++){const i=this.parseAvailabilityBitstream(t.contentAvailabilityHeaders[n],r,s);e._contentAvailabilityBitstreams.push(i)}e._childSubtreeAvailability=this.parseAvailabilityBitstream(t.childSubtreeAvailability,r,o)}parseAvailabilityBitstream(e,t,r){if(!isNaN(e.constant))return{constant:Boolean(e.constant),lengthBits:r};let n;return isNaN(e.bitstream)?isNaN(e.bufferView)||(n=t[e.bufferView]):n=t[e.bitstream],{bitstream:n,lengthBits:r}}expandSubtree(e,t){const r=pf.copy(e);for(let n=0;t&&n<t._contentAvailabilityBitstreams.length;n++)if(t&&this.getBit(t._contentAvailabilityBitstreams[n],0)){r.content={uri:this.parseImplicitURI(e,this.rootTile.content.uri)};break}e.children.push(r);const n=this.transcodeSubtreeTiles(r,t),i=this.listChildSubtrees(t,n);for(let e=0;e<i.length;e++){const t=i[e],r=t.tile,n=this.deriveChildTile(null,r,null,t.childMortonIndex);n.content={uri:this.parseImplicitURI(n,this.rootTile.implicitTiling.subtrees.uri)},r.children.push(n)}}transcodeSubtreeTiles(e,t){let r=[e],n=[];for(let e=1;e<this.rootTile.implicitTiling.subtreeLevels;e++){const i=df(this.rootTile),s=(Math.pow(i,e)-1)/(i-1),o=i*r.length;for(let e=0;e<o;e++){const o=s+e,a=r[e>>Math.log2(i)];if(!this.getBit(t._tileAvailability,o)){n.push(void 0);continue}const l=this.deriveChildTile(t,a,o,e);a.children.push(l),n.push(l)}r=n,n=[]}return r}deriveChildTile(e,t,r,n){const i=new pf(t,n);i.boundingVolume=this.getTileBoundingVolume(i),i.geometricError=this.getGeometricError(i);for(let t=0;e&&t<e._contentAvailabilityBitstreams.length;t++)if(e&&this.getBit(e._contentAvailabilityBitstreams[t],r)){i.content={uri:this.parseImplicitURI(i,this.rootTile.content.uri)};break}return i}getBit(e,t){if(t<0||t>=e.lengthBits)throw new Error("Bit index out of bounds.");if(void 0!==e.constant)return e.constant;const r=t>>3,n=t%8;return 1==(new Uint8Array(e.bitstream)[r]>>n&1)}getTileBoundingVolume(e){const t={};if(this.rootTile.boundingVolume.region){const r=[...this.rootTile.boundingVolume.region],n=r[0],i=r[2],s=r[1],o=r[3],a=(i-n)/Math.pow(2,e.__level),l=(o-s)/Math.pow(2,e.__level);r[0]=n+a*e.__x,r[2]=n+a*(e.__x+1),r[1]=s+l*e.__y,r[3]=s+l*(e.__y+1);for(let e=0;e<4;e++){const t=r[e];t<-Math.PI?r[e]+=2*Math.PI:t>Math.PI&&(r[e]-=2*Math.PI)}if(uf(e)){const t=r[4],n=(r[5]-t)/Math.pow(2,e.__level);r[4]=t+n*e.__z,r[5]=t+n*(e.__z+1)}t.region=r}if(this.rootTile.boundingVolume.box){const r=[...this.rootTile.boundingVolume.box],n=2**e.__level-1,i=Math.pow(2,-e.__level),s=uf(e)?3:2;for(let t=0;t<s;t++){r[3+3*t+0]*=i,r[3+3*t+1]*=i,r[3+3*t+2]*=i;const s=r[3+3*t+0],o=r[3+3*t+1],a=r[3+3*t+2],l=0===t?e.__x:1===t?e.__y:e.__z;r[0]+=2*s*(-.5*n+l),r[1]+=2*o*(-.5*n+l),r[2]+=2*a*(-.5*n+l)}t.box=r}return t}getGeometricError(e){return this.rootTile.geometricError/Math.pow(2,e.__level)}listChildSubtrees(e,t){const r=[],n=df(this.rootTile);for(let i=0;i<t.length;i++){const s=t[i];if(void 0!==s)for(let t=0;t<n;t++){const o=i*n+t;this.getBit(e._childSubtreeAvailability,o)&&r.push({tile:s,childMortonIndex:o})}}return r}parseImplicitURI(e,t){return(t=(t=(t=t.replace("{level}",e.__level)).replace("{x}",e.__x)).replace("{y}",e.__y)).replace("{z}",e.__z)}}class gf{constructor(){this.name="IMPLICIT_TILING_PLUGIN"}init(e){this.tiles=e}preprocessNode(e,t,r){e.implicitTiling?(e.__hasUnrenderableContent=!0,e.__hasRenderableContent=!1,e.__subtreeIdx=0,e.__implicitRoot=e,e.__x=0,e.__y=0,e.__z=0,e.__level=0):/.subtree$/i.test(e.content?.uri)&&(e.__hasUnrenderableContent=!0,e.__hasRenderableContent=!1)}parseTile(e,t,r){if(/^subtree$/i.test(r))return new ff(t).parse(e),Promise.resolve()}preprocessURL(e,t){if(t&&t.implicitTiling){const e=t.implicitTiling.subtrees.uri.replace("{level}",t.__level).replace("{x}",t.__x).replace("{y}",t.__y).replace("{z}",t.__z);return new URL(e,t.__basePath+"/").toString()}return e}disposeTile(e){/.subtree$/i.test(e.content?.uri)&&(e.children.length=0)}}const Af={};Af.LegacyGLTFLoader=function(){class e extends s.Loader{constructor(e){super(e)}load(e,t,r,n){var i,o=this;i=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:s.LoaderUtils.extractUrlBase(e);var a=new s.FileLoader(o.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.load(e,(function(e){o.parse(e,i,t)}),r,n)}parse(e,t,r){var a,h={};s.LoaderUtils.decodeText(new Uint8Array(e,0,4))===o.magic?(h[n.KHR_BINARY_GLTF]=new l(e),a=h[n.KHR_BINARY_GLTF].content):a=s.LoaderUtils.decodeText(new Uint8Array(e));var u=JSON.parse(a);u.extensionsUsed&&u.extensionsUsed.indexOf(n.KHR_MATERIALS_COMMON)>=0&&(h[n.KHR_MATERIALS_COMMON]=new i(u)),u.extensionsUsed&&u.extensionsUsed.indexOf(n.CESIUM_RTC)>=0&&(h[n.CESIUM_RTC]=new c(u)),new M(u,h,{crossOrigin:this.crossOrigin,manager:this.manager,path:t||this.resourcePath||""}).parse((function(e,t,n,i){r({scene:e,scenes:t,cameras:n,animations:i})}))}}function t(){var e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}},update:function(t,r){for(var n in e){var i=e[n];i.update&&i.update(t,r)}}}}function r(e,t){var r={},n=e.material.uniforms;for(var i in n){var o=n[i];if(o.semantic){var a=o.node,l=e;a&&(l=t[a]),r[i]={semantic:o.semantic,sourceNode:l,targetNode:e,uniform:o}}}this.boundUniforms=r,this._m4=new s.Matrix4}e.Shaders={update:function(){console.warn("threeExamples.LegacyGLTFLoader.Shaders has been deprecated, and now updates automatically.")}},r.prototype.update=function(e,t){var r=this.boundUniforms;for(var n in r){var i=r[n];switch(i.semantic){case"MODELVIEW":i.uniform.value.multiplyMatrices(t.matrixWorldInverse,i.sourceNode.matrixWorld);break;case"MODELVIEWINVERSETRANSPOSE":var s=i.uniform.value;this._m4.multiplyMatrices(t.matrixWorldInverse,i.sourceNode.matrixWorld),s.getNormalMatrix(this._m4);break;case"PROJECTION":i.uniform.value.copy(t.projectionMatrix);break;case"JOINTMATRIX":for(var o=i.uniform.value,a=0;a<o.length;a++)o[a].getInverse(i.sourceNode.matrixWorld).multiply(i.targetNode.skeleton.bones[a].matrixWorld).multiply(i.targetNode.skeleton.boneInverses[a]).multiply(i.targetNode.bindMatrix);break;default:console.warn("Unhandled shader semantic: "+i.semantic)}}},e.Animations={update:function(){console.warn("threeExamples.LegacyGLTFLoader.Animation has been deprecated. Use THREE.AnimationMixer instead.")}};var n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_MATERIALS_COMMON:"KHR_materials_common",CESIUM_RTC:"CESIUM_RTC"};function i(e){this.name=n.KHR_MATERIALS_COMMON,this.lights={};var t=(e.extensions&&e.extensions[n.KHR_MATERIALS_COMMON]||{}).lights||{};for(var r in t){var i,o=t[r],a=o[o.type],l=(new s.Color).fromArray(a.color);switch(o.type){case"directional":(i=new s.DirectionalLight(l)).position.set(0,0,1);break;case"point":i=new s.PointLight(l);break;case"spot":(i=new s.SpotLight(l)).position.set(0,0,1);break;case"ambient":i=new s.AmbientLight(l)}i&&(this.lights[r]=i)}}var o={magic:"glTF",version:1,contentFormat:0},a=20;function l(e){this.name=n.KHR_BINARY_GLTF;var t=new DataView(e,0,a),r={magic:s.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0),contentLength:t.getUint32(12,!0),contentFormat:t.getUint32(16,!0)};for(var i in o){var l=o[i];if(r[i]!==l)throw new Error('Unsupported glTF-Binary header: Expected "%s" to be "%s".',i,l)}var c=new Uint8Array(e,a,r.contentLength);this.header=r,this.content=s.LoaderUtils.decodeText(c),this.body=e.slice(a+r.contentLength,r.length)}function c(e){this.name=n.CESIUM_RTC,this.center=[0,0,0],e.extensions&&e.extensions[n.CESIUM_RTC]&&e.extensions[n.CESIUM_RTC].center&&3===e.extensions[n.CESIUM_RTC].center.length&&(this.center=e.extensions[n.CESIUM_RTC].center)}l.prototype.loadShader=function(e,t){var r=t[e.extensions[n.KHR_BINARY_GLTF].bufferView],i=new Uint8Array(r);return s.LoaderUtils.decodeText(i)};var h={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,TRIANGLES:4,LINES:1,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,VERTEX_SHADER:35633,FRAGMENT_SHADER:35632},u={5126:Number,35675:s.Matrix3,35676:s.Matrix4,35664:s.Vector2,35665:s.Vector3,35666:s.Vector4,35678:s.Texture},d={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},p={9728:s.NearestFilter,9729:s.LinearFilter,9984:s.NearestMipmapNearestFilter,9985:s.LinearMipmapNearestFilter,9986:s.NearestMipmapLinearFilter,9987:s.LinearMipmapLinearFilter},f={33071:s.ClampToEdgeWrapping,33648:s.MirroredRepeatWrapping,10497:s.RepeatWrapping},g={6406:s.AlphaFormat,6407:s.RGBAFormat,6408:s.RGBAFormat,6409:s.LuminanceFormat,6410:s.LuminanceAlphaFormat},A={5121:s.UnsignedByteType,32819:s.UnsignedShort4444Type,32820:s.UnsignedShort5551Type,33635:s.UnsignedShort5551Type},m={1028:s.BackSide,1029:s.FrontSide},y={512:s.NeverDepth,513:s.LessDepth,514:s.EqualDepth,515:s.LessEqualDepth,516:s.GreaterEqualDepth,517:s.NotEqualDepth,518:s.GreaterEqualDepth,519:s.AlwaysDepth},v={32774:s.AddEquation,32778:s.SubtractEquation,32779:s.ReverseSubtractEquation},w={0:s.ZeroFactor,1:s.OneFactor,768:s.SrcColorFactor,769:s.OneMinusSrcColorFactor,770:s.SrcAlphaFactor,771:s.OneMinusSrcAlphaFactor,772:s.DstAlphaFactor,773:s.OneMinusDstAlphaFactor,774:s.DstColorFactor,775:s.OneMinusDstColorFactor,776:s.SrcAlphaSaturateFactor},b={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},E={scale:"scale",translation:"position",rotation:"quaternion"},x={LINEAR:s.InterpolateLinear,STEP:s.InterpolateDiscrete},C={2884:"CULL_FACE",2929:"DEPTH_TEST",3042:"BLEND",3089:"SCISSOR_TEST",32823:"POLYGON_OFFSET_FILL",32926:"SAMPLE_ALPHA_TO_COVERAGE"};function _(e,t,r){if(!e)return Promise.resolve();var n,i=[];if("[object Array]"===Object.prototype.toString.call(e)){n=[];for(var s=e.length,o=0;o<s;o++)(l=t.call(r||this,e[o],o))&&(i.push(l),l instanceof Promise?l.then(function(e,t){n[e]=t}.bind(this,o)):n[o]=l)}else for(var a in n={},e){var l;e.hasOwnProperty(a)&&(l=t.call(r||this,e[a],a))&&(i.push(l),l instanceof Promise?l.then(function(e,t){n[e]=t}.bind(this,a)):n[a]=l)}return Promise.all(i).then((function(){return n}))}function I(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:(t||"")+e}function S(e){this.isDeferredShaderMaterial=!0,this.params=e}function M(e,r,n){this.json=e||{},this.extensions=r||{},this.options=n||{},this.cache=new t}return S.prototype.create=function(){var e=s.UniformsUtils.clone(this.params.uniforms);for(var t in this.params.uniforms){var r=this.params.uniforms[t];r.value instanceof s.Texture&&(e[t].value=r.value,e[t].value.needsUpdate=!0),e[t].semantic=r.semantic,e[t].node=r.node}return this.params.uniforms=e,new s.RawShaderMaterial(this.params)},M.prototype._withDependencies=function(e){for(var t={},r=0;r<e.length;r++){var n=e[r],i="load"+n.charAt(0).toUpperCase()+n.slice(1),s=this.cache.get(n);if(void 0!==s)t[n]=s;else if(this[i]){var o=this[i]();this.cache.add(n,o),t[n]=o}}return _(t,(function(e){return e}))},M.prototype.parse=function(e){var t=this.json;this.cache.removeAll(),this._withDependencies(["scenes","cameras","animations"]).then((function(r){var n=[];for(var i in r.scenes)n.push(r.scenes[i]);var s=void 0!==t.scene?r.scenes[t.scene]:n[0],o=[];for(var i in r.cameras){var a=r.cameras[i];o.push(a)}var l=[];for(var i in r.animations)l.push(r.animations[i]);e(s,n,o,l)}))},M.prototype.loadShaders=function(){var e=this.json,t=this.extensions,r=this.options;return this._withDependencies(["bufferViews"]).then((function(i){return _(e.shaders,(function(e){return e.extensions&&e.extensions[n.KHR_BINARY_GLTF]?t[n.KHR_BINARY_GLTF].loadShader(e,i.bufferViews):new Promise((function(t){var n=new s.FileLoader(r.manager);n.setResponseType("text"),n.load(I(e.uri,r.path),(function(e){t(e)}))}))}))}))},M.prototype.loadBuffers=function(){var e=this.json,t=this.extensions,r=this.options;return _(e.buffers,(function(e,i){return"binary_glTF"===i||i===n.KHR_BINARY_GLTF?t[n.KHR_BINARY_GLTF].body:"arraybuffer"===e.type||void 0===e.type?new Promise((function(t){var n=new s.FileLoader(r.manager);n.setResponseType("arraybuffer"),n.load(I(e.uri,r.path),(function(e){t(e)}))})):void console.warn("threeExamples.LegacyGLTFLoader: "+e.type+" buffer type is not supported")}))},M.prototype.loadBufferViews=function(){var e=this.json;return this._withDependencies(["buffers"]).then((function(t){return _(e.bufferViews,(function(e){var r=t.buffers[e.buffer],n=void 0!==e.byteLength?e.byteLength:0;return r.slice(e.byteOffset,e.byteOffset+n)}))}))},M.prototype.loadAccessors=function(){var e=this.json;return this._withDependencies(["bufferViews"]).then((function(t){return _(e.accessors,(function(e){var r=t.bufferViews[e.bufferView],n=b[e.type],i=d[e.componentType],o=i.BYTES_PER_ELEMENT;if(e.byteStride&&e.byteStride!==o*n){var a=new i(r),l=new s.InterleavedBuffer(a,e.byteStride/o);return new s.InterleavedBufferAttribute(l,n,e.byteOffset/o)}return a=new i(r,e.byteOffset,e.count*n),new s.BufferAttribute(a,n)}))}))},M.prototype.loadTextures=function(){var e=this.json,t=this.options;return this._withDependencies(["bufferViews"]).then((function(r){return _(e.textures,(function(i){if(i.source)return new Promise((function(o){var a=e.images[i.source],l=a.uri,c=!1;if(a.extensions&&a.extensions[n.KHR_BINARY_GLTF]){var h=a.extensions[n.KHR_BINARY_GLTF],u=r.bufferViews[h.bufferView],d=new Blob([u],{type:h.mimeType});l=URL.createObjectURL(d),c=!0}var m=t.manager.getHandler(l);null===m&&(m=new s.TextureLoader(t.manager)),m.setCrossOrigin(t.crossOrigin),m.load(I(l,t.path),(function(t){if(c&&URL.revokeObjectURL(l),t.flipY=!1,void 0!==i.name&&(t.name=i.name),t.format=void 0!==i.format?g[i.format]:s.RGBAFormat,void 0!==i.internalFormat&&t.format!==g[i.internalFormat]&&console.warn("threeExamples.LegacyGLTFLoader: Three.js doesn't support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format."),t.type=void 0!==i.type?A[i.type]:s.UnsignedByteType,i.sampler){var r=e.samplers[i.sampler];t.magFilter=p[r.magFilter]||s.LinearFilter,t.minFilter=p[r.minFilter]||s.NearestMipmapLinearFilter,t.wrapS=f[r.wrapS]||s.RepeatWrapping,t.wrapT=f[r.wrapT]||s.RepeatWrapping}o(t)}),void 0,(function(){c&&URL.revokeObjectURL(l),o()}))}))}))}))},M.prototype.loadMaterials=function(){var e=this.json;return this._withDependencies(["shaders","textures"]).then((function(t){return _(e.materials,(function(r){var i,o,a={},l={};if(r.extensions&&r.extensions[n.KHR_MATERIALS_COMMON]&&(o=r.extensions[n.KHR_MATERIALS_COMMON]),o){var c=["ambient","emission","transparent","transparency","doubleSided"];switch(o.technique){case"BLINN":case"PHONG":i=s.MeshPhongMaterial,c.push("diffuse","specular","shininess");break;case"LAMBERT":i=s.MeshLambertMaterial,c.push("diffuse");break;default:i=s.MeshBasicMaterial}c.forEach((function(e){void 0!==o.values[e]&&(a[e]=o.values[e])})),(o.doubleSided||a.doubleSided)&&(l.side=s.DoubleSide),(o.transparent||a.transparent)&&(l.transparent=!0,l.opacity=void 0!==a.transparency?a.transparency:1)}else if(void 0===r.technique)i=s.MeshPhongMaterial,Object.assign(a,r.values);else{const n=e.techniques[r.technique];if(function(e){for(const t in e)if(e[t].includes("czm_"))return!0;return!1}(t.shaders)){i=s.MeshBasicMaterial;let e=null;const o=n.uniforms;for(const i in o){const s=o[i],a=n.parameters[s];if(a.type===h.SAMPLER_2D){let n;void 0!==r.values&&(n=r.values[s]),void 0!==n?e=t.textures[n]:void 0!==a.value&&(e=t.textures[a.value])}}e&&(l.map=e)}else{i=S,l.uniforms={};var d=e.programs[n.program];if(d){l.fragmentShader=t.shaders[d.fragmentShader],l.fragmentShader||(console.warn("ERROR: Missing fragment shader definition:",d.fragmentShader),i=s.MeshPhongMaterial);var p=t.shaders[d.vertexShader];p||(console.warn("ERROR: Missing vertex shader definition:",d.vertexShader),i=s.MeshPhongMaterial),l.vertexShader=function(e,t){var r={};for(var n in t.attributes){var i=t.attributes[n],s=(u=t.parameters[i]).type,o=u.semantic;r[n]={type:s,semantic:o}}var a=t.parameters,l=t.attributes,c={};for(var n in r){var h=a[i=l[n]];(o=h.semantic)&&(c[n]=h)}for(var i in c){o=(u=c[i]).semantic;var u,d=new RegExp("\\b"+i+"\\b","g");switch(o){case"POSITION":e=e.replace(d,"position");break;case"NORMAL":e=e.replace(d,"normal");break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":e=e.replace(d,"uv");break;case"TEXCOORD_1":e=e.replace(d,"uv2");break;case"COLOR_0":case"COLOR0":case"COLOR":e=e.replace(d,"color");break;case"WEIGHT":e=e.replace(d,"skinWeight");break;case"JOINT":e=e.replace(d,"skinIndex")}}return e}(p,n);const e=n.uniforms;for(const i in e){const s=e[i],o=n.parameters[s],a=o.type;if(!u[a])throw new Error("Unknown shader uniform param type: "+a);{const e=o.count;let n;void 0!==r.values&&(n=r.values[s]);var f=new u[a],g=o.semantic,A=o.node;switch(a){case h.FLOAT:f=o.value,"transparency"==s&&(l.transparent=!0),void 0!==n&&(f=n);break;case h.FLOAT_VEC2:case h.FLOAT_VEC3:case h.FLOAT_VEC4:case h.FLOAT_MAT3:o&&o.value&&f.fromArray(o.value),n&&f.fromArray(n);break;case h.FLOAT_MAT2:console.warn("FLOAT_MAT2 is not a supported uniform type");break;case h.FLOAT_MAT4:if(e){f=new Array(e);for(var b=0;b<e;b++)f[b]=new u[a];if(o&&o.value){var E=o.value;f.fromArray(E)}n&&f.fromArray(n)}else{if(o&&o.value){var x=o.value;f.fromArray(x)}n&&f.fromArray(n)}break;case h.SAMPLER_2D:f=void 0!==n?t.textures[n]:void 0!==o.value?t.textures[o.value]:null}l.uniforms[i]={value:f,semantic:g,node:A}}}for(var _=n.states||{},I=_.enable||[],M=_.functions||{},T=!1,B=!1,P=!1,R=0,D=I.length;R<D;R++){var L=I[R];switch(C[L]){case"CULL_FACE":T=!0;break;case"DEPTH_TEST":B=!0;break;case"BLEND":P=!0;break;case"SCISSOR_TEST":case"POLYGON_OFFSET_FILL":case"SAMPLE_ALPHA_TO_COVERAGE":break;default:throw new Error("Unknown technique.states.enable: "+L)}}l.side=T?void 0!==M.cullFace?m[M.cullFace]:s.FrontSide:s.DoubleSide,l.depthTest=B,l.depthFunc=void 0!==M.depthFunc?y[M.depthFunc]:s.LessDepth,l.depthWrite=void 0===M.depthMask||M.depthMask[0],l.blending=P?s.CustomBlending:s.NoBlending,l.transparent=P;var k=M.blendEquationSeparate;void 0!==k?(l.blendEquation=v[k[0]],l.blendEquationAlpha=v[k[1]]):(l.blendEquation=s.AddEquation,l.blendEquationAlpha=s.AddEquation);var O=M.blendFuncSeparate;void 0!==O?(l.blendSrc=w[O[0]],l.blendDst=w[O[1]],l.blendSrcAlpha=w[O[2]],l.blendDstAlpha=w[O[3]]):(l.blendSrc=s.OneFactor,l.blendDst=s.ZeroFactor,l.blendSrcAlpha=s.OneFactor,l.blendDstAlpha=s.ZeroFactor)}}}Array.isArray(a.diffuse)?l.color=(new s.Color).fromArray(a.diffuse):"string"==typeof a.diffuse&&(l.map=t.textures[a.diffuse]),delete l.diffuse,"string"==typeof a.reflective&&(l.envMap=t.textures[a.reflective]),"string"==typeof a.bump&&(l.bumpMap=t.textures[a.bump]),Array.isArray(a.emission)?i===s.MeshBasicMaterial?l.color=(new s.Color).fromArray(a.emission):l.emissive=(new s.Color).fromArray(a.emission):"string"==typeof a.emission&&(i===s.MeshBasicMaterial?l.map=t.textures[a.emission]:l.emissiveMap=t.textures[a.emission]),Array.isArray(a.specular)?l.specular=(new s.Color).fromArray(a.specular):"string"==typeof a.specular&&(l.specularMap=t.textures[a.specular]),void 0!==a.shininess&&(l.shininess=a.shininess);var F=new i(l);return void 0!==r.name&&(F.name=r.name),F}))}))},M.prototype.loadMeshes=function(){var e=this.json;return this._withDependencies(["accessors","materials"]).then((function(t){return _(e.meshes,(function(r){var n=new s.Group;void 0!==r.name&&(n.name=r.name),r.extras&&(n.userData=r.extras);var i=r.primitives||[];for(var o in i){var a=i[o];if(a.mode===h.TRIANGLES||void 0===a.mode){var l=new s.BufferGeometry,c=a.attributes;for(var u in c){if(!(A=c[u]))return;var d=t.accessors[A];switch(u){case"POSITION":l.setAttribute("position",d);break;case"NORMAL":l.setAttribute("normal",d);break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":l.setAttribute("uv",d);break;case"TEXCOORD_1":l.setAttribute("uv2",d);break;case"COLOR_0":case"COLOR0":case"COLOR":l.setAttribute("color",d);break;case"WEIGHT":l.setAttribute("skinWeight",d);break;case"JOINT":l.setAttribute("skinIndex",d);break;default:if(!a.material)break;if(!(g=e.materials[a.material]).technique)break;var p=e.techniques[g.technique].parameters||{};for(var f in p)p[f].semantic===u&&l.setAttribute(f,d)}}a.indices&&l.setIndex(t.accessors[a.indices]);var g=void 0!==t.materials?t.materials[a.material]:new s.MeshPhongMaterial({color:0,emissive:8947848,specular:0,shininess:0,transparent:!1,depthTest:!0,side:s.FrontSide});(m=new s.Mesh(l,g)).castShadow=!0,m.name="0"===o?n.name:n.name+o,a.extras&&(m.userData=a.extras),n.add(m)}else if(a.mode===h.LINES){for(var u in l=new s.BufferGeometry,c=a.attributes){var A;if(!(A=c[u]))return;switch(d=t.accessors[A],u){case"POSITION":l.setAttribute("position",d);break;case"COLOR_0":case"COLOR0":case"COLOR":l.setAttribute("color",d)}}var m;g=t.materials[a.material],a.indices?(l.setIndex(t.accessors[a.indices]),m=new s.LineSegments(l,g)):m=new s.Line(l,g),m.name="0"===o?n.name:n.name+o,a.extras&&(m.userData=a.extras),n.add(m)}else console.warn("Only triangular and line primitives are supported")}return n}))}))},M.prototype.loadCameras=function(){return _(this.json.cameras,(function(e){if("perspective"==e.type&&e.perspective){var t=e.perspective.yfov,r=void 0!==e.perspective.aspectRatio?e.perspective.aspectRatio:1,n=new s.PerspectiveCamera(s.MathUtils.radToDeg(t*r),r,e.perspective.znear||1,e.perspective.zfar||2e6);return void 0!==e.name&&(n.name=e.name),e.extras&&(n.userData=e.extras),n}if("orthographic"==e.type&&e.orthographic)return n=new s.OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,e.orthographic.znear,e.orthographic.zfar),void 0!==e.name&&(n.name=e.name),e.extras&&(n.userData=e.extras),n}))},M.prototype.loadSkins=function(){var e=this.json;return this._withDependencies(["accessors"]).then((function(t){return _(e.skins,(function(e){var r=new s.Matrix4;return void 0!==e.bindShapeMatrix&&r.fromArray(e.bindShapeMatrix),{bindShapeMatrix:r,jointNames:e.jointNames,inverseBindMatrices:t.accessors[e.inverseBindMatrices]}}))}))},M.prototype.loadAnimations=function(){var e=this.json;return this._withDependencies(["accessors","nodes"]).then((function(t){return _(e.animations,(function(e,r){var n=[];for(var i in e.channels){var o=e.channels[i],a=e.samplers[o.sampler];if(a){var l=o.target,c=l.id,h=void 0!==e.parameters?e.parameters[a.input]:a.input,u=void 0!==e.parameters?e.parameters[a.output]:a.output,d=t.accessors[h],p=t.accessors[u],f=t.nodes[c];if(f){f.updateMatrix(),f.matrixAutoUpdate=!0;var g=E[l.path]===E.rotation?s.QuaternionKeyframeTrack:s.VectorKeyframeTrack,A=f.name?f.name:f.uuid,m=void 0!==a.interpolation?x[a.interpolation]:s.InterpolateLinear;n.push(new g(A+"."+E[l.path],d.array.slice(),p.array.slice(),m))}}}return c=void 0!==e.name?e.name:"animation_"+r,new s.AnimationClip(c,void 0,n)}))}))},M.prototype.loadNodes=function(){var e=this.json,t=this.extensions,r=this;return _(e.nodes,(function(e){var t,r=new s.Matrix4;return e.jointName?((t=new s.Bone).name=void 0!==e.name?e.name:e.jointName,t.jointName=e.jointName):(t=new s.Object3D,void 0!==e.name&&(t.name=e.name)),e.extras&&(t.userData=e.extras),void 0!==e.matrix?(r.fromArray(e.matrix),t.applyMatrix4(r)):(void 0!==e.translation&&t.position.fromArray(e.translation),void 0!==e.rotation&&t.quaternion.fromArray(e.rotation),void 0!==e.scale&&t.scale.fromArray(e.scale)),t})).then((function(i){return r._withDependencies(["meshes","skins","cameras"]).then((function(r){return _(i,(function(o,a){var l=e.nodes[a];if(void 0!==l.meshes)for(var c in l.meshes){var h=l.meshes[c],u=r.meshes[h];if(void 0!==u)for(var d in u.children){var p,f=u.children[d],g=f.material,A=f.geometry,m=f.userData,y=f.name;switch(g.isDeferredShaderMaterial?g=v=g.create():v=g,f.type){case"LineSegments":f=new s.LineSegments(A,v);break;case"LineLoop":f=new s.LineLoop(A,v);break;case"Line":f=new s.Line(A,v);break;default:f=new s.Mesh(A,v)}if(f.castShadow=!0,f.userData=m,f.name=y,l.skin&&(p=r.skins[l.skin]),p){var v,w=function(e){for(var t=Object.keys(i),r=0,n=t.length;r<n;r++){var s=i[t[r]];if(s.jointName===e)return s}return null},b=A;(v=g).skinning=!0,(f=new s.SkinnedMesh(b,v)).castShadow=!0,f.userData=m,f.name=y;for(var E=[],x=[],C=0,_=p.jointNames.length;C<_;C++){var I=p.jointNames[C],S=w(I);if(S){E.push(S);var M=p.inverseBindMatrices.array,T=(new s.Matrix4).fromArray(M,16*C);x.push(T)}else console.warn("WARNING: joint: '"+I+"' could not be found")}f.bind(new s.Skeleton(E,x),p.bindShapeMatrix);var B=function(t,r,n){var s=t[n];if(void 0!==s)for(var o=0,a=s.length;o<a;o++){var l=s[o],c=i[l],h=e.nodes[l];void 0!==c&&!0===c.isBone&&void 0!==h&&(r.add(c),B(h,c,"children"))}};B(l,f,"skeletons")}o.add(f)}else console.warn("LegacyGLTFLoader: Couldn't find node \""+h+'".')}if(void 0!==l.camera){var P=r.cameras[l.camera];o.add(P)}if(l.extensions&&l.extensions[n.KHR_MATERIALS_COMMON]&&l.extensions[n.KHR_MATERIALS_COMMON].light){var R=t[n.KHR_MATERIALS_COMMON].lights[l.extensions[n.KHR_MATERIALS_COMMON].light];o.add(R)}return o}))}))}))},M.prototype.loadScenes=function(){var e=this.json,t=this.extensions;function i(t,r,n){var s=n[t];r.add(s);var o=e.nodes[t];if(o.children)for(var a=o.children,l=0,c=a.length;l<c;l++)i(a[l],s,n)}return this._withDependencies(["nodes"]).then((function(o){return _(e.scenes,(function(e){var a=new s.Scene;void 0!==e.name&&(a.name=e.name),e.extras&&(a.userData=e.extras);for(var l=e.nodes||[],c=0,h=l.length;c<h;c++)i(l[c],a,o.nodes);return a.traverse((function(e){e.material&&e.material.isRawShaderMaterial&&(e.gltfShader=new r(e,o.nodes),e.onBeforeRender=function(e,t,r){this.gltfShader.update(t,r)})})),t[n.CESIUM_RTC]&&a.position.fromArray(t[n.CESIUM_RTC].center),a}))}))},e}();const mf=Af.LegacyGLTFLoader;class yf extends s.Loader{constructor(e){super(e),this.legacyGLTFLoader=new mf,this.glTFLoader=new Au}load(e,t,r,n){const i=this;let o;if(""!==this.resourcePath)o=this.resourcePath;else if(""!==this.path){const t=s.LoaderUtils.extractUrlBase(e);o=s.LoaderUtils.resolveURL(t,this.path)}else o=s.LoaderUtils.extractUrlBase(e);this.manager.itemStart(e);const a=t=>{n?n(t):console.error(t),i.manager.itemError(e),i.manager.itemEnd(e)},l=new s.FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,(r=>{try{i.parse(r,o,(r=>{t(r),i.manager.itemEnd(e)}),a)}catch(e){a(e)}}),r,a)}setDRACOLoader(e){this.glTFLoader.setDRACOLoader(e)}setKTX2Loader(e){this.glTFLoader.setKTX2Loader(e)}setMeshoptDecoder(e){this.glTFLoader.setMeshoptDecoder(e)}register(e){this.glTFLoader.register(e)}unregister(e){this.glTFLoader.unregister(e)}parse(e,t,r,n){e&&t?1===new DataView(e,0,20).getUint32(4,!0)?this.legacyGLTFLoader.parse(e,t,r,n):this.glTFLoader.parse(e,t,r,n):n("[iGLTFLoader]: Buffer and path are mandatory to parse a glTF.")}parseAsync(e,t){const r=this;return new Promise(((n,i)=>{r.parse(e,t,n,i)}))}}const vf=yf,wf=new WeakMap;class bf extends s.Loader{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,n){const i=new s.FileLoader(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,(e=>{this.parse(e,t,n)}),r,n)}parse(e,t,r=()=>{}){this.decodeDracoFile(e,t,null,null,s.SRGBColorSpace,r).catch(r)}decodeDracoFile(e,t,r,n,i=s.LinearSRGBColorSpace,o=()=>{}){const a={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!r,vertexColorSpace:i};return this.decodeGeometry(e,a).then(t).catch(o)}decodeGeometry(e,t){const r=JSON.stringify(t);if(wf.has(e)){const t=wf.get(e);if(t.key===r)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const i=this.workerNextTaskID++,s=e.byteLength,o=this._getWorker(i,s).then((r=>(n=r,new Promise(((r,s)=>{n._callbacks[i]={resolve:r,reject:s},n.postMessage({type:"decode",id:i,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return o.catch((()=>!0)).then((()=>{n&&i&&this._releaseTask(n,i)})),wf.set(e,{key:r,promise:o}),o}_createGeometry(e){const t=new s.BufferGeometry;e.index&&t.setIndex(new s.BufferAttribute(e.index.array,1));for(let r=0;r<e.attributes.length;r++){const n=e.attributes[r],i=n.name,o=n.array,a=n.itemSize,l=new s.BufferAttribute(o,a);"color"===i&&(this._assignVertexColorSpace(l,n.vertexColorSpace),l.normalized=o instanceof Float32Array==0),t.setAttribute(i,l)}return t}_assignVertexColorSpace(e,t){if(t!==s.SRGBColorSpace)return;const r=new s.Color;for(let t=0,n=e.count;t<n;t++)r.fromBufferAttribute(e,t),s.ColorManagement.toWorkingColorSpace(r,s.SRGBColorSpace),e.setXYZ(t,r.r,r.g,r.b)}_loadLibrary(e,t){const r=new s.FileLoader(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise(((t,n)=>{r.load(e,t,void 0,n)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{const r=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const n=Ef.toString(),i=["/* draco decoder */",r,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const r=t.data;switch(r.type){case"decode":e._callbacks[r.id].resolve(r);break;case"error":e._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function Ef(){let e,t;function r(e,t,r,n,i,s){const o=s.num_components(),a=r.num_points()*o,l=a*i.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,i),h=e._malloc(l);t.GetAttributeDataArrayForAllPoints(r,s,c,l,h);const u=new i(e.HEAPF32.buffer,h,a).slice();return e._free(h),{name:n,array:u,itemSize:o}}onmessage=function(n){const i=n.data;switch(i.type){case"init":e=i.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":const n=i.buffer,s=i.taskConfig;t.then((e=>{const t=e.draco,o=new t.Decoder;try{const e=function(e,t,n,i){const s=i.attributeIDs,o=i.attributeTypes;let a,l;const c=t.GetEncodedGeometryType(n);if(c===e.TRIANGULAR_MESH)a=new e.Mesh,l=t.DecodeArrayToMesh(n,n.byteLength,a);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new e.PointCloud,l=t.DecodeArrayToPointCloud(n,n.byteLength,a)}if(!l.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const h={index:null,attributes:[]};for(const n in s){const l=self[o[n]];let c,u;if(i.useUniqueIDs)u=s[n],c=t.GetAttributeByUniqueId(a,u);else{if(u=t.GetAttributeId(a,e[s[n]]),-1===u)continue;c=t.GetAttribute(a,u)}const d=r(e,t,a,n,l,c);"color"===n&&(d.vertexColorSpace=i.vertexColorSpace),h.attributes.push(d)}return c===e.TRIANGULAR_MESH&&(h.index=function(e,t,r){const n=3*r.num_faces(),i=4*n,s=e._malloc(i);t.GetTrianglesUInt32Array(r,i,s);const o=new Uint32Array(e.HEAPF32.buffer,s,n).slice();return e._free(s),{array:o,itemSize:1}}(e,t,a)),e.destroy(a),h}(t,o,new Int8Array(n),s),a=e.attributes.map((e=>e.array.buffer));e.index&&a.push(e.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:e},a)}catch(e){console.error(e),self.postMessage({type:"error",id:i.id,error:e.message})}finally{t.destroy(o)}}))}}}class xf{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const r=this.workersResolve[e];if(r&&r(t),this.queue.length){const{resolve:t,msg:r,transfer:n}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(r,n)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise((r=>{const n=this._getIdleWorker();-1!==n?(this._initWorker(n),this.workerStatus|=1<<n,this.workersResolve[n]=r,this.workers[n].postMessage(e,t)):this.queue.push({resolve:r,msg:e,transfer:t})}))}dispose(){this.workers.forEach((e=>e.terminate())),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const Cf=9,_f=15,If=16,Sf=22,Mf=37,Tf=43,Bf=76,Pf=83,Rf=97,Df=100,Lf=103,kf=109,Of=165,Ff=166,Nf=1000066e3;class Uf{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Qf{constructor(e,t,r,n){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,r),this._littleEndian=n,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){void 0===t&&(t=0);const r=this._offset;let n=0;for(;this._dataView.getUint8(this._offset)!==t&&n<e;)n++,this._offset++;return n<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+r,n)}}new Uint8Array([0]);const Gf=[171,75,84,88,32,50,48,187,13,10,26,10];function zf(e){return(new TextDecoder).decode(e)}let jf,Vf,qf;const Hf={env:{emscripten_notify_memory_growth:function(e){qf=new Uint8Array(Vf.exports.memory.buffer)}}};class Wf{init(){return jf||(jf="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+$f).then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,Hf))).then(this._init):WebAssembly.instantiate(Buffer.from($f,"base64"),Hf).then(this._init),jf)}_init(e){Vf=e.instance,Hf.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!Vf)throw new Error("ZSTDDecoder: Await .init() before decoding.");const r=e.byteLength,n=Vf.exports.malloc(r);qf.set(e,n),t=t||Number(Vf.exports.ZSTD_findDecompressedSize(n,r));const i=Vf.exports.malloc(t),s=Vf.exports.ZSTD_decompress(i,t,n,r),o=qf.slice(i,i+s);return Vf.exports.free(n),Vf.exports.free(i),o}}const $f="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",Yf=(s.SRGBTransfer,s.LinearTransfer,s.LinearTransfer,new WeakMap);let Kf,Jf=0;class Xf extends s.Loader{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new xf,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}async detectSupportAsync(e){return this.workerConfig={astcSupported:await e.hasFeatureAsync("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:await e.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await e.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await e.hasFeatureAsync("texture-compression-bc"),bptcSupported:await e.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await e.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(e){return!0===e.isWebGPURenderer?this.workerConfig={astcSupported:e.hasFeature("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:e.hasFeature("texture-compression-etc1"),etc2Supported:e.hasFeature("texture-compression-etc2"),dxtSupported:e.hasFeature("texture-compression-bc"),bptcSupported:e.hasFeature("texture-compression-bptc"),pvrtcSupported:e.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),astcHDRSupported:e.extensions.has("WEBGL_compressed_texture_astc")&&e.extensions.get("WEBGL_compressed_texture_astc").getSupportedProfiles().includes("hdr"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const e=new s.FileLoader(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),r=new s.FileLoader(this.manager);r.setPath(this.transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);const n=r.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,n]).then((([e,t])=>{const r=Xf.BasisWorker.toString(),n=["/* constants */","let _EngineFormat = "+JSON.stringify(Xf.EngineFormat),"let _EngineType = "+JSON.stringify(Xf.EngineType),"let _TranscoderFormat = "+JSON.stringify(Xf.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Xf.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n])),this.transcoderBinary=t,this.workerPool.setWorkerCreator((()=>{const e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e}))})),Jf>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Jf++}return this.transcoderPending}load(e,t,r,n){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const i=new s.FileLoader(this.manager);i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials),i.load(e,(e=>{this.parse(e,t,n)}),r,n)}parse(e,t,r){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(Yf.has(e))return Yf.get(e).promise.then(t).catch(r);this._createTexture(e).then((e=>t?t(e):null)).catch(r)}_createTextureFrom(e,t){const{type:r,error:n,data:{faces:i,width:o,height:a,format:l,type:c,dfdFlags:h}}=e;if("error"===r)return Promise.reject(n);let u;if(6===t.faceCount)u=new s.CompressedCubeTexture(i,l,c);else{const e=i[0].mipmaps;u=t.layerCount>1?new s.CompressedArrayTexture(e,o,a,t.layerCount,l,c):new s.CompressedTexture(e,o,a,l,c)}return u.minFilter=1===i[0].mipmaps.length?s.LinearFilter:s.LinearMipmapLinearFilter,u.magFilter=s.LinearFilter,u.generateMipmaps=!1,u.needsUpdate=!0,u.colorSpace=rg(t),u.premultiplyAlpha=!!(1&h),u}async _createTexture(e,t={}){const r=function(e){const t=new Uint8Array(e.buffer,e.byteOffset,Gf.length);if(t[0]!==Gf[0]||t[1]!==Gf[1]||t[2]!==Gf[2]||t[3]!==Gf[3]||t[4]!==Gf[4]||t[5]!==Gf[5]||t[6]!==Gf[6]||t[7]!==Gf[7]||t[8]!==Gf[8]||t[9]!==Gf[9]||t[10]!==Gf[10]||t[11]!==Gf[11])throw new Error("Missing KTX 2.0 identifier.");const r=new Uf,n=17*Uint32Array.BYTES_PER_ELEMENT,i=new Qf(e,Gf.length,n,!0);r.vkFormat=i._nextUint32(),r.typeSize=i._nextUint32(),r.pixelWidth=i._nextUint32(),r.pixelHeight=i._nextUint32(),r.pixelDepth=i._nextUint32(),r.layerCount=i._nextUint32(),r.faceCount=i._nextUint32();const s=i._nextUint32();r.supercompressionScheme=i._nextUint32();const o=i._nextUint32(),a=i._nextUint32(),l=i._nextUint32(),c=i._nextUint32(),h=i._nextUint64(),u=i._nextUint64(),d=new Qf(e,Gf.length+n,3*s*8,!0);for(let t=0;t<s;t++)r.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});const p=new Qf(e,o,a,!0),f={vendorId:p._skip(4)._nextUint16(),descriptorType:p._nextUint16(),versionNumber:p._nextUint16(),descriptorBlockSize:p._nextUint16(),colorModel:p._nextUint8(),colorPrimaries:p._nextUint8(),transferFunction:p._nextUint8(),flags:p._nextUint8(),texelBlockDimension:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],bytesPlane:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],samples:[]},g=(f.descriptorBlockSize/4-6)/4;for(let e=0;e<g;e++){const t={bitOffset:p._nextUint16(),bitLength:p._nextUint8(),channelType:p._nextUint8(),samplePosition:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&t.channelType?(t.sampleLower=p._nextInt32(),t.sampleUpper=p._nextInt32()):(t.sampleLower=p._nextUint32(),t.sampleUpper=p._nextUint32()),f.samples[e]=t}r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(f);const A=new Qf(e,l,c,!0);for(;A._offset<c;){const e=A._nextUint32(),t=A._scan(e),n=zf(t);if(r.keyValue[n]=A._nextUint8Array(e-t.byteLength-1),n.match(/^ktx/i)){const e=zf(r.keyValue[n]);r.keyValue[n]=e.substring(0,e.lastIndexOf("\0"))}A._skip(e%4?4-e%4:0)}if(u<=0)return r;const m=new Qf(e,h,u,!0),y=m._nextUint16(),v=m._nextUint16(),w=m._nextUint32(),b=m._nextUint32(),E=m._nextUint32(),x=m._nextUint32(),C=[];for(let e=0;e<s;e++)C.push({imageFlags:m._nextUint32(),rgbSliceByteOffset:m._nextUint32(),rgbSliceByteLength:m._nextUint32(),alphaSliceByteOffset:m._nextUint32(),alphaSliceByteLength:m._nextUint32()});const _=h+m._offset,I=_+w,S=I+b,M=S+E,T=new Uint8Array(e.buffer,e.byteOffset+_,w),B=new Uint8Array(e.buffer,e.byteOffset+I,b),P=new Uint8Array(e.buffer,e.byteOffset+S,E),R=new Uint8Array(e.buffer,e.byteOffset+M,x);return r.globalData={endpointCount:y,selectorCount:v,imageDescs:C,endpointsData:T,selectorsData:B,tablesData:P,extendedData:R},r}(new Uint8Array(e)),n=r.vkFormat===Nf&&167===r.dataFormatDescriptor[0].colorModel;if(0!==r.vkFormat&&(!n||this.workerConfig.astcHDRSupported))return async function(e){const{vkFormat:t}=e;if(void 0===eg[t])throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let r;2===e.supercompressionScheme&&(Kf||(Kf=new Promise((async e=>{const t=new Wf;await t.init(),e(t)}))),r=await Kf);const n=[];for(let i=0;i<e.levels.length;i++){const o=Math.max(1,e.pixelWidth>>i),a=Math.max(1,e.pixelHeight>>i),l=e.pixelDepth?Math.max(1,e.pixelDepth>>i):0,c=e.levels[i];let h,u;if(0===e.supercompressionScheme)h=c.levelData;else{if(2!==e.supercompressionScheme)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");h=r.decode(c.levelData,c.uncompressedByteLength)}u=tg[t]===s.FloatType?new Float32Array(h.buffer,h.byteOffset,h.byteLength/Float32Array.BYTES_PER_ELEMENT):tg[t]===s.HalfFloatType?new Uint16Array(h.buffer,h.byteOffset,h.byteLength/Uint16Array.BYTES_PER_ELEMENT):h,n.push({data:u,width:o,height:a,depth:l})}let i;if(Zf.has(eg[t]))i=0===e.pixelDepth?new s.DataTexture(n[0].data,e.pixelWidth,e.pixelHeight):new s.Data3DTexture(n[0].data,e.pixelWidth,e.pixelHeight,e.pixelDepth);else{if(e.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");i=new s.CompressedTexture(n,e.pixelWidth,e.pixelHeight),i.minFilter=1===n.length?s.LinearFilter:s.LinearMipmapLinearFilter,i.magFilter=s.LinearFilter}return i.mipmaps=n,i.type=tg[t],i.format=eg[t],i.colorSpace=rg(e),i.needsUpdate=!0,Promise.resolve(i)}(r);const i=t,o=this.init().then((()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:i},[e]))).then((e=>this._createTextureFrom(e.data,r)));return Yf.set(e,{promise:o}),o}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Jf--,this}}Xf.BasisFormat={ETC1S:0,UASTC:1,UASTC_HDR:2},Xf.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16,BC6H:22,RGB_HALF:24,RGBA_HALF:25},Xf.EngineFormat={RGBAFormat:s.RGBAFormat,RGBA_ASTC_4x4_Format:s.RGBA_ASTC_4x4_Format,RGB_BPTC_UNSIGNED_Format:s.RGB_BPTC_UNSIGNED_Format,RGBA_BPTC_Format:s.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:s.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:s.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:s.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:s.RGB_ETC1_Format,RGB_ETC2_Format:s.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:s.RGB_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format:s.RGBA_S3TC_DXT1_Format},Xf.EngineType={UnsignedByteType:s.UnsignedByteType,HalfFloatType:s.HalfFloatType,FloatType:s.FloatType},Xf.BasisWorker=function(){let e,t,r;const n=_EngineFormat,i=_EngineType,s=_TranscoderFormat,o=_BasisFormat;self.addEventListener("message",(function(n){const s=n.data;switch(s.type){case"init":e=s.config,a=s.transcoderBinary,t=new Promise((e=>{r={wasmBinary:a,onRuntimeInitialized:e},BASIS(r)})).then((()=>{r.initializeBasis(),void 0===r.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")}));break;case"transcode":t.then((()=>{try{const{faces:t,buffers:n,width:a,height:u,hasAlpha:d,format:p,type:f,dfdFlags:g}=function(t){const n=new r.KTX2File(new Uint8Array(t));function s(){n.close(),n.delete()}if(!n.isValid())throw s(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");let a;if(n.isUASTC())a=o.UASTC;else if(n.isETC1S())a=o.ETC1S;else{if(!n.isHDR())throw new Error("THREE.KTX2Loader: Unknown Basis encoding");a=o.UASTC_HDR}const u=n.getWidth(),d=n.getHeight(),p=n.getLayers()||1,f=n.getLevels(),g=n.getFaces(),A=n.getHasAlpha(),m=n.getDFDFlags(),{transcoderFormat:y,engineFormat:v,engineType:w}=function(t,r,n,i){const s=l[t];for(let o=0;o<s.length;o++){const a=s[o];if((!a.if||e[a.if])&&(a.basisFormat.includes(t)&&!(i&&a.transcoderFormat.length<2)&&(!a.needsPowerOfTwo||c(r)&&c(n))))return{transcoderFormat:a.transcoderFormat[i?1:0],engineFormat:a.engineFormat[i?1:0],engineType:a.engineType[0]}}throw new Error("THREE.KTX2Loader: Failed to identify transcoding target.")}(a,u,d,A);if(!u||!d||!f)throw s(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!n.startTranscoding())throw s(),new Error("THREE.KTX2Loader: .startTranscoding failed");const b=[],E=[];for(let e=0;e<g;e++){const t=[];for(let r=0;r<f;r++){const o=[];let a,l;for(let t=0;t<p;t++){const c=n.getImageLevelInfo(r,t,e);0!==e||0!==r||0!==t||c.origWidth%4==0&&c.origHeight%4==0||console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),f>1?(a=c.origWidth,l=c.origHeight):(a=c.width,l=c.height);let h=new Uint8Array(n.getImageTranscodedSizeInBytes(r,t,0,y));const u=n.transcodeImage(h,r,t,e,y,0,-1,-1);if(w===i.HalfFloatType&&(h=new Uint16Array(h.buffer,h.byteOffset,h.byteLength/Uint16Array.BYTES_PER_ELEMENT)),!u)throw s(),new Error("THREE.KTX2Loader: .transcodeImage failed.");o.push(h)}const c=h(o);t.push({data:c,width:a,height:l}),E.push(c.buffer)}b.push({mipmaps:t,width:u,height:d,format:v,type:w})}return s(),{faces:b,buffers:E,width:u,height:d,hasAlpha:A,dfdFlags:m,format:v,type:w}}(s.buffer);self.postMessage({type:"transcode",id:s.id,data:{faces:t,width:a,height:u,hasAlpha:d,format:p,type:f,dfdFlags:g}},n)}catch(e){console.error(e),self.postMessage({type:"error",id:s.id,error:e.message})}}))}var a}));const a=[{if:"astcSupported",basisFormat:[o.UASTC],transcoderFormat:[s.ASTC_4x4,s.ASTC_4x4],engineFormat:[n.RGBA_ASTC_4x4_Format,n.RGBA_ASTC_4x4_Format],engineType:[i.UnsignedByteType],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[s.BC7_M5,s.BC7_M5],engineFormat:[n.RGBA_BPTC_Format,n.RGBA_BPTC_Format],engineType:[i.UnsignedByteType],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[s.BC1,s.BC3],engineFormat:[n.RGBA_S3TC_DXT1_Format,n.RGBA_S3TC_DXT5_Format],engineType:[i.UnsignedByteType],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[s.ETC1,s.ETC2],engineFormat:[n.RGB_ETC2_Format,n.RGBA_ETC2_EAC_Format],engineType:[i.UnsignedByteType],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[s.ETC1],engineFormat:[n.RGB_ETC1_Format],engineType:[i.UnsignedByteType],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[s.PVRTC1_4_RGB,s.PVRTC1_4_RGBA],engineFormat:[n.RGB_PVRTC_4BPPV1_Format,n.RGBA_PVRTC_4BPPV1_Format],engineType:[i.UnsignedByteType],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0},{if:"bptcSupported",basisFormat:[o.UASTC_HDR],transcoderFormat:[s.BC6H],engineFormat:[n.RGB_BPTC_UNSIGNED_Format],engineType:[i.HalfFloatType],priorityHDR:1,needsPowerOfTwo:!1},{basisFormat:[o.ETC1S,o.UASTC],transcoderFormat:[s.RGBA32,s.RGBA32],engineFormat:[n.RGBAFormat,n.RGBAFormat],engineType:[i.UnsignedByteType,i.UnsignedByteType],priorityETC1S:100,priorityUASTC:100,needsPowerOfTwo:!1},{basisFormat:[o.UASTC_HDR],transcoderFormat:[s.RGBA_HALF],engineFormat:[n.RGBAFormat],engineType:[i.HalfFloatType],priorityHDR:100,needsPowerOfTwo:!1}],l={[o.ETC1S]:a.filter((e=>e.basisFormat.includes(o.ETC1S))).sort(((e,t)=>e.priorityUASTC-t.priorityUASTC)),[o.UASTC]:a.filter((e=>e.basisFormat.includes(o.UASTC))).sort(((e,t)=>e.priorityUASTC-t.priorityUASTC)),[o.UASTC_HDR]:a.filter((e=>e.basisFormat.includes(o.UASTC_HDR))).sort(((e,t)=>e.priorityHDR-t.priorityHDR))};function c(e){return e<=2||!(e&e-1)&&0!==e}function h(e){if(1===e.length)return e[0];let t=0;for(let r=0;r<e.length;r++)t+=e[r].byteLength;const r=new Uint8Array(t);let n=0;for(let t=0;t<e.length;t++){const i=e[t];r.set(i,n),n+=i.byteLength}return r}};const Zf=new Set([s.RGBAFormat,s.RGFormat,s.RedFormat]),eg={[kf]:s.RGBAFormat,[Rf]:s.RGBAFormat,[Mf]:s.RGBAFormat,[Tf]:s.RGBAFormat,[Lf]:s.RGFormat,[Pf]:s.RGFormat,[If]:s.RGFormat,[Sf]:s.RGFormat,[Df]:s.RedFormat,[Bf]:s.RedFormat,[_f]:s.RedFormat,[Cf]:s.RedFormat,[Nf]:s.RGBA_ASTC_4x4_Format,[Ff]:s.RGBA_ASTC_6x6_Format,[Of]:s.RGBA_ASTC_6x6_Format},tg={[kf]:s.FloatType,[Rf]:s.HalfFloatType,[Mf]:s.UnsignedByteType,[Tf]:s.UnsignedByteType,[Lf]:s.FloatType,[Pf]:s.HalfFloatType,[If]:s.UnsignedByteType,[Sf]:s.UnsignedByteType,[Df]:s.FloatType,[Bf]:s.HalfFloatType,[_f]:s.UnsignedByteType,[Cf]:s.UnsignedByteType,[Nf]:s.HalfFloatType,[Ff]:s.UnsignedByteType,[Of]:s.UnsignedByteType};function rg(e){const t=e.dataFormatDescriptor[0];return 1===t.colorPrimaries?2===t.transferFunction?s.SRGBColorSpace:s.LinearSRGBColorSpace:10===t.colorPrimaries?2===t.transferFunction?"display-p3":"display-p3-linear":(0===t.colorPrimaries||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${t.colorPrimaries}"`),s.NoColorSpace)}const ng={setDefineMapping(e,t,r){Object.keys(r).forEach((n=>{e.defines[`${t}_${n}`]=r[n]}))},setDefineProperty(e,t,r,n){e.defines[r]=n,Object.defineProperty(e,t,{get:()=>e.defines[r],set:t=>{e.defines[r]!=t&&(e.defines[r]=t,e.needsUpdate=!0)}})},setUniformProperty(e,t,r){e.uniforms[t]=new s.Uniform(r),Object.defineProperty(e,t,{get:()=>e.uniforms[t].value,set:r=>{e.uniforms[t].value!=r&&(e.uniforms[t].value=r)}})}},ig={SPECTRAL:[[0,new s.Color(.3686,.3098,.6353)],[.1,new s.Color(.1961,.5333,.7412)],[.2,new s.Color(.4,.7608,.6471)],[.3,new s.Color(.6706,.8667,.6431)],[.4,new s.Color(.902,.9608,.5961)],[.5,new s.Color(1,1,.749)],[.6,new s.Color(.9961,.8784,.5451)],[.7,new s.Color(.9922,.6824,.3804)],[.8,new s.Color(.9569,.4275,.2627)],[.9,new s.Color(.8353,.2431,.3098)],[1,new s.Color(.6196,.0039,.2588)]],PLASMA:[[0,new s.Color(.241,.015,.61)],[.1,new s.Color(.387,.001,.654)],[.2,new s.Color(.524,.025,.653)],[.3,new s.Color(.651,.125,.596)],[.4,new s.Color(.752,.227,.513)],[.5,new s.Color(.837,.329,.431)],[.6,new s.Color(.907,.435,.353)],[.7,new s.Color(.963,.554,.272)],[.8,new s.Color(.992,.681,.195)],[.9,new s.Color(.987,.822,.144)],[1,new s.Color(.94,.975,.131)]],YELLOW_GREEN:[[0,new s.Color(.1647,.2824,.3451)],[.1,new s.Color(.1338,.3555,.4227)],[.2,new s.Color(.061,.4319,.4864)],[.3,new s.Color(0,.5099,.5319)],[.4,new s.Color(0,.5881,.5569)],[.5,new s.Color(.137,.665,.5614)],[.6,new s.Color(.2906,.7395,.5477)],[.7,new s.Color(.4453,.8099,.5201)],[.8,new s.Color(.6102,.8748,.485)],[.9,new s.Color(.7883,.9323,.4514)],[1,new s.Color(.9804,.9804,.4314)]],VIRIDIS:[[0,new s.Color(.267,.005,.329)],[.1,new s.Color(.283,.141,.458)],[.2,new s.Color(.254,.265,.53)],[.3,new s.Color(.207,.372,.553)],[.4,new s.Color(.164,.471,.558)],[.5,new s.Color(.128,.567,.551)],[.6,new s.Color(.135,.659,.518)],[.7,new s.Color(.267,.749,.441)],[.8,new s.Color(.478,.821,.318)],[.9,new s.Color(.741,.873,.15)],[1,new s.Color(.993,.906,.144)]],INFERNO:[[0,new s.Color(.077,.042,.206)],[.1,new s.Color(.225,.036,.388)],[.2,new s.Color(.373,.074,.432)],[.3,new s.Color(.522,.128,.42)],[.4,new s.Color(.665,.182,.37)],[.5,new s.Color(.797,.255,.287)],[.6,new s.Color(.902,.364,.184)],[.7,new s.Color(.969,.516,.063)],[.8,new s.Color(.988,.683,.072)],[.9,new s.Color(.961,.859,.298)],[1,new s.Color(.988,.998,.645)]],GRAYSCALE:[[0,new s.Color(0,0,0)],[1,new s.Color(1,1,1)]],TURBO:[[0,new s.Color(.18995,.07176,.23217)],[.07,new s.Color(.25107,.25237,.63374)],[.13,new s.Color(.27628,.42118,.89123)],[.2,new s.Color(.25862,.57958,.99876)],[.27,new s.Color(.15844,.73551,.92305)],[.33,new s.Color(.09267,.86554,.7623)],[.4,new s.Color(.19659,.94901,.59466)],[.47,new s.Color(.42778,.99419,.38575)],[.53,new s.Color(.64362,.98999,.23356)],[.6,new s.Color(.80473,.92452,.20459)],[.67,new s.Color(.93301,.81236,.22667)],[.73,new s.Color(.99314,.67408,.20348)],[.8,new s.Color(.9836,.49291,.12849)],[.87,new s.Color(.92105,.31489,.05475)],[.93,new s.Color(.81608,.18462,.01809)],[1,new s.Color(.66449,.08436,.00424)]],RAINBOW:[[0,new s.Color(.278,0,.714)],[1/6,new s.Color(0,0,1)],[2/6,new s.Color(0,1,1)],[.5,new s.Color(0,1,0)],[4/6,new s.Color(1,1,0)],[5/6,new s.Color(1,.64,0)],[1,new s.Color(1,0,0)]],CONTOUR:[[0,new s.Color(0,0,0)],[.03,new s.Color(0,0,0)],[.04,new s.Color(1,1,1)],[1,new s.Color(1,1,1)]]},sg={COLOR:0,INTENSITY:1,CLASSIFICATION:2,ELEVATION:3,RETURN_NUMBER:4,RETURN_TYPE:5,RETURN_COUNT:6,POINT_SOURCE_ID:7,SCAN_ANGLE:8,NORMAL:9},og={CIRCLE:0,SQUARE:1},ag={VALUE:0,ATTENUATED:1},lg=new s.Color(1,1,1),cg={DEFAULT:{0:{visible:!0,name:"never classified",color:new s.Color(.5,.5,.5),opacity:1},1:{visible:!0,name:"unclassified",color:new s.Color(.5,.5,.5),opacity:1},2:{visible:!0,name:"ground",color:new s.Color(.63,.32,.18),opacity:1},3:{visible:!0,name:"low vegetation",color:new s.Color(0,1,0),opacity:1},4:{visible:!0,name:"medium vegetation",color:new s.Color(0,.8,0),opacity:1},5:{visible:!0,name:"high vegetation",color:new s.Color(0,.6,0),opacity:1},6:{visible:!0,name:"building",color:new s.Color(1,.66,0),opacity:1},7:{visible:!0,name:"low point(noise)",color:new s.Color(1,0,1),opacity:1},8:{visible:!0,name:"key-point",color:new s.Color(1,0,0),opacity:1},9:{visible:!0,name:"water",color:new s.Color(0,0,1),opacity:1},10:{visible:!0,name:"rail",color:new s.Color(.8,.8,1),opacity:1},11:{visible:!0,name:"road Surface",color:new s.Color(.4,.4,.7),opacity:1},12:{visible:!0,name:"overlap",color:new s.Color(1,1,0),opacity:1},DEFAULT:{visible:!0,name:"default",color:new s.Color(.3,.6,.6),opacity:1}}},hg={DEFAULT:{0:{visible:!0,name:"0",color:new s.Color("rgb(67, 99, 216)"),opacity:1},1:{visible:!0,name:"1",color:new s.Color("rgb(60, 180, 75);"),opacity:1},2:{visible:!0,name:"2",color:new s.Color("rgb(255, 255, 25)"),opacity:1},3:{visible:!0,name:"3",color:new s.Color("rgb(145, 30, 180)"),opacity:1},4:{visible:!0,name:"4",color:new s.Color("rgb(245, 130, 49)"),opacity:1},5:{visible:!0,name:"5",color:new s.Color("rgb(230, 25, 75)"),opacity:1},6:{visible:!0,name:"6",color:new s.Color("rgb(66, 212, 244)"),opacity:1},7:{visible:!0,name:"7",color:new s.Color("rgb(240, 50, 230)"),opacity:1},DEFAULT:{visible:!0,name:"default",color:lg,opacity:1}}};function ug(e,t,r){const n=t.image.data,i=t.image.width;r||(r=Object.keys(e).length),t.userData.transparent=!1;for(let s=0;s<i;s++){let i,o;e[s]?(i=e[s].color,o=e[s].opacity):e[s%r]?(i=e[s%r].color,o=e[s%r].opacity):e.DEFAULT?(i=e.DEFAULT.color,o=e.DEFAULT.opacity):(i=lg,o=1);const a=4*s;n[a+0]=parseInt(255*i.r,10),n[a+1]=parseInt(255*i.g,10),n[a+2]=parseInt(255*i.b,10),n[a+3]=parseInt(255*o,10),o<1&&(t.userData.transparent=!0)}t.needsUpdate=!0}class dg extends s.ShaderMaterial{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t={...e.gradient,...ig};e.gradient=Object.values(t)[0];const{intensityRange:r=new s.Vector2(1,65536),elevationRange:n=new s.Vector2(0,1e3),angleRange:i=new s.Vector2(-90,90),classificationScheme:o=cg.DEFAULT,discreteScheme:a=hg.DEFAULT,size:l=1,mode:c=sg.COLOR,shape:h=og.CIRCLE,sizeMode:u=ag.ATTENUATED,minAttenuatedSize:d=3,maxAttenuatedSize:p=10,gradient:f,gamma:g=1,scale:A=.025/Math.tan(.5),ambientBoost:m=0,...y}=e;super({...y,fog:!0,transparent:!0,precision:"highp",vertexColors:!0}),this.uniforms=s.UniformsUtils.merge([s.UniformsLib.points,s.UniformsLib.fog]),this.vertexShader="#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec4 vColor; // color_pars_vertex\n\n#ifdef USE_POINTS_UV\n    varying vec2 vUv;\n    uniform mat3 uvTransform;\n#endif\n\n#define SOURCE_ID_GROUP 8.\n\nuniform float size;\nuniform float scale;\n\nuniform bool picking;\nuniform int mode;\n\nuniform vec2 elevationRange;\nuniform vec2 intensityRange;\nuniform vec2 angleRange;\n\nuniform sampler2D classificationTexture;\nuniform sampler2D discreteTexture;\nuniform sampler2D gradientTexture;\nuniform sampler2D visibilityTexture;\n\nuniform int sizeMode;\nuniform float minAttenuatedSize;\nuniform float maxAttenuatedSize;\n\nattribute vec4 unique_id;\nattribute float intensity;\nattribute float classification;\nattribute float pointSourceID;\n\nattribute float returnNumber;\nattribute float numberOfReturns;\nattribute float scanAngle;\n\nvoid main() {\n    vec2 uv = vec2(classification/255., 0.5);\n\n    vColor = vec4(1.0);\n    if (picking) {\n        vColor = unique_id;\n    } else {\n        if (mode == PNTS_MODE_CLASSIFICATION) {\n            vColor = texture2D(classificationTexture, uv);\n        } else if (mode == PNTS_MODE_NORMAL) {\n            vColor.rgb = abs(normal);\n        } else if (mode == PNTS_MODE_COLOR) {\n#if defined(USE_COLOR)\n            vColor.rgb = color.rgb;\n#elif defined(USE_COLOR_ALPHA)\n            vColor = color;\n#endif\n        } else if (mode == PNTS_MODE_RETURN_NUMBER) {\n            vec2 uv = vec2(returnNumber/255., 0.5);\n            vColor = texture2D(discreteTexture, uv);\n        } else if (mode == PNTS_MODE_RETURN_TYPE) {\n            float returnType;\n            if (returnNumber > numberOfReturns) {\n                returnType = 4.;\n            } else if (returnNumber == 1.) {\n                if (numberOfReturns == 1.) {\n                    // single\n                    returnType = 0.;\n                } else {\n                    // first\n                    returnType = 1.;\n                }\n            } else {\n                if (returnNumber == numberOfReturns) {\n                    // last\n                    returnType = 3.;\n                } else {\n                    // intermediate\n                    returnType = 2.;\n                }\n            }\n            vec2 uv = vec2(returnType/255., 0.5);\n            vColor = texture2D(discreteTexture, uv);\n        } else if (mode == PNTS_MODE_RETURN_COUNT) {\n            vec2 uv = vec2(numberOfReturns/255., 0.5);\n            vColor = texture2D(discreteTexture, uv);\n        } else if (mode == PNTS_MODE_POINT_SOURCE_ID) {\n            vec2 uv = vec2(mod(pointSourceID, SOURCE_ID_GROUP)/255., 0.5);\n            vColor = texture2D(discreteTexture, uv);\n        } else if (mode == PNTS_MODE_SCAN_ANGLE) {\n            float i = (scanAngle - angleRange.x) / (angleRange.y - angleRange.x);\n            vec2 uv = vec2(i, (1. - i));\n            vColor = texture2D(gradientTexture, uv);\n        } else if (mode == PNTS_MODE_INTENSITY) {\n            float i = (intensity - intensityRange.x) / (intensityRange.y - intensityRange.x);\n            vec2 uv = vec2(i, (1. - i));\n            vColor = texture2D(gradientTexture, uv);\n        } else if (mode == PNTS_MODE_ELEVATION) {\n            float z = (modelMatrix * vec4(position, 1.0)).z;\n            float i = (z - elevationRange.x) / (elevationRange.y - elevationRange.x);\n            vec2 uv = vec2(i, (1. - i));\n            vColor = texture2D(gradientTexture, uv);\n        }\n    }\n\n    if (texture2D(visibilityTexture, uv).r == 0.) {\n        vColor.a = 0.;\n    }\n\n#define USE_COLOR_ALPHA\n#include <morphcolor_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <project_vertex>\n\n    gl_PointSize = size;\n\n    if (sizeMode == PNTS_SIZE_MODE_ATTENUATED) {\n        bool isPerspective = isPerspectiveMatrix(projectionMatrix);\n\n        if (isPerspective) {\n            gl_PointSize *= scale / -mvPosition.z;\n            gl_PointSize = clamp(gl_PointSize, minAttenuatedSize, maxAttenuatedSize);\n        }\n    }\n\n#include <logdepthbuf_vertex>\n#include <clipping_planes_vertex>\n#include <worldpos_vertex>\n#include <fog_vertex>\n}\n",this.fragmentShader="#define USE_COLOR_ALPHA\n\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nuniform vec3 diffuse;\nuniform float opacity;\nuniform float gamma;\nuniform float ambientBoost;\n\nuniform bool picking;\nuniform int shape;\n\nvoid main() {\n\n// Early discard (clipping planes and shape)\n#include <clipping_planes_fragment>\n    if (shape == PNTS_SHAPE_CIRCLE) {\n        //circular rendering in glsl\n        if ((length(gl_PointCoord - 0.5) > 0.5)) {\n            discard;\n        }\n    }\n\n#include <logdepthbuf_fragment>\n\n    vec4 diffuseColor = vec4(diffuse, opacity);\n#include <map_particle_fragment>\n#include <color_fragment>\n\n#include <alphatest_fragment>\n#include <alphahash_fragment>\n\n    vec3 outgoingLight = diffuseColor.rgb;\n    \n    outgoingLight = max(outgoingLight, vec3(ambientBoost));\n    \n    outgoingLight = pow(outgoingLight, vec3(1.0 / gamma));\n    \n#include <opaque_fragment> // gl_FragColor\n#include <tonemapping_fragment>\n#include <fog_fragment>\n#include <premultiplied_alpha_fragment>\n\n}\n",this.gradients=t,this.gradientTexture=new s.CanvasTexture,ng.setDefineMapping(this,"PNTS_MODE",sg),ng.setDefineMapping(this,"PNTS_SHAPE",og),ng.setDefineMapping(this,"PNTS_SIZE_MODE",ag),this.size=l,ng.setUniformProperty(this,"mode",c),ng.setUniformProperty(this,"shape",h),ng.setUniformProperty(this,"picking",!1),ng.setUniformProperty(this,"opacity",this.opacity),ng.setUniformProperty(this,"intensityRange",r),ng.setUniformProperty(this,"elevationRange",n),ng.setUniformProperty(this,"angleRange",i),ng.setUniformProperty(this,"sizeMode",u),ng.setUniformProperty(this,"scale",A),ng.setUniformProperty(this,"minAttenuatedSize",d),ng.setUniformProperty(this,"maxAttenuatedSize",p),ng.setUniformProperty(this,"gamma",g),ng.setUniformProperty(this,"ambientBoost",m);const v=new Uint8Array(1024),w=new s.DataTexture(v,256,1,s.RGBAFormat);w.needsUpdate=!0,w.magFilter=s.NearestFilter,ng.setUniformProperty(this,"classificationTexture",w);const b=new Uint8Array(1024),E=new s.DataTexture(b,256,1,s.RGBAFormat);E.needsUpdate=!0,E.magFilter=s.NearestFilter,ng.setUniformProperty(this,"discreteTexture",E);const x=new Uint8Array(256),C=new s.DataTexture(x,256,1,s.RedFormat);C.needsUpdate=!0,C.magFilter=s.NearestFilter,ng.setUniformProperty(this,"visibilityTexture",C),this.classificationScheme=o,this.discreteScheme=a,this.recomputeClassification(),this.recomputeDiscreteTexture(),this.recomputeVisibilityTexture(),this.gradient=f,ng.setUniformProperty(this,"gradientTexture",this.gradientTexture)}copy(e){return e.isShaderMaterial?super.copy(e):s.Material.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value.copy(e)}get map(){return this.uniforms.map.value}set map(e){this.uniforms.map.value=e,e&&(e.matrixAutoUpdate&&e.updateMatrix(),this.uniforms.uvTransform.value.copy(e.matrix))}get alphaMap(){return this.uniforms.alphaMap.value}set alphaMap(e){this.uniforms.alphaMap.value=e,e&&(e.matrixAutoUpdate&&e.updateMatrix(),this.uniforms.alphaMapTransform.value.copy(e.matrix))}get size(){return this.uniforms.size.value}set size(e){this.uniforms.size.value=e}get sizeAttenuation(){return this.sizeMode!==ag.VALUE}set sizeAttenuation(e){this.sizeMode=e?ag.ATTENUATED:ag.VALUE}get gamma(){return this.uniforms.gamma.value}set gamma(e){this.uniforms.gamma.value=e}get ambientBoost(){return this.uniforms.ambientBoost.value}set ambientBoost(e){this.uniforms.ambientBoost.value=e}recomputeClassification(){ug(this.classificationScheme,this.classificationTexture,256),this.dispatchEvent({type:"material_property_changed",target:this.uniforms})}recomputeDiscreteTexture(){ug(this.discreteScheme,this.discreteTexture),this.dispatchEvent({type:"material_property_changed",target:this.uniforms})}recomputeVisibilityTexture(){const e=this.visibilityTexture,t=this.classificationScheme,r=e.image.data,n=e.image.width;e.userData.transparent=!1;for(let i=0;i<n;i++){let n;n=t[i]?t[i].visible:!t.DEFAULT||t.DEFAULT.visible,r[i]=n?255:0,n||(e.userData.transparent=!0)}e.needsUpdate=!0,this.dispatchEvent({type:"material_property_changed",target:this.uniforms})}enablePicking(e){this.picking=e,this.blending=e?s.NoBlending:s.NormalBlending}set gradient(e){this.gradientTexture=function(e){const t=64,r=document.createElement("canvas");r.width=t,r.height=t;const n=r.getContext("2d");n.rect(0,0,t,t);const i=n.createLinearGradient(0,0,t,t);for(let t=0;t<e.length;t++){const r=e[t];i.addColorStop(r[0],`#${r[1].getHexString()}`)}n.fillStyle=i,n.fill();const o=new s.CanvasTexture(r);return o.needsUpdate=!0,o.minFilter=s.LinearFilter,o.wrap=s.RepeatWrapping,o.repeat=2,o}(e)}}const pg=dg,fg=new s.Raycaster,gg={},Ag=new vf;Ag.register((()=>new Pp)),Ag.register((()=>new sf)),Ag.register((()=>new of));const mg={LOAD_TILE_SET:"load-tile-set",LOAD_MODEL:"load-model",DISPOSE_MODEL:"dispose-model",TILE_VISIBILITY_CHANGE:"tile-visibility-change",TILES_LOAD_START:"tiles-load-start",TILES_LOAD_END:"tiles-load-end"};function yg(e,t){if(!e)throw new Error("Path to draco folder is mandatory");const r=new bf;r.setDecoderPath(e),t&&r.setDecoderConfig(t),Ag.setDRACOLoader(r)}function vg(e,t){if(!e||!t)throw new Error("Path to ktx2 folder and renderer are mandatory");const r=new Xf;r.setTranscoderPath(e),r.detectSupport(t),Ag.setKTX2Loader(r)}function wg(e){if(!e)throw new Error("MeshOptDecoder module is mandatory");Ag.setMeshoptDecoder(e)}const bg=()=>{console.warn("[OGC3DTilesLayer] Material property cannot be set from the material, use layer properties instead")},Eg=class extends _c{constructor(e,t){const{pntsMode:r=sg.COLOR,pntsShape:n=og.CIRCLE,classification:i=cg.DEFAULT,pntsSizeMode:o=ag.VALUE,pntsMinAttenuatedSize:a=3,pntsMaxAttenuatedSize:l=10,...c}=t;super(e,new s.Group,c),this.isOGC3DTilesLayer=!0,this.pntsMode=r,this.pntsShape=n,this.classification=i,this.pntsSizeMode=o,this.pntsMinAttenuatedSize=a,this.pntsMaxAttenuatedSize=l,this.tilesRenderer=new up(this.source.url),t.source.isOGC3DTilesIonSource?this.tilesRenderer.registerPlugin(new hf({apiToken:t.source.accessToken,assetId:t.source.assetId,autoRefreshToken:!0})):t.source.isOGC3DTilesGoogleSource&&this.tilesRenderer.registerPlugin(new cf({apiToken:t.source.key,autoRefreshToken:!0})),this.tilesRenderer.registerPlugin(new gf),this.tilesRenderer.manager.addHandler(/\.gltf$/,Ag),this.object3d.add(this.tilesRenderer.group),this._res=this.addInitializationStep(),this.sseThreshold=this.tilesRenderer.errorTarget,Object.defineProperty(this,"sseThreshold",{get(){return this.tilesRenderer.errorTarget},set(e){this.tilesRenderer.errorTarget=e}}),t.sseThreshold&&(this.sseThreshold=t.sseThreshold),this.tasks=[],this.tilesSchedulingCB=e=>{this.tasks.push(e)}}_setupCacheAndQueues(e){const t=e.id;if(gg[t])this.tilesRenderer.lruCache=gg[t].lruCache,this.tilesRenderer.downloadQueue=gg[t].downloadQueue,this.tilesRenderer.parseQueue=gg[t].parseQueue,gg[t].layerCallbacks[this.id]=this.tilesSchedulingCB;else{const r=e=>{Object.values(gg[t].layerCallbacks).forEach((t=>{t(e)}))};this.tilesRenderer.downloadQueue.schedulingCallback=r,this.tilesRenderer.parseQueue.schedulingCallback=r,gg[t]={lruCache:this.tilesRenderer.lruCache,downloadQueue:this.tilesRenderer.downloadQueue,parseQueue:this.tilesRenderer.parseQueue,layerCallbacks:{[this.id]:this.tilesSchedulingCB}},e.addEventListener(mA.DISPOSED,(e=>{delete gg[e.target.id]}))}this._viewId=t}_setupEvents(){for(const e of Object.values(mg))this.tilesRenderer.addEventListener(e,(e=>{this.dispatchEvent(e)}))}_setup(e){this.tilesRenderer.setCamera(e.camera3D),this.tilesRenderer.setResolutionFromRenderer(e.camera3D,e.renderer);let t=!1;this.tilesRenderer.addEventListener("load-tile-set",(()=>{e.notifyChange(this),t||(t=!0,this._res())})),this.tilesRenderer.addEventListener("load-model",(t=>{const{scene:r}=t;r.traverse((e=>{this._assignFinalMaterial(e),this._assignFinalAttributes(e)})),e.notifyChange(this)})),this._setupCacheAndQueues(e),this._setupEvents(),this.tilesRenderer.update()}_assignFinalMaterial(e){if(!e.isMesh&&!e.isPoints)return;let t=e.material;if(e.isPoints){const e=new pg({mode:this.pntsMode,shape:this.pntsShape,classificationScheme:this.classification,sizeMode:this.pntsSizeMode,minAttenuatedSize:this.pntsMinAttenuatedSize,maxAttenuatedSize:this.pntsMaxAttenuatedSize});e.copy(t),t=e,function(e,t){let r=e.transparent,n=r;Object.defineProperty(e,"transparent",{get:()=>{const t=e.opacity<1||e.classificationTexture.userData.transparent||e.visibilityTexture.userData.transparent||r;return t!=n&&(e.needsUpdate=!0,n=t),t},set:e=>{r=e}});let i=e.wireframe;Object.defineProperty(e,"wireframe",{get:()=>t.wireframe||i,set:e=>{i=e}});let s=e.uniforms.opacity.value;Object.defineProperty(e.uniforms.opacity,"value",{get:()=>t.opacity*s,set:e=>{s=e}}),Object.defineProperty(e.uniforms.mode,"value",{get:()=>t.pntsMode,set:bg}),Object.defineProperty(e.uniforms.shape,"value",{get:()=>t.pntsShape,set:bg}),Object.defineProperty(e.uniforms.sizeMode,"value",{get:()=>t.pntsSizeMode,set:bg}),Object.defineProperty(e.uniforms.minAttenuatedSize,"value",{get:()=>t.pntsMinAttenuatedSize,set:bg}),Object.defineProperty(e.uniforms.maxAttenuatedSize,"value",{get:()=>t.pntsMaxAttenuatedSize,set:bg}),Object.defineProperty(e.uniforms.scale,"value",{get:()=>t.scale,set:bg})}(t,this)}else!function(e,t){let r=e.opacity;Object.defineProperty(e,"opacity",{get:()=>t.opacity*r,set:e=>{r=e}});let n=e.transparent,i=n;Object.defineProperty(e,"transparent",{get:()=>{const t=e.opacity<1||n;return t!=i&&(e.needsUpdate=!0,i=t),t},set:e=>{n=e}});let s=e.wireframe;Object.defineProperty(e,"wireframe",{get:()=>t.wireframe||s,set:e=>{s=e}})}(t,this);e.material=t}_assignFinalAttributes(e){const t=e.geometry,r=e.batchTable;if(e.isPoints){const e=r?.getPropertyArray("Classification");e&&t.setAttribute("classification",new s.BufferAttribute(e,1))}}handleTasks(){for(let e=0,t=this.tasks.length;e<t;e++)this.tasks[e]();this.tasks.length=0}preUpdate(e){return this.scale=e.camera._preSSE,this.handleTasks(),this.tilesRenderer.update(),null}update(){}delete(){null!=this._viewId&&gg[this._viewId]?.layerCallbacks&&(delete gg[this._viewId].layerCallbacks[this.id],0===Object.keys(gg[this._viewId].layerCallbacks).length&&delete gg[this._viewId]),this.tilesRenderer.dispose(),this.tilesSchedulingCB=null,this._viewId=null}async getMetadataFromIntersections(e){if(!e.length)return null;const t=await async function(e){const{point:t,object:r,face:n,faceIndex:i}=e,{meshFeatures:o,structuralMetadata:a}=r.userData,l=new s.Vector3;if(n){const e=r.geometry.getAttribute("position"),i=(new s.Triangle).setFromAttributeAndIndices(e,n.a,n.b,n.c);i.a.applyMatrix4(r.matrixWorld),i.b.applyMatrix4(r.matrixWorld),i.c.applyMatrix4(r.matrixWorld),i.getBarycoord(t,l)}else l.set(0,0,0);const{features:c,featureIds:h}=o?await async function(e,t){const{faceIndex:r,barycoord:n}=t;return{features:await e.getFeaturesAsync(r,n),featureIds:e.getFeatureInfo()}}(o,{faceIndex:i,barycoord:l}):{},u=h?.map((e=>e.propertyTable)),d=a?function(e,t){const{index:r,faceIndex:n,barycoord:i,tableIndices:s,features:o}=t,a=[];void 0!==s&&void 0!==o&&e.getPropertyTableData(s,o,a);const l=[];void 0!==r&&e.getPropertyAttributeData(r,l);const c=[];return void 0!==n&&e.getPropertyTextureData(n,i,c),[...a,...c,...l]}(a,{...e,barycoord:l,tableIndices:u,features:c}):[];return d}(e[0]);return t}getC3DTileFeatureFromIntersectsArray(e){if(!e.length)return null;const{face:t,index:r,object:n,instanceId:i}=e[0];let s;if(n.isPoints&&null!=r?s=n.geometry.getAttribute("_batchid")?.getX(r)??r:n.isMesh&&t&&(s=n.geometry.getAttribute("_batchid")?.getX(t.a)??i),void 0===s)return null;let o=n;for(;!o.batchTable;)o=o.parent;return o.batchTable.getDataFromId(s)}pickObjectsAt(e,t){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const n=e.camera.camera3D;fg.setFromCamera(e.viewToNormalizedCoords(t),n),fg.near=n.near,fg.far=n.far,fg.firstHitOnly=!0;const i=fg.intersectObject(this.tilesRenderer.group,!0);return i.forEach((e=>{e.layer=this})),r.push(...i),r}attach(){console.warn("[OGC3DTilesLayer]: Attaching / detaching layers is not yet implemented for OGC3DTilesLayer.")}detach(){return console.warn("[OGC3DTilesLayer]: Attaching / detaching layers is not yet implemented for OGC3DTilesLayer."),!0}getObjectToUpdateForAttachedLayers(){return null}forEachTile(e){this.tilesRenderer.traverse((t=>{e(t,t.cached.scene)}))}},xg=(new s.Matrix4).makeRotationX(Math.PI/2),Cg=(new s.Matrix4).makeRotationZ(-Math.PI/2),_g=new TextDecoder;function Ig(e){const t=["MODELVIEW","MODELVIEWINVERSETRANSPOSE","PROJECTION","JOINTMATRIX"];if(e.gltfShader){const r=[];for(const t in e.gltfShader.boundUniforms)r.push(t);for(const n of r){const r=e.gltfShader.boundUniforms[n].semantic;t.includes(r)||delete e.gltfShader.boundUniforms[n]}}}const Sg={parse(e,t){const r=!0===t.frustumCulled;if(!e)throw new Error("No array buffer provided.");const n=new DataView(e,4);let i=0;const o={};if(o.magic=_g.decode(new Uint8Array(e,0,4)),o.magic){o.version=n.getUint32(i,!0),i+=Uint32Array.BYTES_PER_ELEMENT,o.byteLength=n.getUint32(i,!0),i+=Uint32Array.BYTES_PER_ELEMENT,o.FTJSONLength=n.getUint32(i,!0),i+=Uint32Array.BYTES_PER_ELEMENT,o.FTBinaryLength=n.getUint32(i,!0),i+=Uint32Array.BYTES_PER_ELEMENT,o.BTJSONLength=n.getUint32(i,!0),i+=Uint32Array.BYTES_PER_ELEMENT,o.BTBinaryLength=n.getUint32(i,!0),i+=Uint32Array.BYTES_PER_ELEMENT;const a=i+4,l=[];let c={};const h=new s.Vector3;if(o.FTJSONLength>0){const t=a,r=e.slice(t,o.FTJSONLength+t),n=_g.decode(new Uint8Array(r));c=JSON.parse(n),c.RTC_CENTER?h.fromArray(c.RTC_CENTER):h.set(0,0,0)}if(o.FTBinaryLength>0&&console.warn("3D Tiles feature table binary not supported yet."),o.BTJSONLength>0){const r=a+o.FTJSONLength+o.FTBinaryLength,n=e.slice(r,r+o.BTJSONLength+o.BTBinaryLength);l.push(Promise.resolve(new Yh(n,o.BTJSONLength,o.BTBinaryLength,c.BATCH_LENGTH,t.registeredExtensions)))}else l.push(Promise.resolve(new Yh));const u=a+o.FTJSONLength+o.FTBinaryLength+o.BTJSONLength+o.BTBinaryLength,d=e.slice(u),p=function(e){if(e.frustumCulled=r,e.material){if(t.overrideMaterials){const r=e.material;"object"==typeof t.overrideMaterials&&t.overrideMaterials.isMaterial?e.material=t.overrideMaterials:e.material=new s.MeshBasicMaterial,function(e){const t=function(e){const t=[];return e.alphaMap&&t.push(e.map),e.aoMap&&t.push(e.map),e.bumpMap&&t.push(e.bumpMap),e.displacementMap&&t.push(e.bumpMap),e.emissiveMap&&t.push(e.emissiveMap),e.envMap&&t.push(e.envMap),e.lightMap&&t.push(e.envMap),e.map&&t.push(e.map),e.metalnessMap&&t.push(e.map),e.normalMap&&t.push(e.map),e.roughnessMap&&t.push(e.map),e.specularMap&&t.push(e.specularMap),t}(e);if(Array.isArray(e))for(const t of e)t.dispose();else e.dispose();for(let e=0;e<t.length;e++)t[e].dispose()}(r)}else F.isLogDepthBufferSupported()&&e.material.isRawShaderMaterial&&!t.doNotPatchMaterial&&(W.patchMaterialForLogDepthSupport(e.material),console.warn("glTF shader has been patched to add log depth buffer support"));dh(e.material,t.layer)}};return l.push(Ag.parseAsync(d,t).then((e=>{for(const t of e.scenes)t.traverse(Ig);var r,n;r=e.scene,(n=t.gltfUpAxis)&&"Y"!==n?"X"===n&&r.applyMatrix4(Cg):r.applyMatrix4(xg);const i=F.isLogDepthBufferSupported()&&!t.doNotPatchMaterial;return(!1===t.frustumCulling||t.overrideMaterials||i||t.layer)&&e.scene.traverse(p),e.scene.position.copy(h),e})).catch((e=>{throw new Error(e)}))),Promise.all(l).then((e=>({gltf:e[1],batchTable:e[0]}))).catch((e=>{throw new Error(e)}))}throw new Error("Invalid b3dm file.")}},Mg=new TextDecoder,Tg=new TextDecoder;function Bg(e,t,r){const n=s.LoaderUtils.extractUrlBase(r),i={gltfUpAxis:t.tileset.asset.gltfUpAxis,urlBase:n,overrideMaterials:t.overrideMaterials,doNotPatchMaterial:t.doNotPatchMaterial,registeredExtensions:t.registeredExtensions,layer:t};return Sg.parse(e,i).then((e=>({batchTable:e.batchTable,object3d:e.gltf.scene})))}function Pg(e,t,r){const n=s.LoaderUtils.extractUrlBase(r);return Ag.parseAsync(e,n).then((e=>({object3d:e.scene})))}function Rg(e,t){return function(e,t){if(!e)throw new Error("No array buffer provided.");const r=new DataView(e);let n=0;const i={};let o={},a={};if(i.magic=Mg.decode(new Uint8Array(e,n,4)),n+=4,i.magic){i.version=r.getUint32(n,!0),n+=Uint32Array.BYTES_PER_ELEMENT,i.byteLength=r.getUint32(n,!0),n+=Uint32Array.BYTES_PER_ELEMENT,i.FTJSONLength=r.getUint32(n,!0),n+=Uint32Array.BYTES_PER_ELEMENT,i.FTBinaryLength=r.getUint32(n,!0),n+=Uint32Array.BYTES_PER_ELEMENT,i.BTJSONLength=r.getUint32(n,!0),n+=Uint32Array.BYTES_PER_ELEMENT,i.BTBinaryLength=r.getUint32(n,!0),n+=Uint32Array.BYTES_PER_ELEMENT;let l={};if(i.FTJSONLength>0){const t=n,r=e.slice(t,i.FTJSONLength+t),s=Mg.decode(new Uint8Array(r));l=JSON.parse(s)}if(i.FTBinaryLength>0&&(a=function(e,t,r){const n=new s.BufferGeometry,i=Mg.decode(new Uint8Array(e,t,r)),o=JSON.parse(i);let a;if(o.POINTS_LENGTH&&(a=o.POINTS_LENGTH),o.POSITION){const r=o.POSITION.byteOffset+i.length+t,l=new Float32Array(e,r,3*a);n.setAttribute("position",new s.BufferAttribute(l,3))}if(o.RGB){const r=o.RGB.byteOffset+i.length+t,l=new Uint8Array(e,r,3*a);n.setAttribute("color",new s.BufferAttribute(l,3,!0))}if(o.POSITION_QUANTIZED)throw new Error("For pnts loader, POSITION_QUANTIZED: not yet managed");if(o.RGBA)throw new Error("For pnts loader, RGBA: not yet managed");if(o.RGB565)throw new Error("For pnts loader, RGB565: not yet managed");if(o.NORMAL)throw new Error("For pnts loader, NORMAL: not yet managed");if(o.NORMAL_OCT16P)throw new Error("For pnts loader, NORMAL_OCT16P: not yet managed");if(o.BATCH_ID)throw new Error("For pnts loader, BATCH_ID: not yet managed");return{geometry:n,offset:o.RTC_CENTER?(new s.Vector3).fromArray(o.RTC_CENTER):void 0}}(e,n,i.FTJSONLength)),i.BTJSONLength>0){const r=n+i.FTJSONLength+i.FTBinaryLength,c=e.slice(r,i.BTJSONLength+i.BTBinaryLength+r);o=new Yh(c,i.BTJSONLength,i.BTBinaryLength,l.BATCH_ID&&l.BATCH_LENGTH?l.BATCH_LENGTH:l.POINTS_LENGTH,t),a=function(e,t){if(e.geometry)return t.content&&t.content.Classification&&e.geometry.setAttribute("classification",new s.BufferAttribute(new Uint8Array(t.content.Classification),1)),e}(a,o)}const c={point:a,batchTable:o};return Promise.resolve(c)}throw new Error("Invalid pnts file.")}(e,t.registeredExtensions).then((e=>{const r=t.material?t.material.clone():new pg({size:1,mode:t.pntsMode,shape:t.pntsShape,classificationScheme:t.classification,sizeMode:t.pntsSizeMode,minAttenuatedSize:t.pntsMinAttenuatedSize,maxAttenuatedSize:t.pntsMaxAttenuatedSize});dh(r,t);const n=new s.Points(e.point.geometry,r);return e.point.offset&&n.position.copy(e.point.offset),{object3d:n,batchTable:e.batchTable}}))}const Dg={executeCommand:function(e){const t=e.layer,r=e.metadata,n=new s.Object3D;!function(e,t,r,n){e.frustumCulled=!1,e.layer=t,r.transform&&e.applyMatrix4(r.transform),e.geometricError=r.geometricError,e.tileId=r.tileId,r.refine?e.additiveRefinement="ADD"===r.refine.toUpperCase():e.additiveRefinement=!!n&&n.additiveRefinement,e.viewerRequestVolume=r.viewerRequestVolume,e.boundingVolume=r.boundingVolume,e.updateMatrixWorld()}(n,t,r,e.requester);const i=r.content&&(r.content.url||r.content.uri),o=e=>{e.userData.metadata=r,e.layer=t};if(i){let e=i.startsWith("http")?i:r.baseURL+i;t.source.isC3DTilesGoogleSource&&(e=t.source.getTileUrl(e));const s={b3dm:Bg,pnts:Rg,gltf:Pg};return sc.arrayBuffer(e,t.source.networkOptions).then((i=>{if(void 0!==i){let a;const l=Tg.decode(new Uint8Array(i,0,4));if("{"===l[0]){i=JSON.parse(Tg.decode(new Uint8Array(i)));const n=t.source.isC3DTilesGoogleSource?t.source.baseUrl:e.slice(0,e.lastIndexOf("/")+1);t.tileset.extendTileset(i,r.tileId,n,t.registeredExtensions)}else if("b3dm"==l)a=s.b3dm;else if("pnts"==l)t.hasPnts=!0,a=s.pnts;else{if("glTF"!=l)return Promise.reject(`Unsupported magic code ${l}`);a=s.gltf}if(a)return a(i,t,e).then((e=>(n.content=e.object3d,e.batchTable&&(n.batchTable=e.batchTable),n.add(e.object3d),n.traverse(o),n)))}return n.traverse(o),n}))}return n.traverse(o),Promise.resolve(n)}};let Lg=1;const kg={executeCommand(e){const t=e.layer,r=e.requester;return r.load().then((n=>{const o=new s.Points(n,t.material);return function(e){const t=e.geometry.attributes.position.count,r=new Uint8Array(4*t),n=Lg++;if(t>65535||n>65535)return console.warn("Currently picking is limited to Points with less than 65535 elements and less than 65535 Points instances"),e;for(let e=0;e<t;e++){const t=n<<16|e;r[4*e+0]=(4278190080&t)>>24,r[4*e+1]=(16711680&t)>>16,r[4*e+2]=(65280&t)>>8,r[4*e+3]=255&t}e.baseId=n,e.geometry.setAttribute("unique_id",new s.BufferAttribute(r,4,!0))}(o),o.frustumCulled=!1,o.matrixAutoUpdate=!1,o.position.copy(n.userData.origin||r.bbox.min),o.scale.copy(t.scale),o.updateMatrix(),o.tightbbox=n.boundingBox.applyMatrix4(o.matrix),o.layer=t,o.extent=i.zR.fromBox3(e.view.referenceCrs,r.bbox),o.userData.node=r,o}))}};let Og=0;function Fg(e){const t=/\$\{u:([\w-_.|]+)\}/.exec(e);if(!t)return e;const r=t[1].split("|");return e.replace(t[0],r[Og++%r.length])}const Ng={subDomains:Fg,xyz:function(e,t){return Fg(t.url.replace(/(\$\{z\}|%TILEMATRIX)/,t.tileMatrixCallback(e.zoom)).replace(/(\$\{y\}|%ROW)/,e.row).replace(/(\$\{x\}|%COL)/,e.col))},bbox:function(e,t){let r="EPSG:4326"==t.crs?9:2;void 0!==t.bboxDigits&&(r=t.bboxDigits);const n=e.west.toFixed(r),i=e.south.toFixed(r),s=e.east.toFixed(r),o=e.north.toFixed(r);let a=t.axisOrder||"wsen";return a=a.replace("w",`${n},`).replace("s",`${i},`).replace("e",`${s},`).replace("n",`${o},`).slice(0,-1),Fg(t.url.replace("%bbox",a))}};function Ug(e,t){const r=t.priority-e.priority;return 0===r?t.timestamp-e.timestamp:r}function Qg(){return{queue(e){const t=e.layer;let r=this.storages.get(t.id);r||(r={q:new Fh({comparator:Ug}),priority:1,accumulator:0},this.storages.set(t.id,r)),r.priority=t.priority||1,r.q.queue(e),this.counters.pending++},storages:new Map,counters:{executing:0,executed:0,failed:0,cancelled:0,pending:0},execute(e,t){return this.counters.pending--,this.counters.executing++,t.executeCommand(e).then((t=>{this.counters.executing--,e.resolve(t),this.counters.executed++}),(t=>{this.counters.executing--,e.reject(t),this.counters.failed++}))}}}function Gg(){this.defaultQueue=Qg(),this.hostQueues=new Map,this.providers={},this.maxCommandsPerHost=6,this.initDefaultProviders()}Gg.prototype.constructor=Gg,Gg.prototype.initDefaultProviders=function(){this.addProtocolProvider("tile",Qh),this.addProtocolProvider("3d-tiles",Dg),this.addProtocolProvider("pointcloud",kg)},Gg.prototype.runCommand=function(e,t,r){const n=this.getProtocolProvider(e.layer.protocol);if(!n)throw new Error(`No known provider for layer ${e.layer.id}`);t.execute(e,n,r).then((()=>{if(e.view.notifyChange(e.requester,e.redraw),t.counters.executing<this.maxCommandsPerHost){const e=this.deQueue(t);e&&this.runCommand(e,t)}}))},Gg.prototype.execute=function(e){const t=e.layer,r=t.source&&t.source.url&&"none"!==t.source.url?new URL(Ng.subDomains(t.source.url),"file:///home/runner/work/itowns/itowns/packages/Main/src/Core/Scheduler/Scheduler.js").host:void 0;e.promise=new Promise(((t,r)=>{e.resolve=t,e.reject=r})),r&&!this.hostQueues.has(r)&&this.hostQueues.set(r,Qg());const n=r?this.hostQueues.get(r):this.defaultQueue;return e.timestamp=Date.now(),n.queue(e),n.counters.executing<this.maxCommandsPerHost&&Promise.resolve().then((()=>{if(n.counters.executing<this.maxCommandsPerHost){const e=this.deQueue(n);e&&this.runCommand(e,n)}})),e.promise},Gg.prototype.addProtocolProvider=function(e,t){if("function"!=typeof t.executeCommand)throw new Error(`Can't add provider for ${e}: missing a executeCommand function.`);this.providers[e]=t},Gg.prototype.getProtocolProvider=function(e){return this.providers[e]||Nh},Gg.prototype.commandsWaitingExecutionCount=function(){let e=this.defaultQueue.counters.pending+this.defaultQueue.counters.executing;for(const t of this.hostQueues)e+=t[1].counters.pending+t[1].counters.executing;return e},Gg.prototype.commandsRunningCount=function(){let e=this.defaultQueue.counters.executing;for(const t of this.hostQueues)e+=t[1].counters.executing;return e},Gg.prototype.resetCommandsCount=function(e){let t=this.defaultQueue.counters[e];this.defaultQueue.counters[e]=0;for(const r of this.hostQueues)t+=r[1].counters[e],r[1].counters[e]=0;return t},Gg.prototype.deQueue=function(e){const t=function(e){let t,r,n=0;for(const i of e){const e=i[1];e.q.length>0&&(n+=e.priority,e.accumulator+=e.priority,(!t||e.accumulator>r)&&(t=e,r=e.accumulator))}if(t)return t.accumulator-=n,t.q}(e.storages);for(;t&&t.length>0;){const r=t.dequeue();if(!r.earlyDropFunction||!r.earlyDropFunction(r))return r;e.counters.pending--,e.counters.cancelled++,r.reject(new Uh(r))}};const zg=Gg,jg=new i.E$("EPSG:4326");let Vg,qg="";"undefined"!=typeof document&&(qg=void 0!==document.documentElement.style.transform?"transform":void 0!==document.documentElement.style.webkitTransform?"webkitTransform":void 0!==document.documentElement.style.mozTransform?"mozTransform":void 0!==document.documentElement.style.oTransform?"oTransform":"transform");class Hg extends s.Object3D{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null==t)throw new Error("coordinates are mandatory to add a Label");arguments.length>3&&console.warn("Deprecated argument sprites in Label constructor. Sprites must be configured in style argument."),super();let n=this.visible;Object.defineProperty(this,"visible",{set(e){e!=n&&(n=e,this.content.style.display=e?"block":"none")},get:()=>n}),this.isLabel=!0,this.coordinates=t,this.projectedPosition={x:0,y:0},this.boundaries={left:0,right:0,top:0,bottom:0},"string"==typeof e?(this.content=document.createElement("div"),this.content.textContent=r.text.field):this.content=e.cloneNode(!0),this.content.classList.add("itowns-label"),this.content.style.userSelect="none",this.content.style.position="absolute",r.isStyle?(this.anchor=r.getTextAnchorPosition(),this.styleOffset=r.text.offset,"string"==typeof e&&(r.text.haloWidth>0&&this.content.classList.add("itowns-stroke-single"),r.applyToHTML(this.content).then((e=>{e&&(this.icon=e)})))):(this.anchor=[0,0],this.styleOffset=[0,0]),this.iconOffset={left:0,right:0,top:0,bottom:0},this.zoom={min:r.zoom&&null!=r.zoom.min?r.zoom.min:2,max:r.zoom&&null!=r.zoom.max?r.zoom.max:24},this.order=r.order||0,this.padding=2}updateProjectedPosition(e,t){const r=Math.round(e),n=Math.round(t);r==this.projectedPosition.x&&n==this.projectedPosition.y||(this.projectedPosition.x=r,this.projectedPosition.y=n,this.boundaries.left=e+this.offset.left-this.padding,this.boundaries.right=e+this.offset.right+this.padding,this.boundaries.top=t+this.offset.top-this.padding,this.boundaries.bottom=t+this.offset.bottom+this.padding,0===this.iconOffset.left&&0===this.iconOffset.right&&0===this.iconOffset.top&&0===this.iconOffset.bottom||(this.boundaries.left=Math.min(this.boundaries.left,e+this.iconOffset.left),this.boundaries.right=Math.max(this.boundaries.right,e+this.iconOffset.right),this.boundaries.top=Math.min(this.boundaries.top,t+this.iconOffset.top),this.boundaries.bottom=Math.max(this.boundaries.bottom,t+this.iconOffset.bottom)))}updateCSSPosition(){this.content.style[qg]=`translate(${this.projectedPosition.x+this.offset.left}px, ${this.projectedPosition.y+this.offset.top}px)`,this.icon&&(this.icon.style[qg]=`translate(${-this.offset.left}px, ${-this.offset.top}px)`)}initDimensions(){if(!this.offset){Vg=this.content.getBoundingClientRect();const e=Math.round(Vg.width),t=Math.round(Vg.height);this.offset={left:e*this.anchor[0]+this.styleOffset[0],top:t*this.anchor[1]+this.styleOffset[1]},this.offset.right=this.offset.left+e,this.offset.bottom=this.offset.top+t,this.icon&&(Vg=this.icon.getBoundingClientRect(),this.iconOffset={left:Math.floor(Vg.x),top:Math.floor(Vg.y),right:Math.ceil(Vg.x+Vg.width),bottom:Math.ceil(Vg.y+Vg.height)})}}update3dPosition(e){this.coordinates.as(e,jg).toVector3(this.position),this.updateMatrixWorld()}updateElevationFromLayer(e,t){if(0==e.attachedLayers.filter((e=>e.isElevationLayer)).length)return;let r=Math.max(0,u.getElevationValueAt(e,this.coordinates,u.FAST_READ_Z,t));isNaN(r)&&(r=Math.max(0,u.getElevationValueAt(e,this.coordinates,u.FAST_READ_Z))),isNaN(r)||r==this.coordinates.z||(this.coordinates.z=r)}updateHorizonCullingPoint(){this.horizonCullingPoint&&this.getWorldPosition(this.horizonCullingPoint)}}const Wg=Hg;function $g(e){let t,r,n,i=e.r||e[0]/255,s=e.g||e[1]/255,o=e.b||e[2]/255;return i=i>.04045?((i+.055)/1.055)**2.4:i/12.92,s=s>.04045?((s+.055)/1.055)**2.4:s/12.92,o=o>.04045?((o+.055)/1.055)**2.4:o/12.92,t=(.4124*i+.3576*s+.1805*o)/.95047,r=(.2126*i+.7152*s+.0722*o)/1,n=(.0193*i+.1192*s+.9505*o)/1.08883,t=t>.008856?t**(1/3):7.787*t+16/116,r=r>.008856?r**(1/3):7.787*r+16/116,n=n>.008856?n**(1/3):7.787*n+16/116,[116*r-16,500*(t-r),200*(r-n)]}function Yg(e,t){const r=$g(e),n=$g(t),i=r[0]-n[0],s=r[1]-n[1],o=r[2]-n[2],a=Math.sqrt(r[1]*r[1]+r[2]*r[2]),l=a-Math.sqrt(n[1]*n[1]+n[2]*n[2]);let c=s*s+o*o-l*l;c=c<0?0:Math.sqrt(c);const h=i/1,u=l/(1+.045*a),d=c/(1+.015*a),p=h*h+u*u+d*d;return p<0?0:Math.sqrt(p)}const Kg=new oe({max:500});let Jg,Xg;function Zg(e,t){return t?.coordinates?.z||0}function eA(e,t){if(e.expression)return e.expression.evaluate(t);if(e.stops){const r=e.stops;e=e.stops[0][1];for(let n=r.length-1;n>=0;n--){const i=r[n];if(t.zoom>=i[0]){e=i[1];break}}}return"string"==typeof e||e instanceof String?e.replace(/\{(.+?)\}/g,((e,r)=>t.properties[r]||"")).trim():e instanceof Function?e(t.properties,t):e}async function tA(e){const t=e.split("?")[0];let r=Kg.get(t);return r||(r=sc.texture(e,{crossOrigin:"anonymous"}),Kg.set(t,r)),(await r).image}function rA(e,t){const r=t.x||0,n=t.y||0,i=t.width||e.naturalWidth,s=t.height||e.naturalHeight;Xg.width=i,Xg.height=s;const o=Xg.getContext("2d",{willReadFrequently:!0});return o.drawImage(e,r,n,i,s,0,0,i,s),o.getImageData(0,0,i,s)}"undefined"!=typeof document&&(Jg=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix(),Xg=document.createElement("canvas"));const nA={left:[0,-.5],right:[-1,-.5],top:[-.5,0],bottom:[-.5,-1],"top-right":[-1,0],"bottom-left":[0,-1],"bottom-right":[-1,-1],center:[-.5,-.5],"top-left":[0,0]};function iA(e,t,r,n,i){let s=n;Object.defineProperty(e[t],r,{enumerable:!0,get:()=>{if(null!=s)return eA(s,e.context);const n=e.context.featureStyle?.[t]?.[r];return null!=n?eA(n,e.context):i instanceof Function?i(e.context.properties,e.context)??i:i},set:e=>{s=e}})}class sA{#Z=(()=>new i.E$("EPSG:4326",0,0,0))();#ee=(()=>new i.E$("EPSG:4326",0,0,0))();#te=!0;#re={};#ne={};setZoom(e){this.zoom=e}setFeature(e){this.#re=e}setGeometry(e){this.#ne=e}setCollection(e){this.collection=e,this.#ee.setCrs(e.crs)}setLocalCoordinatesFromArray(e,t){return this.#te=!1,this.#ee.setFromArray(e,t)}get properties(){return this.#ne.properties}get type(){return this.#re.type}get featureStyle(){let e=this.#re.style;return e instanceof Function&&(e=e(this.properties,this)),e}get coordinates(){return this.#te||(this.#te=!0,this.#Z.copy(this.#ee).applyMatrix4(this.collection.matrixWorld),"EPSG:4978"!=this.#ee.crs)?this.#Z:this.#Z.as("EPSG:4326",this.#Z)}}const oA={itowns_stroke_single_before:".itowns-stroke-single:before {\n    display: var(--text_stroke_display);\n    content: attr(data-before);\n    opacity: 1;\n    position: absolute;\n    -webkit-text-stroke-width: var(--text_stroke_width);\n    -webkit-text-stroke-color: var(--text_stroke_color);\n    left: 0;\n    right: 0;\n    bottom: 0;\n    top: 0;\n    z-index: -1;\n    white-space: inherit;\n    overflow-wrap: inherit;\n    letter-spacing: inherit;\n    text-align: inherit;\n    padding: inherit;\n    font-family: inherit;\n    text-transform: inherit;\n    max-width: inherit;\n    font-size: inherit;\n}\n"};if("undefined"!=typeof document){const e=document.createElement("style");e.type="text/css",Object.keys(oA).forEach((t=>{e.innerHTML+=`${oA[t]}\n\n`})),document.getElementsByTagName("head")[0].appendChild(e)}const aA=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isStyle=!0,this.context=new sA,e.zoom=e.zoom||{},e.fill=e.fill||{},e.stroke=e.stroke||{},e.point=e.point||{},e.text=e.text||{},e.icon=e.icon||{},this.zoom={},iA(this,"zoom","min",e.zoom.min),iA(this,"zoom","max",e.zoom.max),this.fill={},iA(this,"fill","color",e.fill.color),iA(this,"fill","opacity",e.fill.opacity,1),iA(this,"fill","pattern",e.fill.pattern),iA(this,"fill","base_altitude",e.fill.base_altitude,Zg),this._extrusionHeight=e.fill.extrusion_height,Object.defineProperty(this.fill,"extrusion_height",{get:()=>{if(null!=this._extrusionHeight)return eA(this._extrusionHeight,this.context);const e=this.context.featureStyle?.fill?.extrusion_height;return null!=e?eA(e,this.context):void 0},set:e=>{this._extrusionHeight=e}}),this.stroke={},iA(this,"stroke","color",e.stroke.color),iA(this,"stroke","opacity",e.stroke.opacity,1),iA(this,"stroke","width",e.stroke.width,1),iA(this,"stroke","dasharray",e.stroke.dasharray,[]),iA(this,"stroke","base_altitude",e.stroke.base_altitude,Zg),this.point={},iA(this,"point","color",e.point.color),iA(this,"point","line",e.point.line),iA(this,"point","opacity",e.point.opacity,1),iA(this,"point","radius",e.point.radius,2),iA(this,"point","width",e.point.width,0),iA(this,"point","base_altitude",e.point.base_altitude,Zg),e.point.model&&iA(this,"point","model",e.point.model),this.text={},iA(this,"text","field",e.text.field),iA(this,"text","zOrder",e.text.zOrder,"auto"),iA(this,"text","color",e.text.color,"#000000"),iA(this,"text","anchor",e.text.anchor,"center"),iA(this,"text","offset",e.text.offset,[0,0]),iA(this,"text","padding",e.text.padding,2),iA(this,"text","size",e.text.size,16),iA(this,"text","placement",e.text.placement,"point"),iA(this,"text","rotation",e.text.rotation,"auto"),iA(this,"text","wrap",e.text.wrap,10),iA(this,"text","spacing",e.text.spacing,0),iA(this,"text","transform",e.text.transform,"none"),iA(this,"text","justify",e.text.justify,"center"),iA(this,"text","opacity",e.text.opacity,1),iA(this,"text","font",e.text.font,["Open Sans Regular","Arial Unicode MS Regular","sans-serif"]),iA(this,"text","haloColor",e.text.haloColor,"#000000"),iA(this,"text","haloWidth",e.text.haloWidth,0),iA(this,"text","haloBlur",e.text.haloBlur,0),this.icon={},iA(this,"icon","source",e.icon.source),e.icon.key&&(console.warn("'icon.key' is deprecated: use 'icon.id' instead"),e.icon.id=e.icon.key),iA(this,"icon","id",e.icon.id),iA(this,"icon","cropValues",e.icon.cropValues),iA(this,"icon","anchor",e.icon.anchor,"center"),iA(this,"icon","size",e.icon.size,1),iA(this,"icon","color",e.icon.color),iA(this,"icon","opacity",e.icon.opacity,1)}setContext(e){this.context=e}applyToCanvasPolygon(e,t,r,n){this.stroke.width>0&&this._applyStrokeToPolygon(e,r,t),n&&(this.fill.pattern||this.fill.color)&&this._applyFillToPolygon(e,r,t)}_applyStrokeToPolygon(e,t,r){e.strokeStyle!==this.stroke.color&&(e.strokeStyle=this.stroke.color);const n=this.stroke.width*t;e.lineWidth!==n&&(e.lineWidth=n);const i=this.stroke.opacity;i!==e.globalAlpha&&"number"==typeof i&&(e.globalAlpha=i),e.lineCap!==this.stroke.lineCap&&(e.lineCap=this.stroke.lineCap),e.setLineDash(this.stroke.dasharray.map((e=>e*t*2))),e.stroke(r)}async _applyFillToPolygon(e,t,r){if(this.fill.pattern){let r=this.fill.pattern;const n={...this.fill.pattern.cropValues};this.fill.pattern.source&&(r=await tA(this.fill.pattern.source)),rA(r,n),e.fillStyle=e.createPattern(Xg,"repeat"),e.fillStyle.setTransform?e.fillStyle.setTransform(Jg.scale(t)):console.warn("Raster pattern isn't completely supported on Ie and edge",e.fillStyle)}else e.fillStyle!==this.fill.color&&(e.fillStyle=this.fill.color);this.fill.opacity!==e.globalAlpha&&(e.globalAlpha=this.fill.opacity),e.fill(r)}async applyToHTML(e){if(arguments.length>1&&console.warn("Deprecated argument sprites. Sprites must be configured in style."),e.style.padding=`${this.text.padding}px`,e.style.maxWidth=`${this.text.wrap}em`,e.style.color=this.text.color,this.text.size>0&&(e.style.fontSize=`${this.text.size}px`),e.style.fontFamily=this.text.font.join(","),e.style.textTransform=this.text.transform,e.style.letterSpacing=`${this.text.spacing}em`,e.style.textAlign=this.text.justify,e.style["white-space"]="pre-line",this.text.haloWidth>0&&(e.style.setProperty("--text_stroke_display","block"),e.style.setProperty("--text_stroke_width",`${this.text.haloWidth}px`),e.style.setProperty("--text_stroke_color",this.text.haloColor),e.setAttribute("data-before",e.textContent)),!this.icon.source)return;let t;"undefined"!=typeof document&&(t=document.createElement("img"));const r=new Promise(((r,n)=>{const i={size:this.icon.size,color:this.icon.color,opacity:this.icon.opacity,anchor:this.icon.anchor};t.onload=()=>r(function(e,t,r){const n=e.cloneNode();switch(n.setAttribute("class","itowns-icon"),n.width=e.width*r.size,n.height=e.height*r.size,n.style.color=r.color,n.style.opacity=r.opacity,n.style.position="absolute",n.style.top="0",n.style.left="0",r.anchor){case"left":n.style.top=-.5*n.height+"px";break;case"right":n.style.top=-.5*n.height+"px",n.style.left=-n.width+"px";break;case"top":n.style.left=-.5*n.width+"px";break;case"bottom":n.style.top=-n.height+"px",n.style.left=-.5*n.width+"px";break;case"bottom-left":n.style.top=-n.height+"px";break;case"bottom-right":n.style.top=-n.height+"px",n.style.left=-n.width+"px";break;case"top-left":break;case"top-right":n.style.left=-n.width+"px";break;default:n.style.top=-.5*n.height+"px",n.style.left=-.5*n.width+"px"}return n.style["z-index"]=-1,t.appendChild(n),n}(t,e,i)),t.onerror=e=>n(e)}));if(this.icon.cropValues||this.icon.color){const e={...this.icon.cropValues},r=this.icon.color,n=this.icon.id||this.icon.source,i=function(e,t,r){if(!t)return e;const n=Kg.get(`${r}_${t}`);if(!n){const n=e.data,i=new s.Color(t),o=new s.Color("white");for(let e=0,t=n.length;e<t;e+=4){const t=Yg(n.slice(e,e+3),o)/100;n[e]=n[e]*t+255*i.r*(1-t),n[e+1]=n[e+1]*t+255*i.g*(1-t),n[e+2]=n[e+2]*t+255*i.b*(1-t)}return Kg.set(`${r}_${t}`,e),e}return n}(rA(await tA(this.icon.source),e),r,n);Xg.getContext("2d").putImageData(i,0,0),t.src=Xg.toDataURL("image/png")}else t.src=this.icon.source;return r}getTextAnchorPosition(){return"string"==typeof this.text.anchor?Object.keys(nA).includes(this.text.anchor)?nA[this.text.anchor]:(console.error(`${this.text.anchor} is not a valid input for Style.text.anchor parameter.`),nA.center):this.text.anchor}isExtruded(){return null!=this._extrusionHeight}},lA=new sA,cA=new i.E$("EPSG:4326",0,0,0),hA=new i.zR("EPSG:4326",0,0,0,0),uA=new s.Vector2,dA=new s.Vector2,pA=new s.Vector2;class fA{#ie=!1;constructor(){this.dom=document.createElement("div"),this.dom.style.display="none",this.visible=!0}get visible(){return this.#ie}set visible(e){e!==this.#ie&&(this.#ie=e,this.dom.style.display=e?"block":"none")}hide(){this.visible=!1}show(){this.visible=!0}add(e){this.dom.append(e.dom)}}class gA extends s.Group{constructor(e){super(),this.nodeParent=e,this.needsUpdate=!0}initializeDom(){this.domElements=new fA,this.domElements.labels=new fA,this.domElements.add(this.domElements.labels),this.domElements.labels.dom.style.opacity="0"}addLabel(e){this.add(e),this.domElements.labels.dom.append(e.content),e.initDimensions(),this.nodeParent.layer.isGlobeLayer&&this.nodeParent.level<4&&(e.horizonCullingPoint=new s.Vector3)}removeLabel(e){this.remove(e),this.domElements.labels.dom.removeChild(e.content)}updatePosition(e){this.needsUpdate&&(this.needsAltitude&&e.updateElevationFromLayer(this.nodeParent.layer,[this.nodeParent]),e.update3dPosition(this.nodeParent.layer.crs),e.updateHorizonCullingPoint())}count(){return this.children.length}get labels(){return this.children}}const AA=class extends _c{#se=(()=>new Ih)();constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{domElement:r,performance:n=!0,forceClampToTerrain:i=!1,margin:o,style:a={},...l}=t;super(e,t.object3d||new s.Group,l),this.isLabelLayer=!0,this.style=a instanceof aA?a:new aA(a),this.domElement=new fA,this.domElement.show(),this.domElement.dom.id=`itowns-label-${this.id}`,this.buildExtent=!0,this.crs=t.source.crs,this.performance=n,this.forceClampToTerrain=i,this.margin=o,this.toHide=new s.Group,this.labelDomelement=r,this.margin=t.margin}get visible(){return super.visible}set visible(e){super.visible=e,e?this.domElement?.show():this.domElement?.hide()}get submittedLabelNodes(){return this.object3d.children}convert(e,t){const r=[];return t.isExtent?t.as(e.crs,hA):t.toExtent(e.crs,hA),cA.crs=e.crs,lA.setZoom(t.zoom),e.features.forEach((t=>{if(t.style.text&&0===Object.keys(t.style.text).length)return;lA.setFeature(t);const n=t.style?.text?.field,i=t.style?.point?.base_altitude,s=i instanceof Function&&"baseAltitudeDefault"==i.name;r.needsAltitude=r.needsAltitude||!0===this.forceClampToTerrain||s&&!t.hasRawElevationData,t.geometries.forEach((i=>{lA.setGeometry(i),this.style.setContext(lA);const s=this.style.text&&this.style.text.field,o=i.properties.style&&i.properties.style.text&&i.properties.style.text.field;let a;if(this.labelDomelement)a=eA(this.labelDomelement,lA);else if(!(o||n||s||i.properties.style&&(i.properties.style.icon.source||i.properties.style.icon.key)||t.style&&t.style.icon&&(t.style.icon.source||t.style.icon.key)||this.style.icon&&(this.style.icon.source||this.style.icon.key)))return;this.style.zoom.min>this.style.context.zoom||this.style.zoom.max<=this.style.context.zoom||i.indices.forEach((n=>{if(cA.setFromArray(t.vertices,i.size*n.offset),cA.applyMatrix4(e.matrixWorld),!hA.isPointInside(cA))return;const s=new Wg(a,cA.clone(),this.style);s.layerId=this.id,s.order=t.order,s.padding=this.margin||s.padding,r.push(s)}))}))})),r}preUpdate(e,t){t.has(this.parent)&&(this.object3d.clear(),this.#se.width=.5*this.parent.maxScreenSizeNode,this.#se.height=.5*this.parent.maxScreenSizeNode,this.#se.resize())}#oe(e){this.object3d.add(e)}#ae(e){this.toHide.add(e)}#le(e){return e.parent?.isTileMesh?e.parent.link[this.id]?.domElements||this.#le(e.parent):this.domElement}#ce(e){return e.children.every((e=>e.layerUpdateState&&e.layerUpdateState[this.id]?.hasFinished()))}#he(e){const t=e.children.slice();this.#se.reset(),t.sort(((e,t)=>t.order-e.order)),t.forEach((t=>{e.nodeParent.extent.planarDimensions(uA),cA.crs=e.nodeParent.extent.crs,cA.setFromValues(e.nodeParent.extent.west,e.nodeParent.extent.north,0).toVector3(dA),cA.copy(t.coordinates).as(e.nodeParent.extent.crs,cA).toVector3(pA),pA.sub(dA),pA.y+=uA.y,pA.divide(uA).multiplyScalar(this.#se.width),t.updateProjectedPosition(pA.x,pA.y),this.#se.insert(t)||e.removeLabel(t)}))}update(e,t,r,n){if(!n&&r.link[t.id])return void Cc.removeChildrenAndCleanupRecursively(this,r);const i=r.link[t.id]||new gA(r);if(r.link[t.id]=i,this.frozen||!r.visible||!this.visible)return;if(!r.material.visible&&this.#ce(r))return this.#ae(i);const s=r.getExtentsByProjection(this.source.crs)||[r.extent],o=s[0].zoom;if(o<t.zoom.min||o>t.zoom.max)return this.#ae(i);if(void 0===r.layerUpdateState[this.id]&&(r.layerUpdateState[this.id]=new Sc),!this.source.extentInsideLimit(r.extent,o))return void r.layerUpdateState[this.id].noMoreUpdatePossible();if(this.#ce(r.parent))return r.material.visible||(i.needsUpdate=!0),void this.#oe(i);if(!r.layerUpdateState[this.id].canTryUpdate())return;r.layerUpdateState[this.id].newTry();const a={layer:this,extentsSource:s,view:e.view,requester:r};return e.scheduler.execute(a).then((t=>{if(!t)return;const n=e.view.mainLoop.gfxEngine.label2dRenderer;i.initializeDom(),this.#le(r).add(i.domElements),t.forEach((e=>{r.parent?(i.needsAltitude=i.needsAltitude||e.needsAltitude,e.forEach((e=>{r.extent.isPointInside(e.coordinates)&&i.addLabel(e)}))):e.forEach((e=>{Cc.removeChildrenAndCleanupRecursively(this,e),n.removeLabelDOM(e)}))})),i.count()&&(i.domElements.labels.hide(),i.domElements.labels.dom.style.opacity="1.0",r.addEventListener("show",(()=>i.domElements.labels.show())),r.addEventListener("hidden",(()=>this.#ae(i))),r.addEventListener("removed",(()=>this.removeNodeDomElement(r))),i.needsAltitude&&r.material.getElevationTile()&&r.material.getElevationTile().addEventListener("rasterElevationLevelChanged",(()=>{i.needsUpdate=!0})),this.performance&&this.#he(i)),r.layerUpdateState[this.id].noMoreUpdatePossible()}))}removeLabelsFromNodeRecursive(e){e.children.forEach((e=>{e.link[this.id]&&delete e.link[this.id],this.removeLabelsFromNodeRecursive(e)})),this.removeNodeDomElement(e)}removeNodeDomElement(e){if(e.link[this.id]?.domElements){const t=e.link[this.id].domElements.dom;t.parentElement.removeChild(t),delete e.link[this.id].domElements}}delete(e){e&&this.cache.clear(),this.domElement.dom.parentElement.removeChild(this.domElement.dom),this.parent.level0Nodes.forEach((e=>this.removeLabelsFromNodeRecursive(e)))}},mA={LAYERS_INITIALIZED:"layers-initialized",LAYER_REMOVED:"layer-removed",LAYER_ADDED:"layer-added",INITIALIZED:"initialized",COLOR_LAYERS_ORDER_CHANGED:j,CAMERA_MOVED:"camera-moved",DISPOSED:"disposed"},yA=new s.Vector2,vA=new s.Matrix4,wA=new s.Vector2,bA=new s.Ray,EA=new s.Vector3,xA=new s.Vector3,CA=new i.E$("EPSG:4326"),_A=[];let IA,SA=0;class MA extends s.EventDispatcher{#ue=[];#de=(()=>new Uint8Array(4))();#pe;static ALTITUDE_MAX=1e5;constructor(e,t){let r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t)throw new Error("Invalid viewerDiv parameter (must non be null/undefined)");if(super(),this.domElement=t,this.id=SA++,this.referenceCrs=e,r=n.renderer&&n.renderer.domElement?new Ph(n.renderer):new Ph(t,n.renderer),this.mainLoop=n.mainLoop||new R(new zg,r),this.scene=n.scene3D||new s.Scene,n.scene3D||(this.scene.matrixWorldAutoUpdate=!1),this.camera=new S(this.referenceCrs,this.mainLoop.gfxEngine.getWindowSize().x,this.mainLoop.gfxEngine.getWindowSize().y,n.camera),this._frameRequesters={},this._resizeListener=()=>this.resize(),window.addEventListener("resize",this._resizeListener,!1),this._changeSources=new Set,this._delayedFrameRequesterRemoval=[],this._allLayersAreReadyCallback=()=>{this.getLayers().every((e=>e.ready))&&0==this.mainLoop.scheduler.commandsWaitingExecutionCount()&&0==this.mainLoop.renderingState&&(this.dispatchEvent({type:mA.LAYERS_INITIALIZED}),this.removeFrameRequester(M.UPDATE_END,this._allLayersAreReadyCallback))},this.fovDepthFactor=1,this.camera3D.isPerspectiveCamera){const e=new s.Vector4(1,1,-1);e.applyMatrix4(this.camera3D.projectionMatrixInverse).divideScalar(e.z),this.fovDepthFactor/=Math.sqrt(1+e.x*e.x+e.y*e.y)}this.camera.resize(this.domElement.clientWidth,this.domElement.clientHeight);const i=()=>{this.removeEventListener(mA.LAYERS_INITIALIZED,i),this.dispatchEvent({type:mA.INITIALIZED})};let o;this.addEventListener(mA.LAYERS_INITIALIZED,i),this.#pe=new Uint8Array(4*this.camera.width*this.camera.height),this.domElement.tabIndex=-1,n.disableFocusOnStart||this.domElement.focus(),this.domElement.addEventListener("mouseup",(e=>{2===e.button&&(o&&e.timeStamp-o<500&&this.domElement.dispatchEvent(new MouseEvent("dblclick-right",e)),o=e.timeStamp)})),_A.push(this)}get renderer(){return this.mainLoop?.gfxEngine?.getRenderer()}get camera3D(){return this.camera?.camera3D}dispose(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=_A.indexOf(this);if(-1==t)return void console.warn("View already disposed");window.removeEventListener("resize",this._resizeListener),this.controls&&("function"==typeof this.controls.dispose&&this.controls.dispose(),delete this.controls),this.removeAllFrameRequesters();const r=this.getLayers((e=>!e.isTiledGeometryLayer&&!e.isAtmosphere));for(const t of r)this.removeLayer(t.id,e);const n=this.getLayers((e=>e.isAtmosphere));for(const t of n)this.removeLayer(t.id,e);const i=this.getLayers((e=>e.isTiledGeometryLayer));for(const t of i)this.removeLayer(t.id,e);_A.splice(t,1),this.scene.traverse(Cc.cleanup),this.dispatchEvent({type:mA.DISPOSED}),this.removeAllEvents()}addLayer(e,t){if(!e||!e.isLayer)return Promise.reject(new Error("Add Layer type object"));if(this.getLayerById(e.id))return e._reject(new Error(`Invalid id '${e.id}': id already used`));if(e=function(e,t,r){const n=t.source;if(r&&!t.extent&&(t.extent=r.extent,n&&!n.extent&&(n.extent=r.extent)),t.isGeometryLayer&&!t.isLabelLayer?t.crs=e.referenceCrs:t.crs||(r&&r.tileMatrixSets&&r.tileMatrixSets.includes(n.crs)?t.crs=n.crs:t.crs=r&&r.extent.crs),t.isLabelLayer)e.mainLoop.gfxEngine.label2dRenderer.registerLayer(t);else if(t.labelEnabled||t.addLabelLayer){t.labelEnabled&&console.info("layer.labelEnabled is deprecated use addLabelLayer, instead of"),t.buildExtent=!0,t.structure="3d";const r=new AA(`${t.id}-label`,{source:n,style:t.style,zoom:t.zoom,performance:t.addLabelLayer.performance,crs:n.crs,visible:t.visible,margin:15,forceClampToTerrain:t.addLabelLayer.forceClampToTerrain});t.addEventListener("visible-property-changed",(()=>{r.visible=t.visible}));const i=n=>{n.layerId===t.id&&e.removeLayer(r.id),e.removeEventListener(mA.LAYER_REMOVED,i)};e.addEventListener(mA.LAYER_REMOVED,i),t.whenReady=t.whenReady.then((()=>(e.addLayer(r),t)))}return t.isOGC3DTilesLayer&&t._setup(e),t}(this,e,t),t){if(e.isColorLayer){const t=this.getLayers((e=>e.isColorLayer));e.sequence=t.length}t.attach(e)}else{if("function"!=typeof e.update)return e._reject(new Error("Cant add GeometryLayer: missing a update function"));if("function"!=typeof e.preUpdate)return e._reject(new Error("Cant add GeometryLayer: missing a preUpdate function"));this.#ue.push(e)}return e.object3d&&!e.object3d.parent&&e.object3d!==this.scene&&this.scene.add(e.object3d),e.startup().then((()=>{this.notifyChange(t||e,!1),this._frameRequesters[M.UPDATE_END]&&this._frameRequesters[M.UPDATE_END].includes(this._allLayersAreReadyCallback)||this.addFrameRequester(M.UPDATE_END,this._allLayersAreReadyCallback),this.dispatchEvent({type:mA.LAYER_ADDED,layerId:e.id})})),e.whenReady}removeLayer(e,t){const r=this.getLayerById(e);if(r){const n=r.parent;if(r.delete(t),n&&!n.detach(r))throw new Error(`Error to detach ${e} from ${n.id}`);if(null==n&&this.#ue.splice(this.#ue.findIndex((t=>t.id==e)),1),r.isColorLayer){const e=this.getLayers((e=>e.isColorLayer));for(const t of e)t.sequence>r.sequence&&t.sequence--}let i=0;for(const e of _A)i+=e.getLayers((e=>e.source.uid==r.source.uid&&e.crs==r.crs)).length;return r.source.onLayerRemoved({unusedCrs:0==i?r.crs:void 0}),this.notifyChange(this.camera),this.dispatchEvent({type:mA.LAYER_REMOVED,layerId:e}),!0}throw new Error(`${e} doesn't exist`)}notifyChange(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&(this._changeSources.add(e),this.mainLoop.gfxEngine.renderer.xr.isPresenting||!e.isTileMesh&&!e.isCamera||(this.#pe.needsUpdate=!0)),this.mainLoop.scheduleViewUpdate(this,t)}getLayers(e){const t=[];for(const r of this.#ue)if(e&&!e(r)||t.push(r),r.attachedLayers)for(const n of r.attachedLayers)e&&!e(n,r)||t.push(n);return t}getLayerById(e){return this.getLayers((t=>t.id===e))[0]}addFrameRequester(e,t){if("function"!=typeof t)throw new Error("frameRequester must be a function");this._frameRequesters[e]?this._frameRequesters[e].push(t):this._frameRequesters[e]=[t]}removeFrameRequester(e,t){this._frameRequesters[e].includes(t)?this._delayedFrameRequesterRemoval.push({when:e,frameRequester:t}):console.error("Invalid call to removeFrameRequester: frameRequester isn't registered")}removeAllFrameRequesters(){for(const e in this._frameRequesters)if(Object.prototype.hasOwnProperty.call(this._frameRequesters,e)){const t=this._frameRequesters[e];for(const r of t)this.removeFrameRequester(e,r)}this._executeFrameRequestersRemovals()}removeAllEvents(){if(void 0!==this._listeners){for(const e in this._listeners)Object.prototype.hasOwnProperty.call(this._listeners,e)&&delete this._listeners[e];this._listeners=void 0}}_executeFrameRequestersRemovals(){for(const e of this._delayedFrameRequesterRemoval){const t=this._frameRequesters[e.when].indexOf(e.frameRequester);t>=0?this._frameRequesters[e.when].splice(t,1):console.warn("FrameReq has already been removed")}this._delayedFrameRequesterRemoval.length=0}execFrameRequesters(e,t,r){if(this._frameRequesters[e]){this._delayedFrameRequesterRemoval.length>0&&this._executeFrameRequestersRemovals();for(var n=arguments.length,i=new Array(n>3?n-3:0),s=3;s<n;s++)i[s-3]=arguments[s];for(const n of this._frameRequesters[e])n.update?n.update(t,r,i):n(t,r,i)}}eventToViewCoords(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yA,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=this.domElement.getBoundingClientRect();if(e.touches&&e.touches.length)return t.set(e.touches[r].clientX-n.x,e.touches[r].clientY-n.y);if(void 0!==e.offsetX&&void 0!==e.offsetY){const r=e.target.getBoundingClientRect();return t.set(r.x+e.offsetX-n.x,r.y+e.offsetY-n.y)}}eventToNormalizedCoords(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.viewToNormalizedCoords(this.eventToViewCoords(e,yA,t))}viewToNormalizedCoords(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yA;return t.x=e.x/this.camera.width*2-1,t.y=e.y/this.camera.height*-2+1,t}normalizedToViewCoords(e){return yA.x=.5*(e.x+1)*this.camera.width,yA.y=-.5*(e.y-1)*this.camera.height,yA}pickObjectsAt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;const n=[];if(r&&0!==r.length||(r=this.getLayers((e=>e.isGeometryLayer))),Array.isArray(r)||(r=[r]),r.forEach((e=>{"string"==typeof e&&(e=this.getLayerById(e)),e&&(e.isGeometryLayer||e.isObject3D)&&n.push(e)})),0==n.length)return[];const i=[],s=e instanceof Event?this.eventToViewCoords(e):e;for(const e of n)if(!e.isAtmosphere)if(e.isGeometryLayer){if(!e.ready){console.warn("view.pickObjectAt : layer is not ready : ",e);continue}e.pickObjectsAt(this,s,t,i)}else bc.pickObjectsAt(this,s,t,e,i);return i}getScale(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.28;return this.camera3D.isOrthographicCamera?.001*e/this.getPixelsToMeters():this.getScaleFromDistance(e,this.getDistanceFromCamera())}getScaleFromDistance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.28,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e/=1e3;const r=s.MathUtils.degToRad(this.camera3D.fov);return e*(this.camera.height/(2*t*Math.tan(.5*r)))}getDistanceFromCamera(e){return this.getPickingPositionFromDepth(e,xA),this.camera3D.position.distanceTo(xA)}getPixelsToMeters(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;return this.camera3D.isOrthographicCamera?(IA=(this.camera3D.right-this.camera3D.left)/this.camera3D.zoom,e*IA/this.camera.width):this.getPixelsToMetersFromDistance(e,this.getDistanceFromCamera(t))}getPixelsToMetersFromDistance(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)*(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)/this.camera._preSSE}getMetersToPixels(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;return this.camera3D.isOrthographicCamera?(IA=(this.camera3D.right-this.camera3D.left)/this.camera3D.zoom,e*this.camera.width/IA):this.getMetersToPixelsFromDistance(e,this.getDistanceFromCamera(t))}getMetersToPixelsFromDistance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.camera._preSSE*e/t}pickFeaturesAt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;for(var r=arguments.length,n=new Array(r>2?r-2:0),s=2;s<r;s++)n[s-2]=arguments[s];Array.isArray(n[0])&&(console.warn("Deprecated: the ...where argument of View#pickFeaturesAt should not be an array anymore, but a list: use the spread operator if needed."),n=n[0]);const o=[],a={};(n=0==n.length?this.getLayers((e=>e.isColorLayer||e.isGeometryLayer)):n).forEach((e=>{"string"==typeof e&&(e=this.getLayerById(e)),e&&e.isLayer&&(a[e.id]=[],e.isColorLayer&&o.push(e.id))}));const l=e instanceof Event?this.eventToViewCoords(e,yA):e,c=this.pickObjectsAt(l,t,...n);if(c.length>0&&c.forEach((e=>a[e.layer.id].push(e))),0==o.length)return a;let h;this.getPickingPositionFromDepth(l,xA),CA.crs=this.referenceCrs,CA.setFromVector3(xA);const u={M:this.getPixelsToMeters(t,l),D:.001*t};this.isPlanarView?u.D=u.M:this.getPixelsToDegrees&&(u.D=this.getMetersToDegrees(u.M));const d=bc.pickTilesAt(this,l,t,this.tileLayer);for(const e of d)if(e.object.material)for(const t of e.object.material.getTiles(o))for(const e of t.textures)e.features&&(h=i.tC.isMetricUnit(e.features.crs)?u.M:u.D,Oh.filterFeaturesUnderCoordinate(CA,e.features,h).forEach((e=>{a[t.id].find((t=>t.geometry===e.geometry))||a[t.id].push(e)})));return a}readDepthBuffer(e,t,r,n,i){const s=this.mainLoop.gfxEngine,o=this.tileLayer.wireframe,a=this.tileLayer.opacity,l=this.tileLayer.visible;o&&(this.tileLayer.wireframe=!1),a<1&&(this.tileLayer.opacity=1),l||(this.tileLayer.visible=!0);const c=this.tileLayer.level0Nodes.map((e=>Y.push(e,Y.MODES.DEPTH)));return i=s.renderViewToBuffer({camera:this.camera,scene:this.tileLayer.object3d},{x:e,y:t,width:r,height:n,buffer:i}),c.forEach((e=>e())),this.tileLayer.wireframe!==o&&(this.tileLayer.wireframe=o),this.tileLayer.opacity!==a&&(this.tileLayer.opacity=a),this.tileLayer.visible!==l&&(this.tileLayer.visible=l),i}getPickingPositionFromDepth(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Vector3;if(!this.tileLayer||0==this.tileLayer.level0Nodes.length||!this.tileLayer.level0Nodes[0])return void(t=void 0);const r=this.mainLoop,n=0==r.scheduler.commandsWaitingExecutionCount()&&0==r.renderingState,i=r.gfxEngine,o=i.getWindowSize();let a;if((e=e||o.clone().multiplyScalar(.5)).x=Math.floor(e.x),e.y=Math.floor(e.y),n){this.#pe.needsUpdate&&(this.readDepthBuffer(0,0,o.x,o.y,this.#pe),this.#pe.needsUpdate=!1);const t=4*((o.y-e.y-1)*o.x+e.x);a=this.#pe.slice(t,t+4)}else a=this.readDepthBuffer(e.x,e.y,1,1,this.#de);if(wA.x=e.x/o.x*2-1,wA.y=-e.y/o.y*2+1,F.isLogDepthBufferSupported()&&"PerspectiveCamera"==this.camera3D.type){bA.origin.copy(this.camera3D.position),bA.direction.set(wA.x,wA.y,.5),vA.multiplyMatrices(this.camera3D.matrixWorld,vA.copy(this.camera3D.projectionMatrix).invert()),bA.direction.applyMatrix4(vA),bA.direction.sub(bA.origin),EA.set(0,0,1),EA.applyMatrix4(vA),EA.sub(bA.origin);const e=EA.angleTo(bA.direction),r=i.depthBufferRGBAValueToOrthoZ(a,this.camera3D)/Math.cos(e);t.addVectors(this.camera3D.position,bA.direction.setLength(r))}else{const e=i.depthBufferRGBAValueToOrthoZ(a,this.camera3D);t.set(wA.x,wA.y,e),t.unproject(this.camera3D)}return t.length()>1e7?void 0:t}pickTerrainCoordinates(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new i.E$(this.referenceCrs);return e instanceof Event?this.eventToViewCoords(e):e&&void 0!==e.x&&void 0!==e.y?yA.copy(e):yA.set(this.mainLoop.gfxEngine.width/2,this.mainLoop.gfxEngine.height/2),this.getPickingPositionFromDepth(yA,xA),CA.crs=this.referenceCrs,CA.setFromVector3(xA),CA.as(t.crs,t),t}pickCoordinates(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new i.E$(this.referenceCrs);return console.warn("Deprecated, use View#pickTerrainCoordinates instead."),this.pickTerrainCoordinates(e,t)}resize(e,t){e<0||t<0?console.warn(`Trying to resize the View with negative height (${t}) or width (${e}). Skipping resize.`):(null==e&&(e=this.domElement.clientWidth),null==t&&(t=this.domElement.clientHeight),this.#pe=new Uint8Array(4*e*t),this.mainLoop.gfxEngine.onWindowResize(e,t),0!==e&&0!==t&&(this.camera.resize(e,t),this.notifyChange(this.camera3D)))}}const TA=MA,BA=1e3/60,PA=function(e){e.id&&(clearInterval(e.id),e.id=void 0),e.waitTimer&&(clearInterval(e.waitTimer),e.waitTimer=void 0),e.keyframe=0},RA=function(e){PA(e),e.isEnded()&&e.dispatchEvent({type:"animation-ended"}),e.dispatchEvent({type:"animation-stopped"}),e.duration=0};class DA extends s.EventDispatcher{constructor(){super(),this.id=null,this.keyframe=0,this.duration=0,this.state=0,this.waitTimer=null,this.callback=()=>{}}isPlaying(){return 1===this.state}isStopped(){return 0===this.state}isEnded(){return 2===this.state}setCallback(e){this.callback=e}play(e){this.duration=e,this.dispatchEvent({type:"animation-started"}),this.state=1,PA(this),this.id=setInterval(this.frame.bind(this),BA)}playLater(e,t){const r=Math.floor(BA*t);window.clearInterval(this.waitTimer);const n=this;this.waitTimer=window.setTimeout((()=>{n.play(e)}),r)}stop(){this.state=0,RA(this)}frame(){this.keyframe<this.duration?(this.keyframe++,this.dispatchEvent({type:"animation-frame"}),this.callback()):(this.state=2,RA(this))}}const LA=DA;var kA=r(50040);s.Object3D.DEFAULT_UP.set(0,0,1);const OA=new s.Vector3,FA=new i.E$("EPSG:4326",0,0,0),NA=new i.C1,UA=[],QA=new ch,GA=new s.Vector3;function zA(e){return e-360*Math.floor((e+180)/360)}function jA(e){return e.getLayers((e=>e.isTiledGeometryLayer))[0]}class VA extends s.Object3D{constructor(){super(),this.seaLevel=new s.Object3D,this.target=new s.Object3D,this.target.rotation.order="ZXY",this.camera=new s.Camera,this.add(this.seaLevel),this.seaLevel.add(this.target),this.target.add(this.camera),this.coord=new i.E$("EPSG:4978",0,0),this.targetWorldPosition=new s.Vector3,this.removeAll=()=>{},this._onChangeCallback=null}applyTransformToCamera(e,t){this.proxy?(t.quaternion._onChange(this._onChangeCallback),this.camera.matrixWorld.decompose(this.proxy.position,t.quaternion,t.scale),t.quaternion._onChange((()=>this.removeProxy(e,t)))):this.camera.matrixWorld.decompose(t.position,t.quaternion,t.scale),e.dispatchEvent({type:mA.CAMERA_MOVED,coord:this.coord,range:this.range,heading:this.heading,tilt:this.tilt})}setProxy(e,t){!this.proxy&&e&&t&&(this.proxy={position:new s.Vector3},Object.keys(t.position).forEach((r=>function(e,t,r,n){r.proxy.position[n]=t.position[n],Object.defineProperty(t.position,n,{get:()=>r.proxy.position[n],set:i=>{r.removeProxy(e,t),t.position[n]=i}})}(e,t,this,r))),this._onChangeCallback=t.quaternion._onChangeCallback,t.quaternion._onChange((()=>this.removeProxy(e,t))))}removeProxy(e,t){this.stop(e),this.proxy&&e&&t&&(Object.keys(t.position).forEach((e=>Object.defineProperty(t.position,e,{value:this.proxy.position[e],writable:!0}))),t.quaternion._onChange(this._onChangeCallback),this.proxy=null)}setTargetFromCoordinate(e,t){t.as(jA(e).extent.crs,this.coord);const r=Math.max(0,u.getElevationValueAt(jA(e),this.coord,u.PRECISE_READ_Z)||this.coord.z);this.coord.z=r,this.coord.as(e.referenceCrs).toVector3(OA),"EPSG:4978"==e.referenceCrs?(this.lookAt(OA),this.seaLevel.position.set(0,0,OA.length()-r)):(this.position.set(OA.x,OA.y,0),this.seaLevel.position.set(0,0,0)),this.target.position.set(0,0,r)}setFromPositions(e,t){this.setTargetFromCoordinate(e,new i.E$(e.referenceCrs).setFromVector3(OA)),this.target.rotation.set(0,0,0),this.updateMatrixWorld(!0),this.camera.position.copy(t),this.target.worldToLocal(this.camera.position);const r=this.camera.position.length();this.target.rotation.x=Math.asin(this.camera.position.z/r);const n=s.MathUtils.clamp(this.camera.position.y/(Math.cos(this.target.rotation.x)*r),-1,1);this.target.rotation.z=Math.sign(-this.camera.position.x||1)*Math.acos(n),this.camera.position.set(0,r,0)}applyParams(e,t){t.coord&&this.setTargetFromCoordinate(e,t.coord),null!=t.tilt&&(this.target.rotation.x=s.MathUtils.degToRad(t.tilt)),null!=t.heading&&(this.target.rotation.z=s.MathUtils.degToRad(-zA(t.heading+180))),t.range&&this.camera.position.set(0,t.range,0),this.camera.rotation.set(.5*-Math.PI,0,Math.PI),this.updateMatrixWorld(!0),this.targetWorldPosition.setFromMatrixPosition(this.seaLevel.matrixWorld)}getParams(){return{coord:this.coord.clone(),tilt:this.tilt,heading:this.heading,range:this.range,targetWorldPosition:this.targetWorldPosition}}setfromCamera(e,t,r){t.updateMatrixWorld(!0),null==r&&(r=e.getPickingPositionFromDepth()||function(e,t){const r=new s.Vector3(0,0,.5);if(r.unproject(t),r.sub(t.position).normalize(),"EPSG:4978"==e.referenceCrs)return NA.intersection({direction:r,origin:t.position});{const e=t.position.z/r.z;return r.multiplyScalar(e).add(t.position)}}(e,t));const n=r&&!isNaN(r.x)?t.position.distanceTo(r):100;t.localToWorld(OA.set(0,0,-n)),this.setFromPositions(e,t.position)}copyObject3D(e){return this.copy(e,!1),this.seaLevel.copy(e.seaLevel,!1),this.target.copy(e.target,!1),this.camera.copy(e.camera),this}animateCameraToLookAtTarget(e,t,r){r.easing=r.easing||kA.Ay.Easing.Quartic.InOut,this.setfromCamera(e,t);const n=new kA.Ay.Group;this.start=(this.start||new VA).copyObject3D(this),this.end=(this.end||new VA).copyObject3D(this);const i=r.time||2500,o={t:0},a=[],l=(()=>{let e,t;return{promise:new Promise(((r,n)=>{e=r,t=n})),resolve:e,reject:t}})();this.addPlaceTargetOnGround(e,t,r.coord,o),this.end.applyParams(e,r);const c=this.end.target.rotation.z-this.start.target.rotation.z;return Math.abs(c)>Math.PI&&(this.end.target.rotation.z=this.start.target.rotation.z+c-2*Math.sign(c)*Math.PI),a.push(new kA.Ay.Tween(o).to({t:1},i).easing(r.easing).onUpdate((t=>{"EPSG:4978"==e.referenceCrs&&this.quaternion.slerpQuaternions(this.start.quaternion,this.end.quaternion,t.t),this.camera.quaternion.slerpQuaternions(this.start.camera.quaternion,this.end.camera.quaternion,t.t),this.target.rotation.set(0,0,0),this.target.rotateZ(s.MathUtils.lerp(this.start.target.rotation.z,this.end.target.rotation.z,t.t)),this.target.rotateX(s.MathUtils.lerp(this.start.target.rotation.x,this.end.target.rotation.x,t.t))}))),"EPSG:4978"!=e.referenceCrs&&a.push(new kA.Ay.Tween(this.position).to(this.end.position,i).easing(r.easing)),a.push(new kA.Ay.Tween(this.seaLevel.position).to(this.end.seaLevel.position,i).easing(r.easing)),a.push(new kA.Ay.Tween(this.camera.position).to(this.end.camera.position,i).easing(r.easing)),n.add(...a),this.animationFrameRequester=()=>{n.update(),this.updateMatrixWorld(!0),this.applyTransformToCamera(e,t),this.targetWorldPosition.setFromMatrixPosition(this.seaLevel.matrixWorld),r.callback&&r.callback(this),FA.crs=e.referenceCrs,FA.setFromVector3(this.targetWorldPosition).as(jA(e).extent.crs,this.coord),e.notifyChange(t)},this.removeAll=function(t){this.removeAll=()=>{},n.removeAll(),this.animationFrameRequester&&e.removeFrameRequester(M.BEFORE_RENDER,this.animationFrameRequester),l.resolve(void 0!==t),this.animationFrameRequester=null},a[a.length-1].onComplete(this.removeAll),a.forEach((e=>e.start())),e.addFrameRequester(M.BEFORE_RENDER,this.animationFrameRequester),e.notifyChange(t),l}stop(e){this.removePlaceTargetOnGround(e),this.removeAll()}addPlaceTargetOnGround(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{t:1};if(this.removePlaceTargetOnGround(e),e&&t){const i=this.target.position.z;this.placeTargetOnGround=()=>{const s=Math.max(0,u.getElevationValueAt(jA(e),r||this.coord,u.PRECISE_READ_Z)||0);this.target.position.z=i*(1-n.t)+s*n.t,this.target.updateMatrixWorld(!0),this.applyTransformToCamera(e,t)},this.placeTargetOnGround(),e.addFrameRequester(M.BEFORE_RENDER,this.placeTargetOnGround)}}removePlaceTargetOnGround(e){e&&this.placeTargetOnGround&&(e.removeFrameRequester(M.BEFORE_RENDER,this.placeTargetOnGround),this.placeTargetOnGround=null)}get tilt(){return s.MathUtils.radToDeg(this.target.rotation.x)}get heading(){return-zA(s.MathUtils.radToDeg(this.target.rotation.z)+180)}get range(){return this.camera.position.y}}function qA(e){return UA[e.uuid]=UA[e.uuid]||new VA,UA[e.uuid]}const HA={defaultStopPlaceOnGroundAtEnd:!1,Easing:kA.Ay.Easing,stop(e,t){qA(t).stop(e)},getTransformCameraLookingAtTarget(e,t,r){const n=qA(t);return n.setfromCamera(e,t,r),n.getParams()},transformCameraToLookAtTarget(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r.isExtent&&(r=this.getCameraTransformOptionsFromExtent(e,t,r)),r.proxy=void 0===r.proxy||r.proxy;const n=qA(t);return n.stop(e),n.setfromCamera(e,t),r.proxy&&n.setProxy(e,t),n.applyParams(e,r),n.addPlaceTargetOnGround(e,t,r.coord),n.applyTransformToCamera(e,t),e.notifyChange(t),Promise.resolve(n.getParams())},getCameraTransformOptionsFromExtent(e,t,r){const n={coord:new i.E$(r.crs,0,0,0),heading:0,tilt:e.isPlanarView?90:89.9};let o;if(e.isGlobeView?(r=r.as("EPSG:4326"),QA.setFromExtent(r),QA.box3D.getSize(GA),o={x:GA.y,y:GA.x}):o=(r=r.as(e.referenceCrs)).planarDimensions(),r.center(n.coord),t.isOrthographicCamera)o.x/o.y>t.aspect?t.zoom=(t.right-t.left)/o.x:t.zoom=(t.top-t.bottom)/o.y,t.updateProjectionMatrix(),n.range=1e3;else if(t.isPerspectiveCamera){const r=s.MathUtils.degToRad(t.fov);if(o.x/o.y>t.aspect){const t=.5*e.domElement.clientHeight/Math.tan(.5*r),i=2*Math.atan(.5*e.domElement.clientWidth/t);n.range=o.x/(2*Math.tan(.5*i))}else n.range=o.y/(2*Math.tan(.5*r))}return n},animateCameraToLookAtTarget(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r.proxy=void 0===r.proxy||r.proxy;const n=qA(t);return n.stop(e),r.proxy&&n.setProxy(e,t),n.animateCameraToLookAtTarget(e,t,r).promise.then((t=>{const i=void 0===r.stopPlaceOnGroundAtEnd?this.defaultStopPlaceOnGroundAtEnd:r.stopPlaceOnGroundAtEnd,s=n.getParams();return i&&n.stop(e),s.finished=t,s}))},sequenceAnimationsToLookAtTarget(e,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:[{}]).map((r=>()=>this.animateCameraToLookAtTarget(e,t,r))).reduce(((e,t)=>e.then((e=>!e.length||e[e.length-1].finished?t().then(Array.prototype.concat.bind(e)):Promise.resolve([{finished:!1}])))),Promise.resolve([]))},getDiffParams(e,t){if(!e||!t)return;let r;return Math.abs(e.range-t.range)/e.range>.001&&(r=r||{},r.range={previous:e.range,new:t.range}),Math.abs(e.tilt-t.tilt)>.1&&(r=r||{},r.tilt={previous:e.tilt,new:t.tilt}),Math.abs(e.heading-t.heading)>.1&&(r=r||{},r.heading={previous:e.heading,new:t.heading}),(Math.abs(e.coord.x-t.coord.x)>1e-6||Math.abs(e.coord.y-t.coord.y)>1e-6)&&(r=r||{},r.coord={previous:e.coord,new:t.coord}),r}},WA={ORBIT:{enable:!0,mouseButton:s.MOUSE.LEFT,double:!1,keyboard:17,finger:2,_event:"rotate"},MOVE_GLOBE:{enable:!0,mouseButton:s.MOUSE.LEFT,double:!1,finger:1,_event:"drag"},DOLLY:{enable:!0,mouseButton:s.MOUSE.MIDDLE,double:!1,finger:2,_event:"dolly"},PAN:{enable:!0,mouseButton:s.MOUSE.RIGHT,double:!1,finger:3,_event:"pan"},PANORAMIC:{enable:!0,mouseButton:s.MOUSE.LEFT,double:!1,keyboard:16,_event:"panoramic"},TRAVEL_IN:{enable:!0,mouseButton:s.MOUSE.LEFT,double:!0,_event:"travel_in",_trigger:!0,_direction:"in"},TRAVEL_OUT:{enable:!1,double:!1,_event:"travel_out",_trigger:!0,_direction:"out"},ZOOM:{enable:!0,_event:"zoom",_trigger:!0},PAN_UP:{enable:!0,keyboard:38,double:!1,_event:"pan",_trigger:!0,_direction:"up"},PAN_BOTTOM:{enable:!0,keyboard:40,double:!1,_event:"pan",_trigger:!0,_direction:"bottom"},PAN_LEFT:{enable:!0,keyboard:37,double:!1,_event:"pan",_trigger:!0,_direction:"left"},PAN_RIGHT:{enable:!0,keyboard:39,double:!1,_event:"pan",_trigger:!0,_direction:"right"}},$A=new s.Vector2;class YA extends s.EventDispatcher{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this._view=e,this._domElement=e.domElement;let r=!0;Object.defineProperty(this,"enabled",{get:()=>r,set:e=>{e||(this.onKeyUp(),this.onPointerUp()),r=e}});let n=!0;Object.defineProperty(this,"enableKeys",{get:()=>n,set:e=>{e||this.onKeyUp(),n=e}}),this.NONE={};let i=this.NONE;Object.defineProperty(this,"currentState",{get:()=>i,set:e=>{if(i!==e){const t=i;i=e,this.dispatchEvent({type:"state-changed",viewCoords:$A,previous:t})}}}),this._clickTimeStamp=0,this._lastMousePressed={viewCoords:new s.Vector2},this._currentMousePressed=void 0,this._currentKeyPressed=void 0,this._onPointerDown=this.onPointerDown.bind(this),this._onPointerMove=this.onPointerMove.bind(this),this._onPointerUp=this.onPointerUp.bind(this),this._onMouseWheel=this.onMouseWheel.bind(this),this._onKeyDown=this.onKeyDown.bind(this),this._onKeyUp=this.onKeyUp.bind(this),this._onBlur=this.onBlur.bind(this),this._onContextMenu=this.onContextMenu.bind(this),this._domElement.addEventListener("pointerdown",this._onPointerDown,!1),this._domElement.addEventListener("wheel",this._onMouseWheel,!1),this._domElement.addEventListener("keydown",this._onKeyDown,!1),this._domElement.addEventListener("keyup",this._onKeyUp,!1),this._domElement.addEventListener("blur",this._onBlur),this._domElement.addEventListener("contextmenu",this._onContextMenu,!1),this.setFromOptions(t)}inputToState(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(const n of Object.keys(WA)){const i=this[n];if(i.enable&&i.mouseButton===e&&i.keyboard===t&&i.double===r){if(!i._trigger)return i;this.dispatchEvent({type:i._event,viewCoords:void 0!==e&&$A,direction:i._direction})}}return this.NONE}touchToState(e){for(const t of Object.keys(WA)){const r=this[t];if(r.enable&&e===r.finger)return r}return this.NONE}setFromOptions(e){for(const t in WA)if({}.hasOwnProperty.call(WA,t)){let r={};r=e[t]||this[t]||Object.assign(r,WA[t]),e[t]&&void 0===e[t].enable&&(r.enable=this[t].enable),r.double=!!r.double,r._event=WA[t]._event,r._trigger=WA[t]._trigger,r._direction=WA[t]._direction,this[t]=r}}onPointerDown(e){this.enabled&&($A.copy(this._view.eventToViewCoords(e)),"mouse"===e.pointerType&&(this._currentMousePressed=e.button,void 0===this._currentKeyPressed&&(e.ctrlKey?this._currentKeyPressed=17:e.shiftKey?this._currentKeyPressed=16:e.metaKey&&(this._currentKeyPressed=91)),this.currentState=this.inputToState(this._currentMousePressed,this._currentKeyPressed,e.timeStamp-this._clickTimeStamp<500&&this._lastMousePressed.button===this._currentMousePressed&&this._lastMousePressed.viewCoords.distanceTo($A)<5),this._clickTimeStamp=e.timeStamp,this._lastMousePressed.button=this._currentMousePressed,this._lastMousePressed.viewCoords.copy($A)),this._domElement.addEventListener("pointermove",this._onPointerMove,!1),this._domElement.addEventListener("pointerup",this._onPointerUp,!1),this._domElement.addEventListener("mouseleave",this._onPointerUp,!1))}onPointerMove(e){e.preventDefault(),this.enabled&&($A.copy(this._view.eventToViewCoords(e)),"mouse"===e.pointerType)&&this.dispatchEvent({type:this.currentState._event,viewCoords:$A})}onPointerUp(){this.enabled&&(this._currentMousePressed=void 0,this._domElement.removeEventListener("pointermove",this._onPointerMove,!1),this._domElement.removeEventListener("pointerup",this._onPointerUp,!1),this._domElement.removeEventListener("mouseleave",this._onPointerUp,!1),this.currentState=this.NONE)}onMouseWheel(e){e.preventDefault(),this.enabled&&this.ZOOM.enable&&($A.copy(this._view.eventToViewCoords(e)),this.currentState=this.ZOOM,this.dispatchEvent({type:this.ZOOM._event,delta:e.deltaY,viewCoords:$A}))}onKeyDown(e){this.enabled&&this.enableKeys&&(this._currentKeyPressed=e.keyCode,this.inputToState(this._currentMousePressed,this._currentKeyPressed))}onKeyUp(){this.enabled&&this.enableKeys&&(this._currentKeyPressed=void 0,void 0===this._currentMousePressed&&(this.currentState=this.NONE))}onBlur(){this.onKeyUp(),this.onPointerUp()}onContextMenu(e){e.preventDefault()}dispose(){this._clickTimeStamp=0,this._lastMousePressed=void 0,this._currentKeyPressed=void 0,this._domElement.removeEventListener("pointerdown",this._onPointerDown,!1),this._domElement.removeEventListener("pointermove",this._onPointerMove,!1),this._domElement.removeEventListener("pointerup",this._onPointerUp,!1),this._domElement.removeEventListener("wheel",this._onMouseWheel,!1),this._domElement.removeEventListener("keydown",this._onKeyDown,!1),this._domElement.removeEventListener("keyup",this._onKeyUp,!1),this._domElement.removeEventListener("blur",this._onBlur),this._domElement.removeEventListener("contextmenu",this._onContextMenu,!1)}}const KA=YA,JA=1e-6,XA={up:new s.Vector2(0,1),bottom:new s.Vector2(0,-1),left:new s.Vector2(1,0),right:new s.Vector2(-1,0)},ZA=new s.Vector2,em=new s.Vector2,tm=new s.Vector2,rm=new s.Spherical(1,.01,0),nm=new s.Spherical(1,0,0);let im=1;const sm=new s.Vector2,om=new s.Vector2,am=new s.Vector2,lm=new s.Vector3,cm=new s.Vector2,hm=new s.Vector2,um=new s.Vector2;let dm;const pm=new s.Quaternion,fm=new s.Object3D,gm=new i.E$("EPSG:4978");fm.matrixWorldInverse=new s.Matrix4;const Am=new i.E$("EPSG:4978",0,0,0),mm=new i.E$("EPSG:4326",0,0,0);function ym(e,t){Am.setFromVector3(e).as("EPSG:4326",mm),t.position.copy(e),t.lookAt(mm.geodesicNormal.add(e)),t.rotateX(.5*Math.PI),t.updateMatrixWorld(!0)}let vm=0,wm=!0;const bm=new s.Quaternion(0,0,0,1),Em=new s.Vector3,xm=new s.Vector3,Cm=new s.Quaternion,_m=new s.Sphere,Im=new s.Vector3,Sm=new s.Vector3,Mm={},Tm={PAN_CHANGED:"pan-changed",ORIENTATION_CHANGED:"orientation-changed",RANGE_CHANGED:"range-changed",CAMERA_TARGET_CHANGED:"camera-target-changed"},Bm=new s.Quaternion,Pm=new s.Quaternion,Rm=new s.Vector3(1,0,0);let Dm=1/0;const Lm=new s.Vector3,km=new s.Vector3,Om=new s.Raycaster,Fm=new s.Vector3,Nm=new s.Vector3,Um=new s.Sphere;let Qm;class Gm extends s.EventDispatcher{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),this.player=new LA,this.view=e,this.camera=e.camera3D,this.states=new KA(this.view,r.stateControl),Object.defineProperty(this,"enabled",{get:()=>this.states.enabled,set:e=>{console.warn("GlobeControls.enabled property is deprecated. Use StateControl.enabled instead - which you can access with GlobeControls.states.enabled."),this.states.enabled=e}}),r.zoomSpeed&&(console.warn("Controls zoomSpeed parameter is deprecated. Use zoomFactor instead."),r.zoomFactor=r.zoomFactor||r.zoomSpeed),this.zoomFactor=r.zoomFactor||1.1,this.minDistance=r.minDistance||250,this.maxDistance=r.maxDistance||8*i.Ql.x,this.minZoom=r.minZoom||0,this.maxZoom=r.maxZoom||1/0,this.rotateSpeed=r.rotateSpeed||.25,this.keyPanSpeed=r.keyPanSpeed||7,this.minPolarAngle=s.MathUtils.degToRad(r.minPolarAngle??.5),this.maxPolarAngle=s.MathUtils.degToRad(r.minPolarAngle??86),this.minAzimuthAngle=r.minAzimuthAngle?s.MathUtils.degToRad(r.minAzimuthAngle):-1/0,this.maxAzimuthAngle=r.maxAzimuthAngle?s.MathUtils.degToRad(r.maxAzimuthAngle):1/0,this.handleCollision=void 0===r.handleCollision||r.handleCollision,this.minDistanceCollision=60,Object.defineProperty(this,"enableKeys",{get:()=>this.states.enableKeys,set:e=>{console.warn("GlobeControls.enableKeys property is deprecated. Use StateControl.enableKeys instead - which you can access with GlobeControls.states.enableKeys."),this.states.enableKeys=e}}),this.enableDamping=!1!==r.enableDamping,this.dampingMoveFactor=null!=r.dampingMoveFactor?r.dampingMoveFactor:.25,this.startEvent={type:"start"},this.endEvent={type:"end"},this.updateHelper=function(){},this._onEndingMove=null,this._onTravel=this.travel.bind(this),this._onTouchStart=this.onTouchStart.bind(this),this._onTouchEnd=this.onTouchEnd.bind(this),this._onTouchMove=this.onTouchMove.bind(this),this._onStateChange=this.onStateChange.bind(this),this._onRotation=this.handleRotation.bind(this),this._onDrag=this.handleDrag.bind(this),this._onDolly=this.handleDolly.bind(this),this._onPan=this.handlePan.bind(this),this._onPanoramic=this.handlePanoramic.bind(this),this._onZoom=this.handleZoom.bind(this),this.states.addEventListener("state-changed",this._onStateChange,!1),this.states.addEventListener(this.states.ORBIT._event,this._onRotation,!1),this.states.addEventListener(this.states.MOVE_GLOBE._event,this._onDrag,!1),this.states.addEventListener(this.states.DOLLY._event,this._onDolly,!1),this.states.addEventListener(this.states.PAN._event,this._onPan,!1),this.states.addEventListener(this.states.PANORAMIC._event,this._onPanoramic,!1),this.states.addEventListener("zoom",this._onZoom,!1),this.view.domElement.addEventListener("touchstart",this._onTouchStart,!1),this.view.domElement.addEventListener("touchend",this._onTouchEnd,!1),this.view.domElement.addEventListener("touchmove",this._onTouchMove,!1),this.states.addEventListener(this.states.TRAVEL_IN._event,this._onTravel,!1),this.states.addEventListener(this.states.TRAVEL_OUT._event,this._onTravel,!1),e.scene.add(fm),t.isExtent?t.center().as("EPSG:4978",Am):(t.coord.as("EPSG:4978",Am),t.tilt=t.tilt||89.5,t.heading=t.heading||0),ym(Am,fm),this.lookAtCoordinate(t,!1),gm.crs=this.view.referenceCrs}get zoomInScale(){return this.zoomFactor}get zoomOutScale(){return 1/this.zoomFactor}get isPaused(){return this.states.currentState===this.states.NONE&&!this.player.isPlaying()}onEndingMove(e){this._onEndingMove&&(this.player.removeEventListener("animation-stopped",this._onEndingMove),this._onEndingMove=null),this.handlingEvent(e)}rotateLeft(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;nm.theta-=e}rotateUp(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;nm.phi-=e}panLeft(e){const t=this.camera.matrix.elements;lm.fromArray(t),lm.multiplyScalar(-e),Em.add(lm)}panUp(e){const t=this.camera.matrix.elements;lm.fromArray(t,4),lm.multiplyScalar(e),Em.add(lm)}mouseToPan(e,t){const r=this.view.mainLoop.gfxEngine;if(this.camera.isPerspectiveCamera){let n=this.camera.position.distanceTo(this.getCameraTargetPosition());n*=2*Math.tan(s.MathUtils.degToRad(.5*this.camera.fov)),this.panLeft(e*n/r.width*this.camera.aspect),this.panUp(t*n/r.height)}else this.camera.isOrthographicCamera&&(this.panLeft(e*(this.camera.right-this.camera.left)/r.width),this.panUp(t*(this.camera.top-this.camera.bottom)/r.height))}dolly(e){0!==e&&(dm=e>0?this.zoomInScale:this.zoomOutScale,this.camera.isPerspectiveCamera?im/=dm:this.camera.isOrthographicCamera&&(this.camera.zoom=s.MathUtils.clamp(this.camera.zoom*dm,this.minZoom,this.maxZoom),this.camera.updateProjectionMatrix(),this.view.notifyChange(this.camera)))}getMinDistanceCameraBoundingSphereObbsUp(e){if(e.level>10&&1==e.children.length&&e.geometry){const t=e.obb;Um.center.copy(this.camera.position),Um.radius=this.minDistanceCollision,t.isSphereAboveXYBox(Um)&&(Dm=Math.min(Um.center.z-t.box3D.max.z,Dm))}}update(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.states.currentState;if(Dm=1/0,this.handleCollision&&this.view.tileLayer)for(const e of this.view.tileLayer.level0Nodes)e.traverse(this.getMinDistanceCameraBoundingSphereObbsUp.bind(this));switch(e){case this.states.MOVE_GLOBE:if(Dm<0)fm.translateY(-Dm),this.camera.position.setLength(this.camera.position.length()-Dm);else if(Dm<this.minDistanceCollision){const e=this.minDistanceCollision*(1-Dm/this.minDistanceCollision);fm.translateY(e),this.camera.position.setLength(this.camera.position.length()+e)}Lm.copy(km).applyQuaternion(pm),fm.position.applyQuaternion(pm),this.camera.position.applyQuaternion(pm);break;case this.states.PAN:this.camera.position.add(Em),fm.position.add(Em);break;case this.states.PANORAMIC:{this.camera.worldToLocal(fm.position);const e=this.camera.position.clone().normalize().applyQuaternion(this.camera.quaternion.clone().invert());Bm.setFromAxisAngle(e,nm.theta).multiply(Pm.setFromAxisAngle(Rm,nm.phi)),fm.position.applyQuaternion(Bm),this.camera.localToWorld(fm.position);break}default:{this.camera.position.applyMatrix4(fm.matrixWorldInverse),(nm.theta||nm.phi)&&rm.setFromVector3(this.camera.position);const e=rm.radius*Math.sin(this.minPolarAngle),t=8*e,r=2*e,n=-.01;if(this.handleCollision)if(Dm<t&&Dm>r&&nm.phi>0){const e=t-r,n=1-(e-(Dm-r))/e;nm.phi*=n*n}else if(Dm<r&&Dm>-r&&nm.phi>n){let e=-Math.asin(.25*(r-Dm)/rm.radius);e=s.MathUtils.clamp(e,n,0);const t=1-(r-Dm)/(2*r);nm.phi=s.MathUtils.lerp(nm.phi,e,t),Dm-=Math.sin(nm.phi)*rm.radius}rm.theta+=nm.theta,rm.phi+=nm.phi,rm.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,rm.theta)),rm.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,rm.phi)),rm.radius=this.camera.position.length()*im,rm.makeSafe(),rm.radius=Math.max(this.minDistance,Math.min(this.maxDistance,rm.radius)),this.camera.position.setFromSpherical(rm),Dm<0&&(this.camera.position.y-=Dm,rm.setFromVector3(this.camera.position),nm.phi=0),fm.localToWorld(this.camera.position)}}this.camera.up.copy(fm.position).normalize(),this.camera.lookAt(fm.position),this.enableDamping?(nm.theta*=.75,nm.phi*=.75,pm.slerp(bm,.2*this.dampingMoveFactor)):(nm.theta=0,nm.phi=0,pm.set(0,0,0,1)),im=1,Em.set(0,0,0),(xm.distanceToSquared(this.camera.position)>JA||8*(1-Cm.dot(this.camera.quaternion))>JA)&&(this.view.notifyChange(this.camera),xm.copy(this.camera.position),Cm.copy(this.camera.quaternion)),this.enableDamping&&e===this.states.ORBIT&&this.player.isStopped()&&(nm.theta>JA||nm.phi>JA)&&(this.player.setCallback((()=>{this.update(this.states.ORBIT)})),this.player.playLater(60,2)),this.view.dispatchEvent({type:mA.CAMERA_MOVED,coord:gm.setFromVector3(fm.position),range:rm.radius,heading:-s.MathUtils.radToDeg(rm.theta),tilt:90-s.MathUtils.radToDeg(rm.phi)})}onStateChange(e){this.states.currentState!==this.states.NONE?(HA.stop(this.view,this.camera),this.onEndingMove(),this.player.stop(),this.updateTarget(),Qm=HA.getTransformCameraLookingAtTarget(this.view,this.camera,Nm),ZA.copy(e.viewCoords),this.view.getPickingPositionFromDepth(e.viewCoords,Im)&&(_m.radius=Im.length(),Lm.copy(Im).normalize(),this.updateHelper(Im,Mm.picking)),cm.copy(e.viewCoords),this.view.getPickingPositionFromDepth(e.viewCoords,Nm),sm.copy(e.viewCoords)):this.handleEndMovement(e)}handleRotation(e){this.player.stop(),this.handlePanoramic(e)}handleDrag(e){const t=this.view.viewToNormalizedCoords(e.viewCoords);this.camera.updateMatrixWorld(),Om.setFromCamera(t,this.camera),Om.ray.intersectSphere(_m,Sm)?(km.copy(Sm).normalize(),pm.setFromUnitVectors(km,Lm),vm=Date.now(),this.update()):this.states.onPointerUp()}handleDolly(e){hm.copy(e.viewCoords),um.subVectors(hm,cm),cm.copy(hm),e.delta=um.y,0!=e.delta&&this.handleZoom(e)}handlePan(e){e.viewCoords?(om.copy(e.viewCoords),am.subVectors(om,sm),sm.copy(om)):e.direction&&am.copy(XA[e.direction]).multiplyScalar(this.keyPanSpeed),this.mouseToPan(am.x,am.y),this.update(this.states.PAN)}handlePanoramic(e){em.copy(e.viewCoords),tm.subVectors(em,ZA);const t=this.view.mainLoop.gfxEngine;nm.theta-=2*Math.PI*tm.x/t.width*this.rotateSpeed,nm.phi-=2*Math.PI*tm.y/t.height*this.rotateSpeed,ZA.copy(em),this.update()}handleEndMovement(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.dispatchEvent(this.endEvent),this.player.stop(),this.enableDamping?e.previous===this.states.ORBIT&&(nm.theta>JA||nm.phi>JA)?(this.player.setCallback((()=>{this.update(this.states.ORBIT)})),this.player.play(60),this._onEndingMove=()=>this.onEndingMove(),this.player.addEventListener("animation-stopped",this._onEndingMove)):e.previous===this.states.MOVE_GLOBE&&Date.now()-vm<50?(this.player.setCallback((()=>{this.update(this.states.MOVE_GLOBE)})),this.player.play(120),this._onEndingMove=()=>this.onEndingMove(),this.player.addEventListener("animation-stopped",this._onEndingMove)):this.onEndingMove():this.onEndingMove()}updateTarget(){if(this.view.getPickingPositionFromDepth(null,Nm)){const e=isNaN(Nm.x)?100:this.camera.position.distanceTo(Nm);Fm.set(0,0,-e),this.camera.localToWorld(Fm),ym(Fm,fm),fm.matrixWorldInverse.copy(fm.matrixWorld).invert(),Fm.copy(this.camera.position),Fm.applyMatrix4(fm.matrixWorldInverse),rm.setFromVector3(Fm)}}handlingEvent(e){e=e||HA.getTransformCameraLookingAtTarget(this.view,this.camera);const t=HA.getDiffParams(Qm,e);if(t&&(t.range&&this.dispatchEvent({type:Tm.RANGE_CHANGED,previous:t.range.previous,new:t.range.new}),t.coord&&this.dispatchEvent({type:Tm.CAMERA_TARGET_CHANGED,previous:t.coord.previous,new:t.coord.new}),t.tilt||t.heading)){const e={type:Tm.ORIENTATION_CHANGED};t.tilt&&(e.previous={tilt:t.tilt.previous},e.new={tilt:t.tilt.new}),t.heading&&(e.previous=e.previous||{},e.new=e.new||{},e.new.heading=t.heading.new,e.previous.heading=t.heading.previous),this.dispatchEvent(e)}}travel(e){this.player.stop();const t=this.view.getPickingPositionFromDepth(e.viewCoords),r=this.getRange(t);if(t&&r>this.minDistance)return this.lookAtCoordinate({coord:new i.E$("EPSG:4978").setFromVector3(t),range:r*("out"===e.direction?1/.6:.6),time:1500})}handleZoom(e){this.player.stop(),HA.stop(this.view,this.camera);const t=e.delta>0?this.zoomInScale:this.zoomOutScale;let r="dolly"===e.type?Nm:this.view.getPickingPositionFromDepth(e.viewCoords),n=this.getRange();if(n*=t,r&&n>this.minDistance&&n<this.maxDistance){const e=Am.setFromVector3(fm.position).as("EPSG:4326",mm).toVector3();return r=Am.setFromVector3(r).as("EPSG:4326",mm).toVector3(),e.x*r.x<0&&(e.x-r.x>180?r.x+=360:r.x-e.x>180&&(e.x+=360)),r.lerp(e,t),r=mm.setFromVector3(r).as("EPSG:4978",Am),this.lookAtCoordinate({coord:r,range:n},!1)}}onTouchStart(e){if(this.player.stop(),!1!==this.states.enabled&&(this.state=this.states.touchToState(e.touches.length),this.updateTarget(),this.state!==this.states.NONE)){switch(this.state){case this.states.MOVE_GLOBE:{const t=this.view.eventToViewCoords(e);this.view.getPickingPositionFromDepth(t,Im)?(_m.radius=Im.length(),Lm.copy(Im).normalize(),this.updateHelper(Im,Mm.picking)):this.state=this.states.NONE;break}case this.states.ORBIT:case this.states.DOLLY:{const t=e.touches[0].pageX,r=e.touches[0].pageY,n=t-e.touches[1].pageX,i=r-e.touches[1].pageY,s=Math.sqrt(n*n+i*i);cm.set(0,s),ZA.set(t,r);break}case this.states.PAN:sm.set(e.touches[0].pageX,e.touches[0].pageY)}this.dispatchEvent(this.startEvent)}}onTouchMove(e){if(this.player.isPlaying()&&this.player.stop(),!1!==this.states.enabled){switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case this.states.MOVE_GLOBE.finger:{const t=this.view.eventToViewCoords(e),r=this.view.viewToNormalizedCoords(t);this.camera.updateMatrixWorld(),Om.setFromCamera(r,this.camera),Om.ray.intersectSphere(_m,Sm)?(km.copy(Sm).normalize(),pm.setFromUnitVectors(km,Lm),vm=Date.now()):this.onTouchEnd();break}case this.states.ORBIT.finger:case this.states.DOLLY.finger:{const t=this.view.mainLoop.gfxEngine;em.set(e.touches[0].pageX,e.touches[0].pageY),tm.subVectors(em,ZA),this.rotateLeft(2*Math.PI*tm.x/t.width*this.rotateSpeed),this.rotateUp(2*Math.PI*tm.y/t.height*this.rotateSpeed),ZA.copy(em);const r=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(r*r+n*n);hm.set(0,i),um.subVectors(hm,cm),this.dolly(um.y),cm.copy(hm);break}case this.states.PAN.finger:om.set(e.touches[0].pageX,e.touches[0].pageY),am.subVectors(om,sm),this.mouseToPan(am.x,am.y),sm.copy(om);break;default:this.state=this.states.NONE}this.state!==this.states.NONE&&this.update(this.state)}}onTouchEnd(){this.handleEndMovement({previous:this.state}),this.state=this.states.NONE}dispose(){this.view.domElement.removeEventListener("touchstart",this._onTouchStart,!1),this.view.domElement.removeEventListener("touchend",this._onTouchEnd,!1),this.view.domElement.removeEventListener("touchmove",this._onTouchMove,!1),this.states.dispose(),this.states.removeEventListener("state-changed",this._onStateChange,!1),this.states.removeEventListener(this.states.ORBIT._event,this._onRotation,!1),this.states.removeEventListener(this.states.MOVE_GLOBE._event,this._onDrag,!1),this.states.removeEventListener(this.states.DOLLY._event,this._onDolly,!1),this.states.removeEventListener(this.states.PAN._event,this._onPan,!1),this.states.removeEventListener(this.states.PANORAMIC._event,this._onPanoramic,!1),this.states.removeEventListener("zoom",this._onZoom,!1),this.states.removeEventListener(this.states.TRAVEL_IN._event,this._onTravel,!1),this.states.removeEventListener(this.states.TRAVEL_OUT._event,this._onTravel,!1),this.dispatchEvent({type:"dispose"})}setTilt(e,t){return this.lookAtCoordinate({tilt:e},t)}setHeading(e,t){return this.lookAtCoordinate({heading:e},t)}setRange(e,t){return this.lookAtCoordinate({range:e},t)}getCameraTargetPosition(){return fm.position}getRange(e){return HA.getTransformCameraLookingAtTarget(this.view,this.camera,e).range}getTilt(e){return HA.getTransformCameraLookingAtTarget(this.view,this.camera,e).tilt}getHeading(e){return HA.getTransformCameraLookingAtTarget(this.view,this.camera,e).heading}pan(e){return this.mouseToPan(e.x,e.y),this.update(this.states.PAN),Promise.resolve()}getCameraOrientation(){return this.view.getPickingPositionFromDepth(null,Nm),[this.getTilt(Nm),this.getHeading(Nm)]}getCameraCoordinate(){return new i.E$("EPSG:4978").setFromVector3(this.camera.position).as("EPSG:4326")}getLookAtCoordinate(){return HA.getTransformCameraLookingAtTarget(this.view,this.camera).coord}setAnimationEnabled(e){wm=e}isAnimationEnabled(){return wm}getZoom(){return this.view.tileLayer.computeTileZoomFromDistanceCamera(this.getRange(),this.view.camera)}setZoom(e,t){return this.lookAtCoordinate({zoom:e},t)}getScale(e){return console.warn("Deprecated, use View#getScale instead."),this.view.getScale(e)}pixelsToMeters(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.28;return console.warn("Deprecated use View#getPixelsToMeters instead."),e*t/this.getScale(t)/1e3}pixelsToDegrees(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.28;console.warn("Deprecated, use View#getPixelsToMeters and GlobeControls#getMetersToDegrees instead.");const r=this.pixelsToMeters(e,t);return s.MathUtils.radToDeg(2*Math.asin(r/(2*i.Ql.x)))}metersToPixels(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.28;console.warn("Deprecated, use View#getMetersToPixels instead.");const r=this.getScale(t);return t/=1e3,e*r/t}setScale(e,t,r){return this.lookAtCoordinate({scale:e,pitch:t},r)}lookAtCoordinate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.isAnimationEnabled();if(this.player.stop(),!e.isExtent&&(e.zoom?e.range=this.view.tileLayer.computeDistanceCameraFromTileZoom(e.zoom,this.view.camera):e.scale&&(e.range=this.view.getScaleFromDistance(e.pitch,e.scale),(e.range<this.minDistance||e.range>this.maxDistance)&&(console.warn(`This scale ${e.scale} can not be reached`),e.range=s.MathUtils.clamp(e.range,this.minDistance,this.maxDistance))),void 0!==e.tilt)){const t=90-s.MathUtils.radToDeg(this.maxPolarAngle),r=90-s.MathUtils.radToDeg(this.minPolarAngle);(e.tilt<t||e.tilt>r)&&(e.tilt=s.MathUtils.clamp(e.tilt,t,r),console.warn("Tilt was clamped to ",e.tilt,` the interval is between ${t} and ${r} degree`))}return Qm=HA.getTransformCameraLookingAtTarget(this.view,this.camera),t?(e.callback=e=>fm.position.copy(e.targetWorldPosition),this.dispatchEvent({type:"animation-started"}),HA.animateCameraToLookAtTarget(this.view,this.camera,e).then((e=>(this.dispatchEvent({type:"animation-ended"}),this.handlingEvent(e),e)))):HA.transformCameraToLookAtTarget(this.view,this.camera,e).then((e=>(fm.position.copy(e.targetWorldPosition),this.handlingEvent(e),e)))}pickGeoPosition(e){const t=this.view.getPickingPositionFromDepth(e);if(t)return new i.E$("EPSG:4978").setFromVector3(t).as("EPSG:4326")}}const zm=Gm,jm={uniforms:{luminanceAtmosphere:{type:"f",value:1},turbidity:{type:"f",value:2},reileigh:{type:"f",value:1},mieCoefficient:{type:"f",value:.005},mieDirectionalG:{type:"f",value:.8},v3LightPosition:{type:"v3",value:new s.Vector3},up:{type:"v3",value:new s.Vector3(0,1,0)}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix *  vec4( cameraPosition + position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( cameraPosition + position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D skySampler;","uniform vec3 v3LightPosition;","uniform vec3 up;","varying vec3 vWorldPosition;","// uniform sampler2D sDiffuse;","// const float turbidity = 10.0; //","// const float reileigh = 2.; //","// const float luminanceAtmosphere = 1.0; //","// const float mieCoefficient = 0.005;","// const float mieDirectionalG = 0.8;","uniform float luminanceAtmosphere;","uniform float turbidity;","uniform float reileigh;","uniform float mieCoefficient;","uniform float mieDirectionalG;","// constants for atmospheric scattering","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003; // refractive index of air","const float N = 2.545E25; // number of molecules per unit volume for air at","// 288.15K and 1013mb (sea level -45 celsius)","const float pn = 0.035; // depolatization factor for standard air","// wavelength of used primaries, according to preetham","const vec3 lambda = vec3(680E-9, 550E-9, 450E-9);","// mie stuff","// K coefficient for the primaries","const vec3 K = vec3(0.686, 0.678, 0.666);","const float v = 4.0;","// optical length at zenith for molecules","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const float EE = 1000.0;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","// 66 arc seconds -> degrees, and the cosine of that","// earth shadow hack","const float cutoffAngle = pi/1.95;","const float steepness = 1.5;","vec3 totalRayleigh(vec3 lambda)","{","return (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn));","}","// A simplied version of the total Reayleigh scattering to works on browsers that use ANGLE","vec3 simplifiedRayleigh()","{","return 0.0005 / vec3(94, 40, 18);","}","float rayleighPhase(float cosTheta)","{ ","return (3.0 / (16.0*pi)) * (1.0 + pow(cosTheta, 2.0));","// return (1.0 / (3.0*pi)) * (1.0 + pow(cosTheta, 2.0));","// return (3.0 / 4.0) * (1.0 + pow(cosTheta, 2.0));","}","vec3 totalMie(vec3 lambda, vec3 K, float T)","{","float c = (0.2 * T ) * 10E-18;","return 0.434 * c * pi * pow((2.0 * pi) / lambda, vec3(v - 2.0)) * K;","}","float hgPhase(float cosTheta, float g)","{","return (1.0 / (4.0*pi)) * ((1.0 - pow(g, 2.0)) / pow(1.0 - 2.0*g*cosTheta + pow(g, 2.0), 1.5));","}","float sunIntensity(float zenithAngleCos)","{","return EE * max(0.0, 1.0 - exp(-((cutoffAngle - acos(zenithAngleCos))/steepness)));","}","// float logLuminance(vec3 c)","// {","//     return log(c.r * 0.2126 + c.g * 0.7152 + c.b * 0.0722);","// }","// Filmic ToneMapping http://filmicgames.com/archives/75","float A = 0.15;","float B = 0.50;","float C = 0.10;","float D = 0.20;","float E = 0.02;","float F = 0.30;","float W = 1000.0;","vec3 Uncharted2Tonemap(vec3 x)","{","return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;","}","void main() ","{","vec3 up2 = normalize(cameraPosition.xyz);","float sunfade = 1.0-clamp(1.0-exp((v3LightPosition.y/450000.0)),0.0,1.0);","float reileighCoefficient = reileigh - (1.0* (1.0-sunfade));","vec3 sunDirection = normalize(v3LightPosition);","float sunE = sunIntensity(dot(sunDirection, up2));","// extinction (absorbtion + out scattering) ","// rayleigh coefficients","vec3 betaR = simplifiedRayleigh() * reileighCoefficient;","// mie coefficients","vec3 betaM = totalMie(lambda, K, turbidity) * mieCoefficient;","// optical length","// cutoff angle at 90 to avoid singularity in next formula.","float zenithAngle = acos(max(0.0, dot(up2, normalize(vWorldPosition - cameraPosition))));","float sR = rayleighZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));","float sM = mieZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));","// combined extinction factor","vec3 Fex = exp(-(betaR * sR + betaM * sM));","// in scattering","float cosTheta = dot(normalize(vWorldPosition - cameraPosition), sunDirection);","float rPhase = rayleighPhase(cosTheta*0.5+0.5);","vec3 betaRTheta = betaR * rPhase;","float mPhase = hgPhase(cosTheta, mieDirectionalG);","vec3 betaMTheta = betaM * mPhase;","vec3 Lin = pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * (1.0 - Fex),vec3(1.5));","Lin *= mix(vec3(1.0),pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up2, sunDirection),5.0),0.0,1.0));","//nightsky","vec3 direction = normalize(vWorldPosition - cameraPosition);","float theta = acos(direction.y); // elevation --\x3e y-axis, [-pi/2, pi/2]","float phi = atan(direction.z, direction.x); // azimuth --\x3e x-axis [-pi/2, pi/2]","vec2 uv = vec2(phi, theta) / vec2(2.0*pi, pi) + vec2(0.5, 0.0);","// vec3 L0 = texture2D(skySampler, uv).rgb+0.1 * Fex;","vec3 L0 = vec3(0.1) * Fex;","// composition + solar disc","//if (cosTheta > sunAngularDiameterCos)","float sundisk = smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);","// if (normalize(vWorldPosition - cameraPosition).y>0.0)","L0 += (sunE * 19000.0 * Fex)*sundisk;","vec3 whiteScale = 1.0/Uncharted2Tonemap(vec3(W));","vec3 texColor = (Lin+L0);   ","texColor *= 0.04 ;","texColor += vec3(0.0,0.001,0.0025)*0.3;","float g_fMaxLuminance = 1.0;","float fLumScaled = 0.1 / luminanceAtmosphere;     ","float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (g_fMaxLuminance * g_fMaxLuminance)))) / (1.0 + fLumScaled); ","float ExposureBias = fLumCompressed;","vec3 curr = Uncharted2Tonemap((log2(2.0/pow(luminanceAtmosphere,4.0)))*texColor);","vec3 color = curr*whiteScale;","vec3 retColor = pow(color,vec3(1.0/(1.2+(1.2*sunfade))));","gl_FragColor.rgb = retColor;","gl_FragColor.a = 1. - ( (length(cameraPosition) - 6400000.) / 1000.);","}"].join("\n")};class Vm extends s.Mesh{constructor(){const e=s.UniformsUtils.clone(jm.uniforms),t=new s.ShaderMaterial({fragmentShader:jm.fragmentShader,vertexShader:jm.vertexShader,uniforms:e,side:s.BackSide,transparent:!0,depthWrite:!1});super(new s.SphereGeometry(4e4,32,15),t)}}const qm=Vm,Hm="#include <logdepthbuf_pars_fragment>\n\nuniform int atmoIN;\nvarying float intensity;\n\nvec4 glowColor = vec4(0.45, 0.74, 1. ,1.0);\n\nvoid main() {\n    #include <logdepthbuf_fragment>\n    gl_FragColor = glowColor * intensity;\n}\n\n",Wm="#include <common>\n#include <logdepthbuf_pars_vertex>\n\nuniform int atmoIN;\nvarying float intensity;\n\nvoid main()\n{\n    vec3 normalES    = normalize( normalMatrix * normal );\n    vec3 normalCAMES = normalize( normalMatrix * cameraPosition );\n\n    if(atmoIN == 0) {\n        intensity = pow(0.666 - dot(normalES, normalCAMES), 4. );\n    } else {\n        intensity = pow( 1.  - dot(normalES, normalCAMES), 0.8 );\n    }\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position,  1.0 );\n\n    #include <logdepthbuf_vertex>\n}\n\n\n",$m=new s.Vector3(1,0,0),Ym=new s.Vector3,Km=new i.E$("EPSG:4326"),Jm=new i.E$("EPSG:4326"),Xm=new s.Color(9688568),Zm=new s.Color,ey=new s.Color(197896),ty=6e5,ry=160*i.Ql.x,ny=class extends _c{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"atmosphere",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.source=!1,super(e,new s.Object3D,t),this.isAtmosphere=!0;const r=new s.ShaderMaterial({uniforms:{atmoIN:{type:"i",value:0},screenSize:{type:"v2",value:new s.Vector2(window.innerWidth,window.innerHeight)}},vertexShader:Wm,fragmentShader:Hm,side:s.BackSide,blending:s.AdditiveBlending,transparent:!0,wireframe:!1}),n=new s.SphereGeometry(1,64,64),o=new s.Mesh(n,r);o.scale.copy(i.Ql).multiplyScalar(1.14),this.basicAtmosphere=new s.Object3D,this.realisticAtmosphere=new s.Object3D,this.realisticAtmosphere.visible=!1,this.object3d.add(this.basicAtmosphere),this.object3d.add(this.realisticAtmosphere),this.basicAtmosphere.add(o);const a=new s.ShaderMaterial({uniforms:{atmoIN:{type:"i",value:1},screenSize:{type:"v2",value:new s.Vector2(window.innerWidth,window.innerHeight)}},vertexShader:Wm,fragmentShader:Hm,side:s.FrontSide,blending:s.AdditiveBlending,transparent:!0,depthWrite:!1}),l=new s.Mesh(n,a);l.scale.copy(i.Ql).multiplyScalar(1.002),this.basicAtmosphere.add(l),this.realisticLightingPosition={x:-.5,y:0,z:1},this.fog={enable:!0,distance:ry},this.realisticAtmosphereInitParams=t.Kr?t:{Kr:.0025,Km:.0015,ESun:20,g:-.95,innerRadius:64e5,outerRadius:67e5,wavelength:[.65,.57,.475],scaleDepth:.25},this.object3d.updateMatrixWorld()}update(e,t,r){r.material.setUniform("fogDistance",this.fog.distance),r.material.setUniform("lightingEnabled",this.realisticAtmosphere.visible),r.material.setUniform("lightPosition",this.realisticLightingPosition)}preUpdate(e){const t=e.view.camera3D.position;if(this.fog.enable){Ym.setFromMatrixPosition(e.view.tileLayer.object3d.matrixWorld);const r=Ym.distanceTo(t);this.fog.distance=ry*(.25*(r-.99*i.Ql.x)/i.Ql.x)**1.5}else this.fog.distance=1e11;const r=e.view.mainLoop.gfxEngine.renderer;Km.crs=e.view.referenceCrs,Km.setFromVector3(t).as("EPSG:4326",Jm);const n=Jm.altitude;n<ty?(Zm.copy(ey).lerp(Xm,(ty-n)/ty),r.setClearColor(Zm,r.getClearAlpha())):r.setClearColor(ey,r.getClearAlpha())}_initRealisticLighning(){const e=this.realisticAtmosphereInitParams,t={v3LightPosition:{value:$m.clone().normalize()},v3InvWavelength:{value:new s.Vector3(1/e.wavelength[0]**4,1/e.wavelength[1]**4,1/e.wavelength[2]**4)},fCameraHeight:{value:0},fCameraHeight2:{value:0},fInnerRadius:{value:e.innerRadius},fInnerRadius2:{value:e.innerRadius*e.innerRadius},fOuterRadius:{value:e.outerRadius},fOuterRadius2:{value:e.outerRadius*e.outerRadius},fKrESun:{value:e.Kr*e.ESun},fKmESun:{value:e.Km*e.ESun},fKr4PI:{value:4*e.Kr*Math.PI},fKm4PI:{value:4*e.Km*Math.PI},fScale:{value:1/(e.outerRadius-e.innerRadius)},fScaleDepth:{value:e.scaleDepth},fScaleOverScaleDepth:{value:1/(e.outerRadius-e.innerRadius)/e.scaleDepth},g:{value:e.g},g2:{value:e.g*e.g},nSamples:{value:3},fSamples:{value:3},tDisplacement:{value:new s.Texture},tSkyboxDiffuse:{value:new s.Texture},fNightScale:{value:1}},r=new s.SphereGeometry(e.innerRadius,50,50),n=new s.ShaderMaterial({uniforms:t,vertexShader:"uniform vec3 v3LightPosition;   // The direction vector to the light source\nuniform vec3 v3InvWavelength;   // 1 / pow(wavelength, 4) for the red, green, and blue channels\nuniform float fCameraHeight;    // The camera's current height\nuniform float fCameraHeight2;   // fCameraHeight^2\nuniform float fOuterRadius;     // The outer (atmosphere) radius\nuniform float fOuterRadius2;    // fOuterRadius^2\nuniform float fInnerRadius;     // The inner (planetary) radius\nuniform float fInnerRadius2;    // fInnerRadius^2\nuniform float fKrESun;          // Kr * ESun\nuniform float fKmESun;          // Km * ESun\nuniform float fKr4PI;           // Kr * 4 * PI\nuniform float fKm4PI;           // Km * 4 * PI\nuniform float fScale;           // 1 / (fOuterRadius - fInnerRadius)\nuniform float fScaleDepth;      // The scale depth (i.e. the altitude at which the atmosphere's average density is found)\nuniform float fScaleOverScaleDepth; // fScale / fScaleDepth\n\nvarying vec3 c0;\nvarying vec3 c1;\n\nconst int nSamples = 3;\nconst float fSamples = 3.0;\n\nfloat scale(float fCos)\n{\n    float x = 1.0 - fCos;\n    return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nvoid main(void) {\n\n     float cameraHeight2 = length(cameraPosition) * length(cameraPosition);\n\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n    vec3 v3Ray = position - cameraPosition;\n    float fFar = length(v3Ray);\n    v3Ray /= fFar;\n\n    // Calculate the closest intersection of the ray with the outer atmosphere (which is the near point of the ray passing through the atmosphere)\n    float B = 2.0 * dot(cameraPosition, v3Ray);\n    float C = cameraHeight2 - fOuterRadius2;\n    float fDet = max(0.0, B*B - 4.0 * C);\n    float fNear = 0.5 * (-B - sqrt(fDet));\n\n    // Calculate the ray's starting position, then calculate its scattering offset\n    vec3 v3Start = cameraPosition + v3Ray * fNear;\n    fFar -= fNear;\n    float fDepth = exp((fInnerRadius - fOuterRadius) / fScaleDepth);\n    float fCameraAngle = dot(-v3Ray, position) / length(position);\n    float fLightAngle = dot(v3LightPosition, position) / length(position);\n    float fCameraScale = scale(fCameraAngle);\n    float fLightScale = scale(fLightAngle);\n    float fCameraOffset = fDepth*fCameraScale;\n    float fTemp = (fLightScale + fCameraScale);\n\n    // Initialize the scattering loop variables\n    float fSampleLength = fFar / fSamples;\n    float fScaledLength = fSampleLength * fScale;\n    vec3 v3SampleRay = v3Ray * fSampleLength;\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n    // Now loop through the sample rays\n    vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\n    vec3 v3Attenuate = vec3(0.0, 0.0, 0.0);\n    for(int i=0; i<nSamples; i++)\n    {\n        float fHeight = length(v3SamplePoint);\n        float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n        float fScatter = fDepth*fTemp - fCameraOffset;\n        v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\n        v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\n        v3SamplePoint += v3SampleRay;\n    }\n\n    // Calculate the attenuation factor for the ground\n    c0 = v3Attenuate;\n    c1 = v3FrontColor * (v3InvWavelength * fKrESun + fKmESun);\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec3 c0;\nvarying vec3 c1;\n\nvoid main (void) {\n\tgl_FragColor = vec4(c1, 1.0 - c0/4.);\n}",blending:s.AdditiveBlending,transparent:!0,depthTest:!1,depthWrite:!1}),i=new s.Mesh(r,n),o=new s.SphereGeometry(e.outerRadius,196,196),a=new s.ShaderMaterial({uniforms:t,vertexShader:"uniform vec3 v3LightPosition;   // The direction vector to the light source\nuniform vec3 v3InvWavelength;   // 1 / pow(wavelength, 4) for the red, green, and blue channels\nuniform float fCameraHeight;    // The camera's current height\nuniform float fCameraHeight2;   // fCameraHeight^2\nuniform float fOuterRadius;     // The outer (atmosphere) radius\nuniform float fOuterRadius2;    // fOuterRadius^2\nuniform float fInnerRadius;     // The inner (planetary) radius\nuniform float fInnerRadius2;    // fInnerRadius^2\nuniform float fKrESun;          // Kr * ESun\nuniform float fKmESun;          // Km * ESun\nuniform float fKr4PI;           // Kr * 4 * PI\nuniform float fKm4PI;           // Km * 4 * PI\nuniform float fScale;           // 1 / (fOuterRadius - fInnerRadius)\nuniform float fScaleDepth;      // The scale depth (i.e. the altitude at which the atmosphere's average density is found)\nuniform float fScaleOverScaleDepth; // fScale / fScaleDepth\n\nconst int nSamples = 3;\nconst float fSamples = 3.0;\n\nvarying vec3 v3Direction;\nvarying vec3 c0;\nvarying vec3 c1;\n\nfloat scale(float fCos) {\n    float x = 1.0 - fCos;\n    return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nvoid main(void) {\n    float lengthCamera = length(cameraPosition);\n    float cameraHeight2 = lengthCamera * lengthCamera;\n\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n    vec3 v3Ray = position - cameraPosition;\n    float fFar = length(v3Ray);\n    v3Ray /= fFar;\n\n    // Calculate the closest intersection of the ray with the outer atmosphere (which is the near point of the ray passing through the atmosphere)\n    float B = 2.0 * dot(cameraPosition, v3Ray);\n    float C = cameraHeight2 - fOuterRadius2;\n    float fDet = max(0.0, B*B - 4.0 * C);\n    float fNear = 0.5 * (-B - sqrt(fDet));\n\n    // Calculate the ray's starting position, then calculate its scattering offset\n    vec3 v3Start = cameraPosition + v3Ray * fNear;\n    fFar -= fNear;\n    float fStartAngle = dot(v3Ray, v3Start) / fOuterRadius;\n    float fStartDepth = exp(-1.0 / fScaleDepth);\n    float fStartOffset = fStartDepth * scale(fStartAngle);\n\n    // Initialize the scattering loop variables\n    float fSampleLength = fFar / fSamples;\n    float fScaledLength = fSampleLength * fScale;\n    vec3 v3SampleRay = v3Ray * fSampleLength;\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\n\n    // Now loop through the sample rays\n    vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\n    for(int i=0; i<nSamples; i++)\n    {\n        float fHeight = length(v3SamplePoint);\n        float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n        float fLightAngle = dot(v3LightPosition, v3SamplePoint) / fHeight;\n        float fCameraAngle = dot(v3Ray, v3SamplePoint) / fHeight;\n        float fScatter = (fStartOffset + fDepth * (scale(fLightAngle) - scale(fCameraAngle)));\n        vec3 v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\n\n        v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\n        v3SamplePoint += v3SampleRay;\n    }\n\n    // Finally, scale the Mie and Rayleigh colors and set up the varying variables for the pixel shader\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    c0 = v3FrontColor * (v3InvWavelength * fKrESun);\n    c1 = v3FrontColor * fKmESun;\n    v3Direction = cameraPosition - position;\n}",fragmentShader:"uniform vec3 v3LightPos;\nuniform float g;\nuniform float g2;\n\nvarying vec3 v3Direction;\nvarying vec3 c0;\nvarying vec3 c1;\n\n// Calculates the Mie phase function\nfloat getMiePhase(float fCos, float fCos2, float g, float g2) {\n    return 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + fCos2) / pow(1.0 + g2 - 2.0 * g * fCos, 1.5);\n}\n\n// Calculates the Rayleigh phase function\nfloat getRayleighPhase(float fCos2) {\n    return 0.75 + 0.75 * fCos2;\n}\n\nvoid main (void) {\n    float fCos = dot(v3LightPos, v3Direction) / length(v3Direction);\n    float fCos2 = fCos * fCos;\n\n    vec3 color = getRayleighPhase(fCos2) * c0 + getMiePhase(fCos, fCos2, g, g2) * c1;\n\n    gl_FragColor = vec4(color, 1.0);\n    gl_FragColor.a = gl_FragColor.b;\n}",transparent:!0,side:s.BackSide}),l=new s.Mesh(o,a),c=new qm;c.frustumCulled=!1,this.realisticAtmosphere.add(i),this.realisticAtmosphere.add(l),this.realisticAtmosphere.add(c);c.material.uniforms.turbidity.value=10,c.material.uniforms.reileigh.value=2,c.material.uniforms.luminanceAtmosphere.value=1,c.material.uniforms.mieCoefficient.value=.005,c.material.uniforms.mieDirectionalG.value=.8,c.material.uniforms.up.value=new s.Vector3}setRealisticOn(e){e&&(this.realisticAtmosphere.children.length||this._initRealisticLighning(),this.realisticLightingPosition=i.NT.getSunPositionInScene((new Date).getTime(),48.85,2.35).normalize(),this.realisticAtmosphere.children.forEach((e=>e.material.uniforms.v3LightPosition.value.copy(this.realisticLightingPosition)))),this.basicAtmosphere.visible=!e,this.realisticAtmosphere.visible=e}},iy={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function sy(e){const t=await fetch(e);if(t.ok)return t.json();throw new Error(t.statusText)}const oy={xAxis:0,yAxis:0,button:0,state:iy.ComponentState.DEFAULT};class ay{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===iy.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(oy)}updateFromComponent({xAxis:e,yAxis:t,button:r,state:n}){const{normalizedXAxis:i,normalizedYAxis:s}=function(e=0,t=0){let r=e,n=t;if(Math.sqrt(e*e+t*t)>1){const i=Math.atan2(t,e);r=Math.cos(i),n=Math.sin(i)}return{normalizedXAxis:.5*r+.5,normalizedYAxis:.5*n+.5}}(e,t);switch(this.componentProperty){case iy.ComponentProperty.X_AXIS:this.value=this.states.includes(n)?i:.5;break;case iy.ComponentProperty.Y_AXIS:this.value=this.states.includes(n)?s:.5;break;case iy.ComponentProperty.BUTTON:this.value=this.states.includes(n)?r:0;break;case iy.ComponentProperty.STATE:this.valueNodeProperty===iy.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(n):this.value=this.states.includes(n)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class ly{constructor(e,t){if(!(e&&t&&t.visualResponses&&t.gamepadIndices&&0!==Object.keys(t.gamepadIndices).length))throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach((e=>{const r=new ay(t.visualResponses[e]);this.visualResponses[e]=r})),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:iy.ComponentState.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=iy.ComponentState.DEFAULT,void 0!==this.gamepadIndices.button&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||1===this.values.button?this.values.state=iy.ComponentState.PRESSED:(t.touched||this.values.button>iy.ButtonTouchThreshold)&&(this.values.state=iy.ComponentState.TOUCHED)}void 0!==this.gamepadIndices.xAxis&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===iy.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>iy.AxisTouchThreshold&&(this.values.state=iy.ComponentState.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===iy.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>iy.AxisTouchThreshold&&(this.values.state=iy.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach((e=>{e.updateFromComponent(this.values)}))}}class cy{constructor(e,t,r){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=r,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach((e=>{const t=this.layoutDescription.components[e];this.components[e]=new ly(e,t)})),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach((t=>{e.push(t.data)})),e}updateFromGamepad(){Object.values(this.components).forEach((e=>{e.updateFromGamepad(this.xrInputSource.gamepad)}))}}class hy extends s.Object3D{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e||(this.envMap=e,this.traverse((e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)}))),this}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach((e=>{Object.values(e.visualResponses).forEach((e=>{const{valueNode:t,minNode:r,maxNode:n,value:i,valueNodeProperty:s}=e;t&&(s===iy.VisualResponseProperty.VISIBILITY?t.visible=i:s===iy.VisualResponseProperty.TRANSFORM&&(t.quaternion.slerpQuaternions(r.quaternion,n.quaternion,i),t.position.lerpVectors(r.position,n.position,i)))}))})))}}function uy(e,t){!function(e,t){Object.values(e.components).forEach((e=>{const{type:r,touchPointNodeName:n,visualResponses:i}=e;if(r===iy.ComponentType.TOUCHPAD)if(e.touchPointNode=t.getObjectByName(n),e.touchPointNode){const t=new s.SphereGeometry(.001),r=new s.MeshBasicMaterial({color:255}),n=new s.Mesh(t,r);e.touchPointNode.add(n)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`);Object.values(i).forEach((e=>{const{valueNodeName:r,minNodeName:n,maxNodeName:i,valueNodeProperty:s}=e;if(s===iy.VisualResponseProperty.TRANSFORM){if(e.minNode=t.getObjectByName(n),e.maxNode=t.getObjectByName(i),!e.minNode)return void console.warn(`Could not find ${n} in the model`);if(!e.maxNode)return void console.warn(`Could not find ${i} in the model`)}e.valueNode=t.getObjectByName(r),e.valueNode||console.warn(`Could not find ${r} in the model`)}))}))}(e.motionController,t),e.envMap&&t.traverse((t=>{t.isMesh&&(t.material.envMap=e.envMap,t.material.needsUpdate=!0)})),e.add(t)}class dy{constructor(e=null,t=null){this.gltfLoader=e,this.path="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",this._assetCache={},this.onLoad=t,this.gltfLoader||(this.gltfLoader=new Au)}setPath(e){return this.path=e,this}createControllerModel(e){const t=new hy;let r=null;return e.addEventListener("connected",(e=>{const n=e.data;"tracked-pointer"===n.targetRayMode&&n.gamepad&&!n.hand&&async function(e,t,r=null,n=!0){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");const i=await async function(e){if(!e)throw new Error("No basePath supplied");return await sy(`${e}/profilesList.json`)}(t);let s;if(e.profiles.some((e=>{const r=i[e];return r&&(s={profileId:e,profilePath:`${t}/${r.path}`,deprecated:!!r.deprecated}),!!s})),!s){if(!r)throw new Error("No matching profile name found");const e=i[r];if(!e)throw new Error(`No matching profile name found and default profile "${r}" missing.`);s={profileId:r,profilePath:`${t}/${e.path}`,deprecated:!!e.deprecated}}const o=await sy(s.profilePath);let a;if(n){let t;if(t="any"===e.handedness?o.layouts[Object.keys(o.layouts)[0]]:o.layouts[e.handedness],!t)throw new Error(`No matching handedness, ${e.handedness}, in profile ${s.profileId}`);t.assetPath&&(a=s.profilePath.replace("profile.json",t.assetPath))}return{profile:o,assetPath:a}}(n,this.path,"generic-trigger").then((({profile:e,assetPath:i})=>{t.motionController=new cy(n,e,i);const s=this._assetCache[t.motionController.assetUrl];if(s)r=s.scene.clone(),uy(t,r),this.onLoad&&this.onLoad(r);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,(e=>{this._assetCache[t.motionController.assetUrl]=e,r=e.scene.clone(),uy(t,r),this.onLoad&&this.onLoad(r)}),null,(()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)}))}})).catch((e=>{console.warn(e)}))})),e.addEventListener("disconnected",(()=>{t.motionController=null,t.remove(r),r=null})),t}}class py{static MIN_DELTA_ALTITUDE=1.8;static MAX_NUMBER_CONTROLLERS=2;constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.view=e,this.groupXR=t,this.webXRManager=e.mainLoop.gfxEngine.renderer.xr,this.rightButtonPressed=!1,this.controllers=[],this.initControllers()}static init(e,t){return new py(e,t)}initControllers(){this.groupXR.add(new s.HemisphereLight(10855845,9013641,3));const e=new dy;for(let t=0;t<py.MAX_NUMBER_CONTROLLERS;t++){const r=this.webXRManager.getController(t);r.addEventListener("connected",(n=>{r.name=n.data.handedness,r.userData.handedness=n.data.handedness,r.gamepad=n.data.gamepad,this.groupXR.add(r);const i=this.webXRManager.getControllerGrip(t);i.name=`${r.name}GripController`,i.userData.handedness=n.data.handedness,this.bindGripController(e,i,this.groupXR),this.controllers.push(r),this.groupXR.add(i),this.setupEventListeners(r)})),r.addEventListener("disconnected",(function(){this.remove(this.children[0])}))}}bindGripController(e,t,r){t.add(e.createControllerModel(t)),r.add(t)}setupEventListeners(e){e.addEventListener("itowns-xr-axes-changed",(e=>this.onAxisChanged(e))),e.addEventListener("itowns-xr-axes-stop",(e=>this.onAxisStop(e))),e.addEventListener("itowns-xr-button-pressed",(e=>this.onButtonPressed(e))),e.addEventListener("itowns-xr-button-released",(e=>this.onButtonReleased(e))),e.addEventListener("selectstart",(e=>this.onSelectStart(e))),e.addEventListener("selectend",(e=>this.onSelectEnd(e)))}listenGamepad(){for(const e of this.controllers){if(!e.gamepad)return;const t=e.gamepad,r=t.axes.some((e=>0!==e));if(e.isStickActive&&!r&&e.gamepad.endGamePadtrackEmit)return e.dispatchEvent({type:"itowns-xr-axes-stop",message:{controller:e}}),void(e.isStickActive=!1);!e.isStickActive&&r?(e.gamepad.endGamePadtrackEmit=!1,e.isStickActive=!0):e.isStickActive&&!r&&(e.gamepad.endGamePadtrackEmit=!0),r&&e.dispatchEvent({type:"itowns-xr-axes-changed",message:{controller:e}});for(const[r,n]of t.buttons.entries())n.pressed?(e.dispatchEvent({type:"itowns-xr-button-pressed",message:{controller:e,buttonIndex:r,button:n}}),e.lastButtonItem=n):e.lastButtonItem&&e.lastButtonItem===n&&(e.dispatchEvent({type:"itowns-xr-button-released",message:{controller:e,buttonIndex:r,button:n}}),e.lastButtonItem=void 0),n.touched}}clampAndApplyTransformationToXR(e,t){const r=this.clampToGround(e);this.applyTransformationToXR(r,t)}applyTransformationToXR(e,t){this.groupXR.position.copy(e),this.groupXR.quaternion.copy(t),this.groupXR.updateMatrixWorld(!0)}clampToGround(e){const t=new i.E$(this.view.referenceCrs,e.x,e.y,e.z),r=u.getElevationValueAt(this.view.tileLayer,t,u.PRECISE_READ_Z)||0;if(this.view.controls.getCameraCoordinate){const e=t.as(this.view.controls.getCameraCoordinate().crs);return e.altitude-r-py.MIN_DELTA_ALTITUDE<=0&&(e.altitude=r+py.MIN_DELTA_ALTITUDE),e.as(this.view.referenceCrs).toVector3()}return e}getSpeedFactor(){const e=this.view.controls.getCameraCoordinate?this.view.controls.getCameraCoordinate().altitude:1;return Math.min(Math.max(e/50,2),2e3)}getRotationYaw(e){const t=this.groupXR.quaternion.clone().normalize();let r=0;e&&(r=-Math.PI*e/140);const n=this.groupXR.position.clone().normalize(),i=(new s.Quaternion).setFromAxisAngle(n,r).normalize();return t.premultiply(i),t}getRotationPitch(e){const t=this.groupXR.quaternion.clone().normalize();let r=0;e&&(r=-Math.PI*e/140);const n=new s.Vector3(1,0,0).applyQuaternion(t).normalize(),i=(new s.Quaternion).setFromAxisAngle(n,r).normalize();return t.premultiply(i),t}getTranslationElevation(e,t){const r=this.view.camera3D.position.clone().normalize();return r.multiplyScalar(-e*t),r}cameraOnFly(e){let t=new s.Vector3,r=new s.Vector3;const n=this.getSpeedFactor();if(0!==e.gamepad.axes[3]){const t=e.gamepad.axes[3]*n;r=new s.Vector3(0,0,1).applyQuaternion(this.view.camera3D.quaternion.clone().normalize()).multiplyScalar(t)}if(0!==e.gamepad.axes[2]){const r=e.gamepad.axes[2]*n;t=new s.Vector3(1,0,0).applyQuaternion(this.view.camera3D.quaternion.clone().normalize()).multiplyScalar(r)}const i=this.groupXR.quaternion.clone(),o=this.groupXR.position.clone().add(t.add(r));this.clampAndApplyTransformationToXR(o,i)}onSelectRightEnd(){}onSelectRightStart(){}onSelectLeftStart(){}onSelectLeftEnd(){}onSelectStart(e){const t=e.target;"left"===t.userData.handedness?this.onSelectLeftStart(t):"right"===t.userData.handedness&&this.onSelectRightStart(t)}onSelectEnd(e){const t=e.target;"left"===t.userData.handedness?this.onSelectRightEnd(t):"right"===t.userData.handedness&&this.onSelectLeftEnd(t)}onButtonPressed(e){const t=e.target;"left"===t.userData.handedness?this.onLeftButtonPressed(e):"right"===t.userData.handedness&&this.onRightButtonPressed(e)}onRightButtonPressed(e){const t=e.target;if(1===e.message.buttonIndex){if(0===t.gamepad.axes[3])return;this.rightButtonPressed=!0}}onLeftButtonPressed(){}onAxisChanged(e){const t=e.target;0===t.gamepad.axes[2]&&0===t.gamepad.axes[3]||("left"===t.userData.handedness?this.onLeftAxisChanged(t):"right"===t.userData.handedness&&this.onRightAxisChanged(t))}onRightAxisChanged(e){if("right"===e.userData.handedness)if(this.rightButtonPressed){const t=this.groupXR.quaternion.clone(),r=this.getSpeedFactor(),n=this.getTranslationElevation(e.gamepad.axes[3],r),i=this.groupXR.position.clone().add(n);this.clampAndApplyTransformationToXR(i,t)}else this.cameraOnFly(e)}onLeftAxisChanged(e){if("left"!==e.userData.handedness)return;const t=this.groupXR.position.clone();let r;r=Math.abs(e.gamepad.axes[2])>Math.abs(e.gamepad.axes[3])?this.getRotationYaw(e.gamepad.axes[2]):this.getRotationPitch(e.gamepad.axes[3]),this.applyTransformationToXR(t,r)}onAxisStop(e){const t=e.target;"left"===t.userData.handedness?this.onLeftAxisStop(t):"right"===t.userData.handedness&&this.onRightAxisStop(t)}onRightAxisStop(){}onLeftAxisStop(){}onButtonReleased(e){const t=e.target;"left"===t.userData.handedness?this.onLeftButtonReleased(t):"right"===t.userData.handedness&&this.onRightButtonReleased(t)}onRightButtonReleased(){this.rightButtonPressed=!1}onLeftButtonReleased(){}}const fy=py,gy={CONTROLS_INITIALIZED:"vrControls-initialized"};class Ay extends s.EventDispatcher{constructor(e,t){super(),this.view=e,this.options=t,this.renderCb=t.callback,this.vrControls=null}initializeWebXR=()=>{const e=this.view.renderer.xr;e.addEventListener("sessionstart",(()=>{e.enabled=!0,e.getReferenceSpace("local");const t=new s.Object3D;t.name="xrHeadset",this.view.scene.add(t),this.view.camera3D.getWorldPosition(t.position),this.view.camera3D.getWorldQuaternion(t.quaternion),t.updateMatrixWorld(!0),t.add(e.getCamera()),this.view._camXR=this.view.camera3D.clone(),this.view._camXR.far=2e6,this.view._camXR.near=.1,this.view._camXR.updateProjectionMatrix(),t.add(this.view._camXR),this.view.notifyChange(),this.options.controllers&&(this.vrControls=new fy(this.view,t),this.dispatchEvent({type:"vrControls-initialized"})),e.setAnimationLoop((r=>{e.isPresenting&&e.getCamera().cameras.length>0&&(function(e,t){const{near:r,far:n,aspect:i,fov:o}=function(e){const t=e.elements,r=t[14]/(t[10]-1),n=t[14]/(t[10]+1),i=2*Math.atan(1/t[5]),o=s.MathUtils.radToDeg(i);return{near:r,far:n,aspect:t[5]/t[0],fov:o}}(t._camXR.projectionMatrix);t.camera3D.near=r,t.camera3D.far=n,t.camera3D.aspect=i,t.camera3D.fov=o,t.camera3D.zoom=1,t.camera3D.updateProjectionMatrix(),e.getCamera().getWorldPosition(t.camera3D.position),e.getCamera().getWorldQuaternion(t.camera3D.quaternion),t.camera3D.updateMatrix(),t.camera3D.updateMatrixWorld(!0),t.notifyChange(t.camera3D,!0)}(e,this.view),t.updateMatrixWorld(!0),this.vrControls&&this.vrControls.listenGamepad(),this.renderCb&&this.renderCb()),this.view.mainLoop.step(this.view,r)}))}))}}const my=Ay,yy={GLOBE_INITIALIZED:mA.INITIALIZED,LAYER_ADDED:mA.LAYER_ADDED,LAYER_REMOVED:mA.LAYER_REMOVED,COLOR_LAYERS_ORDER_CHANGED:mA.COLOR_LAYERS_ORDER_CHANGED},vy=class extends TA{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};s.Object3D.DEFAULT_UP.set(0,0,1),super("EPSG:4978",e,r),this.isGlobeView=!0,this.camera3D.near=Math.max(15,2352e-9*i.Ql.x),this.camera3D.far=10*i.Ql.x;const n=new Ch("globe",r.object3d,r);if(this.mainLoop.gfxEngine.label2dRenderer.infoTileLayer=n.info,this.addLayer(n),this.tileLayer=n,t.isExtent||(t.coord=t.coord||new i.E$("EPSG:4326",0,0),t.tilt=t.tilt||89.5,t.heading=t.heading||0,t.range=t.range||2*i.Ql.x),this.farFactor=r.farFactor??20,this.fogSpread=r.fogSpread??.5,r.noControls)HA.transformCameraToLookAtTarget(this,this.camera3D,t);else{this.controls=new zm(this,t,r.controls),this.controls.handleCollision=void 0===r.handleCollision||r.handleCollision;const e=Math.min(i.Ql.x,i.Ql.y,i.Ql.z);this.addEventListener(mA.CAMERA_MOVED,(()=>{const t=this.camera3D.position.lengthSq(),r=new i.E$(this.referenceCrs).setFromVector3(this.camera3D.position);r.as(this.tileLayer.extent.crs,r);const n=r.z,s=n-TA.ALTITUDE_MAX;this.camera3D.near=Math.max(1,s*this.fovDepthFactor);const o=Math.sqrt(Math.max(0,t-e*e));this.camera3D.far=Math.min(this.farFactor*n,o),this.camera3D.updateProjectionMatrix();const a=this.scene.fog;a&&(a.far=this.camera3D.far,a.near=a.far-this.fogSpread*(a.far-this.camera3D.near))})),this.scene.fog=new s.Fog(14872063,1,1e3)}this.addLayer(new ny("atmosphere",r.atmosphere)),this.camera.resize(e.clientWidth,e.clientHeight),r.webXR&&(this.webXR=new my(this,"boolean"==typeof r.webXR?{}:r.webXR),this.webXR.initializeWebXR())}addLayer(e){if(!e||!e.isLayer)return Promise.reject(new Error("Add Layer type object"));if(e.isColorLayer){if(!this.tileLayer.tileMatrixSets.includes(e.source.crs))return e._reject(`Only ${this.tileLayer.tileMatrixSets} tileMatrixSet are currently supported for color layers`)}else if(e.isElevationLayer&&e.source.crs!==this.tileLayer.tileMatrixSets[0])return e._reject(`Only ${this.tileLayer.tileMatrixSets[0]} tileMatrixSet is currently supported for elevation layers`);return super.addLayer(e,this.tileLayer)}getPixelsToDegrees(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;return this.getMetersToDegrees(this.getPixelsToMeters(e,t))}getPixelsToDegreesFromDistance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.getMetersToDegrees(this.getPixelsToMetersFromDistance(e,t))}getMetersToDegrees(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return s.MathUtils.radToDeg(2*Math.asin(e/(2*i.Ql.x)))}},wy=s.MOUSE.LEFT,by=s.MOUSE.MIDDLE,Ey=s.MOUSE.RIGHT;let xy;const Cy=new s.Vector3,_y=new s.Quaternion;let Iy=0;const Sy=new s.Vector3,My=-1,Ty={default:"auto",drag:"move",pan:"cell",travel:"wait",rotate:"move",ortho_zoom:"wait"},By=new s.Vector3,Py=new s.Vector2,Ry=new s.Vector2,Dy=new s.Vector2(0,0),Ly=new s.Vector3,ky=new s.Vector3,Oy=new s.Vector3,Fy=new s.Vector3(0,0,0);let Ny=0;const Uy=new s.Vector3,Qy=new s.Quaternion,Gy=new s.Vector2,zy=new s.Vector3,jy=new s.Vector3,Vy=new s.Quaternion,qy=new s.Quaternion;let Hy=0,Wy=0,$y=!1,Yy=!1,Ky=0,Jy=0;const Xy=new s.Raycaster,Zy=new s.Plane(new s.Vector3(0,0,-1)),ev={enabled:!0,enableRotation:!0,rotateSpeed:2,minPanSpeed:.05,maxPanSpeed:15,zoomTravelTime:.2,zoomFactor:2,maxResolution:0,minResolution:1/0,maxAltitude:5e7,groundLevel:200,autoTravelTimeMin:1.5,autoTravelTimeMax:4,autoTravelTimeDist:5e4,smartTravelHeightMin:75,smartTravelHeightMax:500,instantTravel:!1,minZenithAngle:0,maxZenithAngle:82.5,handleCollision:!0,minDistanceCollision:30,enableSmartTravel:!0,enablePan:!0},tv={MOVED:"moved"};class rv extends s.EventDispatcher{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.view=e,this.camera=e.camera3D,this.enabled="boolean"==typeof t.enabled?t.enabled:ev.enabled,this.camera.isOrthographicCamera?(Iy=this.camera.zoom,this.enableRotation=!1,this.enablePan=!1,this.maxAltitude=1/0,this.zoomTravelTime="number"==typeof t.zoomTravelTime?t.zoomTravelTime:ev.zoomTravelTime):(this.enableRotation=void 0===t.enableRotation?ev.enableRotation:t.enableRotation,this.rotateSpeed=t.rotateSpeed||ev.rotateSpeed,this.enablePan=void 0===t.enablePan?ev.enablePan:t.enablePan,this.minPanSpeed=t.minPanSpeed||ev.minPanSpeed,this.maxPanSpeed=t.maxPanSpeed||ev.maxPanSpeed,this.maxAltitude=t.maxAltitude||ev.maxAltitude,this.zoomTravelTime=t.zoomTravelTime||ev.zoomTravelTime),t.zoomInFactor&&(console.warn("Controls zoomInFactor parameter is deprecated. Use zoomFactor instead."),t.zoomFactor=t.zoomFactor||t.zoomInFactor),t.zoomOutFactor&&(console.warn("Controls zoomOutFactor parameter is deprecated. Use zoomFactor instead."),t.zoomFactor=t.zoomFactor||t.zoomInFactor||1/t.zoomOutFactor),0===t.zoomFactor&&(console.warn("Controls zoomFactor parameter can not be equal to 0. Its value will be set to default."),t.zoomFactor=ev.zoomFactor),this.zoomInFactor=t.zoomFactor||ev.zoomFactor,this.zoomOutFactor=1/(t.zoomFactor||ev.zoomFactor),this.maxResolution=t.maxResolution||ev.maxResolution,this.minResolution=t.minResolution||ev.minResolution,this.groundLevel=t.groundLevel||ev.groundLevel,this.autoTravelTimeMin=t.autoTravelTimeMin||ev.autoTravelTimeMin,this.autoTravelTimeMax=t.autoTravelTimeMax||ev.autoTravelTimeMax,this.autoTravelTimeDist=t.autoTravelTimeDist||ev.autoTravelTimeDist,t.smartZoomHeightMin&&(console.warn("Controls smartZoomHeightMin parameter is deprecated. Use smartTravelHeightMin instead."),t.smartTravelHeightMin=t.smartTravelHeightMin||t.smartZoomHeightMin),t.smartZoomHeightMax&&(console.warn("Controls smartZoomHeightMax parameter is deprecated. Use smartTravelHeightMax instead."),t.smartTravelHeightMax=t.smartTravelHeightMax||t.smartZoomHeightMax),this.smartTravelHeightMin=t.smartTravelHeightMin||ev.smartTravelHeightMin,this.smartTravelHeightMax=t.smartTravelHeightMax||ev.smartTravelHeightMax,this.instantTravel=t.instantTravel||ev.instantTravel,this.minZenithAngle=(t.minZenithAngle||ev.minZenithAngle)*Math.PI/180,this.maxZenithAngle=(t.maxZenithAngle||ev.maxZenithAngle)*Math.PI/180,t.focusOnMouseOver&&console.warn("Planar controls 'focusOnMouseOver' optional parameter has been removed."),t.focusOnMouseClick&&console.warn("Planar controls 'focusOnMouseClick' optional parameter has been removed."),this.handleCollision=void 0===t.handleCollision?ev.handleCollision:t.handleCollision,this.minDistanceCollision=ev.minDistanceCollision,this.enableSmartTravel=void 0===t.enableSmartTravel?ev.enableSmartTravel:t.enableSmartTravel,Cy.copy(this.camera.position),_y.copy(this.camera.quaternion),this.state=My,this.cursor=Ty,this.view.controls&&(console.warn("Deprecated use of PlanarControls. See examples to correct PlanarControls implementation."),this.view.controls.dispose()),this.view.controls=this,this._handlerOnKeyDown=this.onKeyDown.bind(this),this._handlerOnMouseDown=this.onMouseDown.bind(this),this._handlerOnMouseUp=this.onMouseUp.bind(this),this._handlerOnMouseMove=this.onMouseMove.bind(this),this._handlerOnMouseWheel=this.onMouseWheel.bind(this),this._handlerContextMenu=this.onContextMenu.bind(this),this._handlerUpdate=this.update.bind(this),this.view.addFrameRequester(M.AFTER_CAMERA_UPDATE,this._handlerUpdate),this.addInputListeners()}dispose(){this.removeInputListeners(),this.view.removeFrameRequester(M.AFTER_CAMERA_UPDATE,this._handlerUpdate)}update(e,t){t&&(e=16);const r=this.state!==My;let n=!0;switch(this.state){case 3:this.handleTravel(e);break;case 4:this.handleZoomOrtho(e);break;case 0:this.handleDragMovement();break;case 2:this.handleRotation();break;case 1:this.handlePanMovement();break;default:n=!1}n&&(this.view.dispatchEvent({type:mA.CAMERA_MOVED}),this.view.notifyChange(this.camera)),this.handleCollision&&this.view.camera.adjustAltitudeToAvoidCollisionWithLayer(this.view,this.view.tileLayer,this.minDistanceCollision),r&&this.view.dispatchEvent({type:tv.MOVED}),Dy.set(0,0)}initiateDrag(){this.state=0,Ly.copy(this.getWorldPointAtScreenXY(Py)),Oy.set(0,0,0)}handleDragMovement(){this.getWorldPointFromMathPlaneAtScreenXY(Py,Ly.z,ky),Oy.subVectors(Ly,ky),this.camera.position.add(Oy),Oy.set(0,0,0)}initiatePan(){this.state=1}handlePanMovement(){Uy.set(-Dy.x,Dy.y,0),this.camera.localToWorld(Uy),this.camera.position.copy(Uy)}initiateRotation(){this.state=2,Fy.copy(this.getWorldPointAtScreenXY(new s.Vector2(.5*this.view.mainLoop.gfxEngine.width,.5*this.view.mainLoop.gfxEngine.height)));const e=this.camera.position.distanceTo(Fy);Ny=Math.acos((this.camera.position.z-Fy.z)/e)}handleRotation(){const e=-this.rotateSpeed*Dy.x/this.view.mainLoop.gfxEngine.width,t=-this.rotateSpeed*Dy.y/this.view.mainLoop.gfxEngine.height,r=this.camera.position.clone().sub(Fy);0===e&&0===t||(Ny+t>=this.minZenithAngle&&Ny+t<=this.maxZenithAngle&&0!==t&&(Ny+=t,Uy.set(0,0,1),Qy.setFromUnitVectors(this.camera.up,Uy),r.applyQuaternion(Qy),Uy.setFromMatrixColumn(this.camera.matrix,0),Qy.setFromAxisAngle(Uy,t),r.applyQuaternion(Qy),Uy.set(0,0,1),Qy.setFromUnitVectors(this.camera.up,Uy).invert(),r.applyQuaternion(Qy)),0!==e&&(Uy.set(0,0,1),Qy.setFromAxisAngle(Uy,e),r.applyQuaternion(Qy))),this.camera.position.copy(r),this.camera.lookAt(By),this.camera.position.add(Fy),this.camera.updateMatrixWorld()}initiateZoom(e){const t=-e.deltaY;Sy.copy(this.getWorldPointAtScreenXY(Py));const r=new s.Vector3;if(t>0||t<0&&this.maxAltitude>this.camera.position.z){const e=t>0?this.zoomInFactor:this.zoomOutFactor,n=this.view.getPixelsToMeters()/e;if(this.maxResolution>n||n>this.minResolution)return;this.camera.isOrthographicCamera?(this.state=4,this.view.notifyChange(this.camera),Ky=this.camera.zoom,Jy=Ky*e,Sy.z=this.camera.position.z,Hy=0,Wy=this.zoomTravelTime,this.updateMouseCursorType()):(r.lerpVectors(this.camera.position,Sy,1-1/e),this.initiateTravel(r,this.zoomTravelTime,null,!1))}}handleZoomOrtho(e){Hy=Math.min(Hy+e/1e3/Wy,1);const t=Ky+Hy*(Jy-Ky);this.camera.zoom!==t&&(this.camera.zoom=t,this.camera.updateProjectionMatrix(),this.view.viewToNormalizedCoords(Py,Uy),Uy.z=0,Uy.unproject(this.camera),this.camera.position.x+=Sy.x-Uy.x,this.camera.position.y+=Sy.y-Uy.y,this.camera.updateMatrixWorld(!0)),this.testAnimationEnd()}initiateSmartTravel(){const e=this.getWorldPointAtScreenXY(Py),t=new s.Vector3;t.copy(e).sub(this.camera.position),t.z=0,t.normalize();const r=this.camera.position.distanceTo(e),n=s.MathUtils.lerp(this.smartTravelHeightMin,this.smartTravelHeightMax,Math.min(r/5e3,1)),i=new s.Vector3;i.copy(e),this.enableRotation&&i.add(t.multiplyScalar(2*-n)),i.z=e.z+n,this.camera.isOrthographicCamera&&(Ky=this.camera.zoom,Jy=Ky*(1+Math.min(r/5e3,1)),i.z=this.camera.position.z),this.initiateTravel(i,"auto",e,!0)}initiateTravel(e,t,r,n){if(this.state=3,this.view.notifyChange(this.camera),Hy=0,this.updateMouseCursorType(),$y=this.enableRotation&&r&&(r.isQuaternion||r.isVector3),Yy=n,jy.copy(this.camera.position),Vy.copy(this.camera.quaternion),$y&&(r.isQuaternion?qy.copy(r):r.isVector3&&(e===r?(this.camera.lookAt(r),qy.copy(this.camera.quaternion),this.camera.quaternion.copy(Vy)):(this.camera.position.copy(e),this.camera.lookAt(r),qy.copy(this.camera.quaternion),this.camera.quaternion.copy(Vy),this.camera.position.copy(jy)))),zy.copy(e),this.instantTravel)Wy=0;else if("auto"===t){const t=Math.min(1,e.distanceTo(this.camera.position)/this.autoTravelTimeDist);if(Wy=s.MathUtils.lerp(this.autoTravelTimeMin,this.autoTravelTimeMax,t),$y){const e=.5-.5*qy.normalize().dot(this.camera.quaternion.normalize());Wy*=1+2*e,Wy=Math.min(Wy,this.autoTravelTimeMax)}}else Wy=t}handleTravel(e){Hy=Math.min(Hy+e/1e3/Wy,1);const t=Yy?this.smooth(Hy):Hy;this.camera.position.lerpVectors(jy,zy,t);const r=Ky+t*(Jy-Ky);this.camera.isOrthographicCamera&&this.camera.zoom!==r&&(this.camera.zoom=r,this.camera.updateProjectionMatrix()),!0===$y&&this.camera.quaternion.slerpQuaternions(Vy,qy,t),this.testAnimationEnd()}testAnimationEnd(){1===Hy&&(this.state=My,this.updateMouseCursorType())}goToTopView(){const e=new s.Vector3,t=new s.Quaternion;e.copy(this.getWorldPointAtScreenXY(new s.Vector2(.5*this.view.mainLoop.gfxEngine.width,.5*this.view.mainLoop.gfxEngine.height))),e.z+=Math.min(this.maxAltitude,this.camera.position.distanceTo(e)),t.setFromAxisAngle(new s.Vector3(1,0,0),0),this.initiateTravel(e,"auto",t,!0)}goToStartView(){this.camera.isOrthographicCamera&&(Ky=this.camera.zoom,Jy=Iy),this.initiateTravel(Cy,"auto",_y,!0)}getWorldPointFromMathPlaneAtScreenXY(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.Vector3;return Gy.copy(this.view.viewToNormalizedCoords(e)),Xy.setFromCamera(Gy,this.camera),Zy.constant=t,Xy.ray.intersectPlane(Zy,r),r}getWorldPointAtScreenXY(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Vector3;return this.view.getPickingPositionFromDepth(e,t)||this.getWorldPointFromMathPlaneAtScreenXY(e,this.groundLevel,t),t}addInputListeners(){this.view.domElement.addEventListener("keydown",this._handlerOnKeyDown,!1),this.view.domElement.addEventListener("mousedown",this._handlerOnMouseDown,!1),this.view.domElement.addEventListener("mouseup",this._handlerOnMouseUp,!1),this.view.domElement.addEventListener("mouseleave",this._handlerOnMouseUp,!1),this.view.domElement.addEventListener("mousemove",this._handlerOnMouseMove,!1),this.view.domElement.addEventListener("wheel",this._handlerOnMouseWheel,!1),this.view.domElement.addEventListener("contextmenu",this._handlerContextMenu,!1)}removeInputListeners(){this.view.domElement.removeEventListener("keydown",this._handlerOnKeyDown,!0),this.view.domElement.removeEventListener("mousedown",this._handlerOnMouseDown,!1),this.view.domElement.removeEventListener("mouseup",this._handlerOnMouseUp,!1),this.view.domElement.removeEventListener("mouseleave",this._handlerOnMouseUp,!1),this.view.domElement.removeEventListener("mousemove",this._handlerOnMouseMove,!1),this.view.domElement.removeEventListener("wheel",this._handlerOnMouseWheel,!1),this.view.domElement.removeEventListener("contextmenu",this._handlerContextMenu,!1)}updateMouseCursorType(){switch(this.state){case My:this.view.domElement.style.cursor=this.cursor.default;break;case 0:this.view.domElement.style.cursor=this.cursor.drag;break;case 1:this.view.domElement.style.cursor=this.cursor.pan;break;case 3:this.view.domElement.style.cursor=this.cursor.travel;break;case 4:this.view.domElement.style.cursor=this.cursor.ortho_zoom;break;case 2:this.view.domElement.style.cursor=this.cursor.rotate}}updateMousePositionAndDelta(e){this.view.eventToViewCoords(e,Py),Dy.copy(Py).sub(Ry),Ry.copy(Py)}setCursor(e,t){this.cursor[e]=t,this.updateMouseCursorType()}onMouseDown(e){if(this.enabled&&(e.preventDefault(),this.view.domElement.focus(),My===this.state)){if(xy=e.button,this.updateMousePositionAndDelta(e),wy===e.button)if(e.ctrlKey){if(!this.enableRotation)return;this.initiateRotation()}else this.initiateDrag();else if(by===e.button){if(!this.enableSmartTravel)return;this.initiateSmartTravel()}else if(Ey===e.button){if(!this.enablePan)return;this.initiatePan()}this.updateMouseCursorType()}}onMouseUp(e){e.preventDefault(),3!==this.state&&4!==this.state&&xy===e.button&&(this.state=My),this.updateMouseCursorType()}onMouseMove(e){this.enabled&&(e.preventDefault(),this.updateMousePositionAndDelta(e),My!==this.state&&this.view.notifyChange())}onKeyDown(e){if(My===this.state&&this.enabled)switch(e.keyCode){case 84:this.camera.isOrthographicCamera||this.goToTopView();break;case 89:this.goToStartView();break;case 32:this.enableSmartTravel&&this.initiateSmartTravel(e)}}onMouseWheel(e){this.enabled&&(e.preventDefault(),e.stopPropagation(),My===this.state&&this.initiateZoom(e))}onContextMenu(e){e.preventDefault()}smooth(e){return(e**2*(3-2*e))**1.2}}const nv=rv,iv=new s.Quaternion,sv=new s.Vector3;class ov{constructor(e){e.projection&&(console.warn("PlanarTileBuilder projection parameter is deprecated, use crs instead."),e.crs??=e.projection),this._crs=e.crs,this._transform={coords:new i.E$("EPSG:4326",0,0),position:new s.Vector3,normal:new s.Vector3(0,0,1)},this._uvCount=e.uvCount??1}get uvCount(){return this._uvCount}get crs(){return this._crs}prepare(e){const t=e;return t.nbRow=2**(e.level+1),t.coordinates=new i.E$(this.crs),t}center(e){return e.center(this._transform.coords),sv.set(this._transform.coords.x,this._transform.coords.y,0),sv}vertexPosition(e){return this._transform.position.set(e.x,e.y,0),this._transform.position}vertexNormal(){return this._transform.normal}uProject(e,t){return t.west+e*(t.east-t.west)}vProject(e,t){return t.south+e*(t.north-t.south)}computeShareableExtent(e){return{shareableExtent:new i.zR(e.crs).setFromExtent({west:0,east:Math.abs(e.west-e.east),south:0,north:Math.abs(e.north-e.south)}),quaternion:iv,position:this.center(e).clone()}}}const av=class extends yh{constructor(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{minSubdivisionLevel:i=0,maxSubdivisionLevel:o=5,...a}=n,l=[t.crs];Go.get(t.crs)||Go.set(t.crs,t);const c=new ov({crs:t.crs});super(e,r||new s.Group,[t],c,{tileMatrixSets:l,...a}),this.isPlanarLayer=!0,this.extent=t,this.minSubdivisionLevel=i,this.maxSubdivisionLevel=o}},lv=class extends TA{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};s.Object3D.DEFAULT_UP.set(0,0,1),super(t.crs,e,r),this.isPlanarView=!0;const n=t.planarDimensions(),i=Math.max(n.x,n.y),o=new av("planar",t,r.object3d,r);this.mainLoop.gfxEngine.label2dRenderer.infoTileLayer=o.info,this.addLayer(o),this.addEventListener(mA.CAMERA_MOVED,(()=>{if(!this.tileLayer)return;const e=this.tileLayer.object3d,t=new s.Box3;if(e.traverse((e=>{if(e.isMesh&&e.geometry){e.geometry.computeBoundingBox();const r=(new s.Box3).copy(e.geometry.boundingBox).applyMatrix4(e.matrixWorld);t.union(r)}})),t.isEmpty())return;let r=0;const n=this.camera3D.position;for(const e of[t.min.x,t.max.x])for(const i of[t.min.y,t.max.y])for(const s of[t.min.z,t.max.z]){const t=n.distanceToSquared({x:e,y:i,z:s});t>r&&(r=t)}const i=Math.sqrt(r),o=this.camera3D.position.z-TA.ALTITUDE_MAX;this.camera3D.near=Math.max(1,o*this.fovDepthFactor);const a=n.z-t.min.z,l=this.farFactor*a;this.camera3D.far=Math.min(l,i),this.camera3D.updateProjectionMatrix();const c=this.scene.fog;c&&(c.far=l,c.near=c.far-this.fogSpread*(c.far-this.camera3D.near))}));const a=r.placement||{};a.isExtent||(a.coord=a.coord||t.center(),a.tilt=a.tilt||90,a.heading=a.heading||0,a.range=a.range||i),HA.transformCameraToLookAtTarget(this,this.camera3D,a),r.noControls||(this.controls=new nv(this,r.controls)),this.tileLayer=o,this.farFactor=r.farFactor??20,this.fogSpread=r.fogSpread??.5,this.scene.fog=new s.Fog(14872063,1,1e3)}addLayer(e){const t=super.addLayer(e,this.tileLayer);return t.then((()=>{this.dispatchEvent({type:mA.CAMERA_MOVED})})),t}},cv=4;function hv(e,t,r,n,i){if(t.layerUpdateState[r.id])if(e.isCancelledCommandException)t.layerUpdateState[r.id].success();else if(e instanceof SyntaxError)t.layerUpdateState[r.id].failure(0,!0);else{const e=t.layerUpdateState[r.id].errorCount>cv;t.layerUpdateState[r.id].failure(Date.now(),e,{targetLevel:n}),e||window.setTimeout((()=>{i.notifyChange(t,!1)}),1e3*t.layerUpdateState[r.id].secondsUntilNextTry())}}const uv=new i.E$("EPSG:4326",0,0,0),dv={update(e,t,r){if(!r.parent&&r.children.length)return void Cc.removeChildrenAndCleanupRecursively(t,r);if(!r.visible)return;if(void 0===r.layerUpdateState[t.id])r.layerUpdateState[t.id]=new Sc;else if(!r.layerUpdateState[t.id].canTryUpdate())return void r.link[t.id]?.forEach((e=>{e.layer.object3d.add(e),e.meshes.position.z=Mc(t.parent)?r.geoidHeight:0,e.meshes.updateMatrixWorld()}));let n,i=r.getExtentsByProjection(t.source.crs);if(i?n=i[0].zoom:(i=[r.extent],n=r.level),n!=t.zoom.min||!this.source.extentInsideLimit(r.extent,n)||t.source.isFileSource&&!r.extent.isPointInside(t.source.extent.center(uv)))return void r.layerUpdateState[t.id].noMoreUpdatePossible();r.layerUpdateState[t.id].newTry();const s={layer:t,extentsSource:i,view:e.view,requester:r};return e.scheduler.execute(s).then((n=>{r.layerUpdateState[t.id].noMoreUpdatePossible(),n.forEach((n=>{n?(r.link[t.id]=r.link[t.id]||[],n.as(e.view.referenceCrs),n.meshes.position.z=Mc(t.parent)?r.geoidHeight:0,n.updateMatrixWorld(),t.onMeshCreated&&t.onMeshCreated(n,e),r.parent?(t.object3d.add(n),r.link[t.id].push(n)):Cc.removeChildrenAndCleanupRecursively(t,n),n.layer=t):r.layerUpdateState[t.id].failure(1,!0)}))}),(n=>hv(n,r,t,r.level,e.view)))}};const pv=-1,fv=new s.Vector4;class gv extends s.EventDispatcher{constructor(e){super(),this.layer=e,this.crs=e.parent.tileMatrixSets.indexOf(e.crs),-1==this.crs&&console.error("Unknown crs:",e.crs),this.textures=[],this.offsetScales=[],this.level=pv,this.needsUpdate=!1,this._handlerCBEvent=()=>{this.needsUpdate=!0},e.addEventListener("visible-property-changed",this._handlerCBEvent),e.addEventListener("opacity-property-changed",this._handlerCBEvent)}get id(){return this.layer.id}get opacity(){return this.layer.opacity}get visible(){return this.layer.visible}initFromParent(e,t){if(e&&e.level>this.level){let r=0;const n=this.sortBestParentTextures(e.textures);for(const e of t){const t=n.find((t=>t&&e.isInside(t.extent)));t&&this.setTexture(r++,t,e.offsetToParent(t.extent))}}}sortBestParentTextures(e){return e.toSorted(((e,t)=>((e,t)=>e.isTexture===t.isTexture?0:e.isTexture?-1:1)(e,t)||((e,t)=>t.extent.zoom-e.extent.zoom)(e,t)))}disposeRedrawnTextures(e){const t=e.map(((e,t)=>this.shouldWriteTextureAtIndex(t,e)?t:-1)).filter((e=>-1!==e));t.length===e.length?this.dispose(!1):this.disposeAtIndexes(t)}dispose(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(this.layer.removeEventListener("visible-property-changed",this._handlerCBEvent),this.layer.removeEventListener("opacity-property-changed",this._handlerCBEvent),this._listeners={}),this.disposeAtIndexes(this.textures.keys()),this.textures=[],this.offsetScales=[],this.level=pv}disposeAtIndexes(e){for(const t of e){const e=this.textures[t];e&&e.isTexture&&e.dispose()}this.needsUpdate=!0}setTexture(e,t,r){this.shouldWriteTextureAtIndex(e,t)&&(this.level=t&&t.extent?t.extent.zoom:this.level,this.textures[e]=t||null,this.offsetScales[e]=r,this.needsUpdate=!0)}setTextures(e,t){this.disposeRedrawnTextures(e);for(let r=0,n=e.length;r<n;++r)this.setTexture(r,e[r],t[r])}shouldWriteTextureAtIndex(e,t){return!this.textures[e]||t&&t.isTexture}}class Av extends gv{get effect_type(){return this.layer.effect_type}get effect_parameter(){return this.layer.effect_parameter}get transparent(){return this.layer.transparent}}class mv extends gv{constructor(e){super(e);const t={bias:0,mode:Ee.DATA,zmin:-1/0,zmax:1/0};if(this.scaleFactor=1,e.useRgbaTextureElevation)throw t.mode=Ee.RGBA,t.zmax=5e3,new Error("Restore this feature");e.useColorTextureElevation?(this.scaleFactor=e.colorTextureElevationMaxZ-e.colorTextureElevationMinZ,t.mode=Ee.COLOR,t.bias=e.colorTextureElevationMinZ,this.min=this.layer.colorTextureElevationMinZ,this.max=this.layer.colorTextureElevationMaxZ):(this.min=0,this.max=0),this.bias=e.bias??t.bias,this.mode=e.mode??t.mode,this.zmin=e.zmin??t.zmin,this.zmax=e.zmax??t.zmax,e.addEventListener("scale-property-changed",this._handlerCBEvent)}get scale(){return this.layer.scale*this.scaleFactor}dispose(e){super.dispose(e),e&&this.layer.removeEventListener("scale-property-changed",this._handlerCBEvent)}initFromParent(e,t){const r=this.level;super.initFromParent(e,t),this.updateMinMaxElevation(),r!==this.level&&this.dispatchEvent({type:"rasterElevationLevelChanged",node:this})}setTextures(e,t){const r=e.find((e=>null!=e));if(!r)return;const n=this.level;this.replaceNoDataValueFromTexture(r),super.setTextures(e,t),this.updateMinMaxElevation(),n!==this.level&&this.dispatchEvent({type:"rasterElevationLevelChanged",node:this})}updateMinMaxElevation(){const e=this.textures.findIndex((e=>e.isTexture));if(-1!==e&&!this.layer.useColorTextureElevation){const{min:t,max:r}=function(e,t,r){const{width:n,height:i,data:s}=e.image;if(!s)return{min:null,max:null};let{min:o,max:a}=function(e,t,r){const n=t.x,i=t.y,s=t.z,o=[m(r,e,n,i),m(r,e,n+s,i),m(r,e,n+s,i+s),m(r,e,n,i+s)].filter((e=>null!=e));return o.length?{min:Math.min(...o),max:Math.max(...o)}:{min:1/0,max:-1/0}}(e,t,r);const l=Math.floor(t.z*n);if(l>2){const e=Math.floor(t.z*i),c=Math.floor(t.x*n),h=Math.floor(t.y*i),u=Math.max(Math.floor(l/32),2);for(let t=h;t<h+e;t+=u){let e=t*(n||0)+c;const i=e+l;for(;e<i;e+=u){const t=s[e];t!==r.noDataValue&&(a=Math.max(a,t),o=Math.min(o,t))}}}return null!=r.zmin&&(o<r.zmin&&(o=r.zmin),a<r.zmin&&(a=r.zmin)),null!=r.zmax&&(o>r.zmax&&(o=r.zmax),a>r.zmax&&(a=r.zmax)),a===-1/0||o===1/0?{min:null,max:null}:{min:o,max:a}}(this.textures[e],this.offsetScales[e],{noDataValue:this.layer.noDataValue,zmin:this.layer.zmin,zmax:this.layer.zmax});this.min==t&&this.max==r||(this.min=isNaN(t)?this.min:t,this.max=isNaN(r)?this.max:r)}}replaceNoDataValueFromTexture(e){const t=this.layer.noDataValue;if(null==t)return;const r=this.textures.find((e=>null!=e)),n=r&&r.image&&r.image.data,i=e.image&&e.image.data;i&&!function(e,t){const r=e.length;return e[0]>t&&e[r-1]>t&&e[Math.sqrt(r)-1]>t&&e[r-Math.sqrt(r)]>t}(i,t)&&function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>0,r=arguments.length>2?arguments[2]:void 0;for(let n=0,i=e.length;n<i;++n)e[n]===r&&(e[n]=t(n))}(i,n&&function(e,t,r,n){return e.extent.offsetToParent(t.extent,n),e=>r[function(e,t,r){const n=Math.floor(e/r)/r,i=t.x+e%r/r*t.z,s=t.y+n*t.w;return Math.floor(s*r)*r+Math.floor(i*r)}(e,n,256)]}(e,r,n,fv),t)}}const yv=0,vv=1,wv=2,bv=3;function Ev(e,t){const r=t.groups.filter((t=>t<=e));return r.length?r[r.length-1]:t.groups[0]}function xv(e,t,r){return t==pv?r?.min??0:Math.min(e,Math.ceil((t+e)/2))}function Cv(e,t,r,n,i){let s;const o=i?.max??1/0;if(n.lowestLevelError!=1/0)s=xv(n.lowestLevelError,r,i),s=n.lowestLevelError==s?s-1:s,e.type==vv&&(s=Ev(s,e.options));else{switch(e.type){case vv:s=Ev(t,e.options);break;case wv:s=function(e,t,r){return Math.min(e,t+(r.increment||1))}(t,r,e.options);break;case bv:s=xv(t,r,i);break;default:s=t}s=Math.min(s,o)}return s}function _v(e){return e.visible?100:10}function Iv(e){return!(e.requester.parent&&e.requester.material&&!(e.layer.isElevationLayer&&e.requester.material.getElevationTile()&&e.targetLevel<=e.requester.material.getElevationTile().level)&&e.requester.layerUpdateState[e.layer.id]&&e.layer.source._featuresCaches[e.layer.crs]&&e.requester.material.visible)}function Sv(e,t,r,n,i){return{view:e,layer:t,extentsSource:r,extentsDestination:n,requester:i,priority:_v(i.material),earlyDropFunction:Iv,partialLoading:!0}}function Mv(e,t){return t.map(((t,r)=>t.offsetToParent(e[r].extent)))}function Tv(e,t,r,n){const i=r.material;if(!n||!i)return;const s=r.getExtentsByProjection(t.crs),o=s[0].zoom;if(o>t.zoom.max||o<t.zoom.min)return;let a=i.getTile(t.id);if(void 0===r.layerUpdateState[t.id]){if(r.layerUpdateState[t.id]=new Sc,!t.source.extentInsideLimit(r.extent,o)&&(t.noTextureParentOutsideLimit||!n.material||!n.material.getTile||!n.material.getTile(t.id)))return void r.layerUpdateState[t.id].noMoreUpdatePossible();if(!a){a=t.setupRasterNode(r);const e=n.material?.getTile(t.id);a.initFromParent(e,s)}if(a.level>=t.source.zoom?.min)return void e.view.notifyChange(r,!1)}if(!i.visible)return;if(!t.visible||!r.layerUpdateState[t.id].canTryUpdate())return;if(a.level>=s[0].zoom)return void r.layerUpdateState[t.id].noMoreUpdatePossible();if(t.frozen)return;const l=r.layerUpdateState[t.id].failureParams,c=s[0].zoom||r.level,h=Cv(t.updateStrategy,c,a.level,l,t.source.zoom);if(!t.source.isVectorSource&&h<=a.level||h>c)return void(l.lowestLevelError!=1/0&&r.layerUpdateState[t.id].noMoreUpdatePossible());if(!t.source.extentInsideLimit(r.extent,h))return r.layerUpdateState[t.id].noData({targetLevel:h}),void e.view.notifyChange(r,!1);const u=s.map((e=>e.tiledExtentParent(h)));r.layerUpdateState[t.id].newTry();const d=Sv(e.view,t,u,s,r);return e.scheduler.execute(d).then((e=>{if(!r.layerUpdateState[t.id])return;const n=e.map(((e,t)=>null!=e?e:{isTexture:!1,extent:s[t]})),i=Mv(n,s);a.setTextures(n,i),r.layerUpdateState[t.id].success()}),(n=>hv(n,r,t,h,e.view)))}function Bv(e,t,r,n){const i=r.material;if(!n||!i)return;const s=r.getExtentsByProjection(t.crs),o=s[0].zoom;if(o>t.zoom.max||o<t.zoom.min)return;let a=i.getElevationTile();if(a||(a=t.setupRasterNode(r)),void 0===r.layerUpdateState[t.id]){r.layerUpdateState[t.id]=new Sc;const i=n.material?.getTile(t.id);if(a.initFromParent(i,s),a.level>=t.source.zoom.min)return void e.view.notifyChange(r,!1)}if(t.frozen||!i.visible||!r.layerUpdateState[t.id].canTryUpdate())return;const l=r.layerUpdateState[t.id].failureParams,c=Cv(t.updateStrategy,s[0].zoom,a.level,l,t.source.zoom);if(c<=a.level||c>s[0].zoom)return void r.layerUpdateState[t.id].noMoreUpdatePossible();if(!t.source.extentInsideLimit(r.extent,c))return r.layerUpdateState[t.id].noData({targetLevel:c}),void e.view.notifyChange(r,!1);const h=s.map((e=>e.tiledExtentParent(c)));r.layerUpdateState[t.id].newTry();const u=Sv(e.view,t,h,s,r);return e.scheduler.execute(u).then((e=>{if(!r.layerUpdateState[t.id])return;if(c<=a.level)return void r.layerUpdateState[t.id].noMoreUpdatePossible();const n=Mv(e,s);a.setTextures(e,n),r.layerUpdateState[t.id].success()}),(n=>hv(n,r,t,c,e.view)))}function Pv(e){return function(t){t.material?.removeTile&&(void 0!==t.material.elevationTile&&t.setBBoxZ({min:0,max:0}),t.material.removeTile(e)),t.layerUpdateState&&t.layerUpdateState[e]&&delete t.layerUpdateState[e]}}class Rv{constructor(e){this.size=e,this.pps=null,this.polynom=null,this.l1l2=null}setFromMicmacCalibration(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.pps=(new s.Vector2).fromArray(e.pps),this.polynom=(new s.Vector4).fromArray(e.poly357),this.l1l2=new s.Vector3,this.pps.y=t?this.size.y-this.pps.y:this.pps.y,this.polynom.w=e.limit**2,e.l1l2&&(this.l1l2.fromArray(e.l1l2),this.l1l2.z=e.etats)}clone(){const e=new Rv(this.size.clone());return e.pps=this.pps.clone(),e.polynom=this.polynom.clone(),e.l1l2=this.l1l2.clone(),e}}const Dv=new s.Vector3;class Lv extends s.PerspectiveCamera{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4,o=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0;e=e.isVector2?e:new s.Vector2(e,e),a=a||e.x/e.y,super(void 0,a,n,i),this.size=e,this.focal=t.isVector2?t:new s.Vector2(t,t),this.center=r||e.clone().multiplyScalar(.5),this.skew=o||0,this.textureMatrixWorldInverse=new s.Matrix4,Object.defineProperty(this,"fov",{get:()=>2*s.MathUtils.radToDeg(Math.atan2(this.size.y,2*this.focal.y)),set:e=>{const t=.5*this.size.y/Math.tan(s.MathUtils.degToRad(.5*e));this.focal.x=t,this.focal.y=t}}),this.distortion=new Rv(this.size),this.maskPath=void 0,this.mask=void 0,this.updateProjectionMatrix()}updateProjectionMatrix(){if(!this.focal)return;const e=this.near,t=e/this.focal.x,r=e/this.focal.y,n=-t*this.center.x,i=-r*this.center.y,s=n+t*this.size.x,o=i+r*this.size.y;this.projectionMatrix.makePerspective(n,s,o,i,e,this.far),this.projectionMatrix.elements[4]=2*this.skew/this.size.x;const a=this.size.x/this.size.y,l=this.aspect/a;Dv.set(this.zoom,this.zoom,1),l>1?Dv.x/=l:Dv.y*=l,this.projectionMatrix.scale(Dv)}copy(e,t){return super.copy(e,t),this.size=e.size.clone(),this.focal=e.focal.clone(),this.center=e.center.clone(),this.distortion=e.distortion.clone(),this.textureMatrixWorldInverse=e.textureMatrixWorldInverse.clone(),this.skew=e.skew,this.maskPath=e.maskPath,this.mask=e.mask,this}}const kv=Lv,Ov={38:{method:"translateZ",sign:-1},40:{method:"translateZ",sign:1},37:{method:"translateX",sign:-1},39:{method:"translateX",sign:1},33:{method:"rotateZ",sign:1,noSpeed:!0},34:{method:"rotateZ",sign:-1,noSpeed:!0},wheelup:{method:"translateZ",sign:1,oneshot:!0},wheeldown:{method:"translateZ",sign:-1,oneshot:!0}};function Fv(e){e.preventDefault(),this._isMouseDown=!0;const t=this.view.eventToViewCoords(e);this._onMouseDownMouseX=t.x,this._onMouseDownMouseY=t.y}function Nv(e){e.preventDefault(),this._isMouseDown=!0,this._onMouseDownMouseX=e.touches[0].pageX,this._onMouseDownMouseY=e.touches[0].pageY}function Uv(e){if(!0===this._isMouseDown){const t=this.view.eventToViewCoords(e),r=s.MathUtils.degToRad(this._camera3D.fov)/this.view.mainLoop.gfxEngine.height;this._camera3D.rotateY((t.x-this._onMouseDownMouseX)*r),this._camera3D.rotateX((t.y-this._onMouseDownMouseY)*r),this._onMouseDownMouseX=t.x,this._onMouseDownMouseY=t.y,this.view.notifyChange(this._camera3D,!1)}}function Qv(){this._isMouseDown=!1}function Gv(e){const t=Ov[e.keyCode];t&&(this.moves.delete(t),e.preventDefault())}function zv(e){const t=Ov[e.keyCode];t&&(this.moves.add(t),this.view.notifyChange(this._camera3D,!1),e.preventDefault())}function jv(e){-e.deltaY<0?this.moves.add(Ov.wheelup):this.moves.add(Ov.wheeldown),this.view.notifyChange(this._camera3D,!1)}class Vv extends s.EventDispatcher{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.view=e,this.options=t,this._camera3D=e.camera3D,this.moves=new Set,this.moveSpeed=10,this._onMouseDownMouseX=0,this._onMouseDownMouseY=0,this._isMouseDown=!1,e.domElement.addEventListener("mousedown",Fv.bind(this),!1),e.domElement.addEventListener("touchstart",Nv.bind(this),!1);const r=Uv.bind(this);e.domElement.addEventListener("mousemove",r,!1),e.domElement.addEventListener("touchmove",r,!1),e.domElement.addEventListener("mouseup",Qv.bind(this),!1),e.domElement.addEventListener("touchend",Qv.bind(this),!1),e.domElement.addEventListener("wheel",jv.bind(this),!1),e.domElement.addEventListener("keyup",Gv.bind(this),!0),e.domElement.addEventListener("keydown",zv.bind(this),!0),this.view.addFrameRequester(M.AFTER_CAMERA_UPDATE,this.update.bind(this)),t.focusOnMouseOver&&e.domElement.addEventListener("mouseover",(()=>e.domElement.focus())),t.focusOnClick&&e.domElement.addEventListener("click",(()=>e.domElement.focus()))}isUserInteracting(){return 0!==this.moves.size||this._isMouseDown}update(e,t){t&&(e=16);for(const t of this.moves)this._camera3D[t.method](t.sign*(t.noSpeed?1:this.moveSpeed)*e/1e3);if(this.moves.size>0||this._isMouseDown){this.view.notifyChange(this._camera3D);for(const e of this.moves)e.oneshot&&this.moves.delete(e)}}}const qv=Vv;function Hv(e,t,r){const n=.5*s.MathUtils.degToRad(r-e.fov);return s.MathUtils.clamp(t,-n,n)}const Wv=new s.Vector3(0,1,0);function $v(e,t,r){t.quaternion.setFromUnitVectors(Wv,t.up),t.rotateY(r.rotateY),t.rotateX(r.rotateX),e.notifyChange(e.camera3D)}const Yv={38:{method:"translateZ",sign:-1},40:{method:"translateZ",sign:1},37:{method:"translateX",sign:-1},39:{method:"translateX",sign:1},33:{method:"translateY",sign:1},34:{method:"translateY",sign:-1}};function Kv(e){this.camera.position.z+=e}const Jv=new s.Vector3,Xv=new s.Quaternion,Zv=new s.Euler(0,0,0,"YXZ");function ew(e){Jv.copy(this.camera.position),Jv.normalize(),this.camera.position.add(Jv.multiplyScalar(e))}class tw extends s.EventDispatcher{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(super(),this.isFirstPersonControls=!0,this.camera=e.camera3D,this.view=e,this.moves=new Set,t.panoramaRatio){const e=200*t.panoramaRatio/(2*Math.PI);t.verticalFOV=2==t.panoramaRatio?180:s.MathUtils.radToDeg(2*Math.atan(200/(2*e)))}t.verticalFOV=t.verticalFOV||180,t.moveSpeed=void 0===t.moveSpeed?10:t.moveSpeed,this.options=t,this._isMouseDown=!1,this._onMouseDownMouseX=0,this._onMouseDownMouseY=0,this._state={rotateX:0,rotateY:0,snapshot(){return{rotateX:this.rotateX,rotateY:this.rotateY}}},this.reset(),this.eventListeners=t.disableEventListeners,t.disableEventListeners||(this._onMouseDown=this.onMouseDown.bind(this),this._onMouseMove=this.onMouseMove.bind(this),this._onMouseUp=this.onMouseUp.bind(this),this._onMouseWheel=this.onMouseWheel.bind(this),this._onKeyUp=this.onKeyUp.bind(this),this._onKeyDown=this.onKeyDown.bind(this),this._onContextMenu=this.onContextMenu.bind(this),e.domElement.addEventListener("mousedown",this._onMouseDown,!1),e.domElement.addEventListener("touchstart",this._onMouseDown,!1),e.domElement.addEventListener("mousemove",this._onMouseMove,!1),e.domElement.addEventListener("touchmove",this._onMouseMove,!1),e.domElement.addEventListener("mouseup",this._onMouseUp,!1),e.domElement.addEventListener("touchend",this._onMouseUp,!1),e.domElement.addEventListener("wheel",this._onMouseWheel,!1),e.domElement.addEventListener("contextmenu",this._onContextMenu,!1),document.addEventListener("keydown",this._onKeyDown,!1),document.addEventListener("keyup",this._onKeyUp,!1)),this.view.addFrameRequester(M.AFTER_CAMERA_UPDATE,this.update.bind(this)),this._onFocus=()=>e.domElement.focus(),this.focusOnMouseOver=t.focusOnMouseOver,t.focusOnMouseOver&&e.domElement.addEventListener("mouseover",this._onFocus),this.focusOnClick=t.focusOnClick,t.focusOnClick&&e.domElement.addEventListener("click",this._onFocus),"EPSG:4978"==e.referenceCrs?this.moveCameraVertical=ew:this.moveCameraVertical=Kv}isUserInteracting(){return 0!==this.moves.size&&!this._isMouseDown}reset(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Xv.setFromUnitVectors(Wv,this.camera.up),Xv.invert(),Xv.multiply(this.camera.quaternion),Zv.setFromQuaternion(Xv),e||(this._state.rotateX=Zv.x),this._state.rotateY=Zv.y}update(e,t,r){if(0!=this.enabled){t&&(e=16);for(const t of this.moves)"translateY"===t.method?this.moveCameraVertical(t.sign*this.options.moveSpeed*e/1e3):this.camera[t.method](t.sign*this.options.moveSpeed*e/1e3);!0!==this._isMouseDown&&!0!==r||$v(this.view,this.camera,this._state),this.moves.size&&this.view.notifyChange(this.camera)}}onMouseDown(e){if(0==this.enabled)return;this._isMouseDown=!0;const t=this.view.eventToViewCoords(e);this._onMouseDownMouseX=t.x,this._onMouseDownMouseY=t.y,this._stateOnMouseDown=this._state.snapshot()}onMouseUp(){0!=this.enabled&&(this._isMouseDown=!1)}onMouseMove(e){if(0!=this.enabled&&!0===this._isMouseDown){const t=s.MathUtils.degToRad(this.camera.fov)/this.view.mainLoop.gfxEngine.height,r=this.view.eventToViewCoords(e);this._state.rotateY=(r.x-this._onMouseDownMouseX)*t+this._stateOnMouseDown.rotateY,this._state.rotateX=Hv(this.camera,(r.y-this._onMouseDownMouseY)*t+this._stateOnMouseDown.rotateX,this.options.verticalFOV),$v(this.view,this.camera,this._state)}}onMouseWheel(e){if(0==this.enabled)return;const t=e.deltaY;this.camera.fov=s.MathUtils.clamp(this.camera.fov+Math.sign(t),10,Math.min(100,this.options.verticalFOV)),this.camera.updateProjectionMatrix(),this._state.rotateX=Hv(this.camera,this._state.rotateX,this.options.verticalFOV),$v(this.view,this.camera,this._state)}onKeyUp(e){if(0==this.enabled)return;const t=Yv[e.keyCode];t&&(this.moves.delete(t),this.view.notifyChange(void 0,!1),e.preventDefault())}onKeyDown(e){if(0==this.enabled)return;const t=Yv[e.keyCode];t&&(this.moves.add(t),this.view.notifyChange(void 0,!1),e.preventDefault())}onContextMenu(e){e.preventDefault()}dispose(){this.eventListeners||(this.view.domElement.removeEventListener("mousedown",this._onMouseDown,!1),this.view.domElement.removeEventListener("touchstart",this._onMouseDown,!1),this.view.domElement.removeEventListener("mousemove",this._onMouseMove,!1),this.view.domElement.removeEventListener("touchmove",this._onMouseMove,!1),this.view.domElement.removeEventListener("mouseup",this._onMouseUp,!1),this.view.domElement.removeEventListener("touchend",this._onMouseUp,!1),this.view.domElement.removeEventListener("wheel",this._onMouseWheel,!1),this.view.domElement.removeEventListener("contextmenu",this._onContextMenu,!1),document.removeEventListener("keydown",this._onKeyDown,!1),document.removeEventListener("keyup",this._onKeyUp,!1)),this.focusOnMouseOver&&this.view.domElement.removeEventListener("mouseover",this._onFocus),this.focusOnClick&&this.view.domElement.removeEventListener("click",this._onFocus),this.dispatchEvent({type:"dispose"})}}const rw=tw,nw=new s.MeshBasicMaterial({color:16777215,depthTest:!1,transparent:!0,opacity:.5});function iw(e,t,r){e.position.copy(t),e.up.copy(t).normalize(),e.lookAt(r),e.updateMatrixWorld(!0)}const sw=new s.Vector3,ow=new s.Vector3,aw=new s.Matrix3,lw=new s.Vector3,cw=new s.Quaternion;function hw(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{},s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:()=>{};t.getPickingPositionFromDepth(t.eventToViewCoords(e),sw);const o=t.camera3D.position.distanceTo(sw),a=r?t.pickObjectsAt(e,-1,r):[];a.length&&a[0].distance<o?(aw.getNormalMatrix(a[0].object.matrixWorld),ow.copy(a[0].face.normal).applyNormalMatrix(aw),i(a[0].point,ow)):t.tileLayer&&o<.95*t.camera3D.far?(t.tileLayer.isGlobeLayer?lw.copy(sw).multiplyScalar(1.1):lw.set(0,0,1),n(sw,lw)):s()}function uw(e){return 100+30*Math.sqrt(e)}const dw=class extends rw{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(e,t),this.isStreetControls=!0,this._onMouseOut=super.onMouseUp.bind(this),e.domElement.addEventListener("mouseout",this._onMouseOut),this.previousPosition=void 0,this.currentPosition=void 0,this.nextPosition=void 0,this.keyGoToNextPosition=90,this.keyGoToPreviousPosition=83,this.keySetCameraToCurrentPositionAndLookAtNext=65,this.keySetCameraToCurrentPositionAndLookAtPrevious=81,this.tweenGroup=new kA.Ay.Group,this.surfaceGround=t.surfaceGround||function(){const e=new s.CircleGeometry(1,32);return new s.Mesh(e,nw)}(),this.surfaceWall=t.surfaceWall||function(){const e=new s.PlaneGeometry(4,2,1),t=new s.Mesh(e,nw);return t.rotateX(.5*-Math.PI),t}(),this.surfaces=new s.Object3D,this.surfaces.add(this.surfaceGround),this.surfaces.add(this.surfaceWall),this.view.scene.add(this.surfaces),this.wallMaxDistance=t.wallMaxDistance||1e3,this.animationDurationWall=t.animationDurationWall||200,this.buildingsLayer=t.buildingsLayer,this.computeTime=t.computeTime||uw,this.offset=t.offset||4,this.transformationPositionPickOnTheGround=t.transformationPositionPickOnTheGround||(e=>e),this.end=this.camera.clone()}setCurrentPosition(e){this.currentPosition=e}setNextPosition(e){this.nextPosition=e}setPreviousPosition(e){this.previousPosition=e}onMouseUp(e){0!=this.enabled&&(super.onMouseUp(),this._stateOnMouseDrag?this._stateOnMouseDrag=!1:hw(e,this.view,this.buildingsLayer,this.onClickOnGround.bind(this),this.onClickOnWall.bind(this)))}onMouseMove(e){0!=this.enabled&&(super.onMouseMove(e),this._isMouseDown?(this._stateOnMouseDrag=!0,this.stopAnimations()):this.tween||(hw(e,this.view,this.buildingsLayer,((e,t)=>{iw(this.surfaces,e,t),this.surfaceGround.visible=!0,this.surfaceWall.visible=!1}),((e,t)=>{iw(this.surfaces,e,t),this.surfaceWall.visible=!0,this.surfaceGround.visible=!1})),this.view.notifyChange(this.surfaces)))}setCameraToCurrentPosition(e){e?this.setCameraOnPosition(this.currentPosition,this.previousPosition):this.setCameraOnPosition(this.currentPosition,this.nextPosition)}setCameraOnPosition(e,t){e&&t&&(this.camera.position.copy(e),this.view.tileLayer&&this.view.tileLayer.isGlobeLayer?this.camera.up.copy(e).normalize():this.camera.up.set(0,0,1),this.camera.lookAt(t),this.camera.updateMatrixWorld(),this.reset())}onClickOnGround(e){e=this.transformationPositionPickOnTheGround(e),this.view.tileLayer&&this.view.tileLayer.isGlobeLayer?lw.copy(e).normalize():lw.set(0,0,1),e.add(lw.multiplyScalar(this.offset));const t=this.camera.position.distanceTo(e),r=this.computeTime(t);this.moveCameraTo(e,r)}onClickOnWall(e){this.camera.position.distanceTo(e)<this.wallMaxDistance&&this.animateCameraLookAt(e,this.animationDurationWall)}animateCameraLookAt(e,t){this.stopAnimations(),cw.copy(this.camera.quaternion),this.end.copy(this.camera),this.end.lookAt(e),this.tween=new kA.Ay.Tween({t:0}).to({t:1},t).easing(kA.Ay.Easing.Quadratic.Out).onComplete((()=>{this.stopAnimations()})).onUpdate((e=>{this.camera.quaternion.slerpQuaternions(cw,this.end.quaternion,e.t)})).start(),this.tweenGroup.add(this.tween),this.animationFrameRequester=()=>{this.tweenGroup.update(),this.reset(),this.view.notifyChange(this.camera)},this.view.addFrameRequester(M.BEFORE_RENDER,this.animationFrameRequester),this.view.notifyChange(this.camera)}moveCameraTo(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;if(!e)return Promise.resolve();const n=new Promise((e=>{t=e}));return this.stopAnimations(),this.tween=new kA.Ay.Tween(this.camera.position).to(e.clone(),r).easing(kA.Ay.Easing.Quadratic.Out).onComplete((()=>{this.stopAnimations(),t()})).start(),this.tweenGroup.add(this.tween),this.animationFrameRequester=()=>{this.tweenGroup.update(),this.view.notifyChange(this.camera)},this.view.addFrameRequester(M.BEFORE_RENDER,this.animationFrameRequester),this.view.notifyChange(this.camera),n}stopAnimations(){this.tween&&(this.tween.stop(),this.tween=void 0,this.tweenGroup.removeAll()),this.animationFrameRequester&&(this.view.removeFrameRequester(M.BEFORE_RENDER,this.animationFrameRequester),this.animationFrameRequester=null)}moveCameraToCurrentPosition(){this.moveCameraTo(this.currentPosition)}onKeyDown(e){0!=this.enabled&&(super.onKeyDown(e),e.keyCode==this.keyGoToNextPosition&&this.moveCameraTo(this.nextPosition),e.keyCode==this.keyGoToPreviousPosition&&this.moveCameraTo(this.previousPosition),e.keyCode==this.keySetCameraToCurrentPositionAndLookAtNext&&(this.setCameraToCurrentPosition(),this.view.notifyChange(this.view.camera3D)),e.keyCode==this.keySetCameraToCurrentPositionAndLookAtPrevious&&(this.setCameraToCurrentPosition(!0),this.view.notifyChange(this.view.camera3D)))}dispose(){this.view.domElement.removeEventListener("mouseout",this._onMouseOut,!1),super.dispose()}};function pw(e,t,r=2){const n=t&&t.length,i=n?t[0]*r:e.length;let s=fw(e,0,i,r,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c;if(n&&(s=function(e,t,r,n){const i=[];for(let r=0,s=t.length;r<s;r++){const o=fw(e,t[r]*n,r<s-1?t[r+1]*n:e.length,n,!1);o===o.next&&(o.steiner=!0),i.push(_w(o))}i.sort(bw);for(let e=0;e<i.length;e++)r=Ew(i[e],r);return r}(e,t,s,r)),e.length>80*r){a=1/0,l=1/0;let t=-1/0,n=-1/0;for(let s=r;s<i;s+=r){const r=e[s],i=e[s+1];r<a&&(a=r),i<l&&(l=i),r>t&&(t=r),i>n&&(n=i)}c=Math.max(t-a,n-l),c=0!==c?32767/c:0}return Aw(s,o,r,a,l,c,0),o}function fw(e,t,r,n,i){let s;if(i===function(e,t,r,n){let i=0;for(let s=t,o=r-n;s<r;s+=n)i+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return i}(e,t,r,n)>0)for(let i=t;i<r;i+=n)s=Ow(i/n|0,e[i],e[i+1],s);else for(let i=r-n;i>=t;i-=n)s=Ow(i/n|0,e[i],e[i+1],s);return s&&Bw(s,s.next)&&(Fw(s),s=s.next),s}function gw(e,t){if(!e)return e;t||(t=e);let r,n=e;do{if(r=!1,n.steiner||!Bw(n,n.next)&&0!==Tw(n.prev,n,n.next))n=n.next;else{if(Fw(n),n=t=n.prev,n===n.next)break;r=!0}}while(r||n!==t);return t}function Aw(e,t,r,n,i,s,o){if(!e)return;!o&&s&&function(e,t,r,n){let i=e;do{0===i.z&&(i.z=Cw(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,r=1;do{let n,i=e;e=null;let s=null;for(t=0;i;){t++;let o=i,a=0;for(let e=0;e<r&&(a++,o=o.nextZ,o);e++);let l=r;for(;a>0||l>0&&o;)0!==a&&(0===l||!o||i.z<=o.z)?(n=i,i=i.nextZ,a--):(n=o,o=o.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;i=o}s.nextZ=null,r*=2}while(t>1)}(i)}(e,n,i,s);let a=e;for(;e.prev!==e.next;){const l=e.prev,c=e.next;if(s?yw(e,n,i,s):mw(e))t.push(l.i,e.i,c.i),Fw(e),e=c.next,a=c.next;else if((e=c)===a){o?1===o?Aw(e=vw(gw(e),t),t,r,n,i,s,2):2===o&&ww(e,t,r,n,i,s):Aw(gw(e),t,r,n,i,s,1);break}}}function mw(e){const t=e.prev,r=e,n=e.next;if(Tw(t,r,n)>=0)return!1;const i=t.x,s=r.x,o=n.x,a=t.y,l=r.y,c=n.y,h=Math.min(i,s,o),u=Math.min(a,l,c),d=Math.max(i,s,o),p=Math.max(a,l,c);let f=n.next;for(;f!==t;){if(f.x>=h&&f.x<=d&&f.y>=u&&f.y<=p&&Sw(i,a,s,l,o,c,f.x,f.y)&&Tw(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function yw(e,t,r,n){const i=e.prev,s=e,o=e.next;if(Tw(i,s,o)>=0)return!1;const a=i.x,l=s.x,c=o.x,h=i.y,u=s.y,d=o.y,p=Math.min(a,l,c),f=Math.min(h,u,d),g=Math.max(a,l,c),A=Math.max(h,u,d),m=Cw(p,f,t,r,n),y=Cw(g,A,t,r,n);let v=e.prevZ,w=e.nextZ;for(;v&&v.z>=m&&w&&w.z<=y;){if(v.x>=p&&v.x<=g&&v.y>=f&&v.y<=A&&v!==i&&v!==o&&Sw(a,h,l,u,c,d,v.x,v.y)&&Tw(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,w.x>=p&&w.x<=g&&w.y>=f&&w.y<=A&&w!==i&&w!==o&&Sw(a,h,l,u,c,d,w.x,w.y)&&Tw(w.prev,w,w.next)>=0)return!1;w=w.nextZ}for(;v&&v.z>=m;){if(v.x>=p&&v.x<=g&&v.y>=f&&v.y<=A&&v!==i&&v!==o&&Sw(a,h,l,u,c,d,v.x,v.y)&&Tw(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;w&&w.z<=y;){if(w.x>=p&&w.x<=g&&w.y>=f&&w.y<=A&&w!==i&&w!==o&&Sw(a,h,l,u,c,d,w.x,w.y)&&Tw(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function vw(e,t){let r=e;do{const n=r.prev,i=r.next.next;!Bw(n,i)&&Pw(n,r,r.next,i)&&Lw(n,i)&&Lw(i,n)&&(t.push(n.i,r.i,i.i),Fw(r),Fw(r.next),r=e=i),r=r.next}while(r!==e);return gw(r)}function ww(e,t,r,n,i,s){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&Mw(o,e)){let a=kw(o,e);return o=gw(o,o.next),a=gw(a,a.next),Aw(o,t,r,n,i,s,0),void Aw(a,t,r,n,i,s,0)}e=e.next}o=o.next}while(o!==e)}function bw(e,t){let r=e.x-t.x;return 0===r&&(r=e.y-t.y,0===r)&&(r=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)),r}function Ew(e,t){const r=function(e,t){let r=t;const n=e.x,i=e.y;let s,o=-1/0;if(Bw(e,r))return r;do{if(Bw(e,r.next))return r.next;if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){const e=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(e<=n&&e>o&&(o=e,s=r.x<r.next.x?r:r.next,e===n))return s}r=r.next}while(r!==t);if(!s)return null;const a=s,l=s.x,c=s.y;let h=1/0;r=s;do{if(n>=r.x&&r.x>=l&&n!==r.x&&Iw(i<c?n:o,i,l,c,i<c?o:n,i,r.x,r.y)){const t=Math.abs(i-r.y)/(n-r.x);Lw(r,e)&&(t<h||t===h&&(r.x>s.x||r.x===s.x&&xw(s,r)))&&(s=r,h=t)}r=r.next}while(r!==a);return s}(e,t);if(!r)return t;const n=kw(r,e);return gw(n,n.next),gw(r,r.next)}function xw(e,t){return Tw(e.prev,e,t.prev)<0&&Tw(t.next,e,e.next)<0}function Cw(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function _w(e){let t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function Iw(e,t,r,n,i,s,o,a){return(i-o)*(t-a)>=(e-o)*(s-a)&&(e-o)*(n-a)>=(r-o)*(t-a)&&(r-o)*(s-a)>=(i-o)*(n-a)}function Sw(e,t,r,n,i,s,o,a){return!(e===o&&t===a)&&Iw(e,t,r,n,i,s,o,a)}function Mw(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Pw(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(Lw(e,t)&&Lw(t,e)&&function(e,t){let r=e,n=!1;const i=(e.x+t.x)/2,s=(e.y+t.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&i<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(Tw(e.prev,e,t.prev)||Tw(e,t.prev,t))||Bw(e,t)&&Tw(e.prev,e,e.next)>0&&Tw(t.prev,t,t.next)>0)}function Tw(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Bw(e,t){return e.x===t.x&&e.y===t.y}function Pw(e,t,r,n){const i=Dw(Tw(e,t,r)),s=Dw(Tw(e,t,n)),o=Dw(Tw(r,n,e)),a=Dw(Tw(r,n,t));return i!==s&&o!==a||!(0!==i||!Rw(e,r,t))||!(0!==s||!Rw(e,n,t))||!(0!==o||!Rw(r,e,n))||!(0!==a||!Rw(r,t,n))}function Rw(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function Dw(e){return e>0?1:e<0?-1:0}function Lw(e,t){return Tw(e.prev,e,e.next)<0?Tw(e,t,e.next)>=0&&Tw(e,e.prev,t)>=0:Tw(e,t,e.prev)<0||Tw(e,e.next,t)<0}function kw(e,t){const r=Nw(e.i,e.x,e.y),n=Nw(t.i,t.x,t.y),i=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,s.next=n,n.prev=s,n}function Ow(e,t,r,n){const i=Nw(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Fw(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Nw(e,t,r){return{i:e,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}const Uw=new i.E$("EPSG:4326",0,0,0),Qw=new sA,Gw=new aA;let zw;const jw=new s.Vector2,Vw=new s.Vector2,qw=new s.Vector3,Hw=new s.Vector3,Ww=new s.Vector3,$w=new s.Vector3,Yw=new i.zR("EPSG:4326",0,0,0,0),Kw=new s.Color,Jw="EPSG:4326";class Xw extends s.Group{#fe;#ge;#Ae=(()=>new s.Group)();#me=(()=>new s.Group)();constructor(e,t){super(),this.meshes=(new s.Group).add(...e),this.#Ae=(new s.Group).add(this.meshes),this.#Ae.quaternion.copy(t.quaternion),this.#Ae.position.copy(t.position),this.#Ae.scale.copy(t.scale),this.#Ae.updateMatrix(),this.#ge=t.crs,this.#fe=this.#ge,this.extent=t.extent,this.add(this.#me.add(this.#Ae))}as(e){if(this.#fe!==e)if(this.#fe=e,e==this.#ge)this.place.position.set(0,0,0),this.position.set(0,0,0),this.scale.set(1,1,1),this.quaternion.identity();else{Uw.crs=this.#ge,this.extent.isExtent?(Yw.copy(this.extent).applyMatrix4(this.#Ae.matrix),Yw.as(Uw.crs,Yw)):this.extent.toExtent(Uw.crs,Yw),Yw.spatialEuclideanDimensions(jw),Yw.planarDimensions(Vw),Vw.x&&Vw.y&&this.scale.copy(jw).divide(Vw).setZ(1),this.#me.position.copy(this.#Ae.position).negate(),Uw.setFromVector3(this.#Ae.position);const t="EPSG:3857"==this.#ge?Jw:this.#ge;i.SZ.quaternionFromCRSToCRS(t,e)(Uw.as(Jw),this.quaternion),Uw.as(e,Uw).toVector3(this.position)}return this}}function Zw(e){return e?"Color"==e.type?e:Kw.set(e):Kw.set(16777215*Math.random())}function eb(e,t){return t<=255?new Uint8Array(e):t<=65535?new Uint16Array(e):new Uint32Array(e)}function tb(e,t,r,n,i){const s=e.length;e.length+=6*(n-1);for(let o=r,a=s;o<r+n-1;++o,++a)i?(e[a]=o,e[++a]=o+t,e[++a]=o+1,e[++a]=o+1,e[++a]=o+t,e[++a]=o+t+1):(e[a]=o+t,e[++a]=o,e[++a]=o+t+1,e[++a]=o+t+1,e[++a]=o,e[++a]=o+1)}function rb(e,t){const r=e.vertices,n=new Uint8Array(r.length),i=new Uint32Array(r.length),o=t.batchId||((e,t)=>t);let a=0;const l=new Float32Array(r);$w.setFromMatrixScale(Qw.collection.matrixWorldInverse),qw.set(0,0,1).multiply($w);const c=[];Qw.setFeature(e);for(const t of e.geometries){const r=t.indices[0].offset,s=t.indices[0].count,h=o(t.properties,a);Qw.setGeometry(t);for(let t=3*r,o=r;o<r+s;t+=3,o+=1){e.normals&&qw.fromArray(e.normals,t).multiply($w);const r=Qw.setLocalCoordinatesFromArray(e.vertices,t);zw.setContext(Qw);const{base_altitude:s,color:a,radius:u}=zw.point;Uw.copy(r).applyMatrix4(Qw.collection.matrixWorld),"EPSG:4978"==Uw.crs&&Uw.as("EPSG:4326",Uw),Hw.copy(qw).multiplyScalar(s-Uw.z).add(r).toArray(l,t),Zw(a).multiplyScalar(255).toArray(n,t),c.includes(u)||c.push(u),i[o]=h}a++}const h=new s.BufferGeometry;return h.setAttribute("position",new s.BufferAttribute(l,3)),h.setAttribute("color",new s.BufferAttribute(n,3,!0)),h.setAttribute("batchId",new s.BufferAttribute(i,1)),t.pointMaterial.size=c[0],c.length>1&&console.warn("Too many differents point.radius, only the first one will be used"),new s.Points(h,t.pointMaterial)}function nb(e,t,r){const n=(t*=3)+3*r;let i=0;for(let r=n-3,s=t;s<n;r=s,s+=3)i+=e[r]*e[s+1]-e[s]*e[r+1];return.5*i}function ib(e,t,r){const n=new s.InstancedMesh(e.geometry,e.material,t);let i=0;for(let e=0;e<3*t;e+=3){const t=new s.Matrix4;t.setPosition(r[e],r[e+1],r[e+2]),n.setMatrixAt(i,t),i++}return n.instanceMatrix.needsUpdate=!0,n}function sb(e,t){if(!e.vertices)return;let r;switch(e.type){case Vi.POINT:if(zw.point?.model?.object)try{r=function(e){const t=e.vertices,r=e.geometries.length,n=zw.point.model.object;if(n instanceof s.Mesh)return ib(n,r,t);if(n instanceof s.Object3D){const e=new s.Group;return function(e){const t=[];return e.updateMatrixWorld(),e.traverse((e=>{e instanceof s.Mesh&&(e.updateMatrixWorld(),e.geometry.applyMatrix4(e.matrixWorld),t.push(e))})),t}(n).forEach((n=>e.add(ib(n,r,t)))),e}throw new Error("The format of the model object provided in the style (layer.style.point.model.object) is not supported. Only THREE.Mesh or THREE.Object3D are supported.")}(e),r.isInstancedMesh=!0}catch(n){r=rb(e,t)}else r=rb(e,t);break;case Vi.LINE:r=function(e,t){const r=e.vertices,n=new Uint8Array(r.length),i=r.length/3,o=new Uint32Array(i),a=t.batchId||((e,t)=>t);let l=0;const c=new Float32Array(r.length),h=new s.BufferGeometry,u=[];Qw.setFeature(e);const d=eb(2*(i-e.geometries.length),i);let p=0;$w.setFromMatrixScale(Qw.collection.matrixWorldInverse),qw.set(0,0,1).multiply($w);for(const t of e.geometries){Qw.setGeometry(t);const r=a(t.properties,l),i=t.indices[0].offset;if(i>65535){console.warn("Feature to Line: integer overflow, too many points in lines");break}const s=i+t.indices[0].count;for(let t=3*i,a=i;a<s;t+=3,a+=1){if(a<s-1){if(!(a<65535))break;d[p++]=a,d[p++]=a+1}e.normals&&qw.fromArray(e.normals,t).multiply($w);const i=Qw.setLocalCoordinatesFromArray(e.vertices,t);zw.setContext(Qw);const{base_altitude:l,color:h,width:f}=zw.stroke;Uw.copy(i).applyMatrix4(Qw.collection.matrixWorld),"EPSG:4978"==Uw.crs&&Uw.as("EPSG:4326",Uw),Hw.copy(qw).multiplyScalar(l-Uw.z).add(i).toArray(c,t),Zw(h).multiplyScalar(255).toArray(n,t),u.includes(f)||u.push(f),o[a]=r}l++}return t.lineMaterial.linewidth=u[0],u.length>1&&console.warn("Too many differents stroke.width, only the first one will be used"),h.setAttribute("position",new s.BufferAttribute(c,3)),h.setAttribute("color",new s.BufferAttribute(n,3,!0)),h.setAttribute("batchId",new s.BufferAttribute(o,1)),h.setIndex(new s.BufferAttribute(d,1)),new s.LineSegments(h,t.lineMaterial)}(e,t);break;case Vi.POLYGON:r=zw.isExtruded()?function(e,t){const r=e.vertices,n=new Float32Array(2*r.length),i=r.length/3,o=new Uint8Array(2*r.length),a=[],l=new Uint32Array(n.length/3),c=t.batchId||((e,t)=>t);let h=0;Qw.setFeature(e),$w.setFromMatrixScale(Qw.collection.matrixWorldInverse),qw.set(0,0,1).multiply($w),Uw.setCrs(Qw.collection.crs);for(const t of e.geometries){Qw.setGeometry(t);const s=t.indices[0].offset,u=t.indices.slice(-1)[0],d=u.offset+u.count,p=d-s,f=t.indices[0].ccw??nb(r,s,p)<0,g=3*s,A=s+i,m=c(t.properties,h);for(let t=g,a=g+r.length,c=s;t<g+3*p;t+=3,a+=3,c+=1){e.normals&&qw.fromArray(e.normals,t).multiply($w);const s=Qw.setLocalCoordinatesFromArray(r,t);zw.setContext(Qw);const{base_altitude:h,extrusion_height:u,color:d}=zw.fill;Uw.copy(s).applyMatrix4(Qw.collection.matrixWorld),"EPSG:4978"==Uw.crs&&Uw.as("EPSG:4326",Uw),Hw.copy(qw).multiplyScalar(h-Uw.z).add(s).toArray(n,t),l[c]=m,Ww.copy(qw).multiplyScalar(u).add(Hw).toArray(n,a),l[c+i]=m;const p=Zw(d).multiplyScalar(255);p.toArray(o,a),p.multiplyScalar(.5).toArray(o,t)}h++;const y=pw(n.slice(3*A,3*(d+i)),t.indices.map((e=>e.offset-s)).slice(1),3),v=a.length;a.length+=y.length;for(let e=0;e<y.length;e++)a[v+e]=y[e]+A;tb(a,i,t.indices[0].offset,t.indices[0].count,f);for(let e=1;e<t.indices.length;e++){const r=t.indices[e];tb(a,i,r.offset,r.count,!(r.ccw??f))}}const u=new s.BufferGeometry;return u.setAttribute("position",new s.BufferAttribute(n,3)),u.setAttribute("color",new s.BufferAttribute(o,3,!0)),u.setAttribute("batchId",new s.BufferAttribute(l,1)),u.setIndex(new s.BufferAttribute(eb(a,n.length/3),1)),new s.Mesh(u,t.polygonMaterial)}(e,t):function(e,t){const r=new Float32Array(e.vertices),n=new Uint8Array(e.vertices.length),i=[],o=new Uint32Array(r.length/3),a=t.batchId||((e,t)=>t);Qw.setFeature(e),$w.setFromMatrixScale(Qw.collection.matrixWorldInverse),qw.set(0,0,1).multiply($w);let l=0;for(const t of e.geometries){const s=t.indices[0].offset;if(s>4294967295){console.warn("Feature to Polygon: integer overflow, too many points in polygons");break}Qw.setGeometry(t);const c=t.indices.slice(-1)[0],h=c.offset+c.count,u=3*s,d=a(t.properties,l);for(let t=u,i=s;t<u+3*(h-s);t+=3,i+=1){e.normals&&qw.fromArray(e.normals,t).multiply($w);const s=Qw.setLocalCoordinatesFromArray(e.vertices,t);zw.setContext(Qw);const{base_altitude:a,color:l}=zw.fill;Uw.copy(s).applyMatrix4(Qw.collection.matrixWorld),"EPSG:4978"==Uw.crs&&Uw.as("EPSG:4326",Uw),Hw.copy(qw).multiplyScalar(a-Uw.z).add(s).toArray(r,t),Zw(l).multiplyScalar(255).toArray(n,t),o[i]=d}l++;const p=pw(r.slice(3*s,3*h),t.indices.map((e=>e.offset-s)).slice(1),3),f=i.length;i.length+=p.length;for(let e=0;e<p.length;e++)i[f+e]=p[e]+s}const c=new s.BufferGeometry;return c.setAttribute("position",new s.BufferAttribute(r,3)),c.setAttribute("color",new s.BufferAttribute(n,3,!0)),c.setAttribute("batchId",new s.BufferAttribute(o,1)),c.setIndex(new s.BufferAttribute(eb(i,r.length/3),1)),new s.Mesh(c,t.polygonMaterial)}(e,t)}return r.isInstancedMesh||(r.material.vertexColors=!0,r.material.color=new s.Color(16777215)),r.feature=e,r}const ob={convert(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(e=>{e.color&&console.error("Color convert option is removed, use Style.xxx.color"),e.extrude&&console.error("extrude convert option is removed, use Style.fill.extrusion_height instead"),e.altitude&&console.error("altitude convert option is removed, use Style.xxx.base_altitude instead")})(e),function(t){if(!t)return;e.pointMaterial||(e.pointMaterial=dh(new s.PointsMaterial,this),e.lineMaterial=dh(new s.LineBasicMaterial,this),e.polygonMaterial=dh(new s.MeshBasicMaterial,this)),zw=this?.style||(e.style?new aA(e.style):Gw),Qw.setCollection(t);const r=t.features;if(!r||0==r.length)return;const n=r.map((t=>{const r=sb(t,e);return r.layer=this,r}));return new Xw(n,t)}}},ab={color_layers_pars_fragment:"struct Layer {\n    int textureOffset;\n    int crs;\n    int effect_type;\n    float effect_parameter;\n    float opacity;\n    bool transparent;\n};\n\n#include <itowns/custom_header_colorLayer>\n\nuniform sampler2DArray   colorTextures;\nuniform vec4        colorOffsetScales[NUM_FS_TEXTURES];\nuniform Layer       colorLayers[NUM_FS_TEXTURES];\nuniform int         colorTextureCount;\n\nvec3 uvs[NUM_CRS];\n\nfloat getBorderDistance(vec2 uv) {\n    vec2 p2 = min(uv, 1. -uv);\n    return min(p2.x, p2.y);\n}\n\nfloat tolerance = 0.99;\n\nvec4 applyWhiteToInvisibleEffect(vec4 color) {\n    float a = dot(color.rgb, vec3(0.333333333));\n    if (a >= tolerance) {\n        color.a = 0.0;\n    }\n    return color;\n}\n\nvec4 applyLightColorToInvisibleEffect(vec4 color, float intensity) {\n    float a = max(0.05,1. - length(color.xyz - 1.));\n    color.a *= 1.0 - pow(abs(a), intensity);\n    color.rgb *= color.rgb * color.rgb;\n    return color;\n}\n\n#if defined(DEBUG)\nuniform bool showOutline;\nuniform vec3 outlineColors[NUM_CRS];\nuniform float outlineWidth;\n\nvec4 getOutlineColor(vec3 outlineColor, vec2 uv) {\n    float alpha = 1. - clamp(getBorderDistance(uv) / outlineWidth, 0., 1.);\n    return vec4(outlineColor, alpha);\n}\n#endif\n\nuniform float minBorderDistance;\nvec4 getLayerColor(int textureOffset, sampler2DArray tex, vec4 offsetScale, Layer layer) {\n    if ( textureOffset >= colorTextureCount ) return vec4(0);\n\n    vec3 uv;\n    // #pragma unroll_loop\n    for ( int i = 0; i < NUM_CRS; i ++ ) {\n        if ( i == layer.crs ) uv = uvs[ i ];\n    }\n\n    float borderDistance = getBorderDistance(uv.xy);\n    if (textureOffset != layer.textureOffset + int(uv.z) || borderDistance < minBorderDistance ) return vec4(0);\n    vec4 color = texture(tex, vec3(pitUV(uv.xy, offsetScale), float(textureOffset)));\n    if (layer.effect_type == 3) {\n        #include <itowns/custom_body_colorLayer>\n    } else {\n        if (layer.transparent && color.a != 0.0) {\n            color.rgb /= color.a;\n        }\n\n        if (layer.effect_type == 1) {\n            color = applyLightColorToInvisibleEffect(color, layer.effect_parameter);\n        } else if (layer.effect_type == 2) {\n            color = applyWhiteToInvisibleEffect(color);\n        }\n    }\n    color.a *= layer.opacity;\n    return color;\n}\n",custom_body_colorLayer:"// no custom body",custom_header_colorLayer:"// no custom header",elevation_pars_vertex:"#if NUM_VS_TEXTURES > 0\n    struct Layer {\n        float scale;\n        float bias;\n        int mode;\n        float zmin;\n        float zmax;\n    };\n\n    uniform Layer       elevationLayers[NUM_VS_TEXTURES];\n    uniform sampler2DArray   elevationTextures;\n    uniform vec4        elevationOffsetScales[NUM_VS_TEXTURES];\n    uniform int         elevationTextureCount;\n    uniform float       geoidHeight;\n\n    highp float decode32(highp vec4 rgba) {\n        highp float Sign = 1.0 - step(128.0,rgba[0])*2.0;\n        highp float Exponent = 2.0 * mod(rgba[0],128.0) + step(128.0,rgba[1]) - 127.0;\n        highp float Mantissa = mod(rgba[1],128.0)*65536.0 + rgba[2]*256.0 +rgba[3] + float(0x800000);\n        highp float Result =  Sign * exp2(Exponent) * (Mantissa * exp2(-23.0 ));\n        return Result;\n    }\n\n    float getElevationMode(vec2 uv, sampler2DArray tex, int mode) {\n        if (mode == ELEVATION_RGBA)\n            return decode32(texture(tex, vec3(uv, 0.0)).abgr * 255.0);\n        if (mode == ELEVATION_DATA || mode == ELEVATION_COLOR)\n            return texture(tex, vec3(uv, 0.0)).r;\n        return 0.;\n    }\n\n    float getElevation(vec2 uv, sampler2DArray tex, vec4 offsetScale, Layer layer) {\n        // Elevation textures are inverted along the y-axis\n        uv = vec2(uv.x, 1.0 - uv.y);\n        uv = uv * offsetScale.zw + offsetScale.xy;\n        float d = clamp(getElevationMode(uv, tex, layer.mode), layer.zmin, layer.zmax);\n        return d * layer.scale + layer.bias;\n    }\n#endif\n",elevation_vertex:"#if NUM_VS_TEXTURES > 0\n    if(elevationTextureCount > 0) {\n        float elevation = getElevation(uv, elevationTextures, elevationOffsetScales[0], elevationLayers[0]);\n        transformed += elevation * normal;\n    }\n#endif\n",geoid_vertex:"transformed += geoidHeight * normal;\n",lighting_fragment:"if (lightingEnabled) {\n    float light = min(2. * dot(vNormal, lightPosition), 1.);\n    gl_FragColor.rgb *= light;\n}\n",lighting_pars_fragment:"uniform bool lightingEnabled;\nuniform vec3 lightPosition;\nvarying vec3 vNormal;\n",mode_depth_fragment:"#if defined(USE_LOGDEPTHBUF)\ngl_FragColor = packDepthToRGBA(gl_FragDepthEXT);\n#else\nfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\ngl_FragColor = packDepthToRGBA(fragCoordZ);\n#endif\n",mode_id_fragment:"// 16777216.0 == 256.0 * 256.0 * 256.0\ngl_FragColor = packDepthToRGBA(float(objectId) / 16777216.0);\n",mode_pars_fragment:"#if MODE == MODE_ID || MODE == MODE_DEPTH\n#include <packing>\n#endif\n\n#if MODE == MODE_ID\nuniform int objectId;\n#endif\n",overlay_fragment:"gl_FragColor.rgb = mix(gl_FragColor.rgb, overlayColor, overlayAlpha);\n",overlay_pars_fragment:"uniform vec3  overlayColor;\nuniform float overlayAlpha;\n",pitUV:"vec2 pitUV(vec2 uv, vec4 pit)\n{\n    return uv * pit.zw + vec2(pit.x, 1.0 - pit.w - pit.y);\n}\n\n",precision_qualifier:"precision highp float;\nprecision highp int;\n",projective_texturing_vertex:"for(int i = 0; i < ORIENTED_IMAGES_COUNT; ++i)\n    projectiveTextureCoords[i] = projectiveTextureMatrix[i] * mvPosition;\n",projective_texturing_pars_vertex:"uniform mat4 projectiveTextureMatrix[ORIENTED_IMAGES_COUNT];\nvarying vec4 projectiveTextureCoords[ORIENTED_IMAGES_COUNT];\n",projective_texturing_pars_fragment:"uniform sampler2D projectiveTexture[ORIENTED_IMAGES_COUNT];\nuniform sampler2D mask[ORIENTED_IMAGES_COUNT];\nvarying vec4      projectiveTextureCoords[ORIENTED_IMAGES_COUNT];\nuniform float     projectiveTextureAlphaBorder;\nuniform float     opacity;\nuniform bool      boostLight;\n\nstruct Distortion {\n    vec2 size;\n#if USE_DISTORTION\n    vec2 pps;\n    vec4 polynom;\n    vec3 l1l2;\n#endif\n};\n\nuniform Distortion projectiveTextureDistortion[ORIENTED_IMAGES_COUNT];\n\nfloat getAlphaBorder(vec2 p)\n{\n    vec2 d = clamp(projectiveTextureAlphaBorder * min(p, 1. - p), 0., 1.);\n    return min(d.x, d.y);\n}\n\n#if USE_DISTORTION\nvoid distort(inout vec2 p, vec4 polynom, vec2 pps)\n{\n    vec2 v = p - pps;\n    float v2 = dot(v, v);\n    if (v2 > polynom.w) {\n        p = vec2(-1.);\n    }\n    else {\n        p += (v2 * (polynom.x + v2 * (polynom.y + v2 * polynom.z) ) ) * v;\n    }\n}\n\nvoid distort(inout vec2 p, vec4 polynom, vec3 l1l2, vec2 pps)\n{\n    if ((l1l2.x == 0.) && (l1l2.y == 0.)) {\n        distort(p, polynom, pps);\n    } else {\n        vec2 AB = (p - pps) / l1l2.z;\n        float R = length(AB);\n        float lambda = atan(R) / R;\n        vec2 ab = lambda * AB;\n        float rho2 = dot(ab, ab);\n        float r357 = 1. + rho2* (polynom.x + rho2* (polynom.y + rho2 * polynom.z));\n        p = pps + l1l2.z * (r357 * ab + vec2(dot(l1l2.xy, ab), l1l2.y * ab.x));\n    }\n}\n#endif\n\nvec4 mixBaseColor(vec4 aColor, vec4 baseColor) {\n    #ifdef USE_BASE_MATERIAL\n        baseColor.rgb = aColor.a == 1.0 ? aColor.rgb : mix(baseColor, aColor, aColor.a).rgb;\n        baseColor.a = min(1.0, aColor.a + baseColor.a);\n    #else\n        baseColor.rgb += aColor.rgb * aColor.a;\n        baseColor.a += aColor.a;\n    #endif\n    return baseColor;\n}\n\nvec4 projectiveTextureColor(vec4 coords, Distortion distortion, sampler2D tex, sampler2D mask, vec4 baseColor) {\n    vec3 p = coords.xyz / coords.w;\n    if(p.z * p.z < 1.) {\n#if USE_DISTORTION\n        p.xy *= distortion.size;\n        distort(p.xy, distortion.polynom, distortion.l1l2, distortion.pps);\n        p.xy /= distortion.size;\n#endif\n\n        float d = getAlphaBorder(p.xy) * texture2D(mask, p.xy).r;\n\n        if(d > 0.) {\n\n#if DEBUG_ALPHA_BORDER\n        vec3 r = texture2D(tex, p.xy).rgb;\n        return mixBaseColor(vec4( r.r * d, r.g, r.b, 1.0), baseColor);\n#else\n        vec4 color = texture2D(tex, p.xy);\n        color.a *= d;\n        if (boostLight) {\n            return mixBaseColor(vec4(sqrt(color.rgb), color.a), baseColor);\n        } else {\n            return mixBaseColor(color, baseColor);\n        }\n#endif\n\n        }\n    }\n    return mixBaseColor(vec4(0.), baseColor);\n}\n"},lb=new class{constructor(e,t){this.path=t,this.target=e,this.install()}customHeaderColorLayer(e){ab.custom_header_colorLayer=e,this.target[`${this.path}custom_header_colorLayer`]=e}customBodyColorLayer(e){ab.custom_body_colorLayer=e,this.target[`${this.path}custom_body_colorLayer`]=e}install(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.target,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ab,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.path;return Object.keys(t).forEach((n=>{Object.defineProperty(this,n,{get:()=>t[n]}),e[r+n]=t[n]})),e}}(s.ShaderChunk,"itowns/"),cb=lb,hb=new aA,ub=new sA;let db;function pb(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[{offset:0,count:1}],n=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0;if(0===t.length)return;const l=new Path2D;for(const e of r)if(e.extent&&i.zR.intersectsExtent(e.extent,s)){const r=e.offset*n,i=r+e.count*n;l.moveTo(t[r],t[r+1]);for(let e=r+n;e<i;e+=n)l.lineTo(t[e],t[e+1])}db.applyToCanvasPolygon(e,l,o,a)}function fb(e,t,r,n){e.beginPath();const i=null==db.point.opacity?1:db.point.opacity;i!==e.globalAlpha&&(e.globalAlpha=i),e.arc(t,r,(db.point.radius||3)*n,0,2*Math.PI,!1),db.point.color&&(e.fillStyle=db.point.color,e.fill()),db.point.line&&(e.lineWidth=(db.point.width||1)*n,e.strokeStyle=db.point.line,e.stroke())}const gb=new i.E$("EPSG:4326",0,0,0);function Ab(e,t,r,n){const s=r.planarDimensions().x/e.canvas.width;for(const o of t.geometries)if(i.zR.intersectsExtent(o.extent,r)){if(ub.setGeometry(o),db.zoom.min>db.context.zoom||db.zoom.max<=db.context.zoom)return;if(t.type===Vi.POINT&&db.point){const i=(Math.round(db.point.radius*n)||3*n)*s;for(const s of o.indices){const o=s.offset*t.size,a=o+s.count*t.size;for(let s=o;s<a;s+=t.size)gb.setFromArray(t.vertices,s),r.isPointInside(gb,i)&&fb(e,t.vertices[s],t.vertices[s+1],n)}}else pb(e,t.vertices,o.indices,t.size,r,n,t.type==Vi.POLYGON)}}const mb=new s.Vector3,yb=new s.Vector3(0,0,1),vb=new s.Vector3,wb=new s.Quaternion,bb=new s.Matrix4,Eb=new s.Matrix4,xb=new s.Vector3,Cb=new i.zR("EPSG:4326",0,0,0,0),_b={createTextureFromFeature(e,t,r,n,i){let o;if(db=n||hb,db.setContext(ub),e){t.planarDimensions(yb);const a=document.createElement("canvas");gb.crs=t.crs,a.width=r,a.height=r;const l=a.getContext("2d",{willReadFrequently:!0});i&&(l.fillStyle=i.getStyle(),l.fillRect(0,0,r,r)),l.globalCompositeOperation=n.globalCompositeOperation||"source-over",l.imageSmoothingEnabled=!1,l.lineJoin="round",t.as(e.crs,Cb),Cb.applyMatrix4(e.matrixWorldInverse),e.isInverted?(xb.set(t.west,t.north,0),vb.set(l.canvas.width,-l.canvas.height,1).divide(yb)):(xb.set(t.west,t.south,0),vb.set(l.canvas.width,l.canvas.height,1).divide(yb)),bb.compose(xb.multiply(vb).negate(),wb,vb),Eb.multiplyMatrices(bb,e.matrixWorld),Eb.decompose(mb,wb,vb),l.setTransform(vb.x,0,0,vb.y,mb.x,mb.y);const c=Math.abs(1/vb.x);ub.setZoom(t.zoom);for(const t of e.features)ub.setFeature(t),Ab(l,t,Cb,c);o=new s.CanvasTexture(a),o.flipY=e.isInverted}else if(i){const e=new Uint8Array(3);e[0]=255*i.r,e[1]=255*i.g,e[2]=255*i.b,o=new s.DataTexture(e,1,1,s.RGBAFormat)}else o=new s.Texture;return o}},Ib=new i.zR("EPSG:4326"),Sb=(e,t)=>(e.generateMipmaps=!1,e.magFilter=t.magFilter||s.LinearFilter,e.minFilter=t.minFilter||s.LinearFilter,e),Mb={convert(e,t,r){let n;if(e.isFeatureCollection){const i=r.source.backgroundLayer,o=i&&i.paint?new s.Color(i.paint["background-color"]):void 0;t.toExtent(r.crs,Ib),n=_b.createTextureFromFeature(e,Ib,r.subdivisionThreshold,r.style,o),n.features=e,n.extent=t}else{if(!e.isTexture)throw new Error("Data type is not supported to convert into texture");n=e}return r.isColorLayer?function(e,t){return e.anisotropy=16,e.premultiplyAlpha=t.transparent,Sb(e,t)}(n,r):r.isElevationLayer?(n.flipY&&(n.flipY=!1),Sb(n,r)):void 0}},Tb=class extends uc{constructor(e,t){const{cacheLifeTime:r=Ec.TEXTURE,minFilter:n,magFilter:i,updateStrategy:s,...o}=t;super(e,{...o,cacheLifeTime:r}),this.minFilter=n,this.magFilter=i,this.updateStrategy=s??{type:yv,options:{}}}convert(e,t){return Mb.convert(e,t,this)}delete(e){e&&this.cache.clear();for(const e of this.parent.level0Nodes)e.traverse(Pv(this.id))}},Bb=class extends Tb{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var r;(r=t).fx&&(console.warn("ColorLayer fx is deprecated, use ColorLayer.effect_type and ColorLayer.effect_parameter instead."),r.fx>2?(r.effect_parameter=r.fx,r.effect_type=ye.removeLightColor):r.fx>0&&(r.effect_parameter=r.fx,r.effect_type=ye.removeWhiteColor));const{effect_type:n=0,effect_parameter:i=1,transparent:s,addLabelLayer:o=!1,mergeFeatures:a=!0,style:l={},...c}=t;super(e,c),this.isColorLayer=!0,this.style=l instanceof aA?l:new aA(l),this.visible=!0,this.defineLayerProperty("visible",this.visible),this.opacity=1,this.defineLayerProperty("opacity",this.opacity),this.sequence=0,this.defineLayerProperty("sequence",this.sequence),this.transparent=s||this.opacity<1,this.noTextureParentOutsideLimit=!!t.source&&t.source.isFileSource,this.effect_type=n,this.effect_parameter=i,this.buildExtent=!0,this.structure="2d",this.addLabelLayer=o,this.mergeFeatures=a}setupRasterNode(e){const t=new Av(this);return e.material.addColorTile(t),e.material.setColorTileIds(this.parent.colorLayersOrder),t}update(e,t,r,n){return Tv(e,this,r,n)}},Pb=class extends Tb{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{scale:r=1,noDataValue:n,clampValues:i,useRgbaTextureElevation:s,useColorTextureElevation:o,colorTextureElevationMinZ:a,colorTextureElevationMaxZ:l,bias:c,mode:h,...u}=t;super(e,u),this.isElevationLayer=!0,this.noDataValue=n,(t.zmin||t.zmax)&&console.warn("Config using zmin and zmax are deprecated, use {clampValues: {min, max}} structure."),this.zmin=i?.min??t.zmin,this.zmax=i?.max??t.zmax,this.defineLayerProperty("scale",r),this.useRgbaTextureElevation=s,this.useColorTextureElevation=o,this.colorTextureElevationMinZ=a,this.colorTextureElevationMaxZ=l,this.bias=c,this.mode=h}setupRasterNode(e){const t=new mv(this);e.material.setElevationTile(t),e.material.setElevationTileId(this.id);const r=()=>e.setBBoxZ({min:t.min,max:t.max,scale:this.scale});return r(),t.addEventListener("rasterElevationLevelChanged",r),this.addEventListener("scale-property-changed",r),e.addEventListener("dispose",(()=>{this.removeEventListener("scale-property-changed",r)})),t}update(e,t,r,n){return Bv(e,this,r,n)}},Rb=class extends _c{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{object3d:r,batchId:n,onMeshCreated:i,accurate:o=!0,filter:a,mergeFeatures:l=!0,style:c={},...h}=t;super(e,r||new s.Group,h),this.update=dv.update,this.convert=ob.convert({batchId:n}),this.onMeshCreated=i,this.isFeatureGeometryLayer=!0,this.style=c instanceof aA?c:new aA(c),this.accurate=o,this.buildExtent=!this.accurate,this.filter=a,this.mergeFeatures=l}preUpdate(e,t){t.has(this.parent)&&this.object3d.clear()}},Db=new s.Vector3,Lb=new s.Mesh,kb=new s.Box3;function Ob(e,t,r,n){return e.camera.camera3D.isOrthographicCamera?function(e,t,r){const n=new s.Vector4(r);n.applyMatrix4(e.camera.camera3D.projectionMatrix);const i=.5*n.x*e.camera.width,o=.5*n.y*e.camera.height,a=Math.sqrt(i*i+o*o);return Math.max(0,a-t)}(e,t,r):function(e,t,r,n){if(n<=0)return 1/0;const i=e.camera.preSSE*r/n;return Math.max(0,i-t)}(e,t,r,n)}function Fb(e){e.obj&&(e.obj.visible=!1),e.notVisibleSince||(e.notVisibleSince=Date.now(),e.sse=-1);for(const t of e.children)Fb(t)}function Nb(e){e.material.intensityRange?.set(e.minIntensityRange,e.maxIntensityRange)}function Ub(e){e.material.elevationRange?.set(e.minElevationRange,e.maxElevationRange)}function Qb(e){e.material.angleRange?.set(e.minAngleRange,e.maxAngleRange)}Lb.geometry.boundingBox=kb;const Gb=class extends _c{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{object3d:r=new s.Group,group:n=new s.Group,bboxes:i=new s.Group,octreeDepthLimit:o=-1,pointBudget:a=2e6,pointSize:l=2,sseThreshold:c=2,minIntensityRange:h=1,maxIntensityRange:u=65536,minElevationRange:d,maxElevationRange:p,minAngleRange:f=-90,maxAngleRange:g=90,material:A={},mode:m=sg.COLOR,...y}=t;super(e,r,y),this.isPointCloudLayer=!0,this.protocol="pointcloud",this.group=n,this.object3d.add(this.group),this.bboxes=i||new s.Group,this.bboxes.visible=!1,this.object3d.add(this.bboxes),this.group.updateMatrixWorld(),this.octreeDepthLimit=o,this.pointBudget=a,this.pointSize=l,this.sseThreshold=c,this.defineLayerProperty("minIntensityRange",h,Nb),this.defineLayerProperty("maxIntensityRange",u,Nb),this.defineLayerProperty("minElevationRange",d,Ub),this.defineLayerProperty("maxElevationRange",p,Ub),this.defineLayerProperty("minAngleRange",f,Qb),this.defineLayerProperty("maxAngleRange",g,Qb),this.material=A,this.material.isMaterial||(this.material.intensityRange=new s.Vector2(this.minIntensityRange,this.maxIntensityRange),this.material.elevationRange=new s.Vector2(this.minElevationRange,this.maxElevationRange),this.material.angleRange=new s.Vector2(this.minAngleRange,this.maxAngleRange),this.material=new pg(this.material)),this.mode=m||sg.COLOR,this.root=void 0}preUpdate(e,t){let r;e.camera.preSSE=e.camera.height/(2*Math.tan(.5*s.MathUtils.degToRad(e.camera.camera3D.fov))),this.material&&(this.material.visible=this.visible,this.material.opacity=this.opacity,this.material.size=this.pointSize,this.material.scale=e.camera.preSSE,this.material.updateUniforms&&this.material.updateUniforms());for(const e of t.values()){if(e.isCamera||e==this)return[this.root];if(void 0!==e.obj&&e.obj.isPoints&&e.obj.layer==this)if(r){if(r=e.findCommonAncestor(r),!r)return[this.root]}else r=e}return r?[r]:[this.root]}update(e,t,r){if(r.visible=!1,this.octreeDepthLimit>=0&&this.octreeDepthLimit<r.depth)return void Fb(r);const n=r.tightbbox?r.tightbbox:r.bbox;if(r.visible=e.camera.isBox3Visible(n,this.object3d.matrixWorld),r.visible){if(r.notVisibleSince=void 0,Db.copy(e.camera.camera3D.position).sub(this.object3d.getWorldPosition(new s.Vector3)),Db.applyQuaternion(this.object3d.getWorldQuaternion(new s.Quaternion).invert()),0!==r.numPoints)if(r.obj)r.obj.visible=!0;else if(!r.promise){const i=Math.max(.001,n.distanceToPoint(Db)),s=Ob(e,t.pointSize,r.pointSpacing,i)/i;r.promise=e.scheduler.execute({layer:t,requester:r,view:e.view,priority:s,redraw:!0,earlyDropFunction:e=>!e.requester.visible||!this.visible}).then((e=>{r.obj=e,r.tightbbox=e.tightbbox,this.group.add(r.obj),r.obj.updateMatrixWorld(!0)})).catch((e=>{if(!e.isCancelledCommandException)return e})).finally((()=>{r.promise=null}))}if(r.children&&r.children.length){const i=n.distanceToPoint(Db);if(r.sse=Ob(e,t.pointSize,r.pointSpacing,i)/this.sseThreshold,r.sse>=1)return r.children;for(const e of r.children)Fb(e)}}else Fb(r)}postUpdate(){this.displayedCount=0;for(const e of this.group.children)if(e.visible){const t=e.geometry.attributes.position.count;e.geometry.setDrawRange(0,t),this.displayedCount+=t}if(this.displayedCount>this.pointBudget)if(this.supportsProgressiveDisplay){const e=this.pointBudget/this.displayedCount;for(const t of this.group.children)if(t.visible){const r=Math.floor(t.geometry.drawRange.count*e);r>0?t.geometry.setDrawRange(0,r):t.visible=!1}this.displayedCount*=e}else{this.group.children.sort(((e,t)=>t.userData.node.sse-e.userData.node.sse));let e=!1;this.displayedCount=0;for(const t of this.group.children){const r=t.geometry.attributes.position.count;e||this.displayedCount+r>this.pointBudget?(t.visible=!1,e=!0):this.displayedCount+=r}}const e=Date.now();for(let t=this.group.children.length-1;t>=0;t--){const r=this.group.children[t];!r.visible&&e-r.userData.node.notVisibleSince>1e4&&(this.group.children.splice(t,1),r.geometry.dispose(),r.material=null,r.geometry=null,r.userData.node.obj=null)}}pickObjectsAt(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return bc.pickPointsAt(e,t,r,this,n)}getObjectToUpdateForAttachedLayers(e){if(e.obj){const t=e.parent;return t&&t.obj?{element:e.obj,parent:t.obj}:{element:e.obj}}}},zb=new s.Vector3,jb=new s.Vector3,Vb=new s.Vector3;class qb extends s.EventDispatcher{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;super(),this.numPoints=e,this.source=t,this.children=[],this.bbox=new s.Box3,this.sse=-1}get pointSpacing(){return this.source.spacing/2**this.depth}get id(){throw new Error("In extended PointCloudNode, you have to implement the getter id!")}add(e,t){this.children.push(e),e.parent=this,this.createChildAABB(e,t)}createChildAABB(e){const t=2**(e.depth-this.depth);this.bbox.getSize(zb).divideScalar(t),e.bbox.min.copy(this.bbox.min),jb.copy(this).multiplyScalar(t),Vb.subVectors(e,jb).multiply(zb),e.bbox.min.add(Vb),e.bbox.max.copy(e.bbox.min).add(zb)}load(){return this.source.fetcher(this.url,this.source.networkOptions).then((e=>this.source.parse(e,{in:this.source})))}findCommonAncestor(e){return e.depth!=this.depth?e.depth<this.depth?this.parent.findCommonAncestor(e):this.findCommonAncestor(e.parent):e.id==this.id?e:0!=e.depth?this.parent.findCommonAncestor(e.parent):void 0}}const Hb=qb,Wb=new s.Vector3;class $b extends Hb{constructor(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0;super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t),this.childrenBitField=e,this.depth=0,this.hierarchyKey="r",this.baseurl=t.baseurl}get octreeIsLoaded(){return!(this.childrenBitField&&0===this.children.length)}get url(){return`${this.baseurl}/${this.hierarchyKey}.${this.source.extension}`}get id(){return this.hierarchyKey}add(e,t){e.hierarchyKey=this.hierarchyKey+t,e.depth=this.depth+1,super.add(e,t)}createChildAABB(e,t){e.bbox.copy(this.bbox),this.bbox.getCenter(e.bbox.max),Wb.copy(e.bbox.max).sub(this.bbox.min),1===t?(e.bbox.min.z+=Wb.z,e.bbox.max.z+=Wb.z):3===t?(e.bbox.min.z+=Wb.z,e.bbox.max.z+=Wb.z,e.bbox.min.y+=Wb.y,e.bbox.max.y+=Wb.y):0===t||(2===t?(e.bbox.min.y+=Wb.y,e.bbox.max.y+=Wb.y):5===t?(e.bbox.min.z+=Wb.z,e.bbox.max.z+=Wb.z,e.bbox.min.x+=Wb.x,e.bbox.max.x+=Wb.x):7===t?(e.bbox.min.add(Wb),e.bbox.max.add(Wb)):4===t?(e.bbox.min.x+=Wb.x,e.bbox.max.x+=Wb.x):6===t&&(e.bbox.min.y+=Wb.y,e.bbox.max.y+=Wb.y,e.bbox.min.x+=Wb.x,e.bbox.max.x+=Wb.x))}load(){return this.octreeIsLoaded||this.loadOctree(),super.load()}loadOctree(){const e=`${this.baseurl}/${this.hierarchyKey}.${this.source.extensionOctree}`;return this.source.fetcher(e,this.source.networkOptions).then((e=>{const t=new DataView(e),r=[];let n=0;for(this.childrenBitField=t.getUint8(0),n+=1,this.numPoints=t.getUint32(1,!0),n+=4,r.push(this);r.length&&n<e.byteLength;){const i=r.shift();for(let s=0;s<8;s++)if(i.childrenBitField&1<<s&&n+5<=e.byteLength){const e=t.getUint8(n);n+=1;const o=t.getUint32(n,!0)||this.numPoints;n+=4;const a=new $b(o,e,this.source);i.add(a,s),a.depth%this.source.hierarchyStepSize==0?a.baseurl=`${this.baseurl}/${a.hierarchyKey.substring(1)}`:a.baseurl=this.baseurl,r.push(a)}}}))}}const Yb=$b,Kb=new s.Mesh,Jb=new s.Box3;Kb.geometry.boundingBox=Jb;const Xb=class extends Gb{constructor(e,t){super(e,t),this.isPotreeLayer=!0;const r=this.addInitializationStep();this.source.whenReady.then((e=>{this.scale=(new s.Vector3).addScalar(e.scale);const t=Array.isArray(e.pointAttributes)&&e.pointAttributes.find((e=>e.startsWith("NORMAL")));return t&&(this.material.defines[t]=1),this.supportsProgressiveDisplay="cin"===this.source.extension,this.root=new Yb(0,0,this.source),this.root.bbox.min.set(e.boundingBox.lx,e.boundingBox.ly,e.boundingBox.lz),this.root.bbox.max.set(e.boundingBox.ux,e.boundingBox.uy,e.boundingBox.uz),this.minElevationRange=this.minElevationRange??e.boundingBox.lz,this.maxElevationRange=this.maxElevationRange??e.boundingBox.uz,this.extent=i.zR.fromBox3(this.source.crs||"EPSG:4326",this.root.bbox),this.root.loadOctree().then(r)}))}};class Zb extends Yb{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2?arguments[2]:void 0)}get url(){return`${this.baseurl}/octree.bin`}networkOptions(e,t){const r=e;return{...this.source.networkOptions,headers:{...this.source.networkOptions.headers,...this.url.startsWith("https://raw.githubusercontent.com")?{}:{"content-type":"multipart/byteranges"},Range:`bytes=${r}-${r+t-1n}`}}}async load(){return this.octreeIsLoaded||await this.loadOctree(),this.source.fetcher(this.url,this.networkOptions(this.byteOffset,this.byteSize)).then((e=>this.source.parser(e,{in:{source:this.source,bbox:this.bbox,numPoints:this.numPoints}}))).then((e=>(this.loaded=!0,this.loading=!1,e.geometry)))}async loadOctree(){if(!this.loaded&&!this.loading)return this.loading=!0,2===this.nodeType?this.loadHierarchy():Promise.resolve()}async loadHierarchy(){const e=`${this.baseurl}/hierarchy.bin`,t=await this.source.fetcher(e,this.networkOptions(this.hierarchyByteOffset,this.hierarchyByteSize));this.parseHierarchy(t)}parseHierarchy(e){const t=new DataView(e),r=e.byteLength/22,n=[];n.push(this);for(let e=0;e<r;e++){const r=n.shift(),i=22*e,s=t.getUint8(i+0),o=t.getUint8(i+1),a=t.getUint32(i+2,!0),l=t.getBigInt64(i+6,!0),c=t.getBigInt64(i+14,!0);if(2===r.nodeType?(r.byteOffset=l,r.byteSize=c,r.numPoints=a):2===s?(r.hierarchyByteOffset=l,r.hierarchyByteSize=c,r.numPoints=a):(r.byteOffset=l,r.byteSize=c,r.numPoints=a),0n===r.byteSize&&(r.numPoints=0),r.nodeType=s,2!==r.nodeType)for(let e=0;e<8;e++){if(!(1<<e&o))continue;const t=new Zb(a,o,this.source);r.add(t,e),n.push(t)}}}}const eE=Zb,tE=new s.Mesh,rE=new s.Box3;tE.geometry.boundingBox=rE;const nE=class extends Gb{constructor(e,t){super(e,t),this.isPotreeLayer=!0;const r=this.addInitializationStep();this.source.whenReady.then((e=>{this.scale=new s.Vector3(1,1,1),this.metadata=e;const t=Array.isArray(e.attributes)&&e.attributes.find((e=>e.name.startsWith("NORMAL")));t&&(this.material.defines[t.name]=1);const n=new s.Vector3(...e.boundingBox.min),o=new s.Vector3(...e.boundingBox.max),a=new s.Box3(n,o),l=new eE(0,0,this.source);return l.bbox=a,l.boundingSphere=a.getBoundingSphere(new s.Sphere),this.minElevationRange=this.minElevationRange??e.boundingBox.min[2],this.maxElevationRange=this.maxElevationRange??e.boundingBox.max[2],l.nodeType=2,l.hierarchyByteOffset=0n,l.hierarchyByteSize=BigInt(e.hierarchy.firstChunkSize),l.byteOffset=0,this.root=l,this.extent=i.zR.fromBox3(this.source.crs||"EPSG:4326",a),this.root.loadOctree().then(r)}))}};function iE(e,t,r,n,i,s){const o={view:e,requester:i,layer:r,priority:i?1/(i.distance+1):100,metadata:n,redraw:s};return r.dispatchEvent({type:PE.ON_TILE_REQUESTED,metadata:n}),t.execute(o)}function sE(e){return e.children.filter((t=>t.layer==e.layer&&t.tileId))}const oE=new s.Matrix4;function aE(e,t,r,n){return!(!r.viewerRequestVolume||!r.viewerRequestVolume.viewerRequestVolumeCulling(t,n))||!(!r.boundingVolume||!r.boundingVolume.boundingVolumeCulling(t,n))}function lE(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=t.additiveRefinement||r>0;for(let i=0;i<t.children.length;i++)t.children[i].content?lE(e,t.children[i],r+1):n&&Cc.removeChildrenAndCleanupRecursively(t.children[i].layer,t.children[i]);if(n)t.dispose&&t.dispose(),delete t.content,e.tileset.tiles[t.tileId].loaded=!1,t.remove(...t.children),0==r&&t.parent&&t.parent.remove(t);else{const e=sE(t);t.remove(...e)}}function cE(e){if(!this.visible)return[];this.scale=e.camera._preSSE;const t=Date.now();if(this._cleanableTiles.length&&t-this._cleanableTiles[0].cleanableSince>this.cleanupDelay){this.root.cleanableSince=void 0;let e=0;for(;e<this._cleanableTiles.length;e++){const r=this._cleanableTiles[e];if(!(t-r.cleanableSince>this.cleanupDelay))break;lE(this,r)}this._cleanableTiles.splice(0,e)}return[this.root]}const hE=new s.Box3,uE=new s.Sphere;function dE(e,t){e.content&&(e.content.visible=t)}function pE(e,t){t.cleanableSince||(t.cleanableSince=Date.now(),e._cleanableTiles.push(t))}function fE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:aE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:gE;return function(r,n,i){if(i.parent.pendingSubdivision&&!i.parent.additiveRefinement)return void(i.visible=!1);const s=!e||!e(n,r.camera,i,i.matrixWorld);if(i.visible=s,s){let s;if(i.cleanableSince&&(n._cleanableTiles.splice(n._cleanableTiles.indexOf(i),1),i.cleanableSince=void 0),i.pendingSubdivision||t(r,n,i))(function(e,t,r,n){r.additiveRefinement?function(e,t,r,n){for(const i of t.tileset.tiles[r.tileId].children){if(i.promise||i.loaded)continue;let s=r.matrixWorld;i.transform&&(s=oE.multiplyMatrices(r.matrixWorld,i.transform)),(!n||!n(t,e.camera,i,s))&&(i.promise=iE(e.view,e.scheduler,t,i,r,!0).then((n=>{r.add(n),n.updateMatrixWorld(),t.onTileContentLoaded(n),e.view.notifyChange(i),i.loaded=!0,delete i.promise})))}}(e,t,r,n):function(e,t,r){if(!r.pendingSubdivision&&0==sE(r).length){const n=t.tileset.tiles[r.tileId].children;if(void 0===n||0===n.length)return;r.pendingSubdivision=!0;const i=[];for(let s=0;s<n.length;s++)i.push(iE(e.view,e.scheduler,t,n[s],r,!1).then((i=>{n[s].loaded=!0,r.add(i),i.updateMatrixWorld(),r.additiveRefinement&&e.view.notifyChange(r),t.tileset.tiles[i.tileId].loaded=!0,t.onTileContentLoaded(i)})));Promise.all(i).then((()=>{r.pendingSubdivision=!1,e.view.notifyChange(r)}))}}(e,t,r)})(r,n,i,e),dE(i,i.pendingSubdivision||i.additiveRefinement),s=sE(i);else{dE(i,!0);for(const e of sE(i))e.visible=!1,pE(n,e)}return s}pE(n,i)}}function gE(e,t,r){if(void 0===t.tileset.tiles[r.tileId].children)return!1;if(t.tileset.tiles[r.tileId].isTileset)return!0;const n=function(e,t){if(t.distance=0,t.boundingVolume.initialVolumeType===Wh.box)hE.copy(t.boundingVolume.volume),hE.applyMatrix4(t.matrixWorld),t.distance=hE.distanceToPoint(e.camera3D.position);else{if(t.boundingVolume.initialVolumeType!==Wh.sphere&&t.boundingVolume.initialVolumeType!==Wh.region)return 1/0;uE.copy(t.boundingVolume.volume),uE.applyMatrix4(t.matrixWorld),t.distance=Math.max(0,uE.distanceToPoint(e.camera3D.position))}return 0===t.distance?1/0:e._preSSE*(t.geometricError/t.distance)}(e.camera,r);return n>t.sseThreshold}const AE=new i.C1,mE=new s.Vector3,yE=new s.Vector3,vE=new i.E$("EPSG:4326"),wE=new s.Vector3,bE=new i.E$("EPSG:4326"),EE=new s.Vector3,xE=new s.Vector3,CE=new s.Vector3,_E=class{constructor(e,t,r){if(this.type=Hh.boundingVolume,e.region)this.initialVolumeType=Wh.region,this.volume=function(e,t){const r=e[2],n=e[0],i=e[1],o=e[3],a=e[4],l=e[5],c=s.MathUtils.radToDeg(r),h=s.MathUtils.radToDeg(n),u=s.MathUtils.radToDeg(i),d=s.MathUtils.radToDeg(o);bE.setFromValues(h,d,a),AE.cartographicToCartesian(bE,EE),vE.setFromValues(c,u,l),AE.cartographicToCartesian(vE,wE);const p=new s.Vector3;p.lerpVectors(EE,wE,.5);const f=xE.subVectors(EE,wE).length()/2,g=new s.Sphere(p,f);return g.applyMatrix4(t),g}(e.region,t);else if(e.box)this.initialVolumeType=Wh.box,this.volume=function(e){yE.set(e[0],e[1],e[2]),mE.set(e[3],e[7],e[11]).multiplyScalar(2);const t=new s.Box3;return t.setFromCenterAndSize(yE,mE),t}(e.box);else{if(!e.sphere)throw new Error(`Unknown bounding volume type: ${e}. 3D Tiles nodes must have a bounding volume of type\n            region, box or sphere.`);this.initialVolumeType=Wh.sphere,this.volume=function(e){const t=new s.Vector3;return t.set(e[0],e[1],e[2]),new s.Sphere(t,e[3])}(e.sphere)}e.extensions&&(this.extensions=r.parseExtensions(e.extensions,this.type))}boundingVolumeCulling(e,t){if(this.initialVolumeType===Wh.box)return!e.isBox3Visible(this.volume,t);if(this.initialVolumeType===Wh.sphere||this.initialVolumeType===Wh.region)return!e.isSphereVisible(this.volume,t);throw new Error("Unknown bounding volume type.")}viewerRequestVolumeCulling(e,t){return this.initialVolumeType===Wh.region?(console.warn("Region viewerRequestVolume not yet supported"),!0):this.initialVolumeType===Wh.box?(console.warn("Bounding box viewerRequestVolume not yet supported"),!0):this.initialVolumeType===Wh.sphere&&(CE.copy(this.volume.center),CE.applyMatrix4(t),!(e.camera3D.position.distanceTo(CE)<=this.volume.radius))}},IE=new s.Matrix4,SE=class{constructor(e,t,r){this.type=Hh.tileset,this.asset=e.asset,this.properties=e.properties,this.geometricError=e.geometricError,this.extensionsUsed=e.extensionsUsed,this.extensionsRequired=e.extensionsRequired,this.tiles=[],this.parseTiles(e.root,t,void 0,r),e.extensions&&(this.extensions=r.parseExtensions(e.extensions,this.type))}parseTiles(e,t,r,n){if(e.transform=e.transform?(new s.Matrix4).fromArray(e.transform):void 0,e._worldFromLocalTransform=e.transform,r&&r._worldFromLocalTransform&&(e.transform?e._worldFromLocalTransform=(new s.Matrix4).multiplyMatrices(r._worldFromLocalTransform,e.transform):e._worldFromLocalTransform=r._worldFromLocalTransform),(e.viewerRequestVolume&&e.viewerRequestVolume.region||e.boundingVolume&&e.boundingVolume.region)&&(e._worldFromLocalTransform?IE.copy(e._worldFromLocalTransform).invert():IE.identity()),e.viewerRequestVolume=e.viewerRequestVolume?new _E(e.viewerRequestVolume,IE,n):null,e.boundingVolume=e.boundingVolume?new _E(e.boundingVolume,IE,n):null,this.tiles.push(e),e.tileId=this.tiles.length-1,e.baseURL=t,e.children)for(const r of e.children)this.parseTiles(r,t,e,n)}extendTileset(e,t,r,n){this.parseTiles(e.root,r,this.tiles[t],n),this.tiles[t].children=[e.root],this.tiles[t].isTileset=!0}},ME=class{registerExtension(e,t){this[e]=t}getExtension(e,t){if(this[e]&&this[e][t])return this[e][t];console.error(`No extension manager registered for extension  ${e} and for class ${t}`)}isExtensionRegistered(e){return this[e]}parseExtensions(e,t){const r={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=new(this.getExtension(n,t))(e[n]));return r}};function TE(e){return e.batchTable?e.batchTable:e.parent?TE(e.parent):null}const BE=class{#ye;constructor(e,t,r,n,i){this.object3d=i,this.batchId=t,this.groups=r,this.userData=n,this.tileId=e,this.#ye=null}computeWorldBox3(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new s.Box3;return e.max.x=-1/0,e.max.y=-1/0,e.max.z=-1/0,e.min.x=1/0,e.min.y=1/0,e.min.z=1/0,this.groups.forEach((t=>{const r=t.start*this.object3d.geometry.attributes.position.itemSize,n=(t.start+t.count)*this.object3d.geometry.attributes.position.itemSize;for(let t=r;t<n;t++){const r=this.object3d.geometry.attributes.position.getX(t),n=this.object3d.geometry.attributes.position.getY(t),i=this.object3d.geometry.attributes.position.getZ(t);e.max.x=Math.max(r,e.max.x),e.max.y=Math.max(n,e.max.y),e.max.z=Math.max(i,e.max.z),e.min.x=Math.min(r,e.min.x),e.min.y=Math.min(n,e.min.y),e.min.z=Math.min(i,e.min.z)}})),e.applyMatrix4(this.object3d.matrixWorld),e}getInfo(){if(this.#ye)return this.#ye;const e=TE(this.object3d);return e?(this.#ye=e.getInfoById(this.batchId),this.#ye):(console.warn(`[C3DTFeature]: No batch table found for tile ${this.tileId}.`),null)}},PE={ON_TILE_CONTENT_LOADED:"on-tile-content-loaded",ON_TILE_REQUESTED:"on-tile-requested"},RE=fE();function DE(e){let t=e,r=t.tileId;for(;isNaN(r)&&t.parent;)t=t.parent,r=t.tileId;return r}function LE(e){return e.geometry&&e.geometry.attributes._batchid}const kE=class extends _c{#ve;constructor(e,t,r){console.warn("C3DTilesLayer is deprecated and will be removed in iTowns 3.0 version. Use OGC3DTilesLayer instead."),super(e,new s.Group,{source:t.source}),this.isC3DTilesLayer=!0,this.sseThreshold=t.sseThreshold||16,this.cleanupDelay=t.cleanupDelay||1e3,this.protocol="3d-tiles",this.name=t.name,this.registeredExtensions=t.registeredExtensions||new ME,this.pntsMode=sg.COLOR,this.pntsShape=og.CIRCLE,this.classification=t.classification,this.pntsSizeMode=ag.VALUE,this.pntsMinAttenuatedSize=t.pntsMinAttenuatedSize||1,this.pntsMaxAttenuatedSize=t.pntsMaxAttenuatedSize||7,t.pntsMode&&(Object.values(sg).includes(t.pntsMode)?this.pntsMode=t.pntsMode:console.warn("The points cloud mode doesn't exist. Use 'COLOR' or 'CLASSIFICATION' instead.")),t.pntsShape&&(Object.values(og).includes(t.pntsShape)?this.pntsShape=t.pntsShape:console.warn("The points cloud point shape doesn't exist. Use 'CIRCLE' or 'SQUARE' instead.")),t.pntsSizeMode&&(Object.values(ag).includes(t.pntsSizeMode)?this.pntsSizeMode=t.pntsSizeMode:console.warn("The points cloud size mode doesn't exist. Use 'VALUE' or 'ATTENUATED' instead.")),this._style=t.style||null,this.#ve=new Map,this.tilesC3DTileFeatures=new Map,t.onTileContentLoaded&&(console.warn("DEPRECATED onTileContentLoaded should not be passed at the contruction, use C3DTILES_LAYER_EVENTS.ON_TILE_CONTENT_LOADED event instead"),this.addEventListener(PE.ON_TILE_CONTENT_LOADED,t.onTileContentLoaded)),t.overrideMaterials&&(console.warn("overrideMaterials is deprecated, use style API instead"),this.overrideMaterials=t.overrideMaterials),this._cleanableTiles=[];const n=this.addInitializationStep();this.source.whenReady.then((e=>{if(this.tileset=new SE(e,this.source.baseUrl,this.registeredExtensions),this.tileset.extensionsUsed)for(const e of this.tileset.extensionsUsed)this.registeredExtensions.isExtensionRegistered(e)||(this.tileset.extensionsRequired&&this.tileset.extensionsRequired.includes(e)?console.error(`3D Tiles tileset required extension "${e}" must be registered to the 3D Tiles layer of iTowns to be parsed and used.`):console.warn(`3D Tiles tileset used extension "${e}" must be registered to the 3D Tiles layer of iTowns to be parsed and used.`));(function(e,t,r,n){return iE(e,t,r,n,void 0,!0).then((e=>{r.object3d.add(e),e.updateMatrixWorld(),r.tileset.tiles[e.tileId].loaded=!0,r.root=e,r.onTileContentLoaded(e)}))})(r,r.mainLoop.scheduler,this,e.root).then(n)}))}preUpdate(e){return cE.bind(this)(e)}update(e,t,r){return RE(e,t,r)}getObjectToUpdateForAttachedLayers(e){if(e.content){const t=[];e.content.traverse((r=>{r.isObject3D&&r.material&&r.layer==e.layer&&t.push(r)}));const r=e.parent;return r&&r.content?{elements:t,parent:r.content}:{elements:t}}}getC3DTileFeatureFromIntersectsArray(e){let t=null;for(let r=0;r<e.length;r++){const n=e[r];if(n.object.geometry&&n.object.geometry.attributes._batchid&&n.face&&n.layer==this){t=n;break}}if(!t)return null;const r=DE(t.object),n=t.face.a,i=t.object.geometry.attributes._batchid.getX(n);return this.tilesC3DTileFeatures.get(r).get(i)}onTileContentLoaded(e){this.initC3DTileFeatures(e),this.dispatchEvent({type:PE.ON_TILE_CONTENT_LOADED,tileContent:e}),this.updateStyle([e.tileId])}initC3DTileFeatures(e){this.tilesC3DTileFeatures.set(e.tileId,new Map),e.traverse((t=>{if(LE(t)){const r=t.geometry.getAttribute("_batchid");let n=r.getX(0),i=0,s=0;const o=()=>{if(this.tilesC3DTileFeatures.get(e.tileId).has(n))this.tilesC3DTileFeatures.get(e.tileId).get(n).groups.push({start:i,count:s});else{const r=new BE(e.tileId,n,[{start:i,count:s}],{},t);this.tilesC3DTileFeatures.get(e.tileId).set(n,r)}},a=t.geometry.getAttribute("position"),l=a.count*a.itemSize;for(let e=0;e<l;e+=a.itemSize){const t=e/a.itemSize,c=r.getX(t);n!==c&&(o(),n=c,i=t,s=0),s++,e+a.itemSize>=l&&o()}}}))}updateStyle(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this._style)return!1;if(!this.object3d)return!1;const t=[],r=new Map;this.object3d.traverse((t=>{if(LE(t)){const n=DE(t);if(e&&!e.includes(n))return;r.has(n)||r.set(n,[]),r.get(n).push(t)}}));for(const[e,n]of r){const r=this.tilesC3DTileFeatures.get(e);n.forEach((e=>{e.geometry.clearGroups(),e.material=[];for(const[,t]of r){if(t.object3d!=e)continue;this._style.context.setGeometry({properties:t});const r=new s.Color(this._style.fill.color),n=this._style.fill.opacity,i=r.getHexString()+n;let o=null;this.#ve.has(i)?o=this.#ve.get(i):(o=new s.MeshStandardMaterial({color:r,opacity:n,transparent:n<1,alphaTest:.09}),this.#ve.set(i,o));let a=-1;for(let t=0;t<e.material.length;t++){const r=e.material[t];if(o.uuid===r.uuid){a=t;break}}a<0&&(e.material.push(o),a=e.material.length-1),t.groups.forEach((t=>{e.geometry.addGroup(t.start,t.count,a)}))}Kh(e),e.material instanceof Array?e.material.forEach((e=>{t.includes(e)||t.push(e)})):t.includes(e.material)||t.push(e.material)}))}for(const[e,r]of this.#ve)t.includes(r)||(r.dispose(),this.#ve.delete(e));return!0}get materialCount(){return this.#ve.size}set style(e){this._style=e instanceof aA?e:e?new aA(e):null,this.updateStyle()}get style(){return this._style}},OE=new s.Matrix4(1,0,0,1,0,1,0,1,0,0,2,0,0,0,0,2),FE=new s.DataTexture(new Uint8Array([255,255,255,255]),1,1,s.RGBAFormat,s.UnsignedByteType);FE.needsUpdate=!0;const NE=new s.Texture,UE=new s.ShaderMaterial;class QE extends s.ShaderMaterial{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.side=t.side??s.DoubleSide,t.transparent=t.transparent??!0,t.opacity=t.opacity??1;const r={};for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&void 0!==UE[e]&&(r[e]=t[e]);super(r),this.defines.ORIENTED_IMAGES_COUNT=t.OrientedImagesCount??e.length;const n=F.getMaxTextureUnitsCount();this.defines.ORIENTED_IMAGES_COUNT>n&&(console.warn(`OrientedImageMaterial: Can't project ${e.length} textures, because it's more than GPU capabilities maximum texture units (${n})`),this.defines.ORIENTED_IMAGES_COUNT=n-1,console.warn(`OrientedImageMaterial: We'll use only the first ${this.defines.ORIENTED_IMAGES_COUNT} cameras.`)),t.useBaseMaterial&&(this.defines.USE_BASE_MATERIAL=!0),this.defines.USE_DISTORTION=Number(e.some((e=>null!==e.distortion.pps))),this.alphaBorder=20|t.alphaBorder,this.defines.DEBUG_ALPHA_BORDER=0|t.debugAlphaBorder,this.cameras=e;const i=[],o=[],a=[],l=[];this.group=new s.Group;for(let t=0;t<this.defines.ORIENTED_IMAGES_COUNT;++t)o[t]=NE,a[t]=FE,i[t]=new s.Matrix4,e[t].needsUpdate=!0,l[t]=e[t].distortion,this.group.add(e[t]);this.uniforms.opacity=new s.Uniform(this.opacity),this.uniforms.projectiveTextureAlphaBorder=new s.Uniform(this.alphaBorder),this.uniforms.projectiveTextureDistortion=new s.Uniform(l),this.uniforms.projectiveTextureMatrix=new s.Uniform(i),this.uniforms.projectiveTexture=new s.Uniform(o),this.uniforms.mask=new s.Uniform(a),this.uniforms.boostLight=new s.Uniform(!1),this.uniforms.noProjectiveMaterial=new s.Uniform({lightDirection:new s.Vector3(.5,.5,-.5),ambient:new s.Color(.1,.1,.1),opacity:.75}),this.vertexShader="#include <itowns/precision_qualifier>\n#include <itowns/projective_texturing_pars_vertex>\n#include <common>\n#include <logdepthbuf_pars_vertex>\n\nvarying vec3 vNormal;\n\nvoid main() {\n    #include <begin_vertex>\n    #include <project_vertex>\n    vNormal = normal;\n    #include <itowns/projective_texturing_vertex>\n    #include <logdepthbuf_vertex>\n}\n",this.fragmentShader=W.unrollLoops("#include <itowns/precision_qualifier>\n#include <logdepthbuf_pars_fragment>\n#include <itowns/projective_texturing_pars_fragment>\nvarying vec3 vNormal;\n\n#ifdef USE_BASE_MATERIAL\nstruct noPT {\n    vec3 lightDirection;\n    vec3 ambient;\n    float opacity;\n};\n\nuniform noPT noProjectiveMaterial;\n#endif\n\nvoid main(void)\n{\n    #include <logdepthbuf_fragment>\n    #ifdef USE_BASE_MATERIAL\n    float nDotVP = (max(0.1, dot(vNormal, normalize(noProjectiveMaterial.lightDirection))));\n    vec4 color = vec4(noProjectiveMaterial.ambient + nDotVP, 0.0);\n    #else\n    vec4 color = vec4(0.0);\n    #endif\n\n    #pragma unroll_loop\n    for (int i = 0; i < ORIENTED_IMAGES_COUNT; i++) {\n        color = projectiveTextureColor(projectiveTextureCoords[ ORIENTED_IMAGES_COUNT - 1 - i ], projectiveTextureDistortion[ ORIENTED_IMAGES_COUNT - 1 - i ], projectiveTexture[ ORIENTED_IMAGES_COUNT - 1 - i ], mask[ORIENTED_IMAGES_COUNT - 1 - i], color);\n    }\n\n    #ifdef USE_BASE_MATERIAL\n    color.a = color.a < 1.0 ? max(noProjectiveMaterial.opacity, color.a) : 1.0 ;\n    gl_FragColor = vec4(color.rgb, color.a * opacity);\n    #else\n    gl_FragColor = vec4(color.rgb / color.a, opacity);\n    #endif\n\n}\n",this.defines)}setTextures(e,t,r){if(e){this.group.position.copy(t.position),this.group.quaternion.copy(t.quaternion);for(let t=0;t<e.length&&t<this.defines.ORIENTED_IMAGES_COUNT;++t){if(this.uniforms.projectiveTexture.value[t].dispose(),this.uniforms.projectiveTexture.value[t]=e[t],r){const e=this.group.children[t];if(r[t]!=e.name){const e=this.cameras.find((e=>e.name===r[t]));this.uniforms.mask.value[t]=e.maskTexture||FE,this.uniforms.mask.value[t].needsUpdate=!0,this.uniforms.projectiveTextureDistortion.value[t]=e.distortion,this.group.children[t]=e,e.parent=this.group}}this.group.children[t].needsUpdate=!0}this.group.updateMatrixWorld(!0)}}updateUniforms(e){for(let t=0;t<this.group.children.length;++t){const r=this.group.children[t];r.needsUpdate&&(r.textureMatrixWorldInverse.multiplyMatrices(OE,r.projectionMatrix),r.textureMatrixWorldInverse.multiply(r.matrixWorldInverse),r.needsUpdate=!1),this.uniforms.projectiveTextureMatrix.value[t].multiplyMatrices(r.textureMatrixWorldInverse,e.matrixWorld)}}}const GE=QE,zE=new s.TextureLoader,jE=new s.Matrix3,VE={parse(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=JSON.parse(e)),Promise.all(e.map((e=>function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=null==t.useMask||t.useMask,n=null==t.imageYDown||t.imageYDown,i=e.projection,o=(new s.Vector2).fromArray(e.size),a=new s.Vector2(i[0],i[4]),l=new s.Vector2(i[2],n?o.y-i[5]:i[5]),c=i[1],h=new kv(o,a,l,t.near,t.far,c);h.position.fromArray(e.position);const u=jE.fromArray(e.rotation);let d;h.matrix.setFromMatrix3(u),h.quaternion.setFromRotationMatrix(h.matrix),h.rotateX(Math.PI),e.distortion&&h.distortion.setFromMicmacCalibration(e.distortion,n),h.maskPath=e.mask,h.name=e.id;const p=new Promise((e=>{d=e}));return r&&h.maskPath?zE.load(h.maskPath,(e=>{h.maskTexture=e,d(h)})):d(h),p}(e,t))))}},qE=new i.E$("EPSG:4978",0,0,0),HE=e=>e.requester.id!==e.layer.currentPano.id;function WE(e){if(!e||e<=0)return;const t=new s.SphereGeometry(e,32,32),r=new s.MeshPhongMaterial({color:7829503,side:s.DoubleSide,transparent:!0,opacity:.5,wireframe:!0}),n=new s.Mesh(t,r);return n.visible=!0,n.name="OrientedImageBackground",n}const $E=class extends _c{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{backgroundDistance:r,background:n=WE(r),onPanoChanged:o=()=>{},getCamerasNameFromFeature:a=()=>{},...l}=t;t.projection&&(console.warn("OrientedImageLayer projection parameter is deprecated, use crs instead."),t.crs=t.crs||t.projection),super(e,new s.Group,l),this.isOrientedImageLayer=!0,this.background=n,this.background&&(this.background.layer=this.background.layer??{},this.background.layer.id=this.background.layer.id??e,this.object3d.add(this.background)),this.currentPano=void 0,this.onPanoChanged=o,this.getCamerasNameFromFeature=a;const c=this.addInitializationStep();this.mergeFeatures=!1,this.filteringExtent=!1,this.accurate=!0;const h={out:this};this.source.whenReady.then((e=>ds.parse(t.orientation||e.orientation,h).then((e=>{this.panos=e.features;const r=h.in.crs,n=t.crs,o=i.SZ.quaternionFromCRSToCRS(r,n),a=new s.Quaternion;let l=0;for(const t of this.panos)qE.crs=t.crs,qE.setFromArray(t.vertices).applyMatrix4(e.matrix),t.position=qE.toVector3(),o(qE,a),t.quaternion=i.SZ.quaternionFromAttitude(t.geometries[0].properties).premultiply(a),t.id=t.geometries[0].properties.id,t.index=l++})).then((()=>{VE.parse(t.calibration||e.calibration,t).then((e=>{this.cameras=e,this.material=new GE(this.cameras,t),c()}))}))))}update(){}set boostLight(e){this.material.uniforms.boostLight.value=e}get boostLight(){return this.material.uniforms.boostLight.value}preUpdate(e){var t;!function(e,t,r){const n=r.mostNearPano(t.position),i=r.currentPano?r.currentPano.id:void 0;if(n&&i!=n.id){r.currentPano=n,r.onPanoChanged({previousPanoPosition:r.getPreviousPano()?r.getPreviousPano().position:void 0,currentPanoPosition:r.getCurrentPano().position,nextPanoPosition:r.getNextPano().position});const t=n.geometries[0].properties.idSensors,i=r.cameras.map((e=>({cameraId:e.name,panoId:n.id,as:()=>{}}))).filter((e=>!t||t.includes(e.cameraId))),s={layer:r,extentsSource:i,view:e.view,requester:n,earlyDropFunction:HE};e.scheduler.execute(s).then((t=>{n.id===r.currentPano.id&&(r.material.setTextures(t,n,r.getCamerasNameFromFeature(n)),r.material.updateUniforms(e.camera.camera3D),e.view.notifyChange(r,!0))}),(()=>{}))}}(e,e.camera.camera3D,this),this.material.updateUniforms(e.camera.camera3D),(t=this).background&&t.currentPano&&(t.background.position.copy(t.currentPano.position),t.background.updateMatrixWorld(),t.background.material=t.material||t.background.material)}getNextPano(){const e=(this.currentPano.index+1)%this.panos.length;return this.panos[e]}getCurrentPano(){return this.currentPano}getPreviousPano(){const e=(this.currentPano.index-1)%this.panos.length;return this.panos[e]}delete(e){this.background&&super.delete(),e&&this.cache.clear(),this.material.visible=!1,console.warn("You need to replace OrientedImageLayer.material applied on each object. This issue will be fixed when OrientedImageLayer will be a ColorLayer. the material visibility is set to false. To follow issue see https://github.com/iTowns/itowns/issues/1018")}mostNearPano(e){let t,r=1/0;for(const n of this.panos){const i=e.distanceTo(n.position);i<r&&(r=i,t=n)}return t}};function YE(e,t,r,n){return`${e}-${t}-${r}-${n}`}class KE extends Hb{constructor(e,t,r,n,i){super(arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i),this.isEntwinePointTileNode=!0,this.depth=e,this.x=t,this.y=r,this.z=n,this.voxelKey=YE(e,t,r,n),this.url=`${this.source.url}/ept-data/${this.voxelKey}.${this.source.extension}`}get octreeIsLoaded(){return this.numPoints>=0}get id(){return`${this.depth}${this.x}${this.y}${this.z}`}loadOctree(){const e=`${this.source.url}/ept-hierarchy/${this.voxelKey}.json`;return sc.json(e,this.source.networkOptions).then((e=>{this.numPoints=e[this.voxelKey];const t=[];for(t.push(this);t.length;){const r=t.shift(),n=r.depth+1,i=2*r.x,s=2*r.y,o=2*r.z;r.findAndCreateChild(n,i,s,o,e,t),r.findAndCreateChild(n,i+1,s,o,e,t),r.findAndCreateChild(n,i,s+1,o,e,t),r.findAndCreateChild(n,i+1,s+1,o,e,t),r.findAndCreateChild(n,i,s,o+1,e,t),r.findAndCreateChild(n,i+1,s,o+1,e,t),r.findAndCreateChild(n,i,s+1,o+1,e,t),r.findAndCreateChild(n,i+1,s+1,o+1,e,t)}}))}findAndCreateChild(e,t,r,n,i,s){const o=i[YE(e,t,r,n)];if("number"==typeof o){const i=new KE(e,t,r,n,this.source,o);this.add(i),s.push(i)}}}const JE=KE,XE=new s.Mesh,ZE=new s.Box3;XE.geometry.boundingBox=ZE;const ex=class extends Gb{constructor(e,t){super(e,t),this.isEntwinePointTileLayer=!0,this.scale=new s.Vector3(1,1,1);const r=this.addInitializationStep();this.whenReady=this.source.whenReady.then((()=>(this.root=new JE(0,0,0,0,this.source,-1),this.root.bbox.min.fromArray(this.source.boundsConforming,0),this.root.bbox.max.fromArray(this.source.boundsConforming,3),this.minElevationRange=this.minElevationRange??this.source.boundsConforming[2],this.maxElevationRange=this.maxElevationRange??this.source.boundsConforming[5],this.extent=i.zR.fromBox3(t.crs||"EPSG:4326",this.root.bbox),this.root.loadOctree().then(r))))}};var tx=r(15234);function rx(e,t,r,n){return`${e}-${t}-${r}-${n}`}class nx extends Hb{constructor(e,t,r,n,i,s,o){super(arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,o),this.isCopcNode=!0,this.entryOffset=i,this.entryLength=s,this.depth=e,this.x=t,this.y=r,this.z=n,this.voxelKey=rx(e,t,r,n)}get octreeIsLoaded(){return this.numPoints>=0}get id(){return`${this.depth}${this.x}${this.y}${this.z}`}async _fetch(e,t){return this.source.fetcher(this.source.url,{...this.source.networkOptions,headers:{...this.source.networkOptions.headers,range:`bytes=${e}-${e+t-1}`}})}async loadOctree(){const e=await this._fetch(this.entryOffset,this.entryLength),t=await tx.Hierarchy.parse(new Uint8Array(e)),r=t.nodes[this.voxelKey];if(!r)return Promise.reject("[CopcNode]: Ill-formed data, entry not found in hierarchy.");this.numPoints=r.pointCount,this.entryOffset=r.pointDataOffset,this.entryLength=r.pointDataLength;const n=[];for(n.push(this);n.length;){const e=n.shift(),r=e.depth+1,i=2*e.x,s=2*e.y,o=2*e.z;e.findAndCreateChild(r,i,s,o,t,n),e.findAndCreateChild(r,i+1,s,o,t,n),e.findAndCreateChild(r,i,s+1,o,t,n),e.findAndCreateChild(r,i+1,s+1,o,t,n),e.findAndCreateChild(r,i,s,o+1,t,n),e.findAndCreateChild(r,i+1,s,o+1,t,n),e.findAndCreateChild(r,i,s+1,o+1,t,n),e.findAndCreateChild(r,i+1,s+1,o+1,t,n)}}findAndCreateChild(e,t,r,n,i,s){const o=rx(e,t,r,n);let a,l,c;const h=i.nodes[o];if(h)a=h.pointCount,l=h.pointDataOffset,c=h.pointDataLength;else{const e=i.pages[o];if(!e)return;a=-1,l=e.pageOffset,c=e.pageLength}const u=new nx(e,t,r,n,l,c,this.source,a);this.add(u),s.push(u)}async load(){this.octreeIsLoaded||await this.loadOctree();const e=await this._fetch(this.entryOffset,this.entryLength);return await this.source.parser(e,{in:{...this.source,pointCount:this.numPoints}})}}const ix=nx,sx=class extends Gb{constructor(e,t){super(e,t),this.isCopcLayer=!0;const r=()=>this;this.whenReady=this.source.whenReady.then((e=>{const{cube:t}=e.info,{pageOffset:n,pageLength:i}=e.info.rootHierarchyPage;return this.root=new ix(0,0,0,0,n,i,this.source,-1),this.root.bbox.min.fromArray(t,0),this.root.bbox.max.fromArray(t,3),this.minElevationRange=this.minElevationRange??e.header.min[2],this.maxElevationRange=this.maxElevationRange??e.header.max[2],this.scale=new s.Vector3(1,1,1),this.offset=new s.Vector3(0,0,0),this.root.loadOctree().then(r)}))}},ox=class extends cc{constructor(e){if(e.parsedData&&(console.warn("FileSource parsedData parameter is deprecated, use features instead of."),e.features=e.features||e.parsedData),e.projection&&(console.warn("FileSource projection parameter is deprecated, use crs instead."),e.crs=e.crs||e.projection),!e.crs){if(!e.features||!e.features.crs)throw new Error("source.crs is required in FileSource");e.crs=e.features.crs}if(!e.url&&!e.fetchedData&&!e.features)throw new Error("url, fetchedData and features are not set in\n                FileSource; at least one needs to be present");e.url=e.url||"none",super(e),this.isFileSource=!0,this.fetchedData=e.fetchedData,this.fetchedData||e.features?e.features&&(this._featuresCaches[e.features.crs]=new oe({max:500}),this._featuresCaches[e.features.crs].set(0,Promise.resolve(e.features))):this.whenReady=this.fetcher(this.urlFromExtent(),this.networkOptions).then((e=>{this.fetchedData=e})),this.whenReady.then((()=>this.fetchedData)),this.zoom={min:0,max:1/0}}urlFromExtent(){return this.url}onLayerAdded(e){e.in=this,super.onLayerAdded(e);let t=this._featuresCaches[e.out.crs].get(0);t||(e.out.buildExtent="EPSG:4978"!=this.crs,e.out.buildExtent&&(e.out.forcedExtentCrs="EPSG:4978"!=e.out.crs?e.out.crs:this.crs),t=this.parser(this.fetchedData,e),this._featuresCaches[e.out.crs].set(0,t)),t.then((e=>{e.extent&&(this.extent=e.extent.clone(),this.extent.crs==e.crs&&this.extent.applyMatrix4(e.matrixWorld))}))}loadData(e,t){return this._featuresCaches[t.crs].get(0)}extentInsideLimit(e){return this.extent.intersectsExtent(e)}},ax=new Uc("EPSG:4326",0,0,0),lx=class extends cc{constructor(e){if(e.format=e.format||"image/png",super(e),!e.crs)throw new Error("New TMSSource/WMTSSource: crs is required");if(this.isTMSSource=!0,e.extent||(this.extent=Go.get(e.crs)),this.zoom=e.zoom,this.isInverted=e.isInverted||!1,this.crs=e.crs,this.tileMatrixSetLimits=e.tileMatrixSetLimits,this.extentSetlimits={},this.tileMatrixCallback=e.tileMatrixCallback||(e=>e),!this.zoom)if(this.tileMatrixSetLimits){const e=Object.keys(this.tileMatrixSetLimits),t=e.length,r=Number(e[t-1]);this.zoom={min:r-t+1,max:r}}else this.zoom={min:0,max:1/0}}urlFromExtent(e){return Ng.xyz(e,this)}onLayerAdded(e){super.onLayerAdded(e);const t=e.out.parent,r=t?t.extent.crs:e.out.crs;if(this.tileMatrixSetLimits&&!this.extentSetlimits[r]){this.extentSetlimits[r]={},ax.crs=this.crs;for(let e=this.zoom.max;e>=this.zoom.min;e--){const t=this.tileMatrixSetLimits[e],{west:n,north:s}=ax.set(e,t.minTileRow,t.minTileCol).toExtent(r),{east:o,south:a}=ax.set(e,t.maxTileRow,t.maxTileCol).toExtent(r);this.extentSetlimits[r][e]=new i.zR(r,n,o,a,s)}}}extentInsideLimit(e,t){return t>=this.zoom.min&&t<=this.zoom.max&&(null==this.extentSetlimits[e.crs]||this.extentSetlimits[e.crs][t].intersectsExtent(e))}},cx=new i.zR("EPSG:4326"),hx=class extends cc{constructor(e){if(e.projection&&(console.warn("WFSSource projection parameter is deprecated, use crs instead."),e.crs=e.crs||e.projection),!e.typeName)throw new Error("source.typeName is required in wfs source.");if(!e.crs)throw new Error("source.crs is required in wfs source");e.format=e.format||"application/json",super(e),this.isWFSSource=!0,this.typeName=e.typeName,this.version=e.version||"2.0.2",this.bboxDigits=e.bboxDigits,this.zoom={min:0,max:1/0};const t=new URL(e.url);t.searchParams.set("SERVICE","WFS"),t.searchParams.set("REQUEST","GetFeature"),t.searchParams.set("typeName",this.typeName),t.searchParams.set("VERSION",this.version),t.searchParams.set("SRSNAME",this.crs),t.searchParams.set("outputFormat",this.format),t.searchParams.set("BBOX",`%bbox,${this.crs}`),this.vendorSpecific=e.vendorSpecific;for(const e in this.vendorSpecific)Object.prototype.hasOwnProperty.call(this.vendorSpecific,e)&&t.searchParams.set(e,this.vendorSpecific[e]);this.url=decodeURIComponent(t.toString())}handlingError(e){return e.response&&400==e.response.status?e.response.text().then((t=>{const r=`${this.url}SERVICE=WFS&REQUEST=GetCapabilities&VERSION=${this.version}`,n=(new DOMParser).parseFromString(t,"application/xml").querySelector("Exception"),i=n.getAttribute("exceptionCode"),s=n.querySelector("ExceptionText").textContent;console.error(`Source ${this.typeName}: bad request when fetching data. Server says: "${i}: ${s}". \nReviewing ${r} may help.`,e)})):super.handlingError(e)}getDataKey(e){return e.isTile?super.getDataKey(e):`z${e.zoom}s${e.south}w${e.west}`}urlFromExtent(e){const t=e.isExtent?e.as(this.crs,cx):e.toExtent(this.crs,cx);return Ng.bbox(t,this)}extentInsideLimit(e){return this.extent.intersectsExtent(e)}},ux=new i.zR("EPSG:4326"),dx={en:"wsen",es:"wnes",wn:"eswn",ws:"enws",ne:"swne",se:"nwse",nw:"senw",sw:"nesw"},px=class extends cc{constructor(e){if(!e.name)throw new Error("source.name is required.");if(!e.extent)throw new Error("source.extent is required");if(!e.crs&&!e.projection)throw new Error("source.crs is required");var t;e.format=e.format||"image/png",super(e),this.isWMSSource=!0,this.name=e.name,this.zoom={min:0,max:1/0},this.style=e.style||"",this.width=e.width||e.height||256,this.height=e.height||e.width||256,this.version=e.version||"1.3.0",this.transparent=e.transparent||!1,this.bboxDigits=e.bboxDigits,e.axisOrder?this.axisOrder=e.axisOrder:"1.3.0"===this.version?this.axisOrder=(t=i.tC.axisOrder(this.crs))&&dx[t.slice(0,2)]||"wsen":this.axisOrder="wsen";const r="1.3.0"===this.version?"CRS":"SRS",n=new URL(this.url);n.searchParams.set("SERVICE","WMS"),n.searchParams.set("REQUEST","GetMap"),n.searchParams.set("LAYERS",this.name),n.searchParams.set("VERSION",this.version),n.searchParams.set("STYLES",this.style),n.searchParams.set("FORMAT",this.format),n.searchParams.set("TRANSPARENT",this.transparent),n.searchParams.set("BBOX","%bbox"),n.searchParams.set(r,this.crs),n.searchParams.set("WIDTH",this.width),n.searchParams.set("HEIGHT",this.height),this.vendorSpecific=e.vendorSpecific;for(const e in this.vendorSpecific)Object.prototype.hasOwnProperty.call(this.vendorSpecific,e)&&n.searchParams.set(e,this.vendorSpecific[e]);this.url=decodeURIComponent(n.toString())}urlFromExtent(e){const t=e.isExtent?e.as(this.crs,ux):e.toExtent(this.crs,ux);return Ng.bbox(t,this)}extentInsideLimit(e){return this.extent.intersectsExtent(e)}},fx=class extends lx{constructor(e){if(!e.name)throw new Error("New WMTSSource: name is required");super(e),this.isWMTSSource=!0;const t=new URL(this.url);t.searchParams.set("LAYER",e.name),t.searchParams.set("FORMAT",this.format),t.searchParams.set("SERVICE","WMTS"),t.searchParams.set("VERSION",e.version||"1.0.0"),t.searchParams.set("REQUEST","GetTile"),t.searchParams.set("STYLE",e.style||"normal"),t.searchParams.set("TILEMATRIXSET",e.tileMatrixSet),t.searchParams.set("TILEMATRIX","%TILEMATRIX"),t.searchParams.set("TILEROW","%ROW"),t.searchParams.set("TILECOL","%COL"),this.vendorSpecific=e.vendorSpecific;for(const e in this.vendorSpecific)Object.prototype.hasOwnProperty.call(this.vendorSpecific,e)&&t.searchParams.set(e,this.vendorSpecific[e]);this.url=decodeURIComponent(t.toString())}},gx=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ax(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}function mx(e,t){const r=vx("https://api.mapbox.com");if(e.protocol=r.protocol,e.authority=r.authority,"http"===e.protocol){const t=e.params.indexOf("secure");t>=0&&e.params.splice(t,1)}if("/"!==r.path&&(e.path=`${r.path}${e.path}`),!(t=t||null))throw new Error("An API access token is required");if("s"===t[0])throw new Error("Use a public access token (pk.*), not a secret access token (sk.*).");return e.params=e.params.filter((e=>-1===e.indexOf("access_token"))),e.params.push(`access_token=${t}`),Ax(e)}function yx(e){return 0===e.indexOf("mapbox:")}function vx(e){const t=e.match(gx);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}const wx=function(e,t){if(!yx(e))return e;const r=vx(e);return r.path=`/styles/v1${r.path}`,mx(r,t)},bx=function(e,t){if(!yx(e))return e;const r=vx(e);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),mx(r,t)},Ex=function(e,t,r,n){const i=vx(e);return yx(e)?(i.path=`/styles/v1${i.path}/sprite${t}${r}`,mx(i,n)):(i.path+=`${t}${r}`,Ax(i))};function xx(e){return e.replace(/\{/g,"${")}const Cx=class extends lx{constructor(e){e.format="application/x-protobuf;type=mapbox-vector",e.crs="EPSG:3857",e.isInverted=!0,e.url=e.url||".",super(e);const t=e.filter||(()=>!0);let r,n;if(this.urls=[],this.layers={},this.styles={},this.isVectorTileSource=!0,this.accessToken=e.accessToken,!e.style)throw new Error("New VectorTilesSource: style is required");"string"==typeof e.style?(n=wx(e.style,this.accessToken),r=sc.json(n,this.networkOptions)):r=Promise.resolve(e.style),this.whenReady=r.then((t=>{this.jsonStyle=t;let r=e.sprite||t.sprite;if(r){r=new URL(r,n).toString();const e=Ex(r,"",".json",this.accessToken);return sc.json(e,this.networkOptions).then((e=>{this.sprites=e;const n=Ex(r,"",".png",this.accessToken);return this.sprites.source=n,t}))}return t})).then((e=>{if(e.layers.forEach(((r,n)=>{if(r.sourceUid=this.uid,"background"===r.type)this.backgroundLayer=r;else if(t(r)){void 0===r["source-layer"]&&function(e,t){const r=e.filter((e=>e.id===t.ref))[0];["type","source","source-layer","minzoom","maxzoom","filter","layout"].forEach((e=>{t[e]=r[e]}))}(e.layers,r);const t=Qi(r,this.sprites,this.symbolToCircle);this.styles[r.id]=t,this.layers[r["source-layer"]]||(this.layers[r["source-layer"]]=[]),this.layers[r["source-layer"]].push({id:r.id,order:n,filterExpression:Xn(r.filter)})}})),"."==this.url){const t=Object.values(e.sources).map((e=>{if(e.url){e.url=new URL(e.url,n).toString();const t=bx(e.url,this.accessToken);return sc.json(t,this.networkOptions).then((e=>{if(e.tiles[0])return e.tiles[0]=decodeURIComponent(new URL(e.tiles[0],t).toString()),xx(e.tiles[0])}))}return e.tiles?Promise.resolve(xx(e.tiles[0])):Promise.reject()}));return Promise.all(t)}return Promise.resolve([xx(this.url)])})).then((e=>{this.urls=Array.from(new Set(e))}))}urlFromExtent(e,t){return Ng.xyz(e,{tileMatrixCallback:this.tileMatrixCallback,url:t})}onLayerAdded(e){super.onLayerAdded(e),e.out.style&&e.out.isFeatureGeometryLayer&&e.out.accurate&&(console.warn("With VectorTilesSource and FeatureGeometryLayer, the accurate option is always false"),e.out.accurate=!1)}loadData(e,t){const r=this._featuresCaches[t.crs],n=this.getDataKey(e);let i=r.get(n);return i||(i=Promise.all(this.urls.map((r=>this.fetcher(this.urlFromExtent(e,r),this.networkOptions).then((r=>this.parser(r,{out:t,in:this,extent:e})))))).then((e=>function(e){const t=e[0];return e.forEach(((e,r)=>{0!==r&&e.features.forEach((e=>{t.features.push(e)}))})),t}(e))).catch((e=>this.handlingError(e))),r.set(n,i)),i}},_x=class extends cc{constructor(e){super(e),this.isOrientedImageSource=!0;const t=[];t.push(e.orientationsUrl?sc.json(e.orientationsUrl,this.networkOptions):Promise.resolve()),t.push(e.calibrationUrl?sc.json(e.calibrationUrl,this.networkOptions):Promise.resolve()),this.whenReady=Promise.all(t).then((e=>({orientation:e[0],calibration:e[1]})))}urlFromExtent(e){return this.imageUrl(e.cameraId,e.panoId)}getDataKey(e){return`c${e.cameraId}p${e.panoId}`}imageUrl(e,t){return this.url.replace("{cameraId}",e).replace("{panoId}",t)}},Ix={POSITION_CARTESIAN:{numElements:3,arrayType:Float32Array,attributeName:"position"},COLOR_PACKED:{numElements:4,arrayType:Uint8Array,attributeName:"color",normalized:!0},INTENSITY:{numElements:1,numByte:2,arrayType:Uint16Array,attributeName:"intensity",normalized:!0},CLASSIFICATION:{numElements:1,arrayType:Uint8Array,attributeName:"classification",normalized:!0},NORMAL_SPHEREMAPPED:{numElements:2,arrayType:Uint8Array,attributeName:"sphereMappedNormal"},NORMAL_OCT16:{numElements:2,arrayType:Uint8Array,attributeName:"oct16Normal"},NORMAL:{numElements:3,arrayType:Float32Array,attributeName:"normal"}};for(const e of Object.keys(Ix)){const t=Ix[e];t.potreeName=e,t.numByte=t.numByte||t.arrayType.BYTES_PER_ELEMENT,t.byteSize=t.numElements*t.numByte,t.normalized=t.normalized||!1;const r="getUint"+8*t.numByte;t.getValue=1===t.numByte?function(e,t){return e[r](t)}:function(e,t){return e[r](t,!0)}}const Sx={parse:function(e,t){if(!e)throw new Error("No array buffer provided.");const r=new DataView(e);let n=0;for(const e of t.in.pointAttributes)n+=Ix[e].byteSize;const i=Math.floor(e.byteLength/n),o=new s.BufferGeometry;let a=0,l=0;for(const e of t.in.pointAttributes){const t=Ix[e],c=t.numElements*i,h=new t.arrayType(c);for(let e=0;e<c;e+=t.numElements){for(let n=0;n<t.numElements;n++)h[e+n]=t.getValue(r,l+n*t.numByte);l+=n}a+=t.byteSize,l=a,o.setAttribute(t.attributeName,new s.BufferAttribute(h,t.numElements,t.normalized))}return o.computeBoundingBox(),Promise.resolve(o)}},Mx={parse:function(e){if(!e)throw new Error("No array buffer provided.");const t=new DataView(e,0,24),r=new s.Vector3(t.getFloat32(0,!0),t.getFloat32(4,!0),t.getFloat32(8,!0)),n=new s.Vector3(t.getFloat32(12,!0),t.getFloat32(16,!0),t.getFloat32(20,!0)),i=new s.Box3(r,n),o=Math.floor((e.byteLength-24)/16),a=new Float32Array(e,24,3*o),l=new Uint8Array(e,24+12*o,4*o),c=new s.BufferGeometry;return c.setAttribute("position",new s.BufferAttribute(a,3)),c.setAttribute("color",new s.BufferAttribute(l,4,!0)),c.boundingBox=i,Promise.resolve(c)}},Tx=class extends cc{constructor(e){if(!e.file)throw new Error("New PotreeSource: file is required");super(e),this.file=e.file,this.fetcher=sc.arrayBuffer,this.extensionOctree="hrc",this.whenReady=(e.cloud?Promise.resolve(e.cloud):sc.json(`${this.url}/${this.file}`,this.networkOptions)).then((e=>(this.pointAttributes=e.pointAttributes,this.baseurl=`${this.url}/${e.octreeDir}/r`,this.extension="CIN"===e.pointAttributes?"cin":"bin",this.parse="cin"===this.extension?Mx.parse:Sx.parse,this.spacing=e.spacing,this.hierarchyStepSize=e.hierarchyStepSize,e)))}};var Bx=r(40447);Bx.registerSerializer;const Px=Bx.spawn,Rx=(Bx.BlobWorker,Bx.DefaultSerializer,Bx.Pool,Bx.Thread),Dx=Bx.Transfer;let Lx;Bx.Worker;const kx={terminate(){const e=Lx;return Lx=void 0,Rx.terminate(e)},parse:async function(e,t){const n=t.in.source.metadata,i=t.in.source.pointAttributes,o=n.scale,a=t.in.bbox,l=a.min,c=a.max.clone().sub(a.min),h=a.max,u=n.offset,d=t.in.numPoints,p=function(e,t){return"BROTLI"===t.encoding?e.parseBrotli:e.parse}(await async function(){return Lx||(Lx=await Px(new Worker(new URL(r.p+r.u(343),r.b),{type:"module"})),Lx)}(),n),f=await p(Dx(e),{pointAttributes:i,scale:o,min:l,max:h,size:c,offset:u,numPoints:d}),g=f.attributeBuffers,A=new s.BufferGeometry;return Object.keys(g).forEach((e=>{const t=g[e].buffer;if("position"===e)A.setAttribute("position",new s.BufferAttribute(new Float32Array(t),3));else if("rgba"===e)A.setAttribute("color",new s.BufferAttribute(new Uint8Array(t),4,!0));else if("NORMAL"===e)A.setAttribute("normal",new s.BufferAttribute(new Float32Array(t),3));else if("INDICES"===e){const e=new s.BufferAttribute(new Uint8Array(t),4);e.normalized=!0,A.setAttribute("indices",e)}else{const r=new s.BufferAttribute(new Float32Array(t),1),n=g[e].attribute;r.potree={offset:g[e].offset,scale:g[e].scale,preciseBuffer:g[e].preciseBuffer,range:n.range},A.setAttribute(e,r)}})),A.computeBoundingBox(),{geometry:A,density:f.density}}},Ox={DATA_TYPE_DOUBLE:{name:"double",size:8},DATA_TYPE_FLOAT:{name:"float",size:4},DATA_TYPE_INT8:{name:"int8",size:1},DATA_TYPE_UINT8:{name:"uint8",size:1},DATA_TYPE_INT16:{name:"int16",size:2},DATA_TYPE_UINT16:{name:"uint16",size:2},DATA_TYPE_INT32:{name:"int32",size:4},DATA_TYPE_UINT32:{name:"uint32",size:4},DATA_TYPE_INT64:{name:"int64",size:8},DATA_TYPE_UINT64:{name:"uint64",size:8}};Object.keys(Ox).forEach(((e,t)=>{Ox[t]=Ox[e]}));class Fx{constructor(e,t,r){this.name=e,this.type=t,this.numElements=r,this.byteSize=this.numElements*this.type.size,this.description="",this.range=[1/0,-1/0]}}Fx.POSITION_CARTESIAN=new Fx("POSITION_CARTESIAN",Ox.DATA_TYPE_FLOAT,3),Fx.RGBA_PACKED=new Fx("COLOR_PACKED",Ox.DATA_TYPE_INT8,4),Fx.COLOR_PACKED=Fx.RGBA_PACKED,Fx.RGB_PACKED=new Fx("COLOR_PACKED",Ox.DATA_TYPE_INT8,3),Fx.NORMAL_FLOATS=new Fx("NORMAL_FLOATS",Ox.DATA_TYPE_FLOAT,3),Fx.INTENSITY=new Fx("INTENSITY",Ox.DATA_TYPE_UINT16,1),Fx.CLASSIFICATION=new Fx("CLASSIFICATION",Ox.DATA_TYPE_UINT8,1),Fx.NORMAL_SPHEREMAPPED=new Fx("NORMAL_SPHEREMAPPED",Ox.DATA_TYPE_UINT8,2),Fx.NORMAL_OCT16=new Fx("NORMAL_OCT16",Ox.DATA_TYPE_UINT8,2),Fx.NORMAL=new Fx("NORMAL",Ox.DATA_TYPE_FLOAT,3),Fx.RETURN_NUMBER=new Fx("RETURN_NUMBER",Ox.DATA_TYPE_UINT8,1),Fx.NUMBER_OF_RETURNS=new Fx("NUMBER_OF_RETURNS",Ox.DATA_TYPE_UINT8,1),Fx.SOURCE_ID=new Fx("SOURCE_ID",Ox.DATA_TYPE_UINT16,1),Fx.INDICES=new Fx("INDICES",Ox.DATA_TYPE_UINT32,1),Fx.SPACING=new Fx("SPACING",Ox.DATA_TYPE_FLOAT,1),Fx.GPS_TIME=new Fx("GPS_TIME",Ox.DATA_TYPE_DOUBLE,1);class Nx{constructor(){this.attributes=[],this.byteSize=0,this.size=0,this.vectors=[]}add(e){this.attributes.push(e),this.byteSize+=e.byteSize,this.size++}addVector(e){this.vectors.push(e)}hasNormals(){for(let e=0;e<this.attributes.length;e++){const t=this.attributes[e],r=this.attributes[t];if(r===Fx.NORMAL_SPHEREMAPPED||r===Fx.NORMAL_FLOATS||r===Fx.NORMAL||r===Fx.NORMAL_OCT16)return!0}return!1}}const Ux={double:Ox.DATA_TYPE_DOUBLE,float:Ox.DATA_TYPE_FLOAT,int8:Ox.DATA_TYPE_INT8,uint8:Ox.DATA_TYPE_UINT8,int16:Ox.DATA_TYPE_INT16,uint16:Ox.DATA_TYPE_UINT16,int32:Ox.DATA_TYPE_INT32,uint32:Ox.DATA_TYPE_UINT32,int64:Ox.DATA_TYPE_INT64,uint64:Ox.DATA_TYPE_UINT64},Qx=class extends cc{constructor(e){if(!e.file)throw new Error("New Potree2Source: file is required");super(e),this.file=e.file,this.fetcher=sc.arrayBuffer,this.whenReady=(e.metadata?Promise.resolve(e.metadata):sc.json(`${this.url}/${this.file}`,this.networkOptions)).then((e=>(this.metadata=e,this.pointAttributes=function(e){const t=new Nx,r={rgb:"rgba"};for(const n of e){const{name:e,numElements:i,min:s,max:o}=n,a=Ux[n.type],l=new Fx(r[e]?r[e]:e,a,i);l.range=1===i?[s[0],o[0]]:[s,o],"gps-time"===e&&l.range[0]===l.range[1]&&(l.range[1]+=1),l.initialRange=l.range,t.add(l)}void 0!==t.attributes.find((e=>"NormalX"===e.name))&&void 0!==t.attributes.find((e=>"NormalY"===e.name))&&void 0!==t.attributes.find((e=>"NormalZ"===e.name))&&t.addVector({name:"NORMAL",attributes:["NormalX","NormalY","NormalZ"]});return t}(e.attributes),this.baseurl=`${this.url}`,this.extension="bin",this.parser=kx.parse,this.spacing=e.spacing,e)))}},Gx=class extends cc{constructor(e){super(e),this.isC3DTilesSource=!0,this.baseUrl=this.url.slice(0,this.url.lastIndexOf("/")+1),this.whenReady=sc.json(this.url,this.networkOptions)}},zx=class extends Gx{constructor(e){if(!e.accessToken)throw new Error("New 3D Tiles Ion Source: access token is required");if(!e.assetId)throw new Error("New 3D Tiles Ion Source: asset id is required");e.url=`https://api.cesium.com/v1/assets/${e.assetId}/endpoint?access_token=${e.accessToken}`,super(e),this.isC3DTilesIonSource=!0,this.accessToken=e.accessToken,this.assetId=e.assetId,this.whenReady=sc.json(e.url,this.networkOptions).then((e=>{if("3DTILES"!==e.type)throw new Error(`${e.type} datasets from Cesium ion are not supported with C3DTilesIonSource. Only 3D Tiles datasets are supported.`);return this.url=e.url,this.baseUrl=e.url.slice(0,e.url.lastIndexOf("/")+1),this.networkOptions.headers={},this.networkOptions.headers.Authorization=`Bearer ${e.accessToken}`,this.attribution=e.attributions,sc.json(this.url,this.networkOptions)}))}};function jx(e){if(!e)return null;if(e.content&&e.content.uri)return new URLSearchParams(e.content.uri.slice(e.content.uri.indexOf("?")+1)).get("session");if(e.children&&e.children.length>0)for(const t of e.children){const e=jx(t);if(e)return e}return null}const Vx=class extends Gx{constructor(e){if(!e.key)throw new Error("[C3DTilesGoogleSource]: A API key for the google map tiles API is required");e.url=`https://tile.googleapis.com/v1/3dtiles/root.json?key=${e.key}`,super(e),this.isC3DTilesGoogleSource=!0,this.baseUrl="https://tile.googleapis.com",this.key=e.key,this.whenReady=sc.json(e.url,this.networkOptions).then((e=>{if(e&&e.root&&(this.sessionId=jx(e.root),null===this.sessionId))throw new Error("[C3DTilesGoogleSource]: Cannot find sessionId from the tileset while it is mandatory to request tiles.");return e}))}getTileUrl(e){const t=`key=${this.key}&session=${this.sessionId}`;return/\?/.test(e)?`${e}&${t}`:`${e}?${t}`}},qx=class extends cc{constructor(e){super(e),this.isOGC3DTilesSource=!0}},Hx=class extends qx{constructor(e){if(!e.accessToken)throw new Error("[OGC3DTilesIonSource]: accessToken is required");if(!e.assetId)throw new Error("[OGC3DTilesIonSource]: assetId is required");e.url=`https://api.cesium.com/v1/assets/${e.assetId}/endpoint?access_token=${e.accessToken}`,super(e),this.isOGC3DTilesIonSource=!0,this.accessToken=e.accessToken,this.assetId=e.assetId}},Wx=class extends qx{constructor(e){if(!e.key)throw new Error("[OGC3DTilesGoogleSource]: A API key for the google map tiles API is required");e.url=`https://tile.googleapis.com/v1/3dtiles/root.json?key=${e.key}`,super(e),this.isOGC3DTilesGoogleSource=!0,this.key=e.key}};var $x=r(14528);let Yx,Kx;async function Jx(){return Kx||(Kx=await Px(new Worker(new URL(r.p+r.u(352),r.b),{type:"module"})),Yx&&Kx.lazPerf(Yx),Kx)}function Xx(e){const t=new s.BufferGeometry,r=new s.BufferAttribute(e.position,3);t.setAttribute("position",r);const n=new s.BufferAttribute(e.intensity,1);t.setAttribute("intensity",n);const i=new s.BufferAttribute(e.returnNumber,1);t.setAttribute("returnNumber",i);const o=new s.BufferAttribute(e.numberOfReturns,1);t.setAttribute("numberOfReturns",o);const a=new s.BufferAttribute(e.classification,1);t.setAttribute("classification",a);const l=new s.BufferAttribute(e.pointSourceID,1);if(t.setAttribute("pointSourceID",l),e.color){const r=new s.BufferAttribute(e.color,4,!0);t.setAttribute("color",r)}const c=new s.BufferAttribute(e.scanAngle,1);return t.setAttribute("scanAngle",c),t.userData.origin=(new s.Vector3).fromArray(e.origin),t}const Zx={enableLazPerf(e){if(!e)throw new Error("Path to laz-perf is mandatory");Yx=e},terminate(){const e=Kx;return Kx=void 0,Rx.terminate(e)},async parseChunk(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=await Jx(),n=Xx((await r.parseChunk(Dx(e),{pointCount:t.in.pointCount,header:t.in.header,eb:t.eb,colorDepth:t.in.colorDepth})).attributes);return n.computeBoundingBox(),n},async parse(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.out?.skip&&console.warn("Warning: options 'skip' not supported anymore");const r=t.in,n=await Jx(),i=await n.parseFile(Dx(e),{colorDepth:r?.colorDepth}),s=Xx(i.attributes);return s.userData.header=i.header,s.computeBoundingBox(),s}},eC=class extends cc{constructor(e){super(e),this.isEntwinePointTileSource=!0,this.colorDepth=e.colorDepth,this.url=this.url.replace("/ept.json",""),this.whenReady=sc.json(`${this.url}/ept.json`,this.networkOptions).then((e=>{if(this.parse="laszip"===e.dataType?Zx.parse:Sx.parse,this.extension="laszip"===e.dataType?"laz":"bin",e.srs){if(e.srs.authority&&e.srs.horizontal)this.crs=`${e.srs.authority}:${e.srs.horizontal}`,$x.A.defs(this.crs)||$x.A.defs(this.crs,e.srs.wkt);else if(e.srs.wkt){$x.A.defs("unknown",e.srs.wkt);const t=$x.A.defs("unknown");this.crs=t.title||t.name,this.crs in $x.A.defs||$x.A.defs(this.crs,t)}e.srs.vertical&&e.srs.vertical!==e.srs.horizontal&&console.warn("EntwinePointTileSource: Vertical coordinates system code is not yet supported.")}return this.boundsConforming=e.boundsConforming,this.bounds=e.bounds,this.span=e.span,this.spacing=(Math.abs(this.bounds[3]-this.bounds[0])+Math.abs(this.bounds[4]-this.bounds[1]))/(2*this.span),this})),this.fetcher=sc.arrayBuffer}},tC=class extends cc{constructor(e){super(e),this.isCopcSource=!0,this.parser=Zx.parseChunk,this.fetcher=sc.arrayBuffer,this.colorDepth=e.colorDepth??16,this.whenReady=async function(e){const t=tx.Las.Header.parse(await e(0,tx.Las.Constants.minHeaderLength)),r=await tx.Las.Vlr.walk(e,t),n=tx.Las.Vlr.find(r,"copc",1);if(!n)return Promise.reject("COPC info VLR is required");const i=tx.Info.parse(await tx.Las.Vlr.fetch(e,n)),s=tx.Las.Vlr.find(r,"LASF_Projection",2112);if(!s)return Promise.reject("LAS1.4 WKT VLR is required");const o=tx.Binary.toCString(await tx.Las.Vlr.fetch(e,s)),a=tx.Las.Vlr.find(r,"LASF_Spec",4);return{header:t,info:i,wkt:o,eb:a?tx.Las.ExtraBytes.parse(await tx.Las.Vlr.fetch(e,a)):[]}}(((e,t)=>this.fetcher(this.url,{...this.networkOptions,headers:{...this.networkOptions.headers,range:`bytes=${e}-${t-1}`}}).then((e=>new Uint8Array(e))))).then((e=>{let t;this.header=e.header,this.info=e.info,this.eb=e.eb,this.spacing=this.info.spacing,$x.A.defs("unknown",e.wkt),"COMPD_CS"===$x.A.defs("unknown").type?(console.warn("CopcSource: compound coordinate system is not yet supported."),t=$x.A.defs("unknown").PROJCS):t=$x.A.defs("unknown"),this.crs=t.title||t.name||"EPSG:4326",this.crs in $x.A.defs||$x.A.defs(this.crs,t);const r=new s.Box3;return r.min.fromArray(this.info.cube,0),r.max.fromArray(this.info.cube,3),this.extent=i.zR.fromBox3(this.crs,r),this}))}},rC="undefined"!=typeof navigator&&navigator.hardwareConcurrency||2,nC=class{constructor(e=rC,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise((e=>{r.e(651).then(r.bind(r,67651)).then((t=>{e(t.create)}))})),this._awaitingDecoder.then((t=>{this._awaitingDecoder=null,this.workers=[];for(let r=0;r<e;r++)this.workers.push({worker:t(),idle:!0})})))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,0===this.size?ml(e).then((r=>r.decode(e,t))):new Promise((r=>{const n=this.workers.find((e=>e.idle))||this.workers[Math.floor(Math.random()*this.size)];n.idle=!1;const i=this.messageId++,s=e=>{e.data.id===i&&(n.idle=!0,r(e.data.decoded),n.worker.removeEventListener("message",s))};n.worker.addEventListener("message",s),n.worker.postMessage({fileDirectory:e,buffer:t,id:i},[t])}))}destroy(){this.workers&&(this.workers.forEach((e=>{e.worker.terminate()})),this.workers=null)}},iC=10485760,sC=async function(e,t){const{in:{crs:r,defaultAlpha:n,resampleMethod:i,overviews:o,pool:a,maxTextureSize:l=iC},extent:c}=t,h=c.isExtent?c.as(r):c.toExtent(r),u=h.planarDimensions(),d=new s.Vector2(255,Math.round(255*u.y/u.x)),p=function(e,t,r){const n=Math.min(t.x/r.x,t.y/r.y);let i;for(let t=e.length-1;t>=0&&(i=e[t],!(n>=Math.min(Math.abs(i.resolution[0]),Math.abs(i.resolution[1]))));t--);if(!i)throw Error("Unable to determine a best overview for given extent in the COG dataset. LevelTree parsed by CogSource is probably empty.");return i}(o,u,d),f=p.extentToImageWindow(h);let g;return(f[2]-f[0])*(f[3]-f[1])*4>l?(console.warn(`The lowest resolution overview of COG data is too large to be displayed on the requested extent. You should increase the minimum zoom in the corresponding layer properties to at least ${c.zoom+1}.`),g=new s.DataTexture(new Uint8Array(1),1,1,s.RedFormat)):g=await p.extractTexture({imageWindow:f,textureDimensions:d,resampleMethod:i,defaultAlpha:n,pool:a}),g.extent=c,g},oC=class extends cc{constructor(e){const{pool:t=new nC,defaultAlpha:r=255,resampleMethod:n="nearest",...s}=e;s.fetcher=()=>Promise.resolve({}),s.parser=sC,super(s),this.isCogSource=!0,this.defaultAlpha=r,this.pool=t,this.resampleMethod=n,this.overviews=[],this.whenReady=tc(this.url).then((async e=>{const t=await e.getImage(),r=t.getOrigin(),n=ao(t.getSampleFormat(),t.getBitsPerSample()),[s,o,a,l]=t.getBoundingBox();this.extent=new i.zR(this.crs,s,a,o,l),this.overviews.push(new lo({image:t,origin:r,dataType:n}));const c=await e.getImageCount(),h=[];for(let i=1;i<c;i++){const s=e.getImage(i).then((e=>new lo({image:e,resolution:e.getResolution(t),origin:r,dataType:n})));h.push(s)}this.overviews=this.overviews.concat(await Promise.all(h))}))}extentInsideLimit(e){return this.extent.intersectsExtent(e)}urlFromExtent(){return""}};var aC,lC="deflate-raw",cC=self.DecompressionStream;try{new cC(lC),aC=async e=>{let t=new cC(lC),r=t.writable.getWriter(),n=t.readable.getReader();r.write(e),r.close();let i,s,o=[],a=0,l=0;for(;!(s=await n.read()).done;)i=s.value,o.push(i),a+=i.length;return o.length-1?(i=new Uint8Array(a),o.map((e=>{i.set(e,l),l+=e.length})),i):o[0]}}catch{}var hC=new TextDecoder,uC=e=>{throw new Error("but-unzip~"+e)},dC=e=>hC.decode(e);const pC=/.+\.(shp|dbf|json|prj|cpg)$/i,fC=globalThis.URL;async function gC(e,t){const r=((e,t)=>{if(!t)return e;const r=new fC(e);return r.pathname=`${r.pathname}.${t}`,r.href})(e,t),n="prj"===t||"cpg"===t;try{const e=await fetch(r);if(e.status>399)throw new Error(e.statusText);if(n)return e.text();const t=await e.arrayBuffer();return new DataView(t)}catch(e){if(n||"dbf"===t)return!1;throw e}}function AC(e){let t=0,r=1;const n=e.length;let i,s;const o=[e[0][0],e[0][1],e[0][0],e[0][1]];for(;r<n;)i=s||e[0],s=e[r],t+=(s[0]-i[0])*(s[1]+i[1]),r++,s[0]<o[0]&&(o[0]=s[0]),s[1]<o[1]&&(o[1]=s[1]),s[0]>o[2]&&(o[2]=s[0]),s[1]>o[3]&&(o[3]=s[1]);return{ring:e,clockWise:t>0,bbox:o,children:[]}}function mC(e,t){return!(e.bbox[0]>t.bbox[0]||e.bbox[1]>t.bbox[1]||e.bbox[2]<t.bbox[2]||e.bbox[3]<t.bbox[3])}vC.prototype.parsePoint=function(e){return{type:"Point",coordinates:this.parseCoord(e,0)}},vC.prototype.parseZPoint=function(e){const t=this.parsePoint(e);return t.coordinates.push(e.getFloat64(16,!0)),t},vC.prototype.parsePointArray=function(e,t,r){const n=[];let i=0;for(;i<r;)n.push(this.parseCoord(e,t)),t+=16,i++;return n},vC.prototype.parseZPointArray=function(e,t,r,n){let i=0;for(;i<r;)n[i].push(e.getFloat64(t,!0)),i++,t+=8;return n},vC.prototype.parseArrayGroup=function(e,t,r,n,i){const s=[];let o,a,l=0,c=0;for(;l<n;)l++,r+=4,o=c,c=l===n?i:e.getInt32(r,!0),a=c-o,a&&(s.push(this.parsePointArray(e,t,a)),t+=a<<4);return s},vC.prototype.parseZArrayGroup=function(e,t,r,n){let i=0;for(;i<r;)n[i]=this.parseZPointArray(e,t,n[i].length,n[i]),t+=n[i].length<<3,i++;return n},vC.prototype.parseMultiPoint=function(e){const t={},r=e.getInt32(32,!0);if(!r)return null;const n=this.parseCoord(e,0),i=this.parseCoord(e,16);return t.bbox=[n[0],n[1],i[0],i[1]],1===r?(t.type="Point",t.coordinates=this.parseCoord(e,36)):(t.type="MultiPoint",t.coordinates=this.parsePointArray(e,36,r)),t},vC.prototype.parseZMultiPoint=function(e){const t=this.parseMultiPoint(e);if(!t)return null;let r;if("Point"===t.type)return t.coordinates.push(e.getFloat64(72,!0)),t;r=t.coordinates.length;const n=52+(r<<4);return t.coordinates=this.parseZPointArray(e,n,r,t.coordinates),t},vC.prototype.parsePolyline=function(e){const t={},r=e.getInt32(32,!0);if(!r)return null;const n=this.parseCoord(e,0),i=this.parseCoord(e,16);t.bbox=[n[0],n[1],i[0],i[1]];const s=e.getInt32(36,!0);let o,a;return 1===r?(t.type="LineString",o=44,t.coordinates=this.parsePointArray(e,o,s)):(t.type="MultiLineString",o=40+(r<<2),a=40,t.coordinates=this.parseArrayGroup(e,o,40,r,s)),t},vC.prototype.parseZPolyline=function(e){const t=this.parsePolyline(e);if(!t)return null;const r=t.coordinates.length;let n;if("LineString"===t.type)return n=60+(r<<4),t.coordinates=this.parseZPointArray(e,n,r,t.coordinates),t;return n=56+(t.coordinates.reduce((function(e,t){return e+t.length}),0)<<4)+(r<<2),t.coordinates=this.parseZArrayGroup(e,n,r,t.coordinates),t},vC.prototype.polyFuncs=function(e){return e?"LineString"===e.type?(e.type="Polygon",e.coordinates=[e.coordinates],e):(e.coordinates=function(e){const t=[],r=[];for(const n of e){const e=AC(n);e.clockWise?t.push(e):r.push(e)}for(const e of r)for(const r of t)if(mC(r,e)){r.children.push(e.ring);break}const n=[];for(const e of t)n.push([e.ring].concat(e.children));return n}(e.coordinates),1===e.coordinates.length?(e.type="Polygon",e.coordinates=e.coordinates[0],e):(e.type="MultiPolygon",e)):e},vC.prototype.parsePolygon=function(e){return this.polyFuncs(this.parsePolyline(e))},vC.prototype.parseZPolygon=function(e){return this.polyFuncs(this.parseZPolyline(e))};const yC={1:"parsePoint",3:"parsePolyline",5:"parsePolygon",8:"parseMultiPoint",11:"parseZPoint",13:"parseZPolyline",15:"parseZPolygon",18:"parseZMultiPoint"};function vC(e,t){if(!(this instanceof vC))return new vC(e,t);this.buffer=e,this.headers=this.parseHeader(),this.shpFuncs(t),this.rows=this.getRows()}function wC(e,t){return new vC(e,t).rows}vC.prototype.shpFuncs=function(e){let t=this.headers.shpCode;if(t>20&&(t-=20),!(t in yC))throw new Error(`I don't know shp type "${t}"`);var r;this.parseFunc=this[yC[t]],this.parseCoord=(r=e)?function(e,t){const n=[e.getFloat64(t,!0),e.getFloat64(t+8,!0)];return r.inverse(n)}:function(e,t){return[e.getFloat64(t,!0),e.getFloat64(t+8,!0)]}},vC.prototype.getShpCode=function(){return this.parseHeader().shpCode},vC.prototype.parseHeader=function(){const e=this.buffer;return{length:e.getInt32(24)<<1,version:e.getInt32(28,!0),shpCode:e.getInt32(32,!0),bbox:[e.getFloat64(36,!0),e.getFloat64(44,!0),e.getFloat64(52,!0),e.getFloat64(60,!0)]}},vC.prototype.getRows=function(){let e=100;const t=this.buffer.byteLength-8,r=[];let n;for(;e<=t&&(n=this.getRow(e),n);)e+=8,e+=n.len,n.type?r.push(this.parseFunc(n.data)):r.push(null);return r},vC.prototype.getRow=function(e){const t=this.buffer.getInt32(e),r=this.buffer.getInt32(e+4)<<1;return 0===r?{id:t,len:r,type:0}:e+r+8>this.buffer.byteLength?void 0:{id:t,len:r,data:new DataView(this.buffer.buffer,this.buffer.byteOffset+e+12,r-4),type:this.buffer.getInt32(e+8,!0)}};var bC=/^(?:ANSI\s)?(\d+)$/m;function EC(e,t){if(!e)return n;try{new TextDecoder(e.trim())}catch(i){var r=bC.exec(e);return r&&!t?EC("windows-"+r[1],!0):(e=void 0,n)}return n;function n(t){var r=new TextDecoder(e||void 0);return(r.decode(t,{stream:!0})+r.decode()).replace(/\0/g,"").trim()}}function xC(e,t,r,n,i){var s=i(new Uint8Array(e.buffer.slice(e.byteOffset+t,e.byteOffset+t+r)));switch(n){case"N":case"F":case"O":return parseFloat(s,10);case"D":return new Date(s.slice(0,4),parseInt(s.slice(4,6),10)-1,s.slice(6,8));case"L":return"y"===s.toLowerCase()||"t"===s.toLowerCase();default:return s}}function CC(e,t,r,n){for(var i,s,o={},a=0,l=r.length;a<l;)i=xC(e,t,(s=r[a]).len,s.dataType,n),t+=s.len,void 0!==i&&(o[s.name]=i),a++;return o}function _C(e,t){for(var r=EC(t),n=function(e){var t={};return t.lastUpdated=new Date(e.getUint8(1)+1900,e.getUint8(2),e.getUint8(3)),t.records=e.getUint32(4,!0),t.headerLen=e.getUint16(8,!0),t.recLen=e.getUint16(10,!0),t}(e),i=function(e,t,r){for(var n=[],i=32;i<t&&(n.push({name:r(new Uint8Array(e.buffer.slice(e.byteOffset+i,e.byteOffset+i+11))),dataType:String.fromCharCode(e.getUint8(i+11)),len:e.getUint8(i+16),decimal:e.getUint8(i+17)}),13!==e.getUint8(i+32));)i+=32;return n}(e,n.headerLen-1,r),s=2+(i.length+1<<5),o=n.recLen,a=n.records,l=[];a;)l.push(CC(e,s,i,r)),s+=o,a--;return l}const IC=globalThis.URL,SC=new TextDecoder,MC=e=>{if(e)return"string"==typeof e?e:BC(e)||ArrayBuffer.isView(e)||PC(e)?SC.decode(e):void 0},TC=e=>{if(!e)throw new Error("forgot to pass buffer");if(PC(e))return e;if(BC(e))return new DataView(e);if(BC(e.buffer))return new DataView(e.buffer,e.byteOffset,e.byteLength);throw new Error("invalid buffer like object")};function BC(e){return e instanceof globalThis.ArrayBuffer||"[object ArrayBuffer]"===Object.prototype.toString.call(e)}function PC(e){return e instanceof globalThis.DataView||"[object DataView]"===Object.prototype.toString.call(e)}const RC=function([e,t]){const r={type:"FeatureCollection",features:[]};let n=0;const i=e.length;for(t||(t=[]);n<i;)r.features.push({type:"Feature",geometry:e[n],properties:t[n]||{}}),n++;return r},DC=async function(e,t){let r;e=(e=>{if(!e)throw new Error("forgot to pass buffer");if(BC(e))return new Uint8Array(e);if(BC(e.buffer))return 1===e.BYTES_PER_ELEMENT?e:new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("invalid buffer like object")})(e);const n=await(async e=>{const t={},r=[];for(const n of function*(e,t=aC){let r=(e=>{let t=e.length-20,r=Math.max(t-65516,2);for(;-1!==(t=e.lastIndexOf(80,t-1))&&(75!==e[t+1]||5!==e[t+2]||6!==e[t+3])&&t>r;);return t})(e);-1===r&&uC(2);let n=(t,n)=>e.subarray(r+=t,r+=n),i=new DataView(e.buffer,e.byteOffset),s=e=>i.getUint16(e+r,!0),o=e=>i.getUint32(e+r,!0),a=s(10);for(a!==s(8)&&uC(3),r=o(16);a--;){let e,i=s(10),a=s(28),l=s(30),c=s(32),h=o(20),u=o(42),d=dC(n(46,a)),p=dC(n(l,c)),f=r;r=u,e=n(30+s(26)+s(28),h),yield{filename:d,comment:p,read:()=>8&i?t(e):i?uC(1):e},r=f}}(e))pC.test(n.filename)&&r.push(Promise.resolve(n.read()).then((e=>t[n.filename]=e)));await Promise.all(r);const n={},i=new TextDecoder;for(const[e,r]of Object.entries(t))"shp"===e.slice(-3).toLowerCase()||"dbf"===e.slice(-3).toLowerCase()?n[e]=new DataView(r.buffer,r.byteOffset,r.byteLength):n[e]=i.decode(r);return n})(e),i=[];for(r in t=t||[],n)-1===r.indexOf("__MACOSX")&&(".shp"===r.slice(-4).toLowerCase()?(i.push(r.slice(0,-4)),n[r.slice(0,-3)+r.slice(-3).toLowerCase()]=n[r]):".prj"===r.slice(-4).toLowerCase()?n[r.slice(0,-3)+r.slice(-3).toLowerCase()]=(0,$x.A)(n[r]):".json"===r.slice(-5).toLowerCase()||t.indexOf(r.split(".").pop())>-1?i.push(r.slice(0,-3)+r.slice(-3).toLowerCase()):".dbf"!==r.slice(-4).toLowerCase()&&".cpg"!==r.slice(-4).toLowerCase()||(n[r.slice(0,-3)+r.slice(-3).toLowerCase()]=n[r]));if(!i.length)throw new Error("no layers founds");const s=i.map((function(e){let r,i;const s=e.lastIndexOf(".");return s>-1&&e.slice(s).indexOf("json")>-1?(r=JSON.parse(n[e]),r.fileName=e.slice(0,s)):t.indexOf(e.slice(s+1))>-1?(r=n[e],r.fileName=e):(n[e+".dbf"]&&(i=_C(n[e+".dbf"],n[e+".cpg"])),r=RC([wC(n[e+".shp"],n[e+".prj"]),i]),r.fileName=e),r}));return 1===s.length?s[0]:s},LC=async e=>{const t=await Promise.all([gC(e,"shp"),gC(e,"prj")]);let r=!1;try{t[1]&&(r=(0,$x.A)(t[1]))}catch(e){r=!1}return wC(t[0],r)},kC=async e=>{const[t,r]=await Promise.all([gC(e,"dbf"),gC(e,"cpg")]);if(t)return _C(t,r)},OC=(e,t)=>new IC(e,globalThis?.document?.location).pathname.slice(-4).toLowerCase()===t,FC=function(e,t){if(e=TC(e),"string"==typeof(t=MC(t)))try{t=(0,$x.A)(t)}catch(e){t=!1}return wC(e,t)},NC=async function(e,t){if("string"!=typeof e){if(BC(e)||ArrayBuffer.isView(e)||PC(e))return DC(e);if(e.shp)return(({shp:e,dbf:t,cpg:r,prj:n})=>{const i=[FC(e,n)];return t&&i.push(function(e,t){return _C(e=TC(e),t=MC(t))}(t,r)),RC(i)})(e);throw new TypeError("must be a string, some sort of Buffer, or an object with at least a .shp property")}if(OC(e,".zip"))return async function(e,t){const r=await gC(e);return DC(r,t)}(e,t);OC(e,".shp")&&(e=e.slice(0,-4));const r=await Promise.all([LC(e),kC(e)]);return RC(r)},UC={parse(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r=rs(r),e.zip?t=NC(e.zip):e.shp&&e.shx&&e.dbf&&(t=NC(e)),r.in=r.in||{},r.in.crs=e.prj?(0,$x.A)(e.prj).oProj.datumName:r.in.crs,Promise.resolve(t).then((e=>ds.parse(e,r)))}},QC=class{constructor(e){this.classes=e.classes,this.inverseHierarchy={},this.instancesIdxs=[];const t={};let r=0,n=e.parentCounts;void 0===n&&(n=new Array(e.instancesLength),n.fill(1));for(let i=0;i<e.instancesLength;i++){for(let t=0;t<n[i];t++)i!==e.parentIds[r]&&(void 0===this.inverseHierarchy[i]&&(this.inverseHierarchy[i]=[]),this.inverseHierarchy[i].push(e.parentIds[r]),r++);const s=e.classIds[i];void 0===t[s]&&(t[s]=0),this.instancesIdxs[i]={classId:s,instanceIdx:t[s]},t[s]++}}getInfoById(e){const t={},r=this.instancesIdxs[e].classId,n=this.classes[r].name,i=this.instancesIdxs[e].instanceIdx,s=this.classes[r].instances;for(const e in s)Object.prototype.hasOwnProperty.call(s,e)&&(t[e]=s[e][i]);const o={};if(o[n]=t,this.inverseHierarchy&&this.inverseHierarchy[e])for(const t of this.inverseHierarchy[e])Object.assign(o,this.getInfoById(t));return o}},GC="2.46.0"},64601:(e,t,r)=>{r(46518)({target:"Number",stat:!0,nonConfigurable:!0,nonWritable:!0},{MAX_SAFE_INTEGER:9007199254740991})},64743:(e,t,r)=>{r(29314)},64979:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(97751),o=r(6980),a=r(24913).f,l=r(39297),c=r(90679),h=r(23167),u=r(32603),d=r(55002),p=r(16193),f=r(43724),g=r(96395),A="DOMException",m=s("Error"),y=s(A),v=function(){c(this,w);var e=arguments.length,t=u(e<1?void 0:arguments[0]),r=u(e<2?void 0:arguments[1],"Error"),n=new y(t,r),i=new m(t);return i.name=A,a(n,"stack",o(1,p(i.stack,1))),h(n,this,v),n},w=v.prototype=y.prototype,b="stack"in new m(A),E="stack"in new y(1,2),x=y&&f&&Object.getOwnPropertyDescriptor(i,A),C=!(!x||x.writable&&x.configurable),_=b&&!C&&!E;n({global:!0,constructor:!0,forced:g||_},{DOMException:_?v:y});var I=s(A),S=I.prototype;if(S.constructor!==I)for(var M in g||a(S,"constructor",o(1,I)),d)if(l(d,M)){var T=d[M],B=T.s;l(I,B)||a(I,B,o(6,T.c))}},65070:(e,t,r)=>{var n=r(46518),i=r(53250);n({target:"Math",stat:!0,forced:i!==Math.expm1},{expm1:i})},65186:(e,t,r)=>{var n=r(46518),i=r(18449),s=r(28551),o=i.toKey,a=i.set;n({target:"Reflect",stat:!0},{defineMetadata:function(e,t,r){var n=arguments.length<4?void 0:o(arguments[3]);a(e,t,s(r),n)}})},65223:(e,t,r)=>{var n=r(46518),i=r(97080),s=r(94402).remove;n({target:"Set",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var e,t=i(this),r=!0,n=0,o=arguments.length;n<o;n++)e=s(t,arguments[n]),r=r&&e;return!!r}})},65746:(e,t,r)=>{var n,i=r(92744),s=r(44576),o=r(79504),a=r(56279),l=r(3451),c=r(16468),h=r(91625),u=r(20034),d=r(91181).enforce,p=r(79039),f=r(58622),g=Object,A=Array.isArray,m=g.isExtensible,y=g.isFrozen,v=g.isSealed,w=g.freeze,b=g.seal,E=!s.ActiveXObject&&"ActiveXObject"in s,x=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},C=c("WeakMap",x,h),_=C.prototype,I=o(_.set);if(f)if(E){n=h.getConstructor(x,"WeakMap",!0),l.enable();var S=o(_.delete),M=o(_.has),T=o(_.get);a(_,{delete:function(e){if(u(e)&&!m(e)){var t=d(this);return t.frozen||(t.frozen=new n),S(this,e)||t.frozen.delete(e)}return S(this,e)},has:function(e){if(u(e)&&!m(e)){var t=d(this);return t.frozen||(t.frozen=new n),M(this,e)||t.frozen.has(e)}return M(this,e)},get:function(e){if(u(e)&&!m(e)){var t=d(this);return t.frozen||(t.frozen=new n),M(this,e)?T(this,e):t.frozen.get(e)}return T(this,e)},set:function(e,t){if(u(e)&&!m(e)){var r=d(this);r.frozen||(r.frozen=new n),M(this,e)?I(this,e,t):r.frozen.set(e,t)}else I(this,e,t);return this}})}else i&&p((function(){var e=w([]);return I(new C,e,1),!y(e)}))&&a(_,{set:function(e,t){var r;return A(e)&&(y(e)?r=w:v(e)&&(r=b)),I(this,e,t),r&&r(e),this}})},65810:(e,t,r)=>{var n=r(20034),i=r(91181).get;e.exports=function(e){if(!n(e))return!1;var t=i(e);return!!t&&"RawJSON"===t.type}},66090:(e,t,r)=>{r(77691)},66119:(e,t,r)=>{var n=r(25745),i=r(33392),s=n("keys");e.exports=function(e){return s[e]||(s[e]=i(e))}},66197:(e,t,r)=>{r(31698)},66337:(e,t,r)=>{var n=r(92744),i=r(46518),s=r(50283),o=r(79504),a=r(18745),l=r(28551),c=r(48981),h=r(94901),u=r(26198),d=r(24913).f,p=r(67680),f=r(44995),g=r(74615),A=r(58523),m=r(47452),y=new f.WeakMap,v=f.get,w=f.has,b=f.set,E=Array,x=TypeError,C=Object.freeze||Object,_=Object.isFrozen,I=Math.min,S=o("".charAt),M=o("".slice),T=o("".split),B=o(/./.exec),P=/([\n\u2028\u2029]|\r\n?)/g,R=RegExp("^["+m+"]*"),D=RegExp("[^"+m+"]"),L="Invalid tag",k=function(e,t){if(void 0===t||e===t)return e;for(var r=0,n=I(e.length,t.length);r<n&&S(e,r)===S(t,r);r++);return M(e,0,r)},O=function(e){return s((function(t){var r=p(arguments);return r[0]=function(e){var t=e.raw;if(n&&!_(t))throw new x("Raw template should be frozen");if(w(y,t))return v(y,t);var r=function(e){var t,r,n,i,s=c(e),o=u(s),a=E(o),l=E(o),h=0;if(!o)throw new x(L);for(;h<o;h++){var d=s[h];if("string"!=typeof d)throw new x(L);a[h]=T(d,P)}for(h=0;h<o;h++){var p=h+1===o;if(t=a[h],0===h){if(1===t.length||t[0].length>0)throw new x("Invalid opening line");t[1]=""}if(p){if(1===t.length||B(D,t[t.length-1]))throw new x("Invalid closing line");t[t.length-2]="",t[t.length-1]=""}for(var f=2;f<t.length;f+=2){var g=t[f],A=f+1===t.length&&!p,m=B(R,g)[0];A||m.length!==g.length?r=k(m,r):t[f]=""}}var y=r?r.length:0;for(h=0;h<o;h++){for(n=(t=a[h])[0],i=1;i<t.length;i+=2)n+=t[i]+M(t[i+1],y);l[h]=n}return l}(t),i=function(e){for(var t=0,r=e.length,n=E(r);t<r;t++)n[t]=A(e[t]);return n}(r);return d(i,"raw",{value:C(r)}),C(i),b(y,t,i),i}(l(t)),a(e,this,r)}),"")},F=O(g);i({target:"String",stat:!0,forced:!0},{dedent:function(e){return l(e),h(e)?O(e):a(F,this,arguments)}})},66346:(e,t,r)=>{var n=r(44576),i=r(79504),s=r(43724),o=r(77811),a=r(10350),l=r(66699),c=r(62106),h=r(56279),u=r(79039),d=r(90679),p=r(91291),f=r(18014),g=r(57696),A=r(15617),m=r(88490),y=r(42787),v=r(52967),w=r(84373),b=r(67680),E=r(23167),x=r(77740),C=r(10687),_=r(91181),I=a.PROPER,S=a.CONFIGURABLE,M="ArrayBuffer",T="DataView",B="prototype",P="Wrong index",R=_.getterFor(M),D=_.getterFor(T),L=_.set,k=n[M],O=k,F=O&&O[B],N=n[T],U=N&&N[B],Q=Object.prototype,G=n.Array,z=n.RangeError,j=i(w),V=i([].reverse),q=m.pack,H=m.unpack,W=function(e){return[255&e]},$=function(e){return[255&e,e>>8&255]},Y=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},K=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},J=function(e){return q(A(e),23,4)},X=function(e){return q(e,52,8)},Z=function(e,t,r){c(e[B],t,{configurable:!0,get:function(){return r(this)[t]}})},ee=function(e,t,r,n){var i=D(e),s=g(r),o=!!n;if(s+t>i.byteLength)throw new z(P);var a=i.bytes,l=s+i.byteOffset,c=b(a,l,l+t);return o?c:V(c)},te=function(e,t,r,n,i,s){var o=D(e),a=g(r),l=n(+i),c=!!s;if(a+t>o.byteLength)throw new z(P);for(var h=o.bytes,u=a+o.byteOffset,d=0;d<t;d++)h[u+d]=l[c?d:t-d-1]};if(o){var re=I&&k.name!==M;u((function(){k(1)}))&&u((function(){new k(-1)}))&&!u((function(){return new k,new k(1.5),new k(NaN),1!==k.length||re&&!S}))?re&&S&&l(k,"name",M):((O=function(e){return d(this,F),E(new k(g(e)),this,O)})[B]=F,F.constructor=O,x(O,k)),v&&y(U)!==Q&&v(U,Q);var ne=new N(new O(2)),ie=i(U.setInt8);ne.setInt8(0,2147483648),ne.setInt8(1,2147483649),!ne.getInt8(0)&&ne.getInt8(1)||h(U,{setInt8:function(e,t){ie(this,e,t<<24>>24)},setUint8:function(e,t){ie(this,e,t<<24>>24)}},{unsafe:!0})}else F=(O=function(e){d(this,F);var t=g(e);L(this,{type:M,bytes:j(G(t),0),byteLength:t}),s||(this.byteLength=t,this.detached=!1)})[B],U=(N=function(e,t,r){d(this,U),d(e,F);var n=R(e),i=n.byteLength,o=p(t);if(o<0||o>i)throw new z("Wrong offset");if(o+(r=void 0===r?i-o:f(r))>i)throw new z("Wrong length");L(this,{type:T,buffer:e,byteLength:r,byteOffset:o,bytes:n.bytes}),s||(this.buffer=e,this.byteLength=r,this.byteOffset=o)})[B],s&&(Z(O,"byteLength",R),Z(N,"buffer",D),Z(N,"byteLength",D),Z(N,"byteOffset",D)),h(U,{getInt8:function(e){return ee(this,1,e)[0]<<24>>24},getUint8:function(e){return ee(this,1,e)[0]},getInt16:function(e){var t=ee(this,2,e,arguments.length>1&&arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=ee(this,2,e,arguments.length>1&&arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return K(ee(this,4,e,arguments.length>1&&arguments[1]))},getUint32:function(e){return K(ee(this,4,e,arguments.length>1&&arguments[1]))>>>0},getFloat32:function(e){return H(ee(this,4,e,arguments.length>1&&arguments[1]),23)},getFloat64:function(e){return H(ee(this,8,e,arguments.length>1&&arguments[1]),52)},setInt8:function(e,t){te(this,1,e,W,t)},setUint8:function(e,t){te(this,1,e,W,t)},setInt16:function(e,t){te(this,2,e,$,t,arguments.length>2&&arguments[2])},setUint16:function(e,t){te(this,2,e,$,t,arguments.length>2&&arguments[2])},setInt32:function(e,t){te(this,4,e,Y,t,arguments.length>2&&arguments[2])},setUint32:function(e,t){te(this,4,e,Y,t,arguments.length>2&&arguments[2])},setFloat32:function(e,t){te(this,4,e,J,t,arguments.length>2&&arguments[2])},setFloat64:function(e,t){te(this,8,e,X,t,arguments.length>2&&arguments[2])}});C(O,M),C(N,T),e.exports={ArrayBuffer:O,DataView:N}},66412:(e,t,r)=>{r(70511)("asyncIterator")},66557:(e,t,r)=>{var n=r(46518),i=r(43724),s=r(97751),o=r(79306),a=r(90679),l=r(36840),c=r(56279),h=r(62106),u=r(78227),d=r(91181),p=r(91021),f=s("SuppressedError"),g=ReferenceError,A=u("dispose"),m=u("toStringTag"),y="DisposableStack",v=d.set,w=d.getterFor(y),b="sync-dispose",E="disposed",x=function(e){var t=w(e);if(t.state===E)throw new g(y+" already disposed");return t},C=function(){v(a(this,_),{type:y,state:"pending",stack:[]}),i||(this.disposed=!1)},_=C.prototype;c(_,{dispose:function(){var e=w(this);if(e.state!==E){e.state=E,i||(this.disposed=!0);for(var t,r=e.stack,n=r.length,s=!1;n;){var o=r[--n];r[n]=null;try{o()}catch(e){s?t=new f(e,t):(s=!0,t=e)}}if(e.stack=null,s)throw t}},use:function(e){return p(x(this),e,b),e},adopt:function(e,t){var r=x(this);return o(t),p(r,void 0,b,(function(){t(e)})),e},defer:function(e){var t=x(this);o(e),p(t,void 0,b,e)},move:function(){var e=x(this),t=new C;return w(t).stack=e.stack,e.stack=[],e.state=E,i||(this.disposed=!0),t}}),i&&h(_,"disposed",{configurable:!0,get:function(){return w(this).state===E}}),l(_,A,_.dispose,{name:"dispose"}),l(_,m,y,{nonWritable:!0}),n({global:!0,constructor:!0},{DisposableStack:C})},66651:(e,t,r)=>{var n=r(94644),i=r(19617).indexOf,s=n.aTypedArray;(0,n.exportTypedArrayMethod)("indexOf",(function(e){return i(s(this),e,arguments.length>1?arguments[1]:void 0)}))},66699:(e,t,r)=>{var n=r(43724),i=r(24913),s=r(6980);e.exports=n?function(e,t,r){return i.f(e,t,s(1,r))}:function(e,t,r){return e[t]=r,e}},66712:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Transfer=t.isTransferDescriptor=void 0;const n=r(83682);t.isTransferDescriptor=function(e){return e&&"object"==typeof e&&e[n.$transferable]},t.Transfer=function(e,t){if(!t){if(!(r=e)||"object"!=typeof r)throw Error();t=[e]}var r;return{[n.$transferable]:!0,send:e,transferables:t}}},66771:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(47650),o=r(68750);n({target:"Set",proto:!0,real:!0,forced:!0},{intersection:function(e){return i(o,this,s(e))}})},66812:(e,t,r)=>{var n=r(94644),i=r(18745),s=r(8379),o=n.aTypedArray;(0,n.exportTypedArrayMethod)("lastIndexOf",(function(e){var t=arguments.length;return i(s,o(this),t>1?[e,arguments[1]]:[e])}))},66820:(e,t,r)=>{var n=r(46518),i=r(18449),s=r(28551),o=i.has,a=i.toKey;n({target:"Reflect",stat:!0},{hasOwnMetadata:function(e,t){var r=arguments.length<3?void 0:a(arguments[2]);return o(e,s(t),r)}})},66838:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Scale=void 0,t.Scale={apply:(e,t=1,r=0)=>(e-r)/t,unapply:(e,t=1,r=0)=>e*t+r}},66933:(e,t,r)=>{var n=r(79504),i=r(34376),s=r(94901),o=r(22195),a=r(655),l=n([].push);e.exports=function(e){if(s(e))return e;if(i(e)){for(var t=e.length,r=[],n=0;n<t;n++){var c=e[n];"string"==typeof c?l(r,c):"number"!=typeof c&&"Number"!==o(c)&&"String"!==o(c)||l(r,a(c))}var h=r.length,u=!0;return function(e,t){if(u)return u=!1,t;if(i(this))return t;for(var n=0;n<h;n++)if(r[n]===e)return t}}}},67296:(e,t,r)=>{r(46518)({target:"JSON",stat:!0,forced:!r(27819)},{isRawJSON:r(65810)})},67302:(e,t,r)=>{var n=r(94644),i=r(26198),s=r(18727),o=r(35610),a=r(75854),l=r(91291),c=n.aTypedArray,h=n.getTypedArrayConstructor,u=n.exportTypedArrayMethod,d=Math.max,p=Math.min;u("toSpliced",(function(e,t){var r,n,u,f,g,A,m,y=c(this),v=h(y),w=i(y),b=o(e,w),E=arguments.length,x=0;if(0===E)r=n=0;else if(1===E)r=0,n=w-b;else if(n=p(d(l(t),0),w-b),r=E-2){f=new v(r),u=s(f);for(var C=2;C<E;C++)g=arguments[C],f[C-2]=u?a(g):+g}for(m=new v(A=w+r-n);x<b;x++)m[x]=y[x];for(;x<b+r;x++)m[x]=f[x-b];for(;x<A;x++)m[x]=y[x+n-r];return m}),!0)},67316:e=>{var t,r=(t="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e){var r,n,i=void 0!==(e=e||{})?e:{};i.ready=new Promise((function(e,t){r=e,n=t})),["_main","___getTypeName","__embind_initialize_bindings","_fflush","onRuntimeInitialized"].forEach((e=>{Object.getOwnPropertyDescriptor(i.ready,e)||Object.defineProperty(i.ready,e,{get:()=>q("You are getting "+e+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js"),set:()=>q("You are setting "+e+" on the Promise object, instead of the instance. Use .then() to get called back with the instance, see the MODULARIZE docs in src/settings.js")})}));var s=Object.assign({},i),o=[],a="./this.program";if(i.ENVIRONMENT)throw new Error("Module.ENVIRONMENT has been deprecated. To force the environment, use the ENVIRONMENT compile-time option (for example, -sENVIRONMENT=web or -sENVIRONMENT=node)");var l="";if("undefined"!=typeof document&&document.currentScript&&(l=document.currentScript.src),t&&(l=t),l=0!==l.indexOf("blob:")?l.substr(0,l.replace(/[?#].*/,"").lastIndexOf("/")+1):"","object"!=typeof window&&"function"!=typeof importScripts)throw new Error("not compiled for this environment (did you build to HTML and try to run it not on the web, or set ENVIRONMENT to something - like node - and run it someplace else - like on the web?)");var c,h,u,d=i.print||console.log.bind(console),p=i.printErr||console.warn.bind(console);function f(e,t){Object.getOwnPropertyDescriptor(i,e)||Object.defineProperty(i,e,{configurable:!0,get:function(){q("Module."+e+" has been replaced with plain "+t+" (the initial value can be provided on Module, but after startup the value is only looked for on a local variable of that name)")}})}function g(e){return"FS_createPath"===e||"FS_createDataFile"===e||"FS_createPreloadedFile"===e||"FS_unlink"===e||"addRunDependency"===e||"FS_createLazyFile"===e||"FS_createDevice"===e||"removeRunDependency"===e}Object.assign(i,s),s=null,c="fetchSettings",Object.getOwnPropertyDescriptor(i,c)&&q("`Module."+c+"` was supplied but `"+c+"` not included in INCOMING_MODULE_JS_API"),i.arguments&&(o=i.arguments),f("arguments","arguments_"),i.thisProgram&&(a=i.thisProgram),f("thisProgram","thisProgram"),i.quit&&i.quit,f("quit","quit_"),m(void 0===i.memoryInitializerPrefixURL,"Module.memoryInitializerPrefixURL option was removed, use Module.locateFile instead"),m(void 0===i.pthreadMainPrefixURL,"Module.pthreadMainPrefixURL option was removed, use Module.locateFile instead"),m(void 0===i.cdInitializerPrefixURL,"Module.cdInitializerPrefixURL option was removed, use Module.locateFile instead"),m(void 0===i.filePackagePrefixURL,"Module.filePackagePrefixURL option was removed, use Module.locateFile instead"),m(void 0===i.read,"Module.read option was removed (modify read_ in JS)"),m(void 0===i.readAsync,"Module.readAsync option was removed (modify readAsync in JS)"),m(void 0===i.readBinary,"Module.readBinary option was removed (modify readBinary in JS)"),m(void 0===i.setWindowTitle,"Module.setWindowTitle option was removed (modify setWindowTitle in JS)"),m(void 0===i.TOTAL_MEMORY,"Module.TOTAL_MEMORY has been renamed Module.INITIAL_MEMORY"),f("read","read_"),f("readAsync","readAsync"),f("readBinary","readBinary"),f("setWindowTitle","setWindowTitle"),m(!0,"worker environment detected but not enabled at build time.  Add 'worker' to `-sENVIRONMENT` to enable."),m(!0,"node environment detected but not enabled at build time.  Add 'node' to `-sENVIRONMENT` to enable."),m(!0,"shell environment detected but not enabled at build time.  Add 'shell' to `-sENVIRONMENT` to enable."),i.wasmBinary&&(h=i.wasmBinary),f("wasmBinary","wasmBinary"),i.noExitRuntime,f("noExitRuntime","noExitRuntime"),"object"!=typeof WebAssembly&&q("no native wasm support detected");var A=!1;function m(e,t){e||q("Assertion failed"+(t?": "+t:""))}var y,v,w,b,E,x,C,_,I,S="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function M(e,t,r){for(var n=t+r,i=t;e[i]&&!(i>=n);)++i;if(i-t>16&&e.buffer&&S)return S.decode(e.subarray(t,i));for(var s="";t<i;){var o=e[t++];if(128&o){var a=63&e[t++];if(192!=(224&o)){var l=63&e[t++];if(224==(240&o)?o=(15&o)<<12|a<<6|l:(240!=(248&o)&&Z("Invalid UTF-8 leading byte 0x"+o.toString(16)+" encountered when deserializing a UTF-8 string in wasm memory to a JS string!"),o=(7&o)<<18|a<<12|l<<6|63&e[t++]),o<65536)s+=String.fromCharCode(o);else{var c=o-65536;s+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else s+=String.fromCharCode((31&o)<<6|a)}else s+=String.fromCharCode(o)}return s}function T(e,t){return e?M(w,e,t):""}function B(e,t,r,n){if(!(n>0))return 0;for(var i=r,s=r+n-1,o=0;o<e.length;++o){var a=e.charCodeAt(o);if(a>=55296&&a<=57343&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++o)),a<=127){if(r>=s)break;t[r++]=a}else if(a<=2047){if(r+1>=s)break;t[r++]=192|a>>6,t[r++]=128|63&a}else if(a<=65535){if(r+2>=s)break;t[r++]=224|a>>12,t[r++]=128|a>>6&63,t[r++]=128|63&a}else{if(r+3>=s)break;a>1114111&&Z("Invalid Unicode code point 0x"+a.toString(16)+" encountered when serializing a JS string to a UTF-8 string in wasm memory! (Valid unicode code points should be in range 0-0x10FFFF)."),t[r++]=240|a>>18,t[r++]=128|a>>12&63,t[r++]=128|a>>6&63,t[r++]=128|63&a}}return t[r]=0,r-i}function P(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n<=127?t++:n<=2047?t+=2:n>=55296&&n<=57343?(t+=4,++r):t+=3}return t}function R(e){y=e,i.HEAP8=v=new Int8Array(e),i.HEAP16=b=new Int16Array(e),i.HEAP32=x=new Int32Array(e),i.HEAPU8=w=new Uint8Array(e),i.HEAPU16=E=new Uint16Array(e),i.HEAPU32=C=new Uint32Array(e),i.HEAPF32=_=new Float32Array(e),i.HEAPF64=I=new Float64Array(e)}var D=65536;i.TOTAL_STACK&&m(D===i.TOTAL_STACK,"the stack size can no longer be determined at runtime");var L,k=i.INITIAL_MEMORY||262144;function O(){if(!A){var e=wt(),t=C[e>>2],r=C[e+4>>2];34821223==t&&2310721022==r||q("Stack overflow! Stack cookie has been overwritten at 0x"+e.toString(16)+", expected hex dwords 0x89BACDFE and 0x2135467, but received 0x"+r.toString(16)+" 0x"+t.toString(16)),1668509029!==C[0]&&q("Runtime error: The application has corrupted its heap memory area (address zero)!")}}f("INITIAL_MEMORY","INITIAL_MEMORY"),m(k>=D,"INITIAL_MEMORY should be larger than TOTAL_STACK, was "+k+"! (TOTAL_STACK="+D+")"),m("undefined"!=typeof Int32Array&&"undefined"!=typeof Float64Array&&null!=Int32Array.prototype.subarray&&null!=Int32Array.prototype.set,"JS engine does not provide full typed array support"),m(!i.wasmMemory,"Use of `wasmMemory` detected.  Use -sIMPORTED_MEMORY to define wasmMemory externally"),m(262144==k,"Detected runtime INITIAL_MEMORY setting.  Use -sIMPORTED_MEMORY to define wasmMemory dynamically"),function(){var e=new Int16Array(1),t=new Int8Array(e.buffer);if(e[0]=25459,115!==t[0]||99!==t[1])throw"Runtime error: expected the system to be little-endian! (Run with -sSUPPORT_BIG_ENDIAN to bypass)"}();var F=[],N=[],U=[],Q=!1;m(Math.imul,"This browser does not support Math.imul(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),m(Math.fround,"This browser does not support Math.fround(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),m(Math.clz32,"This browser does not support Math.clz32(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill"),m(Math.trunc,"This browser does not support Math.trunc(), build with LEGACY_VM_SUPPORT or POLYFILL_OLD_MATH_FUNCTIONS to add in a polyfill");var G=0,z=null,j=null,V={};function q(e){i.onAbort&&i.onAbort(e),p(e="Aborted("+e+")"),A=!0;var t=new WebAssembly.RuntimeError(e);throw n(t),t}var H,W,$={error:function(){q("Filesystem support (FS) was not included. The problem is that you are using files from JS, but files were not used from C/C++, so filesystem support was not auto-included. You can force-include filesystem support with -sFORCE_FILESYSTEM")},init:function(){$.error()},createDataFile:function(){$.error()},createPreloadedFile:function(){$.error()},createLazyFile:function(){$.error()},open:function(){$.error()},mkdev:function(){$.error()},registerDevice:function(){$.error()},analyzePath:function(){$.error()},loadFilesFromDB:function(){$.error()},ErrnoError:function(){$.error()}};function Y(e){return e.startsWith("data:application/octet-stream;base64,")}function K(e,t){return function(){var r=e,n=t;return t||(n=i.asm),m(Q,"native function `"+r+"` called before runtime initialization"),n[e]||m(n[e],"exported native function `"+r+"` not found"),n[e].apply(null,arguments)}}function J(e){try{if(e==H&&h)return new Uint8Array(h);throw"both async and sync fetching of the wasm failed"}catch(e){q(e)}}function X(e){for(;e.length>0;)e.shift()(i)}function Z(e){Z.shown||(Z.shown={}),Z.shown[e]||(Z.shown[e]=1,p(e))}function ee(e){this.excPtr=e,this.ptr=e-24,this.set_type=function(e){C[this.ptr+4>>2]=e},this.get_type=function(){return C[this.ptr+4>>2]},this.set_destructor=function(e){C[this.ptr+8>>2]=e},this.get_destructor=function(){return C[this.ptr+8>>2]},this.set_refcount=function(e){x[this.ptr>>2]=e},this.set_caught=function(e){e=e?1:0,v[this.ptr+12|0]=e},this.get_caught=function(){return 0!=v[this.ptr+12|0]},this.set_rethrown=function(e){e=e?1:0,v[this.ptr+13|0]=e},this.get_rethrown=function(){return 0!=v[this.ptr+13|0]},this.init=function(e,t){this.set_adjusted_ptr(0),this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var e=x[this.ptr>>2];x[this.ptr>>2]=e+1},this.release_ref=function(){var e=x[this.ptr>>2];return x[this.ptr>>2]=e-1,m(e>0),1===e},this.set_adjusted_ptr=function(e){C[this.ptr+16>>2]=e},this.get_adjusted_ptr=function(){return C[this.ptr+16>>2]},this.get_exception_ptr=function(){if(bt(this.get_type()))return C[this.excPtr>>2];var e=this.get_adjusted_ptr();return 0!==e?e:this.excPtr}}function te(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}i.FS_createDataFile=$.createDataFile,i.FS_createPreloadedFile=$.createPreloadedFile,Y(H="laz-perf.wasm")||(W=H,H=i.locateFile?i.locateFile(W,l):l+W);var re=void 0;function ne(e){for(var t="",r=e;w[r];)t+=re[w[r++]];return t}var ie={},se={},oe={};function ae(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=48&&t<=57?"_"+e:e}function le(e,t){return e=ae(e),function(){return t.apply(this,arguments)}}function ce(e,t){var r=le(t,(function(e){this.name=t,this.message=e;var r=new Error(e).stack;void 0!==r&&(this.stack=this.toString()+"\n"+r.replace(/^Error(:[^\n]*)?\n/,""))}));return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},r}var he=void 0;function ue(e){throw new he(e)}var de=void 0;function pe(e){throw new de(e)}function fe(e,t,r){function n(t){var n=r(t);n.length!==e.length&&pe("Mismatched type converter count");for(var i=0;i<e.length;++i)ge(e[i],n[i])}e.forEach((function(e){oe[e]=t}));var i=new Array(t.length),s=[],o=0;t.forEach(((e,t)=>{se.hasOwnProperty(e)?i[t]=se[e]:(s.push(e),ie.hasOwnProperty(e)||(ie[e]=[]),ie[e].push((()=>{i[t]=se[e],++o===s.length&&n(i)})))})),0===s.length&&n(i)}function ge(e,t,r={}){if(!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var n=t.name;if(e||ue('type "'+n+'" must have a positive integer typeid pointer'),se.hasOwnProperty(e)){if(r.ignoreDuplicateRegistrations)return;ue("Cannot register type '"+n+"' twice")}if(se[e]=t,delete oe[e],ie.hasOwnProperty(e)){var i=ie[e];delete ie[e],i.forEach((e=>e()))}}function Ae(e){ue(e.$$.ptrType.registeredClass.name+" instance already deleted")}var me=!1;function ye(e){}function ve(e){e.count.value-=1,0===e.count.value&&function(e){e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)}(e)}function we(e,t,r){if(t===r)return e;if(void 0===r.baseClass)return null;var n=we(e,t,r.baseClass);return null===n?null:r.downcast(n)}var be={};var Ee=[];function xe(){for(;Ee.length;){var e=Ee.pop();e.$$.deleteScheduled=!1,e.delete()}}var Ce=void 0;var _e={};function Ie(e,t){return t.ptrType&&t.ptr||pe("makeClassHandle requires ptr and ptrType"),!!t.smartPtrType!=!!t.smartPtr&&pe("Both smartPtrType and smartPtr must be specified"),t.count={value:1},Me(Object.create(e,{$$:{value:t}}))}function Se(e){var t=this.getPointee(e);if(!t)return this.destructor(e),null;var r=function(e,t){return t=function(e,t){for(void 0===t&&ue("ptr should not be undefined");e.baseClass;)t=e.upcast(t),e=e.baseClass;return t}(e,t),_e[t]}(this.registeredClass,t);if(void 0!==r){if(0===r.$$.count.value)return r.$$.ptr=t,r.$$.smartPtr=e,r.clone();var n=r.clone();return this.destructor(e),n}function i(){return this.isSmartPointer?Ie(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:e}):Ie(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var s,o=this.registeredClass.getActualType(t),a=be[o];if(!a)return i.call(this);s=this.isConst?a.constPointerType:a.pointerType;var l=we(t,this.registeredClass,s.registeredClass);return null===l?i.call(this):this.isSmartPointer?Ie(s.registeredClass.instancePrototype,{ptrType:s,ptr:l,smartPtrType:this,smartPtr:e}):Ie(s.registeredClass.instancePrototype,{ptrType:s,ptr:l})}function Me(e){return"undefined"==typeof FinalizationRegistry?(Me=e=>e,e):(me=new FinalizationRegistry((e=>{console.warn(e.leakWarning.stack.replace(/^Error: /,"")),ve(e.$$)})),Me=e=>{var t=e.$$;if(t.smartPtr){var r={$$:t},n=t.ptrType.registeredClass;r.leakWarning=new Error("Embind found a leaked C++ instance "+n.name+" <0x"+t.ptr.toString(16)+">.\nWe'll free it automatically in this case, but this functionality is not reliable across various environments.\nMake sure to invoke .delete() manually once you're done with the instance instead.\nOriginally allocated"),"captureStackTrace"in Error&&Error.captureStackTrace(r.leakWarning,Se),me.register(e,r,e)}return e},ye=e=>me.unregister(e),Me(e))}function Te(){}function Be(e,t,r){if(void 0===e[t].overloadTable){var n=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||ue("Function '"+r+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!"),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[n.argCount]=n}}function Pe(e,t,r,n,i,s,o,a){this.name=e,this.constructor=t,this.instancePrototype=r,this.rawDestructor=n,this.baseClass=i,this.getActualType=s,this.upcast=o,this.downcast=a,this.pureVirtualFunctions=[]}function Re(e,t,r){for(;t!==r;)t.upcast||ue("Expected null or instance of "+r.name+", got an instance of "+t.name),e=t.upcast(e),t=t.baseClass;return e}function De(e,t){if(null===t)return this.isReference&&ue("null is not a valid "+this.name),0;t.$$||ue('Cannot pass "'+Ye(t)+'" as a '+this.name),t.$$.ptr||ue("Cannot pass deleted object as a pointer of type "+this.name);var r=t.$$.ptrType.registeredClass;return Re(t.$$.ptr,r,this.registeredClass)}function Le(e,t){var r;if(null===t)return this.isReference&&ue("null is not a valid "+this.name),this.isSmartPointer?(r=this.rawConstructor(),null!==e&&e.push(this.rawDestructor,r),r):0;t.$$||ue('Cannot pass "'+Ye(t)+'" as a '+this.name),t.$$.ptr||ue("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&t.$$.ptrType.isConst&&ue("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);var n=t.$$.ptrType.registeredClass;if(r=Re(t.$$.ptr,n,this.registeredClass),this.isSmartPointer)switch(void 0===t.$$.smartPtr&&ue("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?r=t.$$.smartPtr:ue("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:r=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)r=t.$$.smartPtr;else{var i=t.clone();r=this.rawShare(r,$e.toHandle((function(){i.delete()}))),null!==e&&e.push(this.rawDestructor,r)}break;default:ue("Unsupporting sharing policy")}return r}function ke(e,t){if(null===t)return this.isReference&&ue("null is not a valid "+this.name),0;t.$$||ue('Cannot pass "'+Ye(t)+'" as a '+this.name),t.$$.ptr||ue("Cannot pass deleted object as a pointer of type "+this.name),t.$$.ptrType.isConst&&ue("Cannot convert argument of type "+t.$$.ptrType.name+" to parameter type "+this.name);var r=t.$$.ptrType.registeredClass;return Re(t.$$.ptr,r,this.registeredClass)}function Oe(e){return this.fromWireType(x[e>>2])}function Fe(e,t,r,n,i,s,o,a,l,c,h){this.name=e,this.registeredClass=t,this.isReference=r,this.isConst=n,this.isSmartPointer=i,this.pointeeType=s,this.sharingPolicy=o,this.rawGetPointee=a,this.rawConstructor=l,this.rawShare=c,this.rawDestructor=h,i||void 0!==t.baseClass?this.toWireType=Le:n?(this.toWireType=De,this.destructorFunction=null):(this.toWireType=ke,this.destructorFunction=null)}var Ne=[];function Ue(e){var t=Ne[e];return t||(e>=Ne.length&&(Ne.length=e+1),Ne[e]=t=L.get(e)),m(L.get(e)==t,"JavaScript-side Wasm function table mirror is out of date!"),t}function Qe(e,t){var r=(e=ne(e)).includes("j")?function(e,t){m(e.includes("j")||e.includes("p"),"getDynCaller should only be called with i64 sigs");var r=[];return function(){return r.length=0,Object.assign(r,arguments),function(e,t,r){return e.includes("j")?function(e,t,r){m("dynCall_"+e in i,"bad function pointer type - no table for sig '"+e+"'"),r&&r.length?m(r.length===e.substring(1).replace(/j/g,"--").length):m(1==e.length);var n=i["dynCall_"+e];return r&&r.length?n.apply(null,[t].concat(r)):n.call(null,t)}(e,t,r):(m(Ue(t),"missing table entry in dynCall: "+t),Ue(t).apply(null,r))}(e,t,r)}}(e,t):Ue(t);return"function"!=typeof r&&ue("unknown function pointer with signature "+e+": "+t),r}var Ge=void 0;function ze(e){var t=yt(e),r=ne(t);return mt(t),r}function je(e,t){var r=[],n={};throw t.forEach((function e(t){n[t]||se[t]||(oe[t]?oe[t].forEach(e):(r.push(t),n[t]=!0))})),new Ge(e+": "+r.map(ze).join([", "]))}function Ve(e,t){for(var r=[],n=0;n<e;n++)r.push(C[t+4*n>>2]);return r}function qe(e,t,r,n,i){var s=t.length;s<2&&ue("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var o=null!==t[1]&&null!==r,a=!1,l=1;l<t.length;++l)if(null!==t[l]&&void 0===t[l].destructorFunction){a=!0;break}var c="void"!==t[0].name,h=s-2,u=new Array(h),d=[],p=[];return function(){var r;arguments.length!==h&&ue("function "+e+" called with "+arguments.length+" arguments, expected "+h+" args!"),p.length=0,d.length=o?2:1,d[0]=i,o&&(r=t[1].toWireType(p,this),d[1]=r);for(var s=0;s<h;++s)u[s]=t[s+2].toWireType(p,arguments[s]),d.push(u[s]);return function(e){if(a)!function(e){for(;e.length;){var t=e.pop();e.pop()(t)}}(p);else for(var n=o?1:2;n<t.length;n++){var i=1===n?r:u[n-2];null!==t[n].destructorFunction&&t[n].destructorFunction(i)}if(c)return t[0].fromWireType(e)}(n.apply(null,d))}}var He=[],We=[{},{value:void 0},{value:null},{value:!0},{value:!1}];var $e={toValue:e=>(e||ue("Cannot use deleted val. handle = "+e),We[e].value),toHandle:e=>{switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=He.length?He.pop():We.length;return We[t]={refcount:1,value:e},t}}};function Ye(e){if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e}function Ke(e,t){switch(t){case 2:return function(e){return this.fromWireType(_[e>>2])};case 3:return function(e){return this.fromWireType(I[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function Je(e,t,r){switch(t){case 0:return r?function(e){return v[e]}:function(e){return w[e]};case 1:return r?function(e){return b[e>>1]}:function(e){return E[e>>1]};case 2:return r?function(e){return x[e>>2]}:function(e){return C[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}var Xe="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function Ze(e,t){m(e%2==0,"Pointer passed to UTF16ToString must be aligned to two bytes!");for(var r=e,n=r>>1,i=n+t/2;!(n>=i)&&E[n];)++n;if((r=n<<1)-e>32&&Xe)return Xe.decode(w.subarray(e,r));for(var s="",o=0;!(o>=t/2);++o){var a=b[e+2*o>>1];if(0==a)break;s+=String.fromCharCode(a)}return s}function et(e,t,r){if(m(t%2==0,"Pointer passed to stringToUTF16 must be aligned to two bytes!"),m("number"==typeof r,"stringToUTF16(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),void 0===r&&(r=2147483647),r<2)return 0;for(var n=t,i=(r-=2)<2*e.length?r/2:e.length,s=0;s<i;++s){var o=e.charCodeAt(s);b[t>>1]=o,t+=2}return b[t>>1]=0,t-n}function tt(e){return 2*e.length}function rt(e,t){m(e%4==0,"Pointer passed to UTF32ToString must be aligned to four bytes!");for(var r=0,n="";!(r>=t/4);){var i=x[e+4*r>>2];if(0==i)break;if(++r,i>=65536){var s=i-65536;n+=String.fromCharCode(55296|s>>10,56320|1023&s)}else n+=String.fromCharCode(i)}return n}function nt(e,t,r){if(m(t%4==0,"Pointer passed to stringToUTF32 must be aligned to four bytes!"),m("number"==typeof r,"stringToUTF32(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),void 0===r&&(r=2147483647),r<4)return 0;for(var n=t,i=n+r-4,s=0;s<e.length;++s){var o=e.charCodeAt(s);if(o>=55296&&o<=57343&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++s)),x[t>>2]=o,(t+=4)+4>i)break}return x[t>>2]=0,t-n}function it(e){for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&++r,t+=4}return t}function st(e){try{return u.grow(e-y.byteLength+65535>>>16),R(u.buffer),1}catch(t){p("emscripten_realloc_buffer: Attempted to grow heap from "+y.byteLength+" bytes to "+e+" bytes, but got error: "+t)}}var ot={};function at(){if(!at.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:a||"./this.program"};for(var t in ot)void 0===ot[t]?delete e[t]:e[t]=ot[t];var r=[];for(var t in e)r.push(t+"="+e[t]);at.strings=r}return at.strings}var lt=[null,[],[]];function ct(e,t){var r=lt[e];m(r),0===t||10===t?((1===e?d:p)(M(r,0)),r.length=0):r.push(t)}function ht(e){return e%4==0&&(e%100!=0||e%400==0)}var ut=[31,29,31,30,31,30,31,31,30,31,30,31],dt=[31,28,31,30,31,30,31,31,30,31,30,31];function pt(e,t,r,n){var i=x[n+40>>2],s={tm_sec:x[n>>2],tm_min:x[n+4>>2],tm_hour:x[n+8>>2],tm_mday:x[n+12>>2],tm_mon:x[n+16>>2],tm_year:x[n+20>>2],tm_wday:x[n+24>>2],tm_yday:x[n+28>>2],tm_isdst:x[n+32>>2],tm_gmtoff:x[n+36>>2],tm_zone:i?T(i):""},o=T(r),a={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var l in a)o=o.replace(new RegExp(l,"g"),a[l]);var c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],h=["January","February","March","April","May","June","July","August","September","October","November","December"];function u(e,t,r){for(var n="number"==typeof e?e.toString():e||"";n.length<t;)n=r[0]+n;return n}function d(e,t){return u(e,t,"0")}function p(e,t){function r(e){return e<0?-1:e>0?1:0}var n;return 0===(n=r(e.getFullYear()-t.getFullYear()))&&0===(n=r(e.getMonth()-t.getMonth()))&&(n=r(e.getDate()-t.getDate())),n}function f(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function g(e){var t=function(e,t){for(var r=new Date(e.getTime());t>0;){var n=ht(r.getFullYear()),i=r.getMonth(),s=(n?ut:dt)[i];if(!(t>s-r.getDate()))return r.setDate(r.getDate()+t),r;t-=s-r.getDate()+1,r.setDate(1),i<11?r.setMonth(i+1):(r.setMonth(0),r.setFullYear(r.getFullYear()+1))}return r}(new Date(e.tm_year+1900,0,1),e.tm_yday),r=new Date(t.getFullYear(),0,4),n=new Date(t.getFullYear()+1,0,4),i=f(r),s=f(n);return p(i,t)<=0?p(s,t)<=0?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var A={"%a":function(e){return c[e.tm_wday].substring(0,3)},"%A":function(e){return c[e.tm_wday]},"%b":function(e){return h[e.tm_mon].substring(0,3)},"%B":function(e){return h[e.tm_mon]},"%C":function(e){return d((e.tm_year+1900)/100|0,2)},"%d":function(e){return d(e.tm_mday,2)},"%e":function(e){return u(e.tm_mday,2," ")},"%g":function(e){return g(e).toString().substring(2)},"%G":function(e){return g(e)},"%H":function(e){return d(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),d(t,2)},"%j":function(e){return d(e.tm_mday+function(e,t){for(var r=0,n=0;n<=t;r+=e[n++]);return r}(ht(e.tm_year+1900)?ut:dt,e.tm_mon-1),3)},"%m":function(e){return d(e.tm_mon+1,2)},"%M":function(e){return d(e.tm_min,2)},"%n":function(){return"\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return d(e.tm_sec,2)},"%t":function(){return"\t"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=e.tm_yday+7-e.tm_wday;return d(Math.floor(t/7),2)},"%V":function(e){var t=Math.floor((e.tm_yday+7-(e.tm_wday+6)%7)/7);if((e.tm_wday+371-e.tm_yday-2)%7<=2&&t++,t){if(53==t){var r=(e.tm_wday+371-e.tm_yday)%7;4==r||3==r&&ht(e.tm_year)||(t=1)}}else{t=52;var n=(e.tm_wday+7-e.tm_yday-1)%7;(4==n||5==n&&ht(e.tm_year%400-1))&&t++}return d(t,2)},"%w":function(e){return e.tm_wday},"%W":function(e){var t=e.tm_yday+7-(e.tm_wday+6)%7;return d(Math.floor(t/7),2)},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t=e.tm_gmtoff,r=t>=0;return t=(t=Math.abs(t)/60)/60*100+t%60,(r?"+":"-")+String("0000"+t).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var l in o=o.replace(/%%/g,"\0\0"),A)o.includes(l)&&(o=o.replace(new RegExp(l,"g"),A[l](s)));var y,w,b,E=(w=P(y=o=o.replace(/\0\0/g,"%"))+1,B(y,b=new Array(w),0,b.length),b);return E.length>t?0:(function(e,t){m(e.length>=0,"writeArrayToMemory array must have a length (should be an array or typed array)"),v.set(e,t)}(E,e),E.length-1)}!function(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);re=e}(),he=i.BindingError=ce(Error,"BindingError"),de=i.InternalError=ce(Error,"InternalError"),Te.prototype.isAliasOf=function(e){if(!(this instanceof Te))return!1;if(!(e instanceof Te))return!1;for(var t=this.$$.ptrType.registeredClass,r=this.$$.ptr,n=e.$$.ptrType.registeredClass,i=e.$$.ptr;t.baseClass;)r=t.upcast(r),t=t.baseClass;for(;n.baseClass;)i=n.upcast(i),n=n.baseClass;return t===n&&r===i},Te.prototype.clone=function(){if(this.$$.ptr||Ae(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var e,t=Me(Object.create(Object.getPrototypeOf(this),{$$:{value:(e=this.$$,{count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType})}}));return t.$$.count.value+=1,t.$$.deleteScheduled=!1,t},Te.prototype.delete=function(){this.$$.ptr||Ae(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ue("Object already scheduled for deletion"),ye(this),ve(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},Te.prototype.isDeleted=function(){return!this.$$.ptr},Te.prototype.deleteLater=function(){return this.$$.ptr||Ae(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ue("Object already scheduled for deletion"),Ee.push(this),1===Ee.length&&Ce&&Ce(xe),this.$$.deleteScheduled=!0,this},i.getInheritedInstanceCount=function(){return Object.keys(_e).length},i.getLiveInheritedInstances=function(){var e=[];for(var t in _e)_e.hasOwnProperty(t)&&e.push(_e[t]);return e},i.flushPendingDeletes=xe,i.setDelayFunction=function(e){Ce=e,Ee.length&&Ce&&Ce(xe)},Fe.prototype.getPointee=function(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e},Fe.prototype.destructor=function(e){this.rawDestructor&&this.rawDestructor(e)},Fe.prototype.argPackAdvance=8,Fe.prototype.readValueFromPointer=Oe,Fe.prototype.deleteObject=function(e){null!==e&&e.delete()},Fe.prototype.fromWireType=Se,Ge=i.UnboundTypeError=ce(Error,"UnboundTypeError"),i.count_emval_handles=function(){for(var e=0,t=5;t<We.length;++t)void 0!==We[t]&&++e;return e},i.get_first_emval=function(){for(var e=5;e<We.length;++e)if(void 0!==We[e])return We[e];return null};var ft,gt={__cxa_allocate_exception:function(e){return At(e+24)+24},__cxa_throw:function(e,t,r){throw new ee(e).init(t,r),e+" - Exception catching is disabled, this exception cannot be caught. Compile with -sNO_DISABLE_EXCEPTION_CATCHING or -sEXCEPTION_CATCHING_ALLOWED=[..] to catch."},_embind_register_bigint:function(e,t,r,n,i){},_embind_register_bool:function(e,t,r,n,i){var s=te(r);ge(e,{name:t=ne(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?n:i},argPackAdvance:8,readValueFromPointer:function(e){var n;if(1===r)n=v;else if(2===r)n=b;else{if(4!==r)throw new TypeError("Unknown boolean type size: "+t);n=x}return this.fromWireType(n[e>>s])},destructorFunction:null})},_embind_register_class:function(e,t,r,n,s,o,a,l,c,h,u,d,p){u=ne(u),o=Qe(s,o),l&&(l=Qe(a,l)),h&&(h=Qe(c,h)),p=Qe(d,p);var f=ae(u);!function(e,t,r){i.hasOwnProperty(e)?(ue("Cannot register public name '"+e+"' twice"),Be(i,e,e),i.hasOwnProperty(r)&&ue("Cannot register multiple overloads of a function with the same number of arguments ("+r+")!"),i[e].overloadTable[void 0]=t):i[e]=t}(f,(function(){je("Cannot construct "+u+" due to unbound types",[n])})),fe([e,t,r],n?[n]:[],(function(t){var r,s;t=t[0],s=n?(r=t.registeredClass).instancePrototype:Te.prototype;var a=le(f,(function(){if(Object.getPrototypeOf(this)!==c)throw new he("Use 'new' to construct "+u);if(void 0===d.constructor_body)throw new he(u+" has no accessible constructor");var e=d.constructor_body[arguments.length];if(void 0===e)throw new he("Tried to invoke ctor of "+u+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(d.constructor_body).toString()+") parameters instead!");return e.apply(this,arguments)})),c=Object.create(s,{constructor:{value:a}});a.prototype=c;var d=new Pe(u,a,c,p,r,o,l,h),g=new Fe(u,d,!0,!1,!1),A=new Fe(u+"*",d,!1,!1,!1),m=new Fe(u+" const*",d,!1,!0,!1);return be[e]={pointerType:A,constPointerType:m},function(e,t,r){i.hasOwnProperty(e)||pe("Replacing nonexistant public symbol"),i[e].overloadTable,i[e]=t,i[e].argCount=r}(f,a),[g,A,m]}))},_embind_register_class_constructor:function(e,t,r,n,i,s){m(t>0);var o=Ve(t,r);i=Qe(n,i),fe([],[e],(function(e){var r="constructor "+(e=e[0]).name;if(void 0===e.registeredClass.constructor_body&&(e.registeredClass.constructor_body=[]),void 0!==e.registeredClass.constructor_body[t-1])throw new he("Cannot register multiple constructors with identical number of parameters ("+(t-1)+") for class '"+e.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return e.registeredClass.constructor_body[t-1]=()=>{je("Cannot construct "+e.name+" due to unbound types",o)},fe([],o,(function(n){return n.splice(1,0,null),e.registeredClass.constructor_body[t-1]=qe(r,n,null,i,s),[]})),[]}))},_embind_register_class_function:function(e,t,r,n,i,s,o,a){var l=Ve(r,n);t=ne(t),s=Qe(i,s),fe([],[e],(function(e){var n=(e=e[0]).name+"."+t;function i(){je("Cannot call "+n+" due to unbound types",l)}t.startsWith("@@")&&(t=Symbol[t.substring(2)]),a&&e.registeredClass.pureVirtualFunctions.push(t);var c=e.registeredClass.instancePrototype,h=c[t];return void 0===h||void 0===h.overloadTable&&h.className!==e.name&&h.argCount===r-2?(i.argCount=r-2,i.className=e.name,c[t]=i):(Be(c,t,n),c[t].overloadTable[r-2]=i),fe([],l,(function(i){var a=qe(n,i,e,s,o);return void 0===c[t].overloadTable?(a.argCount=r-2,c[t]=a):c[t].overloadTable[r-2]=a,[]})),[]}))},_embind_register_emval:function(e,t){ge(e,{name:t=ne(t),fromWireType:function(e){var t=$e.toValue(e);return function(e){e>4&&0==--We[e].refcount&&(We[e]=void 0,He.push(e))}(e),t},toWireType:function(e,t){return $e.toHandle(t)},argPackAdvance:8,readValueFromPointer:Oe,destructorFunction:null})},_embind_register_float:function(e,t,r){var n=te(r);ge(e,{name:t=ne(t),fromWireType:function(e){return e},toWireType:function(e,t){if("number"!=typeof t&&"boolean"!=typeof t)throw new TypeError('Cannot convert "'+Ye(t)+'" to '+this.name);return t},argPackAdvance:8,readValueFromPointer:Ke(t,n),destructorFunction:null})},_embind_register_integer:function(e,t,r,n,i){t=ne(t),-1===i&&(i=4294967295);var s=te(r),o=e=>e;if(0===n){var a=32-8*r;o=e=>e<<a>>>a}var l=t.includes("unsigned"),c=(e,r)=>{if("number"!=typeof e&&"boolean"!=typeof e)throw new TypeError('Cannot convert "'+Ye(e)+'" to '+r);if(e<n||e>i)throw new TypeError('Passing a number "'+Ye(e)+'" from JS side to C/C++ side to an argument of type "'+t+'", which is outside the valid range ['+n+", "+i+"]!")};ge(e,{name:t,fromWireType:o,toWireType:l?function(e,t){return c(t,this.name),t>>>0}:function(e,t){return c(t,this.name),t},argPackAdvance:8,readValueFromPointer:Je(t,s,0!==n),destructorFunction:null})},_embind_register_memory_view:function(e,t,r){var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function i(e){var t=C,r=t[e>>=2],i=t[e+1];return new n(y,i,r)}ge(e,{name:r=ne(r),fromWireType:i,argPackAdvance:8,readValueFromPointer:i},{ignoreDuplicateRegistrations:!0})},_embind_register_std_string:function(e,t){var r="std::string"===(t=ne(t));ge(e,{name:t,fromWireType:function(e){var t,n=C[e>>2],i=e+4;if(r)for(var s=i,o=0;o<=n;++o){var a=i+o;if(o==n||0==w[a]){var l=T(s,a-s);void 0===t?t=l:(t+=String.fromCharCode(0),t+=l),s=a+1}}else{var c=new Array(n);for(o=0;o<n;++o)c[o]=String.fromCharCode(w[i+o]);t=c.join("")}return mt(e),t},toWireType:function(e,t){var n;t instanceof ArrayBuffer&&(t=new Uint8Array(t));var i="string"==typeof t;i||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||ue("Cannot pass non-string to std::string"),n=r&&i?P(t):t.length;var s,o,a,l=At(4+n+1),c=l+4;if(C[l>>2]=n,r&&i)s=t,o=c,m("number"==typeof(a=n+1),"stringToUTF8(str, outPtr, maxBytesToWrite) is missing the third parameter that specifies the length of the output buffer!"),B(s,w,o,a);else if(i)for(var h=0;h<n;++h){var u=t.charCodeAt(h);u>255&&(mt(c),ue("String has UTF-16 code units that do not fit in 8 bits")),w[c+h]=u}else for(h=0;h<n;++h)w[c+h]=t[h];return null!==e&&e.push(mt,l),l},argPackAdvance:8,readValueFromPointer:Oe,destructorFunction:function(e){mt(e)}})},_embind_register_std_wstring:function(e,t,r){var n,i,s,o,a;r=ne(r),2===t?(n=Ze,i=et,o=tt,s=()=>E,a=1):4===t&&(n=rt,i=nt,o=it,s=()=>C,a=2),ge(e,{name:r,fromWireType:function(e){for(var r,i=C[e>>2],o=s(),l=e+4,c=0;c<=i;++c){var h=e+4+c*t;if(c==i||0==o[h>>a]){var u=n(l,h-l);void 0===r?r=u:(r+=String.fromCharCode(0),r+=u),l=h+t}}return mt(e),r},toWireType:function(e,n){"string"!=typeof n&&ue("Cannot pass non-string to C++ string type "+r);var s=o(n),l=At(4+s+t);return C[l>>2]=s>>a,i(n,l+4,s+t),null!==e&&e.push(mt,l),l},argPackAdvance:8,readValueFromPointer:Oe,destructorFunction:function(e){mt(e)}})},_embind_register_void:function(e,t){ge(e,{isVoid:!0,name:t=ne(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})},abort:function(){q("native code called abort()")},emscripten_memcpy_big:function(e,t,r){w.copyWithin(e,t,t+r)},emscripten_resize_heap:function(e){var t=w.length;m((e>>>=0)>t);var r,n=2147483648;if(e>n)return p("Cannot enlarge memory, asked to go up to "+e+" bytes, but the limit is "+n+" bytes!"),!1;for(var i=1;i<=4;i*=2){var s=t*(1+.2/i);s=Math.min(s,e+100663296);var o=Math.min(n,(r=Math.max(e,s))+(65536-r%65536)%65536);if(st(o))return!0}return p("Failed to grow the heap from "+t+" bytes to "+o+" bytes, not enough memory!"),!1},environ_get:function(e,t){var r=0;return at().forEach((function(n,i){var s=t+r;C[e+4*i>>2]=s,function(e,t){for(var r=0;r<e.length;++r)m(e.charCodeAt(r)===(255&e.charCodeAt(r))),v[0|t++]=e.charCodeAt(r);v[0|t]=0}(n,s),r+=n.length+1})),0},environ_sizes_get:function(e,t){var r=at();C[e>>2]=r.length;var n=0;return r.forEach((function(e){n+=e.length+1})),C[t>>2]=n,0},fd_close:function(e){q("fd_close called without SYSCALLS_REQUIRE_FILESYSTEM")},fd_seek:function(e,t,r,n,i){return 70},fd_write:function(e,t,r,n){for(var i=0,s=0;s<r;s++){var o=C[t>>2],a=C[t+4>>2];t+=8;for(var l=0;l<a;l++)ct(e,w[o+l]);i+=a}return C[n>>2]=i,0},strftime_l:function(e,t,r,n){return pt(e,t,r,n)}},At=(function(){var e,t={env:gt,wasi_snapshot_preview1:gt};function r(e,t){var r,n=e.exports;i.asm=n,m(u=i.asm.memory,"memory not found in wasm exports"),R(u.buffer),m(L=i.asm.__indirect_function_table,"table not found in wasm exports"),r=i.asm.__wasm_call_ctors,N.unshift(r),function(e){if(G--,i.monitorRunDependencies&&i.monitorRunDependencies(G),e?(m(V[e]),delete V[e]):p("warning: run dependency removed without ID"),0==G&&(null!==z&&(clearInterval(z),z=null),j)){var t=j;j=null,t()}}("wasm-instantiate")}e="wasm-instantiate",G++,i.monitorRunDependencies&&i.monitorRunDependencies(G),e?(m(!V[e]),V[e]=1,null===z&&"undefined"!=typeof setInterval&&(z=setInterval((function(){if(A)return clearInterval(z),void(z=null);var e=!1;for(var t in V)e||(e=!0,p("still waiting on run dependencies:")),p("dependency: "+t);e&&p("(end of list)")}),1e4))):p("warning: run dependency added without ID");var s=i;function o(e){m(i===s,"the Module object should not be replaced during async compilation - perhaps the order of HTML elements is wrong?"),s=null,r(e.instance)}function a(e){return(h||"function"!=typeof fetch?Promise.resolve().then((function(){return J(H)})):fetch(H,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+H+"'";return e.arrayBuffer()})).catch((function(){return J(H)}))).then((function(e){return WebAssembly.instantiate(e,t)})).then((function(e){return e})).then(e,(function(e){p("failed to asynchronously prepare wasm: "+e),H.startsWith("file://")&&p("warning: Loading from a file URI ("+H+") is not supported in most browsers. See https://emscripten.org/docs/getting_started/FAQ.html#how-do-i-run-a-local-webserver-for-testing-why-does-my-program-stall-in-downloading-or-preparing"),q(e)}))}if(i.instantiateWasm)try{return i.instantiateWasm(t,r)}catch(e){return p("Module.instantiateWasm callback failed with error: "+e),!1}(h||"function"!=typeof WebAssembly.instantiateStreaming||Y(H)||"function"!=typeof fetch?a(o):fetch(H,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,t).then(o,(function(e){return p("wasm streaming compile failed: "+e),p("falling back to ArrayBuffer instantiation"),a(o)}))}))).catch(n)}(),i.___wasm_call_ctors=K("__wasm_call_ctors"),i._malloc=K("malloc")),mt=i._free=K("free"),yt=i.___getTypeName=K("__getTypeName"),vt=(i.__embind_initialize_bindings=K("_embind_initialize_bindings"),i.___errno_location=K("__errno_location"),i._fflush=K("fflush"),i._emscripten_stack_init=function(){return(vt=i._emscripten_stack_init=i.asm.emscripten_stack_init).apply(null,arguments)}),wt=(i._emscripten_stack_get_free=function(){return(i._emscripten_stack_get_free=i.asm.emscripten_stack_get_free).apply(null,arguments)},i._emscripten_stack_get_base=function(){return(i._emscripten_stack_get_base=i.asm.emscripten_stack_get_base).apply(null,arguments)},i._emscripten_stack_get_end=function(){return(wt=i._emscripten_stack_get_end=i.asm.emscripten_stack_get_end).apply(null,arguments)}),bt=(i.stackSave=K("stackSave"),i.stackRestore=K("stackRestore"),i.stackAlloc=K("stackAlloc"),i.___cxa_is_pointer_type=K("__cxa_is_pointer_type"));function Et(e){function t(){ft||(ft=!0,i.calledRun=!0,A||(m(!Q),Q=!0,O(),X(N),r(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),m(!i._main,'compiled without a main, but one is present. if you added it from JS, use Module["onRuntimeInitialized"]'),function(){if(O(),i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)e=i.postRun.shift(),U.unshift(e);var e;X(U)}()))}var n;e=e||o,G>0||(vt(),m(!(3&(n=wt()))),C[n>>2]=34821223,C[n+4>>2]=2310721022,C[0]=1668509029,function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)e=i.preRun.shift(),F.unshift(e);var e;X(F)}(),G>0||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),t()}),1)):t(),O()))}if(i.dynCall_viijii=K("dynCall_viijii"),i.dynCall_ji=K("dynCall_ji"),i.dynCall_jiji=K("dynCall_jiji"),i.dynCall_iiiiij=K("dynCall_iiiiij"),i.dynCall_iiiiijj=K("dynCall_iiiiijj"),i.dynCall_iiiiiijj=K("dynCall_iiiiiijj"),["run","UTF8ArrayToString","UTF8ToString","stringToUTF8Array","stringToUTF8","lengthBytesUTF8","addOnPreRun","addOnInit","addOnPreMain","addOnExit","addOnPostRun","addRunDependency","removeRunDependency","FS_createFolder","FS_createPath","FS_createDataFile","FS_createPreloadedFile","FS_createLazyFile","FS_createLink","FS_createDevice","FS_unlink","getLEB","getFunctionTables","alignFunctionTables","registerFunctions","prettyPrint","getCompilerSetting","print","printErr","callMain","abort","keepRuntimeAlive","wasmMemory","stackAlloc","stackSave","stackRestore","getTempRet0","setTempRet0","writeStackCookie","checkStackCookie","ptrToString","zeroMemory","stringToNewUTF8","exitJS","getHeapMax","emscripten_realloc_buffer","ENV","ERRNO_CODES","ERRNO_MESSAGES","setErrNo","inetPton4","inetNtop4","inetPton6","inetNtop6","readSockaddr","writeSockaddr","DNS","getHostByName","Protocols","Sockets","getRandomDevice","warnOnce","traverseStack","UNWIND_CACHE","convertPCtoSourceLocation","readAsmConstArgsArray","readAsmConstArgs","mainThreadEM_ASM","jstoi_q","jstoi_s","getExecutableName","listenOnce","autoResumeAudioContext","dynCallLegacy","getDynCaller","dynCall","handleException","runtimeKeepalivePush","runtimeKeepalivePop","callUserCallback","maybeExit","safeSetTimeout","asmjsMangle","asyncLoad","alignMemory","mmapAlloc","writeI53ToI64","writeI53ToI64Clamped","writeI53ToI64Signaling","writeI53ToU64Clamped","writeI53ToU64Signaling","readI53FromI64","readI53FromU64","convertI32PairToI53","convertI32PairToI53Checked","convertU32PairToI53","getCFunc","ccall","cwrap","uleb128Encode","sigToWasmTypes","convertJsFunctionToWasm","freeTableIndexes","functionsInTableMap","getEmptyTableSlot","updateTableMap","addFunction","removeFunction","reallyNegative","unSign","strLen","reSign","formatString","setValue","getValue","PATH","PATH_FS","intArrayFromString","intArrayToString","AsciiToString","stringToAscii","UTF16Decoder","UTF16ToString","stringToUTF16","lengthBytesUTF16","UTF32ToString","stringToUTF32","lengthBytesUTF32","allocateUTF8","allocateUTF8OnStack","writeStringToMemory","writeArrayToMemory","writeAsciiToMemory","SYSCALLS","getSocketFromFD","getSocketAddress","JSEvents","registerKeyEventCallback","specialHTMLTargets","maybeCStringToJsString","findEventTarget","findCanvasEventTarget","getBoundingClientRect","fillMouseEventData","registerMouseEventCallback","registerWheelEventCallback","registerUiEventCallback","registerFocusEventCallback","fillDeviceOrientationEventData","registerDeviceOrientationEventCallback","fillDeviceMotionEventData","registerDeviceMotionEventCallback","screenOrientation","fillOrientationChangeEventData","registerOrientationChangeEventCallback","fillFullscreenChangeEventData","registerFullscreenChangeEventCallback","JSEvents_requestFullscreen","JSEvents_resizeCanvasForFullscreen","registerRestoreOldStyle","hideEverythingExceptGivenElement","restoreHiddenElements","setLetterbox","currentFullscreenStrategy","restoreOldWindowedStyle","softFullscreenResizeWebGLRenderTarget","doRequestFullscreen","fillPointerlockChangeEventData","registerPointerlockChangeEventCallback","registerPointerlockErrorEventCallback","requestPointerLock","fillVisibilityChangeEventData","registerVisibilityChangeEventCallback","registerTouchEventCallback","fillGamepadEventData","registerGamepadEventCallback","registerBeforeUnloadEventCallback","fillBatteryEventData","battery","registerBatteryEventCallback","setCanvasElementSize","getCanvasElementSize","demangle","demangleAll","jsStackTrace","stackTrace","ExitStatus","getEnvStrings","checkWasiClock","flush_NO_FILESYSTEM","dlopenMissingError","setImmediateWrapped","clearImmediateWrapped","polyfillSetImmediate","uncaughtExceptionCount","exceptionLast","exceptionCaught","ExceptionInfo","exception_addRef","exception_decRef","Browser","setMainLoop","wget","FS","MEMFS","TTY","PIPEFS","SOCKFS","_setNetworkCallback","tempFixedLengthArray","miniTempWebGLFloatBuffers","heapObjectForWebGLType","heapAccessShiftForWebGLHeap","GL","emscriptenWebGLGet","computeUnpackAlignedImageSize","emscriptenWebGLGetTexPixelData","emscriptenWebGLGetUniform","webglGetUniformLocation","webglPrepareUniformLocationsBeforeFirstUse","webglGetLeftBracePos","emscriptenWebGLGetVertexAttrib","writeGLArray","AL","SDL_unicode","SDL_ttfContext","SDL_audio","SDL","SDL_gfx","GLUT","EGL","GLFW_Window","GLFW","GLEW","IDBStore","runAndAbortIfError","ALLOC_NORMAL","ALLOC_STACK","allocate","InternalError","BindingError","UnboundTypeError","PureVirtualError","init_embind","throwInternalError","throwBindingError","throwUnboundTypeError","ensureOverloadTable","exposePublicSymbol","replacePublicSymbol","extendError","createNamedFunction","embindRepr","registeredInstances","getBasestPointer","registerInheritedInstance","unregisterInheritedInstance","getInheritedInstance","getInheritedInstanceCount","getLiveInheritedInstances","registeredTypes","awaitingDependencies","typeDependencies","registeredPointers","registerType","whenDependentTypesAreResolved","embind_charCodes","embind_init_charCodes","readLatin1String","getTypeName","heap32VectorToArray","requireRegisteredType","getShiftFromSize","integerReadValueFromPointer","enumReadValueFromPointer","floatReadValueFromPointer","simpleReadValueFromPointer","runDestructors","new_","craftInvokerFunction","embind__requireFunction","tupleRegistrations","structRegistrations","genericPointerToWireType","constNoSmartPtrRawPointerToWireType","nonConstNoSmartPtrRawPointerToWireType","init_RegisteredPointer","RegisteredPointer","RegisteredPointer_getPointee","RegisteredPointer_destructor","RegisteredPointer_deleteObject","RegisteredPointer_fromWireType","runDestructor","releaseClassHandle","finalizationRegistry","detachFinalizer_deps","detachFinalizer","attachFinalizer","makeClassHandle","init_ClassHandle","ClassHandle","ClassHandle_isAliasOf","throwInstanceAlreadyDeleted","ClassHandle_clone","ClassHandle_delete","deletionQueue","ClassHandle_isDeleted","ClassHandle_deleteLater","flushPendingDeletes","delayFunction","setDelayFunction","RegisteredClass","shallowCopyInternalPointer","downcastPointer","upcastPointer","validateThis","char_0","char_9","makeLegalFunctionName","emval_handle_array","emval_free_list","emval_symbols","init_emval","count_emval_handles","get_first_emval","getStringOrSymbol","Emval","emval_newers","craftEmvalAllocator","emval_get_global","emval_lookupTypes","emval_allocateDestructors","emval_methodCallers","emval_addMethodCaller","emval_registeredMethods"].forEach((function(e){Object.getOwnPropertyDescriptor(i,e)||Object.defineProperty(i,e,{configurable:!0,get:function(){var t="'"+e+"' was not exported. add it to EXPORTED_RUNTIME_METHODS (see the FAQ)";g(e)&&(t+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),q(t)}})})),["ptrToString","zeroMemory","stringToNewUTF8","exitJS","setErrNo","inetPton4","inetNtop4","inetPton6","inetNtop6","readSockaddr","writeSockaddr","getHostByName","getRandomDevice","traverseStack","convertPCtoSourceLocation","readAsmConstArgs","mainThreadEM_ASM","jstoi_q","jstoi_s","listenOnce","autoResumeAudioContext","runtimeKeepalivePush","runtimeKeepalivePop","callUserCallback","maybeExit","safeSetTimeout","asmjsMangle","asyncLoad","alignMemory","mmapAlloc","writeI53ToI64","writeI53ToI64Clamped","writeI53ToI64Signaling","writeI53ToU64Clamped","writeI53ToU64Signaling","readI53FromI64","readI53FromU64","convertI32PairToI53","convertU32PairToI53","reallyNegative","unSign","strLen","reSign","formatString","getSocketFromFD","getSocketAddress","registerKeyEventCallback","maybeCStringToJsString","findEventTarget","findCanvasEventTarget","getBoundingClientRect","fillMouseEventData","registerMouseEventCallback","registerWheelEventCallback","registerUiEventCallback","registerFocusEventCallback","fillDeviceOrientationEventData","registerDeviceOrientationEventCallback","fillDeviceMotionEventData","registerDeviceMotionEventCallback","screenOrientation","fillOrientationChangeEventData","registerOrientationChangeEventCallback","fillFullscreenChangeEventData","registerFullscreenChangeEventCallback","JSEvents_requestFullscreen","JSEvents_resizeCanvasForFullscreen","registerRestoreOldStyle","hideEverythingExceptGivenElement","restoreHiddenElements","setLetterbox","softFullscreenResizeWebGLRenderTarget","doRequestFullscreen","fillPointerlockChangeEventData","registerPointerlockChangeEventCallback","registerPointerlockErrorEventCallback","requestPointerLock","fillVisibilityChangeEventData","registerVisibilityChangeEventCallback","registerTouchEventCallback","fillGamepadEventData","registerGamepadEventCallback","registerBeforeUnloadEventCallback","fillBatteryEventData","battery","registerBatteryEventCallback","setCanvasElementSize","getCanvasElementSize","checkWasiClock","setImmediateWrapped","clearImmediateWrapped","polyfillSetImmediate","exception_addRef","exception_decRef","setMainLoop","_setNetworkCallback","heapObjectForWebGLType","heapAccessShiftForWebGLHeap","emscriptenWebGLGet","computeUnpackAlignedImageSize","emscriptenWebGLGetTexPixelData","emscriptenWebGLGetUniform","webglGetUniformLocation","webglPrepareUniformLocationsBeforeFirstUse","webglGetLeftBracePos","emscriptenWebGLGetVertexAttrib","writeGLArray","SDL_unicode","SDL_ttfContext","SDL_audio","GLFW_Window","runAndAbortIfError","registerInheritedInstance","unregisterInheritedInstance","requireRegisteredType","enumReadValueFromPointer","validateThis","getStringOrSymbol","craftEmvalAllocator","emval_get_global","emval_lookupTypes","emval_allocateDestructors","emval_addMethodCaller"].forEach((function(e){"undefined"==typeof globalThis||Object.getOwnPropertyDescriptor(globalThis,e)||Object.defineProperty(globalThis,e,{configurable:!0,get:function(){var t="`"+e+"` is a library symbol and not included by default; add it to your library.js __deps or to DEFAULT_LIBRARY_FUNCS_TO_INCLUDE on the command line";g(e)&&(t+=". Alternatively, forcing filesystem support (-sFORCE_FILESYSTEM) can export this for you"),Z(t)}})})),j=function e(){ft||Et(),ft||(j=e)},i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();return Et(),e.ready});e.exports=r},67348:(e,t,r)=>{var n=r(46518),i=r(76557),s=r(44995).remove;n({target:"WeakMap",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var e,t=i(this),r=!0,n=0,o=arguments.length;n<o;n++)e=s(t,arguments[n]),r=r&&e;return!!r}})},67357:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(67750),o=r(91291),a=r(655),l=r(79039),c=i("".charAt);n({target:"String",proto:!0,forced:l((function(){return"\ud842"!=="".at(-2)}))},{at:function(e){var t=a(s(this)),r=t.length,n=o(e),i=n>=0?n:r+n;return i<0||i>=r?void 0:c(t,i)}})},67394:(e,t,r)=>{var n=r(44576),i=r(46706),s=r(22195),o=n.ArrayBuffer,a=n.TypeError;e.exports=o&&i(o.prototype,"byteLength","get")||function(e){if("ArrayBuffer"!==s(e))throw new a("ArrayBuffer expected");return e.byteLength}},67400:e=>{e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},67416:(e,t,r)=>{var n=r(79039),i=r(78227),s=r(43724),o=r(96395),a=i("iterator");e.exports=!n((function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,r=new URLSearchParams("a=1&a=2&b=3"),n="";return e.pathname="c%20d",t.forEach((function(e,r){t.delete("b"),n+=r+e})),r.delete("a",2),r.delete("b",void 0),o&&(!e.toJSON||!r.has("a",1)||r.has("a",2)||!r.has("a",void 0)||r.has("b"))||!t.size&&(o||!s)||!t.sort||"https://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[a]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("https://").host||"#%D0%B1"!==new URL("https://a#").hash||"a1c3"!==n||"x"!==new URL("https://x",void 0).host}))},67438:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(79504),o=r(67750),a=r(655),l=r(79039),c=Array,h=s("".charAt),u=s("".charCodeAt),d=s([].join),p="".toWellFormed,f=p&&l((function(){return"1"!==i(p,1)}));n({target:"String",proto:!0,forced:f},{toWellFormed:function(){var e=a(o(this));if(f)return i(p,e);for(var t=e.length,r=c(t),n=0;n<t;n++){var s=u(e,n);55296!=(63488&s)?r[n]=h(e,n):s>=56320||n+1>=t||56320!=(64512&u(e,n+1))?r[n]="":(r[n]=h(e,n),r[++n]=h(e,n))}return d(r,"")}})},67680:(e,t,r)=>{var n=r(79504);e.exports=n([].slice)},67750:(e,t,r)=>{var n=r(64117),i=TypeError;e.exports=function(e){if(n(e))throw new i("Can't call method on "+e);return e}},67787:e=>{var t=Math.log,r=Math.LN2;e.exports=Math.log2||function(e){return t(e)/r}},67945:(e,t,r)=>{var n=r(46518),i=r(43724),s=r(96801).f;n({target:"Object",stat:!0,forced:Object.defineProperties!==s,sham:!i},{defineProperties:s})},67947:(e,t,r)=>{r(70511)("species")},67979:(e,t,r)=>{var n=r(28551);e.exports=function(){var e=n(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},68156:(e,t,r)=>{var n=r(46518),i=r(60533).start;n({target:"String",proto:!0,forced:r(83063)},{padStart:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},68183:(e,t,r)=>{var n=r(79504),i=r(91291),s=r(655),o=r(67750),a=n("".charAt),l=n("".charCodeAt),c=n("".slice),h=function(e){return function(t,r){var n,h,u=s(o(t)),d=i(r),p=u.length;return d<0||d>=p?e?"":void 0:(n=l(u,d))<55296||n>56319||d+1===p||(h=l(u,d+1))<56320||h>57343?e?a(u,d):n:e?c(u,d,d+2):h-56320+(n-55296<<10)+65536}};e.exports={codeAt:h(!1),charAt:h(!0)}},68750:(e,t,r)=>{var n=r(97080),i=r(94402),s=r(25170),o=r(83789),a=r(38469),l=r(40507),c=i.Set,h=i.add,u=i.has;e.exports=function(e){var t=n(this),r=o(e),i=new c;return s(t)>r.size?l(r.getIterator(),(function(e){u(t,e)&&h(i,e)})):a(t,(function(e){r.includes(e)&&h(i,e)})),i}},68916:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Header=void 0;const n=r(876),i=r(48300),s=r(47952);function o(e){const t=n.Binary.toDataView(e),r=[];for(let e=0;e<120;e+=8)r.push((0,n.getBigUint64)(t,e,!0));return r.map((e=>(0,n.parseBigInt)(e)))}function a(e){const t=n.Binary.toDataView(e),r=[];for(let e=0;e<20;e+=4)r.push(t.getUint32(e,!0));return r}t.Header={parse:function(e){if(e.byteLength<i.minHeaderLength)throw new Error(`Invalid header: must be at least ${i.minHeaderLength} bytes`);const t=n.Binary.toDataView(e),r=n.Binary.toCString(e.slice(0,4));if("LASF"!==r)throw new Error(`Invalid file signature: ${r}`);const l=t.getUint8(24),c=t.getUint8(25);if(1!==l||2!==c&&4!==c)throw new Error(`Invalid version (only 1.2 and 1.4 supported): ${l}.${c}`);const h={fileSignature:r,fileSourceId:t.getUint16(4,!0),globalEncoding:t.getUint16(6,!0),projectId:(0,s.formatGuid)(e.slice(8,24)),majorVersion:l,minorVersion:c,systemIdentifier:n.Binary.toCString(e.slice(26,58)),generatingSoftware:n.Binary.toCString(e.slice(58,90)),fileCreationDayOfYear:t.getUint16(90,!0),fileCreationYear:t.getUint16(92,!0),headerLength:t.getUint16(94,!0),pointDataOffset:t.getUint32(96,!0),vlrCount:t.getUint32(100,!0),pointDataRecordFormat:15&t.getUint8(104),pointDataRecordLength:t.getUint16(105,!0),pointCount:t.getUint32(107,!0),pointCountByReturn:a(e.slice(111,131)),scale:(0,s.parsePoint)(e.slice(131,155)),offset:(0,s.parsePoint)(e.slice(155,179)),min:[t.getFloat64(187,!0),t.getFloat64(203,!0),t.getFloat64(219,!0)],max:[t.getFloat64(179,!0),t.getFloat64(195,!0),t.getFloat64(211,!0)],waveformDataOffset:0,evlrOffset:0,evlrCount:0};return 2==c?h:{...h,pointCount:(0,n.parseBigInt)((0,n.getBigUint64)(t,247,!0)),pointCountByReturn:o(e.slice(255,375)),waveformDataOffset:(0,n.parseBigInt)((0,n.getBigUint64)(t,227,!0)),evlrOffset:(0,n.parseBigInt)((0,n.getBigUint64)(t,235,!0)),evlrCount:t.getUint32(243,!0)}}}},68931:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(47650),o=r(53838);n({target:"Set",proto:!0,real:!0,forced:!0},{isSubsetOf:function(e){return i(o,this,s(e))}})},68962:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(69545),t),i(r(24305),t)},69085:(e,t,r)=>{var n=r(46518),i=r(44213);n({target:"Object",stat:!0,arity:2,forced:Object.assign!==i},{assign:i})},69479:(e,t,r)=>{var n=r(44576),i=r(43724),s=r(62106),o=r(67979),a=r(79039),l=n.RegExp,c=l.prototype;i&&a((function(){var e=!0;try{l(".","d")}catch(t){e=!1}var t={},r="",n=e?"dgimsy":"gimsy",i=function(e,n){Object.defineProperty(t,e,{get:function(){return r+=n,!0}})},s={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var o in e&&(s.hasIndices="d"),s)i(o,s[o]);return Object.getOwnPropertyDescriptor(c,"flags").get.call(t)!==n||r!==n}))&&s(c,"flags",{configurable:!0,get:o})},69539:(e,t,r)=>{var n=r(94644),i=r(59213).filter,s=r(29948),o=n.aTypedArray;(0,n.exportTypedArrayMethod)("filter",(function(e){var t=i(o(this),e,arguments.length>1?arguments[1]:void 0);return s(this,t)}))},69545:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},69546:(e,t,r)=>{var n=r(46518),i=r(77240);n({target:"String",proto:!0,forced:r(23061)("fontsize")},{fontsize:function(e){return i(this,"font","size",e)}})},69565:(e,t,r)=>{var n=r(40616),i=Function.prototype.call;e.exports=n?i.bind(i):function(){return i.apply(i,arguments)}},70081:(e,t,r)=>{var n=r(69565),i=r(79306),s=r(28551),o=r(16823),a=r(50851),l=TypeError;e.exports=function(e,t){var r=arguments.length<2?a(e):t;if(i(r))return s(n(r,e));throw new l(o(e)+" is not iterable")}},70259:(e,t,r)=>{var n=r(34376),i=r(26198),s=r(96837),o=r(76080),a=function(e,t,r,l,c,h,u,d){for(var p,f,g=c,A=0,m=!!u&&o(u,d);A<l;)A in r&&(p=m?m(r[A],A,t):r[A],h>0&&n(p)?(f=i(p),g=a(e,t,p,f,g,h-1)-1):(s(g+1),e[g]=p),g++),A++;return g};e.exports=a},70380:(e,t,r)=>{var n=r(79504),i=r(79039),s=r(60533).start,o=RangeError,a=isFinite,l=Math.abs,c=Date.prototype,h=c.toISOString,u=n(c.getTime),d=n(c.getUTCDate),p=n(c.getUTCFullYear),f=n(c.getUTCHours),g=n(c.getUTCMilliseconds),A=n(c.getUTCMinutes),m=n(c.getUTCMonth),y=n(c.getUTCSeconds);e.exports=i((function(){return"0385-07-25T07:06:39.999Z"!==h.call(new Date(-50000000000001))}))||!i((function(){h.call(new Date(NaN))}))?function(){if(!a(u(this)))throw new o("Invalid time value");var e=this,t=p(e),r=g(e),n=t<0?"-":t>9999?"+":"";return n+s(l(t),n?6:4,0)+"-"+s(m(e)+1,2,0)+"-"+s(d(e),2,0)+"T"+s(f(e),2,0)+":"+s(A(e),2,0)+":"+s(y(e),2,0)+"."+s(r,3,0)+"Z"}:h},70511:(e,t,r)=>{var n=r(19167),i=r(39297),s=r(1951),o=r(24913).f;e.exports=function(e){var t=n.Symbol||(n.Symbol={});i(t,e)||o(t,e,{value:s.f(e)})}},70597:(e,t,r)=>{var n=r(79039),i=r(78227),s=r(39519),o=i("species");e.exports=function(e){return s>=51||!n((function(){var t=[];return(t.constructor={})[o]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},70761:(e,t,r)=>{r(46518)({target:"Math",stat:!0},{trunc:r(80741)})},70933:(e,t,r)=>{var n=r(76080),i=r(28551),s=r(48981),o=r(72652);e.exports=function(e,t,r){return function(a){var l=s(a),c=arguments.length,h=c>1?arguments[1]:void 0,u=void 0!==h,d=u?n(h,c>2?arguments[2]:void 0):void 0,p=new e,f=0;return o(l,(function(e){var n=u?d(e,f++):e;r?t(p,i(n)[0],n[1]):t(p,n)})),p}}},71072:(e,t,r)=>{var n=r(61828),i=r(88727);e.exports=Object.keys||function(e){return n(e,i)}},71137:(e,t,r)=>{r(46518)({target:"Reflect",stat:!0},{ownKeys:r(35031)})},71517:(e,t,r)=>{var n=r(46518),i=r(36194),s=r(72248).remove;n({target:"Map",proto:!0,real:!0,forced:!0},{deleteAll:function(){for(var e,t=i(this),r=!0,n=0,o=arguments.length;n<o;n++)e=s(t,arguments[n]),r=r&&e;return!!r}})},71658:(e,t,r)=>{var n=r(46518),i=r(6469),s=r(96837),o=r(26198),a=r(35610),l=r(25397),c=r(91291),h=Array,u=Math.max,d=Math.min;n({target:"Array",proto:!0},{toSpliced:function(e,t){var r,n,i,p,f=l(this),g=o(f),A=a(e,g),m=arguments.length,y=0;for(0===m?r=n=0:1===m?(r=0,n=g-A):(r=m-2,n=d(u(c(t),0),g-A)),i=s(g+r-n),p=h(i);y<A;y++)p[y]=f[y];for(;y<A+r;y++)p[y]=arguments[y-A+2];for(;y<i;y++)p[y]=f[y+n-r];return p}}),i("toSpliced")},71678:(e,t,r)=>{var n,i=r(96395),s=r(46518),o=r(44576),a=r(97751),l=r(79504),c=r(79039),h=r(33392),u=r(94901),d=r(33517),p=r(64117),f=r(20034),g=r(10757),A=r(72652),m=r(28551),y=r(36955),v=r(39297),w=r(97040),b=r(66699),E=r(26198),x=r(22812),C=r(61034),_=r(72248),I=r(94402),S=r(38469),M=r(94483),T=r(24659),B=r(1548),P=o.Object,R=o.Array,D=o.Date,L=o.Error,k=o.TypeError,O=o.PerformanceMark,F=a("DOMException"),N=_.Map,U=_.has,Q=_.get,G=_.set,z=I.Set,j=I.add,V=I.has,q=a("Object","keys"),H=l([].push),W=l((!0).valueOf),$=l(1..valueOf),Y=l("".valueOf),K=l(D.prototype.getTime),J=h("structuredClone"),X="DataCloneError",Z="Transferring",ee=function(e){return!c((function(){var t=new o.Set([7]),r=e(t),n=e(P(7));return r===t||!r.has(7)||!f(n)||7!=+n}))&&e},te=function(e,t){return!c((function(){var r=new t,n=e({a:r,b:r});return!(n&&n.a===n.b&&n.a instanceof t&&n.a.stack===r.stack)}))},re=o.structuredClone,ne=i||!te(re,L)||!te(re,F)||(n=re,!!c((function(){var e=n(new o.AggregateError([1],J,{cause:3}));return"AggregateError"!==e.name||1!==e.errors[0]||e.message!==J||3!==e.cause}))),ie=!re&&ee((function(e){return new O(J,{detail:e}).detail})),se=ee(re)||ie,oe=function(e){throw new F("Uncloneable type: "+e,X)},ae=function(e,t){throw new F((t||"Cloning")+" of "+e+" cannot be properly polyfilled in this engine",X)},le=function(e,t){return se||ae(t),se(e)},ce=function(e,t,r){if(U(t,e))return Q(t,e);var n,i,s,a,l,c;if("SharedArrayBuffer"===(r||y(e)))n=se?se(e):e;else{var h=o.DataView;h||u(e.slice)||ae("ArrayBuffer");try{if(u(e.slice)&&!e.resizable)n=e.slice(0);else{i=e.byteLength,s="maxByteLength"in e?{maxByteLength:e.maxByteLength}:void 0,n=new ArrayBuffer(i,s),a=new h(e),l=new h(n);for(c=0;c<i;c++)l.setUint8(c,a.getUint8(c))}}catch(e){throw new F("ArrayBuffer is detached",X)}}return G(t,e,n),n},he=function(e,t){if(g(e)&&oe("Symbol"),!f(e))return e;if(t){if(U(t,e))return Q(t,e)}else t=new N;var r,n,i,s,l,c,h,d,p=y(e);switch(p){case"Array":i=R(E(e));break;case"Object":i={};break;case"Map":i=new N;break;case"Set":i=new z;break;case"RegExp":i=new RegExp(e.source,C(e));break;case"Error":switch(n=e.name){case"AggregateError":i=new(a(n))([]);break;case"EvalError":case"RangeError":case"ReferenceError":case"SuppressedError":case"SyntaxError":case"TypeError":case"URIError":i=new(a(n));break;case"CompileError":case"LinkError":case"RuntimeError":i=new(a("WebAssembly",n));break;default:i=new L}break;case"DOMException":i=new F(e.message,e.name);break;case"ArrayBuffer":case"SharedArrayBuffer":i=ce(e,t,p);break;case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float16Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":c="DataView"===p?e.byteLength:e.length,i=function(e,t,r,n,i){var s=o[t];return f(s)||ae(t),new s(ce(e.buffer,i),r,n)}(e,p,e.byteOffset,c,t);break;case"DOMQuad":try{i=new DOMQuad(he(e.p1,t),he(e.p2,t),he(e.p3,t),he(e.p4,t))}catch(t){i=le(e,p)}break;case"File":if(se)try{i=se(e),y(i)!==p&&(i=void 0)}catch(e){}if(!i)try{i=new File([e],e.name,e)}catch(e){}i||ae(p);break;case"FileList":if(s=function(){var e;try{e=new o.DataTransfer}catch(t){try{e=new o.ClipboardEvent("").clipboardData}catch(e){}}return e&&e.items&&e.files?e:null}()){for(l=0,c=E(e);l<c;l++)s.items.add(he(e[l],t));i=s.files}else i=le(e,p);break;case"ImageData":try{i=new ImageData(he(e.data,t),e.width,e.height,{colorSpace:e.colorSpace})}catch(t){i=le(e,p)}break;default:if(se)i=se(e);else switch(p){case"BigInt":i=P(e.valueOf());break;case"Boolean":i=P(W(e));break;case"Number":i=P($(e));break;case"String":i=P(Y(e));break;case"Date":i=new D(K(e));break;case"Blob":try{i=e.slice(0,e.size,e.type)}catch(e){ae(p)}break;case"DOMPoint":case"DOMPointReadOnly":r=o[p];try{i=r.fromPoint?r.fromPoint(e):new r(e.x,e.y,e.z,e.w)}catch(e){ae(p)}break;case"DOMRect":case"DOMRectReadOnly":r=o[p];try{i=r.fromRect?r.fromRect(e):new r(e.x,e.y,e.width,e.height)}catch(e){ae(p)}break;case"DOMMatrix":case"DOMMatrixReadOnly":r=o[p];try{i=r.fromMatrix?r.fromMatrix(e):new r(e)}catch(e){ae(p)}break;case"AudioData":case"VideoFrame":u(e.clone)||ae(p);try{i=e.clone()}catch(e){oe(p)}break;case"CropTarget":case"CryptoKey":case"FileSystemDirectoryHandle":case"FileSystemFileHandle":case"FileSystemHandle":case"GPUCompilationInfo":case"GPUCompilationMessage":case"ImageBitmap":case"RTCCertificate":case"WebAssembly.Module":ae(p);default:oe(p)}}switch(G(t,e,i),p){case"Array":case"Object":for(h=q(e),l=0,c=E(h);l<c;l++)d=h[l],w(i,d,he(e[d],t));break;case"Map":e.forEach((function(e,r){G(i,he(r,t),he(e,t))}));break;case"Set":e.forEach((function(e){j(i,he(e,t))}));break;case"Error":b(i,"message",he(e.message,t)),v(e,"cause")&&b(i,"cause",he(e.cause,t)),"AggregateError"===n?i.errors=he(e.errors,t):"SuppressedError"===n&&(i.error=he(e.error,t),i.suppressed=he(e.suppressed,t));case"DOMException":T&&b(i,"stack",he(e.stack,t))}return i};s({global:!0,enumerable:!0,sham:!B,forced:ne},{structuredClone:function(e){var t,r,n=x(arguments.length,1)>1&&!p(arguments[1])?m(arguments[1]):void 0,i=n?n.transfer:void 0;void 0!==i&&(r=function(e,t){if(!f(e))throw new k("Transfer option cannot be converted to a sequence");var r=[];A(e,(function(e){H(r,m(e))}));for(var n,i,s,a,l,c=0,h=E(r),p=new z;c<h;){if(n=r[c++],"ArrayBuffer"===(i=y(n))?V(p,n):U(t,n))throw new F("Duplicate transferable",X);if("ArrayBuffer"!==i){if(B)a=re(n,{transfer:[n]});else switch(i){case"ImageBitmap":s=o.OffscreenCanvas,d(s)||ae(i,Z);try{(l=new s(n.width,n.height)).getContext("bitmaprenderer").transferFromImageBitmap(n),a=l.transferToImageBitmap()}catch(e){}break;case"AudioData":case"VideoFrame":u(n.clone)&&u(n.close)||ae(i,Z);try{a=n.clone(),n.close()}catch(e){}break;case"MediaSourceHandle":case"MessagePort":case"MIDIAccess":case"OffscreenCanvas":case"ReadableStream":case"RTCDataChannel":case"TransformStream":case"WebTransportReceiveStream":case"WebTransportSendStream":case"WritableStream":ae(i,Z)}if(void 0===a)throw new F("This object cannot be transferred: "+i,X);G(t,n,a)}else j(p,n)}return p}(i,t=new N));var s=he(e,t);return r&&function(e){S(e,(function(e){B?se(e,{transfer:[e]}):u(e.transfer)?e.transfer():M?M(e):ae("ArrayBuffer",Z)}))}(r),s}})},71761:(e,t,r)=>{var n=r(69565),i=r(89228),s=r(28551),o=r(64117),a=r(18014),l=r(655),c=r(67750),h=r(55966),u=r(57829),d=r(56682);i("match",(function(e,t,r){return[function(t){var r=c(this),i=o(t)?void 0:h(t,e);return i?n(i,t,r):new RegExp(t)[e](l(r))},function(e){var n=s(this),i=l(e),o=r(t,n,i);if(o.done)return o.value;if(!n.global)return d(n,i);var c=n.unicode;n.lastIndex=0;for(var h,p=[],f=0;null!==(h=d(n,i));){var g=l(h[0]);p[f]=g,""===g&&(n.lastIndex=u(i,a(n.lastIndex),c)),f++}return 0===f?null:p}]}))},72107:(e,t,r)=>{r(15823)("Int16",(function(e){return function(t,r,n){return e(this,t,r,n)}}))},72152:(e,t,r)=>{var n=r(46518),i=r(79039),s=Math.imul;n({target:"Math",stat:!0,forced:i((function(){return-5!==s(4294967295,5)||2!==s.length}))},{imul:function(e,t){var r=65535,n=+e,i=+t,s=r&n,o=r&i;return 0|s*o+((r&n>>>16)*o+s*(r&i>>>16)<<16>>>0)}})},72170:(e,t,r)=>{var n=r(94644),i=r(59213).every,s=n.aTypedArray;(0,n.exportTypedArrayMethod)("every",(function(e){return i(s(this),e,arguments.length>1?arguments[1]:void 0)}))},72248:(e,t,r)=>{var n=r(79504),i=Map.prototype;e.exports={Map,set:n(i.set),get:n(i.get),has:n(i.has),remove:n(i.delete),proto:i}},72333:(e,t,r)=>{var n=r(91291),i=r(655),s=r(67750),o=RangeError;e.exports=function(e){var t=i(s(this)),r="",a=n(e);if(a<0||a===1/0)throw new o("Wrong number of repetitions");for(;a>0;(a>>>=1)&&(t+=t))1&a&&(r+=t);return r}},72400:(e,t,r)=>{r(57145)},72527:(e,t,r)=>{var n=r(46518),i=r(18449),s=r(28551),o=r(42787),a=i.has,l=i.get,c=i.toKey,h=function(e,t,r){if(a(e,t,r))return l(e,t,r);var n=o(t);return null!==n?h(e,n,r):void 0};n({target:"Reflect",stat:!0},{getMetadata:function(e,t){var r=arguments.length<3?void 0:c(arguments[2]);return h(e,s(t),r)}})},72577:(e,t,r)=>{r(20116)},72652:(e,t,r)=>{var n=r(76080),i=r(69565),s=r(28551),o=r(16823),a=r(44209),l=r(26198),c=r(1625),h=r(70081),u=r(50851),d=r(9539),p=TypeError,f=function(e,t){this.stopped=e,this.result=t},g=f.prototype;e.exports=function(e,t,r){var A,m,y,v,w,b,E,x=r&&r.that,C=!(!r||!r.AS_ENTRIES),_=!(!r||!r.IS_RECORD),I=!(!r||!r.IS_ITERATOR),S=!(!r||!r.INTERRUPTED),M=n(t,x),T=function(e){return A&&d(A,"normal",e),new f(!0,e)},B=function(e){return C?(s(e),S?M(e[0],e[1],T):M(e[0],e[1])):S?M(e,T):M(e)};if(_)A=e.iterator;else if(I)A=e;else{if(!(m=u(e)))throw new p(o(e)+" is not iterable");if(a(m)){for(y=0,v=l(e);v>y;y++)if((w=B(e[y]))&&c(g,w))return w;return new f(!1)}A=h(e,m)}for(b=_?e.next:A.next;!(E=i(b,A)).done;){try{w=B(E.value)}catch(e){d(A,"throw",e)}if("object"==typeof w&&w&&c(g,w))return w}return new f(!1)}},72712:(e,t,r)=>{var n=r(46518),i=r(80926).left,s=r(34598),o=r(39519);n({target:"Array",proto:!0,forced:!r(38574)&&o>79&&o<83||!s("reduce")},{reduce:function(e){var t=arguments.length;return i(this,e,t,t>1?arguments[1]:void 0)}})},72777:(e,t,r)=>{var n=r(69565),i=r(20034),s=r(10757),o=r(55966),a=r(84270),l=r(78227),c=TypeError,h=l("toPrimitive");e.exports=function(e,t){if(!i(e)||s(e))return e;var r,l=o(e,h);if(l){if(void 0===t&&(t="default"),r=n(l,e,t),!i(r)||s(r))return r;throw new c("Can't convert object to primitive value")}return void 0===t&&(t="number"),a(e,t)}},72805:(e,t,r)=>{var n=r(44576),i=r(79039),s=r(84428),o=r(94644).NATIVE_ARRAY_BUFFER_VIEWS,a=n.ArrayBuffer,l=n.Int8Array;e.exports=!o||!i((function(){l(1)}))||!i((function(){new l(-1)}))||!s((function(e){new l,new l(null),new l(1.5),new l(e)}),!0)||i((function(){return 1!==new l(new a(2),1,void 0).length}))},72882:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.PoolEventType=void 0,(r=t.PoolEventType||(t.PoolEventType={})).initialized="initialized",r.taskCanceled="taskCanceled",r.taskCompleted="taskCompleted",r.taskFailed="taskFailed",r.taskQueued="taskQueued",r.taskQueueDrained="taskQueueDrained",r.taskStart="taskStart",r.terminated="terminated"},72931:(e,t,r)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerEventType=void 0,r(83682),(n=t.WorkerEventType||(t.WorkerEventType={})).internalError="internalError",n.message="message",n.termination="termination"},73067:(e,t,r)=>{var n=r(46518),i=r(18449),s=r(28551),o=r(42787),a=i.has,l=i.toKey,c=function(e,t,r){if(a(e,t,r))return!0;var n=o(t);return null!==n&&c(e,n,r)};n({target:"Reflect",stat:!0},{hasMetadata:function(e,t){var r=arguments.length<3?void 0:l(arguments[2]);return c(e,s(t),r)}})},73440:(e,t,r)=>{r(70511)("replaceAll")},73506:(e,t,r)=>{var n=r(13925),i=String,s=TypeError;e.exports=function(e){if(n(e))return e;throw new s("Can't set "+i(e)+" as a prototype")}},73525:(e,t,r)=>{var n=r(46518),i=r(79306),s=r(76557),o=r(44995),a=o.get,l=o.has,c=o.set;n({target:"WeakMap",proto:!0,real:!0,forced:!0},{getOrInsertComputed:function(e,t){if(s(this),i(t),l(this,e))return a(this,e);c(this,e);var r=t(e);return c(this,e,r),r}})},73677:(e,t,r)=>{r(71658)},73772:(e,t,r)=>{r(65746)},74017:(e,t,r)=>{var n=r(46518),i=180/Math.PI;n({target:"Math",stat:!0,forced:!0},{degrees:function(e){return e*i}})},74147:(e,t,r)=>{var n=r(69565),i=r(36840),s=r(97751),o=r(55966),a=r(39297),l=r(78227),c=r(53982),h=l("asyncDispose"),u=s("Promise");a(c,h)||i(c,h,(function(){var e=this;return new u((function(t,r){var i=o(e,"return");i?u.resolve(n(i,e)).then((function(){t(void 0)}),r):t(void 0)}))}))},74176:(e,t,r)=>{var n=r(46518),i=r(33994),s=r(62529),o=r(67750),a=r(655),l=r(91181),c=r(68183),h=c.codeAt,u=c.charAt,d="String Iterator",p=l.set,f=l.getterFor(d),g=i((function(e){p(this,{type:d,string:e,index:0})}),"String",(function(){var e,t=f(this),r=t.string,n=t.index;return n>=r.length?s(void 0,!0):(e=u(r,n),t.index+=e.length,s({codePoint:h(e,0),position:n},!1))}));n({target:"String",proto:!0,forced:!0},{codePoints:function(){return new g(a(o(this)))}})},74423:(e,t,r)=>{var n=r(46518),i=r(19617).includes,s=r(79039),o=r(6469);n({target:"Array",proto:!0,forced:s((function(){return!Array(1).includes()}))},{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),o("includes")},74488:(e,t,r)=>{var n=r(67680),i=Math.floor,s=function(e,t){var r=e.length;if(r<8)for(var o,a,l=1;l<r;){for(a=l,o=e[l];a&&t(e[a-1],o)>0;)e[a]=e[--a];a!==l++&&(e[a]=o)}else for(var c=i(r/2),h=s(n(e,0,c),t),u=s(n(e,c),t),d=h.length,p=u.length,f=0,g=0;f<d||g<p;)e[f+g]=f<d&&g<p?t(h[f],u[g])<=0?h[f++]:u[g++]:f<d?h[f++]:u[g++];return e};e.exports=s},74615:(e,t,r)=>{var n=r(79504),i=r(25397),s=r(655),o=r(26198),a=TypeError,l=n([].push),c=n([].join);e.exports=function(e){var t=i(e),r=o(t);if(!r)return"";for(var n=arguments.length,h=[],u=0;;){var d=t[u++];if(void 0===d)throw new a("Incorrect template");if(l(h,s(d)),u===r)return c(h,"");u<n&&l(h,s(arguments[u]))}}},74648:(e,t,r)=>{var n=r(46518),i=r(36639).every;n({target:"AsyncIterator",proto:!0,real:!0},{every:function(e){return i(this,e)}})},74945:function(e,t){var r="undefined"!=typeof self?self:this,n=function(){function e(){this.fetch=!1,this.DOMException=r.DOMException}return e.prototype=r,new e}();!function(e){!function(t){var r="URLSearchParams"in e,n="Symbol"in e&&"iterator"in Symbol,i="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),s="FormData"in e,o="ArrayBuffer"in e;if(o)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],l=ArrayBuffer.isView||function(e){return e&&a.indexOf(Object.prototype.toString.call(e))>-1};function c(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function h(e){return"string"!=typeof e&&(e=String(e)),e}function u(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function p(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function f(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function g(e){var t=new FileReader,r=f(t);return t.readAsArrayBuffer(e),r}function A(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function m(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:i&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:s&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:r&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():o&&i&&(t=e)&&DataView.prototype.isPrototypeOf(t)?(this._bodyArrayBuffer=A(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):o&&(ArrayBuffer.prototype.isPrototypeOf(e)||l(e))?this._bodyArrayBuffer=A(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},i&&(this.blob=function(){var e=p(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?p(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(g)}),this.text=function(){var e,t,r,n=p(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,r=f(t=new FileReader),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},s&&(this.formData=function(){return this.text().then(w)}),this.json=function(){return this.text().then(JSON.parse)},this}d.prototype.append=function(e,t){e=c(e),t=h(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},d.prototype.delete=function(e){delete this.map[c(e)]},d.prototype.get=function(e){return e=c(e),this.has(e)?this.map[e]:null},d.prototype.has=function(e){return this.map.hasOwnProperty(c(e))},d.prototype.set=function(e,t){this.map[c(e)]=h(t)},d.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},d.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),u(e)},d.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),u(e)},d.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),u(e)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var y=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function v(e,t){var r,n,i=(t=t||{}).body;if(e instanceof v){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new d(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new d(t.headers)),this.method=(n=(r=t.method||this.method||"GET").toUpperCase(),y.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function w(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(i))}})),t}function b(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new d(t.headers),this.url=t.url||"",this._initBody(e)}v.prototype.clone=function(){return new v(this,{body:this._bodyInit})},m.call(v.prototype),m.call(b.prototype),b.prototype.clone=function(){return new b(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},b.error=function(){var e=new b(null,{status:0,statusText:""});return e.type="error",e};var E=[301,302,303,307,308];b.redirect=function(e,t){if(-1===E.indexOf(t))throw new RangeError("Invalid status code");return new b(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function x(e,r){return new Promise((function(n,s){var o=new v(e,r);if(o.signal&&o.signal.aborted)return s(new t.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function l(){a.abort()}a.onload=function(){var e,t,r={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new d,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();t.append(n,i)}})),t)};r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var i="response"in a?a.response:a.responseText;n(new b(i,r))},a.onerror=function(){s(new TypeError("Network request failed"))},a.ontimeout=function(){s(new TypeError("Network request failed"))},a.onabort=function(){s(new t.DOMException("Aborted","AbortError"))},a.open(o.method,o.url,!0),"include"===o.credentials?a.withCredentials=!0:"omit"===o.credentials&&(a.withCredentials=!1),"responseType"in a&&i&&(a.responseType="blob"),o.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),o.signal&&(o.signal.addEventListener("abort",l),a.onreadystatechange=function(){4===a.readyState&&o.signal.removeEventListener("abort",l)}),a.send(void 0===o._bodyInit?null:o._bodyInit)}))}x.polyfill=!0,e.fetch||(e.fetch=x,e.Headers=d,e.Request=v,e.Response=b),t.Headers=d,t.Request=v,t.Response=b,t.fetch=x,Object.defineProperty(t,"__esModule",{value:!0})}({})}(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var i=n;(t=i.fetch).default=i.fetch,t.fetch=i.fetch,t.Headers=i.Headers,t.Request=i.Request,t.Response=i.Response,e.exports=t},75044:(e,t,r)=>{var n=r(94644),i=r(84373),s=r(75854),o=r(36955),a=r(69565),l=r(79504),c=r(79039),h=n.aTypedArray,u=n.exportTypedArrayMethod,d=l("".slice);u("fill",(function(e){var t=arguments.length;h(this);var r="Big"===d(o(this),0,3)?s(e):+e;return a(i,this,r,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}),c((function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),1!==e})))},75289:(e,t,r)=>{var n=r(46518),i=r(14468),s=TypeError;n({target:"Iterator",stat:!0,forced:!0},{range:function(e,t,r){if("number"==typeof e)return new i(e,t,r,"number",0,1);if("bigint"==typeof e)return new i(e,t,r,"bigint",BigInt(0),BigInt(1));throw new s("Incorrect Iterator.range arguments")}})},75376:(e,t,r)=>{r(46518)({target:"Math",stat:!0},{log10:r(49340)})},75854:(e,t,r)=>{var n=r(72777),i=TypeError;e.exports=function(e){var t=n(e,"number");if("number"==typeof t)throw new i("Can't convert number to bigint");return BigInt(t)}},76031:(e,t,r)=>{r(15575),r(24599)},76080:(e,t,r)=>{var n=r(27476),i=r(79306),s=r(40616),o=n(n.bind);e.exports=function(e,t){return i(e),void 0===t?e:s?o(e,t):function(){return e.apply(t,arguments)}}},76557:(e,t,r)=>{var n=r(44995).has;e.exports=function(e){return n(e),e}},76913:(e,t,r)=>{r(46518)({target:"Iterator",proto:!0,real:!0,forced:!0},{indexed:r(47958)})},76918:(e,t,r)=>{var n=r(36840),i=r(77536),s=Error.prototype;s.toString!==i&&n(s,"toString",i)},77208:(e,t,r)=>{r(70511)("patternMatch")},77240:(e,t,r)=>{var n=r(79504),i=r(67750),s=r(655),o=/"/g,a=n("".replace);e.exports=function(e,t,r,n){var l=s(i(e)),c="<"+t;return""!==r&&(c+=" "+r+'="'+a(s(n),o,"&quot;")+'"'),c+">"+l+"</"+t+">"}},77347:(e,t,r)=>{var n=r(43724),i=r(69565),s=r(48773),o=r(6980),a=r(25397),l=r(56969),c=r(39297),h=r(35917),u=Object.getOwnPropertyDescriptor;t.f=n?u:function(e,t){if(e=a(e),t=l(t),h)try{return u(e,t)}catch(e){}if(c(e,t))return o(!i(s.f,e,t),e[t])}},77536:(e,t,r)=>{var n=r(43724),i=r(79039),s=r(28551),o=r(32603),a=Error.prototype.toString,l=i((function(){if(n){var e=Object.create(Object.defineProperty({},"name",{get:function(){return this===e}}));if("true"!==a.call(e))return!0}return"2: 1"!==a.call({message:1,name:2})||"Error"!==a.call({})}));e.exports=l?function(){var e=s(this),t=o(e.name,"Error"),r=o(e.message);return t?r?t+": "+r:t:r}:a},77584:(e,t,r)=>{var n=r(20034),i=r(66699);e.exports=function(e,t){n(t)&&"cause"in t&&i(e,"cause",t.cause)}},77629:(e,t,r)=>{var n=r(96395),i=r(44576),s=r(39433),o="__core-js_shared__",a=e.exports=i[o]||s(o,{});(a.versions||(a.versions=[])).push({version:"3.41.0",mode:n?"pure":"global",copyright:" 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.41.0/LICENSE",source:"https://github.com/zloirock/core-js"})},77691:(e,t,r)=>{var n=r(46518),i=r(97751),s=r(79504),o=r(79306),a=r(67750),l=r(56969),c=r(72652),h=r(79039),u=Object.groupBy,d=i("Object","create"),p=s([].push);n({target:"Object",stat:!0,forced:!u||h((function(){return 1!==u("ab",(function(e){return e})).a.length}))},{groupBy:function(e,t){a(e),o(t);var r=d(null),n=0;return c(e,(function(e){var i=l(t(e,n++));i in r?p(r[i],e):r[i]=[e]})),r}})},77740:(e,t,r)=>{var n=r(39297),i=r(35031),s=r(77347),o=r(24913);e.exports=function(e,t,r){for(var a=i(t),l=o.f,c=s.f,h=0;h<a.length;h++){var u=a[h];n(e,u)||r&&n(r,u)||l(e,u,c(t,u))}}},77762:(e,t,r)=>{var n=r(46518),i=r(53250),s=Math.cosh,o=Math.abs,a=Math.E;n({target:"Math",stat:!0,forced:!s||s(710)===1/0},{cosh:function(e){var t=i(o(e)-1)+1;return(t+1/(t*a*a))*(a/2)}})},77782:e=>{e.exports=Math.sign||function(e){var t=+e;return 0===t||t!=t?t:t<0?-1:1}},77811:e=>{e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},77905:e=>{e.exports=function(e,t,r,n,i){var s=+e,o=+t,a=+r,l=+n,c=+i;return s!=s||o!=o||a!=a||l!=l||c!=c?NaN:s===1/0||s===-1/0?s:(s-o)*(c-l)/(a-o)+l}},77936:(e,t,r)=>{var n=r(46518),i=r(95636);i&&n({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return i(this,arguments.length?arguments[0]:void 0,!1)}})},77957:(e,t,r)=>{var n=r(76080),i=r(79504),s=r(47055),o=r(48981),a=r(56969),l=r(26198),c=r(2360),h=r(35370),u=Array,d=i([].push);e.exports=function(e,t,r,i){for(var p,f,g,A=o(e),m=s(A),y=n(t,r),v=c(null),w=l(m),b=0;w>b;b++)g=m[b],(f=a(y(g,b,A)))in v?d(v[f],g):v[f]=[g];if(i&&(p=i(A))!==u)for(f in v)v[f]=h(p,v[f]);return v}},78100:(e,t,r)=>{var n=r(46518),i=r(95636);i&&n({target:"ArrayBuffer",proto:!0},{transfer:function(){return i(this,arguments.length?arguments[0]:void 0,!0)}})},78125:(e,t,r)=>{var n=r(97751),i=r(70511),s=r(10687);i("toStringTag"),s(n("Symbol"),"Symbol")},78227:(e,t,r)=>{var n=r(44576),i=r(25745),s=r(39297),o=r(33392),a=r(4495),l=r(7040),c=n.Symbol,h=i("wks"),u=l?c.for||c:c&&c.withoutSetter||o;e.exports=function(e){return s(h,e)||(h[e]=a&&s(c,e)?c[e]:u("Symbol."+e)),h[e]}},78347:(e,t,r)=>{r(46518)({target:"Object",stat:!0},{hasOwn:r(39297)})},78350:(e,t,r)=>{var n=r(46518),i=r(70259),s=r(79306),o=r(48981),a=r(26198),l=r(1469);n({target:"Array",proto:!0},{flatMap:function(e){var t,r=o(this),n=a(r);return s(e),(t=l(r,0)).length=i(t,r,r,n,0,1,e,arguments.length>1?arguments[1]:void 0),t}})},78459:(e,t,r)=>{var n=r(46518),i=r(33904);n({global:!0,forced:parseFloat!==i},{parseFloat:i})},78553:(e,t,r)=>{var n=r(46518),i=r(79039),s=r(53250),o=Math.abs,a=Math.exp,l=Math.E;n({target:"Math",stat:!0,forced:i((function(){return-2e-17!==Math.sinh(-2e-17)}))},{sinh:function(e){var t=+e;return o(t)<1?(s(t)-s(-t))/2:(a(t-1)-a(-t-1))*(l/2)}})},78662:(e,t,r)=>{var n=r(46518),i=r(97751),s=r(33517),o=i("Array");n({target:"Observable",stat:!0,forced:!0},{of:function(){for(var e=s(this)?this:i("Observable"),t=arguments.length,r=o(t),n=0;n<t;)r[n]=arguments[n++];return new e((function(e){for(var n=0;n<t;n++)if(e.next(r[n]),e.closed)return;e.complete()}))}})},78898:(e,t,r)=>{var n=r(46518),i=r(68183).charAt,s=r(67750),o=r(91291),a=r(655);n({target:"String",proto:!0,forced:!0},{at:function(e){var t=a(s(this)),r=t.length,n=o(e),l=n>=0?n:r+n;return l<0||l>=r?void 0:i(t,l)}})},79039:e=>{e.exports=function(e){try{return!!e()}catch(e){return!0}}},79175:(e,t,r)=>{r.d(t,{$K:()=>p,Fv:()=>d,ME:()=>u,R4:()=>h,ki:()=>f,pN:()=>g});var n=r(96509);function i(e){return e===n.S2||e===n.Wk}function s(e,t){return e.__lastFrameVisited===t&&e.__used}function o(e,t){e.__lastFrameVisited!==t.frameCount&&(e.__lastFrameVisited=t.frameCount,e.__used=!1,e.__inFrustum=!1,e.__isLeaf=!1,e.__visible=!1,e.__active=!1,e.__error=1/0,e.__distanceFromCamera=1/0,e.__childrenWereVisible=!1,e.__allChildrenLoaded=!1,e.__inFrustum=t.tileInView(e),t.calculateError(e))}function a(e,t){if(t.ensureChildrenArePreprocessed(e),o(e,t),c(e,t),!e.__hasRenderableContent){const r=e.children;for(let e=0,n=r.length;e<n;e++)a(r[e],t)}}function l(e,t){if(t.ensureChildrenArePreprocessed(e),s(e,t.frameCount)){e.__hasContent&&e.__loadingState===n.nk&&!t.lruCache.isFull()&&t.queueTileForDownload(e);const r=e.children;for(let e=0,n=r.length;e<n;e++)l(r[e],t)}}function c(e,t){e.__used||(e.__used=!0,t.markTileUsed(e),t.stats.used++,!0===e.__inFrustum&&t.stats.inFrustum++)}function h(e,t=null,r=null){const n=[];for(n.push(e),n.push(null),n.push(0);n.length>0;){const e=n.pop(),i=n.pop(),s=n.pop();if(t&&t(s,i,e))return void(r&&r(s,i,e));const o=s.children;if(o)for(let t=o.length-1;t>=0;t--)n.push(o[t]),n.push(s),n.push(e+1);r&&r(s,i,e)}}function u(e,t){if(t.ensureChildrenArePreprocessed(e),o(e,t),!e.__inFrustum)return;if(!function(e,t){return!(e.__error<=t.errorTarget||t.maxDepth>0&&e.__depth+1>=t.maxDepth)}(e,t))return void c(e,t);let r=!1,n=!1;const i=e.children;for(let e=0,o=i.length;e<o;e++){const o=i[e];u(o,t),r=r||s(o,t.frameCount),n=n||o.__inFrustum}if("REPLACE"!==e.refine||n||0===i.length||e.__hasUnrenderableContent){if(c(e,t),r&&"REPLACE"===e.refine)for(let e=0,r=i.length;e<r;e++)a(i[e],t)}else e.__inFrustum=!1}function d(e,t){const r=t.frameCount;if(!s(e,r))return;const o=e.children;let a=!1;for(let e=0,t=o.length;e<t;e++){const t=o[e];a=a||s(t,r)}if(a){let a=!1,l=!0;for(let e=0,c=o.length;e<c;e++){const c=o[e];if(d(c,t),a=a||c.__wasSetVisible||c.__childrenWereVisible,s(c,r)){const e=c.__allChildrenLoaded||c.__hasRenderableContent&&i(c.__loadingState)||!c.__hasContent&&0===c.children.length||c.__hasUnrenderableContent&&c.__loadingState===n.Wk;l=l&&e}}e.__childrenWereVisible=a,e.__allChildrenLoaded=l}else e.__isLeaf=!0}function p(e,t){const r=t.stats;if(!s(e,t.frameCount))return;const o=t.lruCache;if(e.__isLeaf)return void(e.__loadingState===n.S2?(e.__inFrustum&&(e.__visible=!0,r.visible++),e.__active=!0,r.active++):!o.isFull()&&e.__hasContent&&t.queueTileForDownload(e));const a=e.children,c=e.__hasContent,h=i(e.__loadingState)&&c,u=(t.errorTarget+1)*t.errorThreshold,d=e.__error<=u,f=e.__childrenWereVisible,g=e.__allChildrenLoaded;if((d||"ADD"===e.refine)&&!h&&!o.isFull()&&c&&t.queueTileForDownload(e),(d&&!g&&!f&&h||"ADD"===e.refine&&h)&&(e.__inFrustum&&(e.__visible=!0,r.visible++),e.__active=!0,r.active++),"REPLACE"===e.refine&&d&&!g)for(let e=0,r=a.length;e<r;e++){const r=a[e];s(r,t.frameCount)&&l(r,t)}else for(let e=0,r=a.length;e<r;e++)p(a[e],t)}function f(e,t){const r=s(e,t.frameCount);if(r||e.__usedLastFrame){let i=!1,s=!1;r?(i=e.__active,s=t.displayActiveTiles&&e.__active||e.__visible):o(e,t),e.__hasRenderableContent&&e.__loadingState===n.S2&&(e.__wasSetActive!==i&&t.setTileActive(e,i),e.__wasSetVisible!==s&&t.invokeOnePlugin((t=>t.setTileVisible&&t.setTileVisible(e,s)))),e.__wasSetActive=i,e.__wasSetVisible=s,e.__usedLastFrame=r;const a=e.children;for(let e=0,r=a.length;e<r;e++)f(a[e],t)}}function g(e,t=null){let r=e;for(;r;){const e=r.__depth,n=r.parent;t&&t(r,n,e),r=n}}},79296:(e,t,r)=>{var n=r(4055)("span").classList,i=n&&n.constructor&&n.constructor.prototype;e.exports=i===Object.prototype?void 0:i},79306:(e,t,r)=>{var n=r(94901),i=r(16823),s=TypeError;e.exports=function(e){if(n(e))return e;throw new s(i(e)+" is not a function")}},79310:(e,t,r)=>{var n=r(46518),i=r(77905),s=r(15617);n({target:"Math",stat:!0,forced:!0},{fscale:function(e,t,r,n,o){return s(i(e,t,r,n,o))}})},79432:(e,t,r)=>{var n=r(46518),i=r(48981),s=r(71072);n({target:"Object",stat:!0,forced:r(79039)((function(){s(1)}))},{keys:function(e){return s(i(e))}})},79472:(e,t,r)=>{var n,i=r(44576),s=r(18745),o=r(94901),a=r(84215),l=r(82839),c=r(67680),h=r(22812),u=i.Function,d=/MSIE .\./.test(l)||"BUN"===a&&((n=i.Bun.version.split(".")).length<3||"0"===n[0]&&(n[1]<3||"3"===n[1]&&"0"===n[2]));e.exports=function(e,t){var r=t?2:1;return d?function(n,i){var a=h(arguments.length,1)>r,l=o(n)?n:u(n),d=a?c(arguments,r):[],p=a?function(){s(l,this,d)}:l;return t?e(p,i):e(p)}:e}},79504:(e,t,r)=>{var n=r(40616),i=Function.prototype,s=i.call,o=n&&i.bind.bind(s,s);e.exports=n?o:function(e){return function(){return s.apply(e,arguments)}}},79565:(e,t,r)=>{var n=r(79504),i=r(79306),s=r(64117),o=r(26198),a=r(48981),l=r(72248),c=r(26223),h=l.Map,u=l.has,d=l.set,p=n([].push);e.exports=function(e){var t,r,n,l=a(this),f=o(l),g=[],A=new h,m=s(e)?function(e){return e}:i(e);for(t=0;t<f;t++)n=m(r=l[t]),u(A,n)||d(A,n,r);return c(A,(function(e){p(g,e)})),g}},79577:(e,t,r)=>{var n=r(39928),i=r(94644),s=r(18727),o=r(91291),a=r(75854),l=i.aTypedArray,c=i.getTypedArrayConstructor,h=i.exportTypedArrayMethod,u=!!function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(e){return 8===e}}();h("with",{with:function(e,t){var r=l(this),i=o(e),h=s(r)?a(t):+t;return n(r,c(r),i,h)}}.with,!u)},79732:(e,t,r)=>{var n=r(46518),i=r(44995);n({target:"WeakMap",stat:!0,forced:!0},{of:r(87500)(i.WeakMap,i.set,!0)})},79733:(e,t,r)=>{var n=r(46518),i=r(79306),s=r(36194),o=r(72248),a=TypeError,l=o.get,c=o.has,h=o.set;n({target:"Map",proto:!0,real:!0,forced:!0},{update:function(e,t){var r=s(this),n=arguments.length;i(t);var o=c(r,e);if(!o&&n<3)throw new a("Updating absent value");var u=o?l(r,e):i(n>2?arguments[2]:void 0)(e,r);return h(r,e,t(u,e,r)),r}})},79739:(e,t,r)=>{var n=r(97751),i="DOMException";r(10687)(n(i),i)},79852:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(18449),o=r(28551),a=r(42787),l=i(r(79565)),c=i([].concat),h=s.keys,u=s.toKey,d=function(e,t){var r=h(e,t),n=a(e);if(null===n)return r;var i=d(n,t);return i.length?r.length?l(c(r,i)):i:r};n({target:"Reflect",stat:!0},{getMetadataKeys:function(e){var t=arguments.length<2?void 0:u(arguments[1]);return d(o(e),t)}})},79926:(e,t,r)=>{var n=r(46518),i=r(14468);n({target:"Number",stat:!0,forced:!0},{range:function(e,t,r){return new i(e,t,r,"number",0,1)}})},79978:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(79504),o=r(67750),a=r(94901),l=r(64117),c=r(60788),h=r(655),u=r(55966),d=r(61034),p=r(2478),f=r(78227),g=r(96395),A=f("replace"),m=TypeError,y=s("".indexOf),v=s("".replace),w=s("".slice),b=Math.max;n({target:"String",proto:!0},{replaceAll:function(e,t){var r,n,s,f,E,x,C,_,I,S,M=o(this),T=0,B="";if(!l(e)){if((r=c(e))&&(n=h(o(d(e))),!~y(n,"g")))throw new m("`.replaceAll` does not allow non-global regexes");if(s=u(e,A))return i(s,e,M,t);if(g&&r)return v(h(M),e,t)}for(f=h(M),E=h(e),(x=a(t))||(t=h(t)),C=E.length,_=b(1,C),I=y(f,E);-1!==I;)S=x?h(t(E,I,f)):p(E,f,I,[],void 0,t),B+=w(f,T,I)+S,T=I+C,I=I+_>f.length?-1:y(f,E,I+_);return T<f.length&&(B+=w(f,T)),B}})},80061:e=>{e.exports=function e(t,r,n){function i(o,a){if(!r[o]){if(!t[o]){if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=r[o]={exports:{}};t[o][0].call(c.exports,(function(e){return i(t[o][1][e]||e)}),c,c.exports,e,t,r,n)}return r[o].exports}for(var s=void 0,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,r){var n,i,s,o,a,l={}.hasOwnProperty;n=e("./PriorityQueue/AbstractPriorityQueue"),i=e("./PriorityQueue/ArrayStrategy"),o=e("./PriorityQueue/BinaryHeapStrategy"),s=e("./PriorityQueue/BHeapStrategy"),(a=function(e){function t(e){e||(e={}),e.strategy||(e.strategy=o),e.comparator||(e.comparator=function(e,t){return(e||0)-(t||0)}),t.__super__.constructor.call(this,e)}return function(e,t){for(var r in t)l.call(t,r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype}(t,e),t}(n)).ArrayStrategy=i,a.BinaryHeapStrategy=o,a.BHeapStrategy=s,t.exports=a},{"./PriorityQueue/AbstractPriorityQueue":2,"./PriorityQueue/ArrayStrategy":3,"./PriorityQueue/BHeapStrategy":4,"./PriorityQueue/BinaryHeapStrategy":5}],2:[function(e,t,r){t.exports=function(){function e(e){var t;if(null==(null!=e?e.strategy:void 0))throw"Must pass options.strategy, a strategy";if(null==(null!=e?e.comparator:void 0))throw"Must pass options.comparator, a comparator";this.priv=new e.strategy(e),this.length=(null!=e&&null!=(t=e.initialValues)?t.length:void 0)||0}return e.prototype.queue=function(e){this.length++,this.priv.queue(e)},e.prototype.dequeue=function(e){if(!this.length)throw"Empty queue";return this.length--,this.priv.dequeue()},e.prototype.peek=function(e){if(!this.length)throw"Empty queue";return this.priv.peek()},e.prototype.clear=function(){return this.length=0,this.priv.clear()},e}()},{}],3:[function(e,t,r){var n;n=function(e,t,r){var n,i,s;for(i=0,n=e.length;i<n;)r(e[s=i+n>>>1],t)>=0?i=s+1:n=s;return i},t.exports=function(){function e(e){var t;this.options=e,this.comparator=this.options.comparator,this.data=(null!=(t=this.options.initialValues)?t.slice(0):void 0)||[],this.data.sort(this.comparator).reverse()}return e.prototype.queue=function(e){var t;t=n(this.data,e,this.comparator),this.data.splice(t,0,e)},e.prototype.dequeue=function(){return this.data.pop()},e.prototype.peek=function(){return this.data[this.data.length-1]},e.prototype.clear=function(){this.data.length=0},e}()},{}],4:[function(e,t,r){t.exports=function(){function e(e){var t,r,n,i,s,o,a,l;for(this.comparator=(null!=e?e.comparator:void 0)||function(e,t){return e-t},this.pageSize=(null!=e?e.pageSize:void 0)||512,this.length=0,a=0;1<<a<this.pageSize;)a+=1;if(1<<a!==this.pageSize)throw"pageSize must be a power of two";for(this._shift=a,this._emptyMemoryPageTemplate=t=[],r=0,s=this.pageSize;0<=s?r<s:r>s;0<=s?++r:--r)t.push(null);if(this._memory=[],this._mask=this.pageSize-1,e.initialValues)for(n=0,i=(o=e.initialValues).length;n<i;n++)l=o[n],this.queue(l)}return e.prototype.queue=function(e){this.length+=1,this._write(this.length,e),this._bubbleUp(this.length,e)},e.prototype.dequeue=function(){var e,t;return e=this._read(1),t=this._read(this.length),this.length-=1,this.length>0&&(this._write(1,t),this._bubbleDown(1,t)),e},e.prototype.peek=function(){return this._read(1)},e.prototype.clear=function(){this.length=0,this._memory.length=0},e.prototype._write=function(e,t){var r;for(r=e>>this._shift;r>=this._memory.length;)this._memory.push(this._emptyMemoryPageTemplate.slice(0));return this._memory[r][e&this._mask]=t},e.prototype._read=function(e){return this._memory[e>>this._shift][e&this._mask]},e.prototype._bubbleUp=function(e,t){var r,n,i,s;for(r=this.comparator;e>1&&(n=e&this._mask,e<this.pageSize||n>3?i=e&~this._mask|n>>1:n<2?(i=e-this.pageSize>>this._shift,i+=i&~(this._mask>>1),i|=this.pageSize>>1):i=e-2,!(r(s=this._read(i),t)<0));)this._write(i,t),this._write(e,s),e=i},e.prototype._bubbleDown=function(e,t){var r,n,i,s,o;for(o=this.comparator;e<this.length;)if(e>this._mask&&!(e&this._mask-1)?r=n=e+2:e&this.pageSize>>1?(r=(e&~this._mask)>>1,n=1+(r=1+(r|=e&this._mask>>1)<<this._shift)):n=(r=e+(e&this._mask))+1,r!==n&&n<=this.length)if(i=this._read(r),s=this._read(n),o(i,t)<0&&o(i,s)<=0)this._write(r,t),this._write(e,i),e=r;else{if(!(o(s,t)<0))break;this._write(n,t),this._write(e,s),e=n}else{if(!(r<=this.length))break;if(!(o(i=this._read(r),t)<0))break;this._write(r,t),this._write(e,i),e=r}},e}()},{}],5:[function(e,t,r){t.exports=function(){function e(e){var t;this.comparator=(null!=e?e.comparator:void 0)||function(e,t){return e-t},this.length=0,this.data=(null!=(t=e.initialValues)?t.slice(0):void 0)||[],this._heapify()}return e.prototype._heapify=function(){var e,t,r;if(this.data.length>0)for(e=t=1,r=this.data.length;1<=r?t<r:t>r;e=1<=r?++t:--t)this._bubbleUp(e)},e.prototype.queue=function(e){this.data.push(e),this._bubbleUp(this.data.length-1)},e.prototype.dequeue=function(){var e,t;return t=this.data[0],e=this.data.pop(),this.data.length>0&&(this.data[0]=e,this._bubbleDown(0)),t},e.prototype.peek=function(){return this.data[0]},e.prototype.clear=function(){this.length=0,this.data.length=0},e.prototype._bubbleUp=function(e){for(var t,r;e>0&&(t=e-1>>>1,this.comparator(this.data[e],this.data[t])<0);)r=this.data[t],this.data[t]=this.data[e],this.data[e]=r,e=t},e.prototype._bubbleDown=function(e){var t,r,n,i,s;for(t=this.data.length-1;i=1+(r=1+(e<<1)),n=e,r<=t&&this.comparator(this.data[r],this.data[n])<0&&(n=r),i<=t&&this.comparator(this.data[i],this.data[n])<0&&(n=i),n!==e;)s=this.data[n],this.data[n]=this.data[e],this.data[e]=s,e=n},e}()},{}]},{},[1])(1)},80081:(e,t,r)=>{var n=r(46518),i=r(6469),s=r(2952);n({target:"Array",proto:!0,forced:r(96395)},{groupToMap:s}),i("groupToMap")},80550:(e,t,r)=>{var n=r(44576);e.exports=n.Promise},80630:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(79039),o=r(31240),a=i(1..toPrecision);n({target:"Number",proto:!0,forced:s((function(){return"1"!==a(1,void 0)}))||!s((function(){a({})}))},{toPrecision:function(e){return void 0===e?a(o(this)):a(o(this),e)}})},80741:e=>{var t=Math.ceil,r=Math.floor;e.exports=Math.trunc||function(e){var n=+e;return(n>0?r:t)(n)}},80747:(e,t,r)=>{var n=r(66699),i=r(16193),s=r(24659),o=Error.captureStackTrace;e.exports=function(e,t,r,a){s&&(o?o(e,t):n(e,"stack",i(r,a)))}},80805:(e,t,r)=>{var n=r(46518),i=r(76557),s=r(44995),o=s.get,a=s.has,l=s.set;n({target:"WeakMap",proto:!0,real:!0,forced:!0},{getOrInsert:function(e,t){return a(i(this),e)?o(this,e):(l(this,e,t),t)}})},80926:(e,t,r)=>{var n=r(79306),i=r(48981),s=r(47055),o=r(26198),a=TypeError,l="Reduce of empty array with no initial value",c=function(e){return function(t,r,c,h){var u=i(t),d=s(u),p=o(u);if(n(r),0===p&&c<2)throw new a(l);var f=e?p-1:0,g=e?-1:1;if(c<2)for(;;){if(f in d){h=d[f],f+=g;break}if(f+=g,e?f<0:p<=f)throw new a(l)}for(;e?f>=0:p>f;f+=g)f in d&&(h=r(h,d[f],f,u));return h}};e.exports={left:c(!1),right:c(!0)}},81148:(e,t,r)=>{var n=r(46518),i=r(72652),s=r(79306),o=r(28551),a=r(1767);n({target:"Iterator",proto:!0,real:!0},{every:function(e){o(this),s(e);var t=a(this),r=0;return!i(t,(function(t,n){if(!e(t,r++))return n()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},81202:(e,t,r)=>{var n=r(44576),i=r(70511),s=r(24913).f,o=r(77347).f,a=n.Symbol;if(i("asyncDispose"),a){var l=o(a,"asyncDispose");l.enumerable&&l.configurable&&l.writable&&s(a,"asyncDispose",{value:l.value,enumerable:!1,configurable:!1,writable:!1})}},81218:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(79306),o=r(28551),a=r(50851),l=r(19462),c=r(62529),h=Array,u=l((function(){for(;;){var e=this.iterator;if(!e){var t=this.nextIterableIndex++,r=this.iterables;if(t>=r.length)return this.done=!0,c(void 0,!0);var n=r[t];this.iterables[t]=null,e=this.iterator=i(n.method,n.iterable),this.next=e.next}var s=o(i(this.next,e));if(!s.done)return s;this.iterator=null,this.next=null}}),!1,!0);n({target:"Iterator",stat:!0,forced:!0},{concat:function(){for(var e=arguments.length,t=h(e),r=0;r<e;r++){var n=o(arguments[r]);t[r]={iterable:n,method:s(a(n))}}return new u({iterables:t,nextIterableIndex:0,iterator:null,next:null})}})},81278:(e,t,r)=>{var n=r(46518),i=r(43724),s=r(35031),o=r(25397),a=r(77347),l=r(97040);n({target:"Object",stat:!0,sham:!i},{getOwnPropertyDescriptors:function(e){for(var t,r,n=o(e),i=a.f,c=s(n),h={},u=0;c.length>u;)void 0!==(r=i(n,t=c[u++]))&&l(h,t,r);return h}})},81332:(e,t,r)=>{var n=r(46518),i=r(79504)(DataView.prototype.getUint8);n({target:"DataView",proto:!0,forced:!0},{getUint8Clamped:function(e){return i(this,e)}})},81454:(e,t,r)=>{r(61701)},81510:(e,t,r)=>{var n=r(46518),i=r(97751),s=r(39297),o=r(655),a=r(25745),l=r(91296),c=a("string-to-symbol-registry"),h=a("symbol-to-string-registry");n({target:"Symbol",stat:!0,forced:!l},{for:function(e){var t=o(e);if(s(c,t))return c[t];var r=i("Symbol")(t);return c[t]=r,h[r]=t,r}})},81592:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isWorkerRuntime=t.getWorkerImplementation=t.defaultPoolSize=void 0;const n=r(11029);t.defaultPoolSize="undefined"!=typeof navigator&&navigator.hardwareConcurrency?navigator.hardwareConcurrency:4;const i=e=>/^[a-zA-Z][a-zA-Z\d+\-.]*:/.test(e);function s(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}let o;t.getWorkerImplementation=function(){return o||(o=function(){if("undefined"==typeof Worker)return class{constructor(){throw Error("No web worker implementation available. You might have tried to spawn a worker within a worker in a browser that doesn't support workers in workers.")}};class e extends Worker{constructor(e,t){var r,o;"string"==typeof e&&t&&t._baseURL?e=new URL(e,t._baseURL):"string"==typeof e&&!i(e)&&n.getBundleURL().match(/^file:\/\//i)&&(e=new URL(e,n.getBundleURL().replace(/\/[^\/]+$/,"/")),(null===(r=null==t?void 0:t.CORSWorkaround)||void 0===r||r)&&(e=s(`importScripts(${JSON.stringify(e)});`))),"string"==typeof e&&i(e)&&(null===(o=null==t?void 0:t.CORSWorkaround)||void 0===o||o)&&(e=s(`importScripts(${JSON.stringify(e)});`)),super(e,t)}}class t extends e{constructor(e,t){super(window.URL.createObjectURL(e),t)}static fromText(e,r){const n=new window.Blob([e],{type:"text/javascript"});return new t(n,r)}}return{blob:t,default:e}}()),o},t.isWorkerRuntime=function(){const e="undefined"!=typeof self&&"undefined"!=typeof Window&&self instanceof Window;return!("undefined"==typeof self||!self.postMessage||e)}},81630:(e,t,r)=>{var n=r(79504),i=r(94644),s=n(r(57029)),o=i.aTypedArray;(0,i.exportTypedArrayMethod)("copyWithin",(function(e,t){return s(o(this),e,t,arguments.length>2?arguments[2]:void 0)}))},81723:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(72652),o=r(94901),a=r(79306),l=r(72248).Map;n({target:"Map",stat:!0,forced:!0},{keyBy:function(e,t){var r=new(o(this)?this:l);a(t);var n=a(r.set);return s(e,(function(e){i(n,r,t(e),e)})),r}})},81730:(e,t,r)=>{var n=r(46518),i=r(28551),s=r(24074),o=r(44690),a=r(1767);n({target:"Iterator",proto:!0,real:!0,forced:r(96395)},{toAsync:function(){return new o(a(new s(a(i(this)))))}})},82003:(e,t,r)=>{var n=r(46518),i=r(96395),s=r(10916).CONSTRUCTOR,o=r(80550),a=r(97751),l=r(94901),c=r(36840),h=o&&o.prototype;if(n({target:"Promise",proto:!0,forced:s,real:!0},{catch:function(e){return this.then(void 0,e)}}),!i&&l(o)){var u=a("Promise").prototype.catch;h.catch!==u&&c(h,"catch",u,{unsafe:!0})}},82101:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(91291),o="Invalid number representation",a=RangeError,l=SyntaxError,c=TypeError,h=parseInt,u=Math.pow,d=/^[\d.a-z]+$/,p=i("".charAt),f=i(d.exec),g=i(1..toString),A=i("".slice),m=i("".split);n({target:"Number",stat:!0,forced:!0},{fromString:function(e,t){var r=1;if("string"!=typeof e)throw new c(o);if(!e.length)throw new l(o);if("-"===p(e,0)&&(r=-1,!(e=A(e,1)).length))throw new l(o);var n=void 0===t?10:s(t);if(n<2||n>36)throw new a("Invalid radix");if(!f(d,e))throw new l(o);var i=m(e,"."),y=h(i[0],n);if(i.length>1&&(y+=h(i[1],n)/u(n,i[1].length)),10===n&&g(y,n)!==e)throw new l(o);return r*y}})},82326:(e,t,r)=>{var n=r(46518),i=Math.asinh,s=Math.log,o=Math.sqrt;n({target:"Math",stat:!0,forced:!(i&&1/i(0)>0)},{asinh:function e(t){var r=+t;return isFinite(r)&&0!==r?r<0?-e(-r):s(r+o(r*r+1)):r}})},82451:(e,t,r)=>{var n=r(46518),i=r(88205);n({target:"WeakSet",stat:!0,forced:!0},{from:r(70933)(i.WeakSet,i.add,!1)})},82750:(e,t,r)=>{var n=r(46518),i=r(43724),s=r(97751),o=r(79306),a=r(90679),l=r(36840),c=r(56279),h=r(62106),u=r(78227),d=r(91181),p=r(91021),f=r(39519),g=s("Promise"),A=s("SuppressedError"),m=ReferenceError,y=u("asyncDispose"),v=u("toStringTag"),w="AsyncDisposableStack",b=d.set,E=d.getterFor(w),x="async-dispose",C="disposed",_=function(e){var t=E(e);if(t.state===C)throw new m(w+" already disposed");return t},I=function(){b(a(this,S),{type:w,state:"pending",stack:[]}),i||(this.disposed=!1)},S=I.prototype;c(S,{disposeAsync:function(){var e=this;return new g((function(t,r){var n=E(e);if(n.state===C)return t(void 0);n.state=C,i||(e.disposed=!0);var s,o=n.stack,a=o.length,l=!1,c=function(e){l?s=new A(e,s):(l=!0,s=e),h()},h=function(){if(a){var e=o[--a];o[a]=null;try{g.resolve(e()).then(h,c)}catch(e){c(e)}}else n.stack=null,l?r(s):t(void 0)};h()}))},use:function(e){return p(_(this),e,x),e},adopt:function(e,t){var r=_(this);return o(t),p(r,void 0,x,(function(){return t(e)})),e},defer:function(e){var t=_(this);o(e),p(t,void 0,x,e)},move:function(){var e=_(this),t=new I;return E(t).stack=e.stack,e.stack=[],e.state=C,i||(this.disposed=!0),t}}),i&&h(S,"disposed",{configurable:!0,get:function(){return E(this).state===C}}),l(S,y,S.disposeAsync,{name:"disposeAsync"}),l(S,v,w,{nonWritable:!0}),n({global:!0,constructor:!0,forced:f&&f<136},{AsyncDisposableStack:I})},82839:(e,t,r)=>{var n=r(44576).navigator,i=n&&n.userAgent;e.exports=i?String(i):""},83062:(e,t,r)=>{r(46518)({target:"Math",stat:!0,forced:!0},{iaddh:function(e,t,r,n){var i=e>>>0,s=r>>>0;return(t>>>0)+(n>>>0)+((i&s|(i|s)&~(i+s>>>0))>>>31)|0}})},83063:(e,t,r)=>{var n=r(82839);e.exports=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(n)},83142:(e,t,r)=>{r(70511)("matchAll")},83237:(e,t,r)=>{r(70511)("replace")},83354:(e,t,r)=>{r(46518)({target:"Function",proto:!0,forced:!0},{demethodize:r(12865)})},83440:(e,t,r)=>{var n=r(97080),i=r(94402),s=r(89286),o=r(25170),a=r(83789),l=r(38469),c=r(40507),h=i.has,u=i.remove;e.exports=function(e){var t=n(this),r=a(e),i=s(t);return o(t)<=r.size?l(t,(function(e){r.includes(e)&&u(i,e)})):c(r.getIterator(),(function(e){h(t,e)&&u(i,e)})),i}},83635:(e,t,r)=>{var n=r(79039),i=r(44576).RegExp;e.exports=n((function(){var e=i(".","s");return!(e.dotAll&&e.test("\n")&&"s"===e.flags)}))},83650:(e,t,r)=>{var n=r(97080),i=r(94402),s=r(89286),o=r(83789),a=r(40507),l=i.add,c=i.has,h=i.remove;e.exports=function(e){var t=n(this),r=o(e).getIterator(),i=s(t);return a(r,(function(e){c(t,e)?h(i,e):l(i,e)})),i}},83682:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.$worker=t.$transferable=t.$terminate=t.$events=t.$errors=void 0,t.$errors=Symbol("thread.errors"),t.$events=Symbol("thread.events"),t.$terminate=Symbol("thread.terminate"),t.$transferable=Symbol("thread.transferable"),t.$worker=Symbol("thread.worker")},83742:(e,t,r)=>{var n=r(46518),i=r(23755),s=r(88205).add;n({target:"WeakSet",proto:!0,real:!0,forced:!0},{addAll:function(){for(var e=i(this),t=0,r=arguments.length;t<r;t++)s(e,arguments[t]);return e}})},83789:(e,t,r)=>{var n=r(79306),i=r(28551),s=r(69565),o=r(91291),a=r(1767),l="Invalid size",c=RangeError,h=TypeError,u=Math.max,d=function(e,t){this.set=e,this.size=u(t,0),this.has=n(e.has),this.keys=n(e.keys)};d.prototype={getIterator:function(){return a(i(s(this.keys,this.set)))},includes:function(e){return s(this.has,this.set,e)}},e.exports=function(e){i(e);var t=+e.size;if(t!=t)throw new h(l);var r=o(t);if(r<0)throw new c(l);return new d(e,r)}},83851:(e,t,r)=>{var n=r(46518),i=r(79039),s=r(25397),o=r(77347).f,a=r(43724);n({target:"Object",stat:!0,forced:!a||i((function(){o(1)})),sham:!a},{getOwnPropertyDescriptor:function(e,t){return o(s(e),t)}})},83972:(e,t,r)=>{var n=r(20034),i=String,s=TypeError;e.exports=function(e){if(void 0===e||n(e))return e;throw new s(i(e)+" is not an object or undefined")}},84114:(e,t,r)=>{r(46518)({target:"String",stat:!0,forced:!0},{cooked:r(74615)})},84120:(e,t,r)=>{r.d(t,{tC:()=>n,NT:()=>q,E$:()=>T,C1:()=>c,zR:()=>j,SZ:()=>i,Ql:()=>a});var n={};r.r(n),r.d(n,{UNIT:()=>u,axisOrder:()=>w,defs:()=>b,getUnit:()=>f,is4326:()=>d,isGeocentric:()=>m,isGeographic:()=>A,isMetricUnit:()=>g,isValid:()=>y,reasonableEpsilon:()=>v});var i={};r.r(i),r.d(i,{quaternionFromAttitude:()=>te,quaternionFromCRSToCRS:()=>pe,quaternionFromCRSToEnu:()=>de,quaternionFromEnuToCRS:()=>ue,quaternionFromEnuToGeocent:()=>re,quaternionFromEnuToLCC:()=>se,quaternionFromEnuToLongLat:()=>ce,quaternionFromEnuToTMerc:()=>ae,quaternionFromGeocentToEnu:()=>ne,quaternionFromLCCToEnu:()=>ie,quaternionFromLongLatToEnu:()=>le,quaternionFromOmegaPhiKappa:()=>ee,quaternionFromRollPitchHeading:()=>Z,quaternionFromTMercToEnu:()=>oe,quaternionUnimplemented:()=>he});var s=r(43070),o=r(14528);const a=(()=>new s.Vector3(o.A.WGS84.a,o.A.WGS84.a,o.A.WGS84.b))(),l=new s.Vector3,c=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a;this.size=new s.Vector3,this._radiiSquared=new s.Vector3,this._invRadiiSquared=new s.Vector3,this.eccentricity=0,this.setSize(e)}geodeticSurfaceNormal(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Vector3;return e.toVector3(t).multiply(this._invRadiiSquared).normalize()}geodeticSurfaceNormalCartographic(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Vector3;const r=s.MathUtils.degToRad(e.longitude),n=s.MathUtils.degToRad(e.latitude),i=Math.cos(n);return t.set(i*Math.cos(r),i*Math.sin(r),Math.sin(n))}setSize(e){return this.size.set(e.x,e.y,e.z),this._radiiSquared.multiplyVectors(e,e),this._invRadiiSquared.x=0===e.x?0:1/this._radiiSquared.x,this._invRadiiSquared.y=0===e.y?0:1/this._radiiSquared.y,this._invRadiiSquared.z=0===e.z?0:1/this._radiiSquared.z,this.eccentricity=Math.sqrt(this._radiiSquared.x-this._radiiSquared.z)/this.size.x,this}cartographicToCartesian(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Vector3;l.copy(e.geodesicNormal),t.multiplyVectors(this._radiiSquared,l);const r=Math.sqrt(l.dot(t));return t.divideScalar(r),l.multiplyScalar(e.altitude),t.add(l)}cartesianToCartographic(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new T("EPSG:4326",0,0,0);const r=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),n=this.size.x,i=this.size.z,o=Math.abs((n*n-i*i)/(n*n)),a=1-Math.sqrt(1-o),l=Math.sqrt(e.x*e.x+e.y*e.y),c=Math.atan2(e.y,e.x),h=Math.atan(e.z/l*(1-a+o*n/r)),u=Math.sin(h),d=Math.cos(h),p=Math.atan((e.z*(1-a)+o*n*u*u*u)/((1-a)*(l-o*n*d*d*d))),f=l*Math.cos(p)+e.z*Math.sin(p)-n*Math.sqrt(1-o*Math.sin(p)*Math.sin(p));return t.setFromValues(s.MathUtils.radToDeg(c),s.MathUtils.radToDeg(p),f)}cartographicToCartesianArray(e){const t=[];for(let r=0;r<e.length;r++)t.push(this.cartographicToCartesian(e[r]));return t}intersection(e){const t=1e-4,r=e.origin,n=e.direction,i=n.x*n.x*this._invRadiiSquared.x+n.y*n.y*this._invRadiiSquared.y+n.z*n.z*this._invRadiiSquared.z,o=2*r.x*n.x*this._invRadiiSquared.x+2*r.y*n.y*this._invRadiiSquared.y+2*r.z*n.z*this._invRadiiSquared.z,a=r.x*r.x*this._invRadiiSquared.x+r.y*r.y*this._invRadiiSquared.y+r.z*r.z*this._invRadiiSquared.z-1;let l=o*o-4*i*a;if(l<0||0===i||0===o||0===a)return!1;l=Math.sqrt(l);const c=(-o+l)/(2*i),h=(-o-l)/(2*i);if(c<=t&&h<=t)return!1;let u=0;if(u=c<=t?h:h<=t||c<h?c:h,u<t)return!1;const d=new s.Vector3;return d.addVectors(e.origin,n.clone().setLength(u)),d}geodesicDistance(e,t){const r=s.MathUtils.degToRad(e.longitude),n=s.MathUtils.degToRad(e.latitude),i=s.MathUtils.degToRad(t.longitude),o=s.MathUtils.degToRad(t.latitude),a=Math.acos(Math.sin(n)*Math.sin(o)+Math.cos(n)*Math.cos(o)*Math.cos(i-r)),l=this.eccentricity,c=.5*(n+o),h=(l*Math.sin(c))**2,u=this.size.x*(1-l**2)/(1-h)**1.5,d=this.size.x/Math.sqrt(1-h);return a*Math.sqrt(u*d)}};function h(e){if(!("string"==typeof(t=e)||t instanceof String))throw new Error(`Crs parameter value must be a string: '${e}'`);var t}o.A.defs("EPSG:4978","+proj=geocent +datum=WGS84 +units=m +no_defs"),o.A.defs("EPSG:4326").axis="neu",o.A.defs("EPSG:4269").axis="neu",o.A.defs("WGS84").axis="neu";const u={DEGREE:1,METER:2,FOOT:3};function d(e){return"EPSG:4326"===e}function p(e){return"degrees"===e.units?u.DEGREE:"m"===e.units||"meter"===e.units?u.METER:"foot"===e.units?u.FOOT:void 0===e.units&&void 0===e.to_meter?u.METER:void 0}function f(e){h(e);const t=o.A.defs(e);if(t)return p(t)}function g(e){return f(e)===u.METER}function A(e){return f(e)===u.DEGREE}function m(e){h(e);const t=o.A.defs(e);return!!t&&"geocent"==t.projName}function y(e){const t=o.A.defs(e);if(!t)throw new Error(`Undefined crs '${e}'. Add it with proj4.defs('${e}', string)`);if(!p(t))throw new Error(`No valid unit found for crs '${e}', found ${t.units}`)}function v(e){return d(e)?.01:.001}function w(e){h(e);const t=o.A.defs(e);return t?t.axis:void 0}const b=(e,t)=>o.A.defs(e,t),E=new c,x={},C=new s.Vector3,_=new s.Vector3;let I,S;class M{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.isCoordinates=!0,y(e),this.crs=e,this.x=0,this.y=0,this.z=0,this._normal=new s.Vector3,t.length>0?(console.warn("Deprecated Coordinates#constructor(string, number[]),","use `new Coordinates(string).setFromArray(number[])` instead."),this.setFromArray(t)):t.isVector3||t.isCoordinates?(console.warn("Deprecated Coordinates#constructor(string, Vector3),","use `new Coordinates(string).setFromVector3(Vector3)` instead."),this.setFromVector3(t)):this.setFromValues(t,r,n),this._normalNeedsUpdate=!0}setCrs(e){return y(e),this.crs=e,this}setFromValues(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.x=e,this.y=t,this.z=r,this._normalNeedsUpdate=!0,this}setFromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.setFromValues(e[t],e[t+1],e[t+2])}setFromVector3(e){return this.setFromValues(e.x,e.y,e.z)}clone(){return new M(this.crs,this.x,this.y,this.z)}copy(e){return this.crs=e.crs,this.setFromVector3(e)}get longitude(){return this.x}get latitude(){return this.y}get altitude(){return this.z}set altitude(e){this.z=e}get geodesicNormal(){return this._normalNeedsUpdate&&(this._normalNeedsUpdate=!1,d(this.crs)?E.geodeticSurfaceNormalCartographic(this,this._normal):"EPSG:4978"==this.crs?E.geodeticSurfaceNormal(this,this._normal):this._normal.set(0,0,1)),this._normal}toVector3(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new s.Vector3).copy(this)}toArray(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return s.Vector3.prototype.toArray.call(this,e,t)}planarDistanceTo(e){return this.toVector3(C).setZ(0),e.toVector3(_).setZ(0),C.distanceTo(_)}geodeticDistanceTo(e){return this.as("EPSG:4326",I),e.as("EPSG:4326",S),E.geodesicDistance(I,S)}spatialEuclideanDistanceTo(e){return this.as("EPSG:4978",I).toVector3(C),e.as("EPSG:4978",S).toVector3(_),C.distanceTo(_)}applyMatrix4(e){return s.Vector3.prototype.applyMatrix4.call(this,e),this}as(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new M(e);var r,n;return this.crs==e?t.copy(this):(d(this.crs)&&"EPSG:3857"==e&&(this.y=s.MathUtils.clamp(this.y,-89.999999,89.999999)),t.setFromArray((r=this.crs,n=e,x[r]||(x[r]={}),x[r][n]||(x[r][n]=(0,o.A)(r,n)),x[r][n]).forward([this.x,this.y,this.z]))),t.crs=e,t}}I=new M("EPSG:4326",0,0,0),S=new M("EPSG:4326",0,0,0);const T=M,B=new s.Vector2,P=new s.Vector2,R=new s.Box3,D=new s.Vector2(2,2),L=new T("EPSG:4326",0,0,0),k=new T("EPSG:4326",0,0,0),O=new T("EPSG:4326",0,0,0),F=new s.Vector3,N=new s.Vector3;let U;const Q=[new T("EPSG:4326",0,0,0),new T("EPSG:4326",0,0,0),new T("EPSG:4326",0,0,0),new T("EPSG:4326",0,0,0),new T("EPSG:4326",0,0,0),new T("EPSG:4326",0,0,0),new T("EPSG:4326",0,0,0),new T("EPSG:4326",0,0,0)],G=new T("EPSG:4326",0,0);class z{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(m(e))throw new Error(`Non-compatible geocentric projection ${e} to build a geographical extent`);this.isExtent=!0,this.crs=e,this.west=0,this.east=0,this.south=0,this.north=0,this.set(t,r,n,i)}clone(){return new z(this.crs,this.west,this.east,this.south,this.north)}as(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z("EPSG:4326");if(y(e),this.crs!=e){const r=this.center(G);Q[0].setFromValues(this.west,this.north),Q[1].setFromValues(r.x,this.north),Q[2].setFromValues(this.east,this.north),Q[3].setFromValues(this.east,r.y),Q[4].setFromValues(this.east,this.south),Q[5].setFromValues(r.x,this.south),Q[6].setFromValues(this.west,this.south),Q[7].setFromValues(this.west,r.y),t.set(1/0,-1/0,1/0,-1/0);for(let r=0;r<Q.length;r++)Q[r].crs=this.crs,Q[r].as(e,G),t.north=Math.max(t.north,G.y),t.south=Math.min(t.south,G.y),t.east=Math.max(t.east,G.x),t.west=Math.min(t.west,G.x);return t.crs=e,t}return t.crs=e,t.set(this.west,this.east,this.south,this.north),t}center(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new T(this.crs);return this.planarDimensions(B),e.crs=this.crs,e.setFromValues(this.west+.5*B.x,this.south+.5*B.y),e}planarDimensions(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:new s.Vector2).set(Math.abs(this.east-this.west),Math.abs(this.north-this.south))}geodeticDimensions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new s.Vector2;return L.crs=this.crs,k.crs=this.crs,O.crs=this.crs,L.setFromValues(this.west,this.north,0),k.setFromValues(this.west,this.south,0),O.setFromValues(this.east,this.north,0),e.set(L.geodeticDistanceTo(O),L.geodeticDistanceTo(k))}spatialEuclideanDimensions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new s.Vector2;return L.crs=this.crs,k.crs=this.crs,O.crs=this.crs,L.setFromValues(this.west,this.north,0),k.setFromValues(this.west,this.south,0),O.setFromValues(this.east,this.north,0),e.set(L.spatialEuclideanDistanceTo(O),L.spatialEuclideanDistanceTo(k))}isPointInside(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.crs==e.crs?G.copy(e):e.as(this.crs,G),G.x<=this.east+t&&G.x>=this.west-t&&G.y<=this.north+t&&G.y>=this.south-t}isInside(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v(this.crs);return e.as(this.crs,U),this.east-U.east<=t&&U.west-this.west<=t&&this.north-U.north<=t&&U.south-this.south<=t}offsetToParent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Vector4;if(this.crs!=e.crs)throw new Error("unsupported mix");e.planarDimensions(B),this.planarDimensions(P);const r=(this.west-e.west)/B.x,n=(e.north-this.north)/B.y,i=P.x/B.x,o=P.y/B.y;return t.set(r,n,i,o)}intersectsExtent(e){return z.intersectsExtent(this,e)}static intersectsExtent(e,t){const r=t.crs==e.crs?t:t.as(e.crs,U);return!(e.west>=r.east||e.east<=r.west||e.south>=r.north||e.north<=r.south)}intersect(e){return this.intersectsExtent(e)?(e.crs!=this.crs&&(e=e.as(this.crs,U)),new z(this.crs,Math.max(this.west,e.west),Math.min(this.east,e.east),Math.max(this.south,e.south),Math.min(this.north,e.north))):new z(this.crs)}set(e,t,r,n){if(null==e)throw new Error("No values to set in the extent");return void 0!==e.west?(console.warn("Deprecated Extent#constructor(string, Extent) and Extent#set(Extent),","use new Extent(string).setFromExtent(Extent) instead."),this.setFromExtent(e)):4==e.length?(console.warn("Deprecated Extent#constructor(string, number[]) and Extent#set(number[]),","use new Extent(string).setFromArray(number[]) instead."),this.setFromArray(e)):void 0!==n&&(this.west=e,this.east=t,this.south=r,this.north=n),this}setFromArray(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.west=e[t],this.east=e[t+1],this.south=e[t+2],this.north=e[t+3],this}setFromExtent(e){return this.west=e.west,this.east=e.east,this.south=e.south,this.north=e.north,this}copy(e){return this.crs=e.crs,this.setFromExtent(e)}union(e){if(e.crs!=this.crs)throw new Error("unsupported union between 2 diff crs");if(this.west===1/0)this.copy(e);else{const t=e.west;t<this.west&&(this.west=t);const r=e.east;r>this.east&&(this.east=r);const n=e.south;n<this.south&&(this.south=n);const i=e.north;i>this.north&&(this.north=i)}}expandByCoordinates(e){const t=e.crs==this.crs?e:e.as(this.crs,G);this.expandByValuesCoordinates(t.x,t.y)}expandByValuesCoordinates(e,t){e<this.west&&(this.west=e),e>this.east&&(this.east=e),t<this.south&&(this.south=t),t>this.north&&(this.north=t)}static fromBox3(e,t){return m(e)&&(e="EPSG:4326",t=R.copy(t),k.crs=e,k.setFromVector3(t.min).as(e,k).toVector3(t.min),O.crs=e,O.setFromVector3(t.max).as(e,O).toVector3(t.max)),new z(e).setFromExtent({west:t.min.x,east:t.max.x,south:t.min.y,north:t.max.y})}toString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.east}${e}${this.north}${e}${this.west}${e}${this.south}`}subdivision(){return this.subdivisionByScheme()}subdivisionByScheme(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D;const t=[],r=this.planarDimensions(B).divide(e);for(let n=e.x-1;n>=0;n--)for(let i=e.y-1;i>=0;i--){const e=this.west+n*r.x,s=this.south+i*r.y;t.push(new z(this.crs,e,e+r.x,s,s+r.y))}return t}applyMatrix4(e){if(F.set(this.west,this.south,0).applyMatrix4(e),N.set(this.east,this.north,0).applyMatrix4(e),this.west=F.x,this.east=N.x,this.south=F.y,this.north=N.y,this.west>this.east){const e=this.west;this.west=this.east,this.east=e}if(this.south>this.north){const e=this.south;this.south=this.north,this.north=e}return this}clampSouthNorth(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.south,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.north;return this.south=Math.max(this.south,e),this.north=Math.min(this.north,t),this}clampWestEast(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.west,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.east;return this.west=Math.max(this.west,e),this.east=Math.min(this.east,t),this}clampByExtent(e){return this.clampSouthNorth(e.south,e.north),this.clampWestEast(e.west,e.east)}}U=new z("EPSG:4326");const j=z,V={getSunPosition(){const e=Math,t=e.PI,r=e.sin,n=e.cos,i=e.tan,s=e.asin,o=e.atan2,a=t/180,l=23.4397*a;function c(e,t,s){return o(r(e),n(e)*r(t)-i(s)*n(t))}function h(e,t,i){return s(r(t)*r(i)+n(t)*n(i)*n(e))}return function(e,u,d){const p=a*-d,f=a*u,g=function(e){return function(e){return e.valueOf()/864e5-.5+2440588}(e)-2451545}(e),A=function(e){return a*(357.5291+.98560028*e)}(g),m=function(e){return a*(1.9148*r(e)+.02*r(2*e)+3e-4*r(3*e))}(A),y=function(e,r){return e+r+102.9372*a+t}(A,m),v=(w=y,s(r(0)*n(l)+n(0)*r(l)*r(w)));var w;const b=function(e){return o(r(e)*n(l)-i(0)*r(l),n(e))}(y),E=function(e,t){return a*(280.16+360.9856235*e)-t}(g,p),x=E-b;return{EclipticLongitude:y,declinaison:v,ascension:b,H:x,SiderealTime:E,altitude:h(x,f,v),azimuth:c(x,f,v)+t/2}}},getSunPositionInScene(e,t,r){"number"!=typeof e&&(e=e.valueOf());const n=864e5,i=V.getSunPosition()(e,t,r).ascension+e%n/n*-360+180;return new T("EPSG:4326",i,t,5e7).as("EPSG:4978").toVector3()}},q=V,H=new s.Matrix4,W=new s.Vector3,$=new s.Vector3,Y=(new s.Vector3).set(0,0,1),K=new T("EPSG:4326",0,0,0),J=new s.Euler,X=new s.Quaternion;function Z(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new s.Quaternion;return e*=s.MathUtils.DEG2RAD,t*=s.MathUtils.DEG2RAD,r*=s.MathUtils.DEG2RAD,n.setFromEuler(J.set(-t,-e,-r,"YXZ"))}function ee(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new s.Quaternion;return e*=s.MathUtils.DEG2RAD,t*=s.MathUtils.DEG2RAD,r*=s.MathUtils.DEG2RAD,n.setFromEuler(J.set(e,t,r,"XYZ")),n.set(n.w,n.z,-n.y,-n.x),n}function te(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Quaternion;return"roll"in e||"pitch"in e||"heading"in e?Z(e.roll,e.pitch,e.heading,t):"omega"in e||"phi"in e||"kappa"in e?ee(e.omega,e.phi,e.kappa,t):t.set(0,0,0,1)}function re(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Quaternion;return e?re()(e,t):function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Quaternion;const r=e.geodesicNormal;return 0==r.x&&0==r.y?t.set(0,0,0,1):($.set(-r.y,r.x,0).normalize(),W.crossVectors(r,$),H.makeBasis($,W,r),t.setFromRotationMatrix(H))}}function ne(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Quaternion;if(e)return ne()(e,t);const r=re();return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Quaternion;return r(e,t).conjugate()}}function ie(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.Quaternion;if(t)return ie(e)(t,r);const n=Math.sin(e.lat0);return function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Quaternion;const i=t.as(K.crs,K).longitude*s.MathUtils.DEG2RAD;return r.setFromAxisAngle(Y,n*(e.long0-i))}}function se(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.Quaternion;if(t)return se(e)(t,r);const n=ie(e);return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Quaternion;return n(e,t).conjugate()}}function oe(e,t){let r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.Quaternion;if(t)return oe(e)(t,n);if(e.e){const t=e.e*e.e;r=t/(1-t)}else{const t=e.a*e.a,n=e.b*e.b;r=t/n-1}return function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Quaternion;t.as(K.crs,K);const i=K.longitude*s.MathUtils.DEG2RAD,o=K.latitude*s.MathUtils.DEG2RAD,a=e.long0-i,l=Math.cos(o),c=Math.sin(o),h=l*l,u=a*a*h,d=r*h,p=a*c*(1+u/3*(1+3*d+2*d*d)+u*u*(2-c/l)/15);return n.setFromAxisAngle(Y,p)}}function ae(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.Quaternion;if(t)return ae(e)(t,r);const n=oe(e);return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Quaternion;return n(e,t).conjugate()}}function le(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Quaternion;return e?t.set(0,0,0,1):function(e){return le(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Quaternion)}}function ce(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Quaternion;return e?t.set(0,0,0,1):function(e){return ce(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Quaternion)}}function he(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.Quaternion;return console.warn("This quaternion function is not implemented for projections of type",e.projName),t?r.set(0,0,0,1):function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Quaternion;return he(e,t,r)}}function ue(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.Quaternion;if(t)return ue(e)(t,r);const n="string"==typeof e?(0,o.A)(e).oProj:e,i=o.A.Proj.projections.get(n.projName);switch(i&&i.names[0]){case"Geocentric":return re();case"Lambert Tangential Conformal Conic Projection":return se(n);case"Fast_Transverse_Mercator":return ae(n);case"longlat":return ce();default:return he(n)}}function de(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new s.Quaternion;if(t)return de(e)(t,r);const n="string"==typeof e?(0,o.A)(e).oProj:e,i=o.A.Proj.projections.get(n.projName);switch(i&&i.names[0]){case"Geocentric":return ne();case"Lambert Tangential Conformal Conic Projection":return ie(n);case"Fast_Transverse_Mercator":return oe(n);case"longlat":return le();default:return he(n)}}function pe(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new s.Quaternion;if(r)return pe(e,t)(r,n);if(e==t)return function(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Quaternion).set(0,0,0,1)};const i=de(e),o=ue(t);return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.Quaternion;return o(e,t).multiply(i(e,X))}}},84185:(e,t,r)=>{var n=r(46518),i=r(43724),s=r(24913).f;n({target:"Object",stat:!0,forced:Object.defineProperty!==s,sham:!i},{defineProperty:s})},84208:(e,t,r)=>{r(78347)},84215:(e,t,r)=>{var n=r(44576),i=r(82839),s=r(22195),o=function(e){return i.slice(0,e.length)===e};e.exports=o("Bun/")?"BUN":o("Cloudflare-Workers")?"CLOUDFLARE":o("Deno/")?"DENO":o("Node.js/")?"NODE":n.Bun&&"string"==typeof Bun.version?"BUN":n.Deno&&"object"==typeof Deno.version?"DENO":"process"===s(n.process)?"NODE":n.window&&n.document?"BROWSER":"REST"},84270:(e,t,r)=>{var n=r(69565),i=r(94901),s=r(20034),o=TypeError;e.exports=function(e,t){var r,a;if("string"===t&&i(r=e.toString)&&!s(a=n(r,e)))return a;if(i(r=e.valueOf)&&!s(a=n(r,e)))return a;if("string"!==t&&i(r=e.toString)&&!s(a=n(r,e)))return a;throw new o("Can't convert object to primitive value")}},84373:(e,t,r)=>{var n=r(48981),i=r(35610),s=r(26198);e.exports=function(e){for(var t=n(this),r=s(t),o=arguments.length,a=i(o>1?arguments[1]:void 0,r),l=o>2?arguments[2]:void 0,c=void 0===l?r:i(l,r);c>a;)t[a++]=e;return t}},84428:(e,t,r)=>{var n=r(78227)("iterator"),i=!1;try{var s=0,o={next:function(){return{done:!!s++}},return:function(){i=!0}};o[n]=function(){return this},Array.from(o,(function(){throw 2}))}catch(e){}e.exports=function(e,t){try{if(!t&&!i)return!1}catch(e){return!1}var r=!1;try{var s={};s[n]=function(){return{next:function(){return{done:r=!0}}}},e(s)}catch(e){}return r}},84606:(e,t,r)=>{var n=r(16823),i=TypeError;e.exports=function(e,t){if(!delete e[t])throw new i("Cannot delete property "+n(t)+" of "+n(e))}},84634:(e,t,r)=>{var n=r(46518),i=r(28551),s=r(34124);n({target:"Reflect",stat:!0},{isExtensible:function(e){return i(e),s(e)}})},84847:(e,t,r)=>{r(46518)({target:"AsyncIterator",name:"indexed",proto:!0,real:!0,forced:!0},{asIndexedPairs:r(87481)})},84864:(e,t,r)=>{var n=r(43724),i=r(44576),s=r(79504),o=r(92796),a=r(23167),l=r(66699),c=r(2360),h=r(38480).f,u=r(1625),d=r(60788),p=r(655),f=r(61034),g=r(58429),A=r(11056),m=r(36840),y=r(79039),v=r(39297),w=r(91181).enforce,b=r(87633),E=r(78227),x=r(83635),C=r(18814),_=E("match"),I=i.RegExp,S=I.prototype,M=i.SyntaxError,T=s(S.exec),B=s("".charAt),P=s("".replace),R=s("".indexOf),D=s("".slice),L=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,k=/a/g,O=/a/g,F=new I(k)!==k,N=g.MISSED_STICKY,U=g.UNSUPPORTED_Y;if(o("RegExp",n&&(!F||N||x||C||y((function(){return O[_]=!1,I(k)!==k||I(O)===O||"/a/i"!==String(I(k,"i"))}))))){for(var Q=function(e,t){var r,n,i,s,o,h,g=u(S,this),A=d(e),m=void 0===t,y=[],b=e;if(!g&&A&&m&&e.constructor===Q)return e;if((A||u(S,e))&&(e=e.source,m&&(t=f(b))),e=void 0===e?"":p(e),t=void 0===t?"":p(t),b=e,x&&"dotAll"in k&&(n=!!t&&R(t,"s")>-1)&&(t=P(t,/s/g,"")),r=t,N&&"sticky"in k&&(i=!!t&&R(t,"y")>-1)&&U&&(t=P(t,/y/g,"")),C&&(s=function(e){for(var t,r=e.length,n=0,i="",s=[],o=c(null),a=!1,l=!1,h=0,u="";n<=r;n++){if("\\"===(t=B(e,n)))t+=B(e,++n);else if("]"===t)a=!1;else if(!a)switch(!0){case"["===t:a=!0;break;case"("===t:if(i+=t,"?:"===D(e,n+1,n+3))continue;T(L,D(e,n+1))&&(n+=2,l=!0),h++;continue;case">"===t&&l:if(""===u||v(o,u))throw new M("Invalid capture group name");o[u]=!0,s[s.length]=[u,h],l=!1,u="";continue}l?u+=t:i+=t}return[i,s]}(e),e=s[0],y=s[1]),o=a(I(e,t),g?this:S,Q),(n||i||y.length)&&(h=w(o),n&&(h.dotAll=!0,h.raw=Q(function(e){for(var t,r=e.length,n=0,i="",s=!1;n<=r;n++)"\\"!==(t=B(e,n))?s||"."!==t?("["===t?s=!0:"]"===t&&(s=!1),i+=t):i+="[\\s\\S]":i+=t+B(e,++n);return i}(e),r)),i&&(h.sticky=!0),y.length&&(h.groups=y)),e!==b)try{l(o,"source",""===b?"(?:)":b)}catch(e){}return o},G=h(I),z=0;G.length>z;)A(Q,I,G[z++]);S.constructor=Q,Q.prototype=S,m(i,"RegExp",Q,{constructor:!0})}b("RegExp")},84916:(e,t,r)=>{var n=r(97751),i=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}},s=function(e){return{size:e,has:function(){return!0},keys:function(){throw new Error("e")}}};e.exports=function(e,t){var r=n("Set");try{(new r)[e](i(0));try{return(new r)[e](i(-1)),!1}catch(n){if(!t)return!0;try{return(new r)[e](s(-1/0)),!1}catch(n){var o=new r;return o.add(1),o.add(2),t(o[e](s(1/0)))}}}catch(e){return!1}}},85901:(e,t,r)=>{r(11558)},85906:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(25397),o=r(48981),a=r(655),l=r(26198),c=i([].push),h=i([].join);n({target:"String",stat:!0},{raw:function(e){var t=s(o(e).raw),r=l(t);if(!r)return"";for(var n=arguments.length,i=[],u=0;;){if(c(i,a(t[u++])),u===r)return h(i,"");u<n&&c(i,a(arguments[u]))}}})},86097:(e,t,r)=>{var n=r(46518),i=r(76080),s=r(36194),o=r(26223);n({target:"Map",proto:!0,real:!0,forced:!0},{findKey:function(e){var t=s(this),r=i(e,arguments.length>1?arguments[1]:void 0),n=o(t,(function(e,n){if(r(e,n,t))return{key:n}}),!0);return n&&n.key}})},86368:(e,t,r)=>{var n=r(46518),i=r(44576),s=r(59225).clear;n({global:!0,bind:!0,enumerable:!0,forced:i.clearImmediate!==s},{clearImmediate:s})},86565:(e,t,r)=>{var n=r(46518),i=r(28551),s=r(42787);n({target:"Reflect",stat:!0,sham:!r(12211)},{getPrototypeOf:function(e){return s(i(e))}})},86601:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Copc=void 0;const o=s(r(30549)),a=r(876),l=r(98363),c=r(15690);async function h(e,{pointDataOffset:t,pointDataLength:r}){return a.Getter.create(e)(t,t+r)}async function u(e,{pointDataRecordFormat:t,pointDataRecordLength:r},n,i){const s=await h(e,n),{pointCount:a}=n;return o.PointData.decompressChunk(s,{pointCount:a,pointDataRecordFormat:t,pointDataRecordLength:r},i)}t.Copc={create:async function(e){const t=a.Getter.create(e),r=t(0,65536);async function n(e,n){return n>=65536?t(e,n):(await r).slice(e,n)}const i=o.Header.parse(await n(0,o.Constants.minHeaderLength)),s=await o.Vlr.walk(n,i),l=o.Vlr.find(s,"copc",1);if(!l)throw new Error("COPC info VLR is required");const h=c.Info.parse(await o.Vlr.fetch(n,l));let u;const d=o.Vlr.find(s,"LASF_Projection",2112);d&&d.contentLength&&(u=a.Binary.toCString(await o.Vlr.fetch(n,d)),""===u&&(u=void 0));let p=[];const f=o.Vlr.find(s,"LASF_Spec",4);return f&&(p=o.ExtraBytes.parse(await o.Vlr.fetch(n,f))),{header:i,vlrs:s,info:h,wkt:u,eb:p}},loadHierarchyPage:async function(e,t){const r=a.Getter.create(e);return l.Hierarchy.load(r,t)},loadCompressedPointDataBuffer:h,loadPointDataBuffer:u,loadPointDataView:async function(e,t,r,{lazPerf:n,include:i}={}){const s=await u(e,t.header,r,n);return o.View.create(s,t.header,t.eb,i)}}},86614:(e,t,r)=>{var n=r(94644),i=r(18014),s=r(35610),o=n.aTypedArray,a=n.getTypedArrayConstructor;(0,n.exportTypedArrayMethod)("subarray",(function(e,t){var r=o(this),n=r.length,l=s(e,n);return new(a(r))(r.buffer,r.byteOffset+l*r.BYTES_PER_ELEMENT,i((void 0===t?n:s(t,n))-l))}))},86938:(e,t,r)=>{var n=r(2360),i=r(62106),s=r(56279),o=r(76080),a=r(90679),l=r(64117),c=r(72652),h=r(51088),u=r(62529),d=r(87633),p=r(43724),f=r(3451).fastKey,g=r(91181),A=g.set,m=g.getterFor;e.exports={getConstructor:function(e,t,r,h){var u=e((function(e,i){a(e,d),A(e,{type:t,index:n(null),first:null,last:null,size:0}),p||(e.size=0),l(i)||c(i,e[h],{that:e,AS_ENTRIES:r})})),d=u.prototype,g=m(t),y=function(e,t,r){var n,i,s=g(e),o=v(e,t);return o?o.value=r:(s.last=o={index:i=f(t,!0),key:t,value:r,previous:n=s.last,next:null,removed:!1},s.first||(s.first=o),n&&(n.next=o),p?s.size++:e.size++,"F"!==i&&(s.index[i]=o)),e},v=function(e,t){var r,n=g(e),i=f(t);if("F"!==i)return n.index[i];for(r=n.first;r;r=r.next)if(r.key===t)return r};return s(d,{clear:function(){for(var e=g(this),t=e.first;t;)t.removed=!0,t.previous&&(t.previous=t.previous.next=null),t=t.next;e.first=e.last=null,e.index=n(null),p?e.size=0:this.size=0},delete:function(e){var t=this,r=g(t),n=v(t,e);if(n){var i=n.next,s=n.previous;delete r.index[n.index],n.removed=!0,s&&(s.next=i),i&&(i.previous=s),r.first===n&&(r.first=i),r.last===n&&(r.last=s),p?r.size--:t.size--}return!!n},forEach:function(e){for(var t,r=g(this),n=o(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:r.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!v(this,e)}}),s(d,r?{get:function(e){var t=v(this,e);return t&&t.value},set:function(e,t){return y(this,0===e?0:e,t)}}:{add:function(e){return y(this,e=0===e?0:e,e)}}),p&&i(d,"size",{configurable:!0,get:function(){return g(this).size}}),u},setStrong:function(e,t,r){var n=t+" Iterator",i=m(t),s=m(n);h(e,t,(function(e,t){A(this,{type:n,target:e,state:i(e),kind:t,last:null})}),(function(){for(var e=s(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?u("keys"===t?r.key:"values"===t?r.value:[r.key,r.value],!1):(e.target=null,u(void 0,!0))}),r?"entries":"values",!r,!0),d(t)}}},86964:(e,t,r)=>{r(70511)("match")},86994:(e,t,r)=>{var n=r(46518),i=r(36639).toArray;n({target:"AsyncIterator",proto:!0,real:!0},{toArray:function(){return i(this,void 0,[])}})},87153:(e,t,r)=>{r(46518)({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:r(12586)})},87220:(e,t,r)=>{var n=r(46518),i=r(33904);n({target:"Number",stat:!0,forced:Number.parseFloat!==i},{parseFloat:i})},87370:(e,t,r)=>{var n=r(46518),i=r(59213).filterReject,s=r(6469);n({target:"Array",proto:!0,forced:!0},{filterOut:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),s("filterOut")},87411:(e,t,r)=>{var n=r(46518),i=r(43724),s=r(28551),o=r(56969),a=r(24913);n({target:"Reflect",stat:!0,forced:r(79039)((function(){Reflect.defineProperty(a.f({},1,{value:1}),1,{value:2})})),sham:!i},{defineProperty:function(e,t,r){s(e);var n=o(t);s(r);try{return a.f(e,n,r),!0}catch(e){return!1}}})},87433:(e,t,r)=>{var n=r(34376),i=r(33517),s=r(20034),o=r(78227)("species"),a=Array;e.exports=function(e){var t;return n(e)&&(t=e.constructor,(i(t)&&(t===a||n(t.prototype))||s(t)&&null===(t=t[o]))&&(t=void 0)),void 0===t?a:t}},87478:(e,t,r)=>{r(87633)("Array")},87481:(e,t,r)=>{var n=r(69565),i=r(41750),s=function(e,t){return[t,e]};e.exports=function(){return n(i,this,s)}},87500:(e,t,r)=>{var n=r(28551);e.exports=function(e,t,r){return function(){for(var i=new e,s=arguments.length,o=0;o<s;o++){var a=arguments[o];r?t(i,n(a)[0],a[1]):t(i,a)}return i}}},87607:(e,t,r)=>{var n=r(46518),i=r(43724),s=r(42551),o=r(79306),a=r(48981),l=r(24913);i&&n({target:"Object",proto:!0,forced:s},{__defineSetter__:function(e,t){l.f(a(this),e,{set:o(t),enumerable:!0,configurable:!0})}})},87633:(e,t,r)=>{var n=r(97751),i=r(62106),s=r(78227),o=r(43724),a=s("species");e.exports=function(e){var t=n(e);o&&t&&!t[a]&&i(t,a,{configurable:!0,get:function(){return this}})}},87745:(e,t,r)=>{var n=r(43724),i=r(58429).MISSED_STICKY,s=r(22195),o=r(62106),a=r(91181).get,l=RegExp.prototype,c=TypeError;n&&i&&o(l,"sticky",{configurable:!0,get:function(){if(this!==l){if("RegExp"===s(this))return!!a(this).sticky;throw new c("Incompatible receiver, RegExp required")}}})},88177:(e,t,r)=>{var n=r(46518),i=r(34598),s=r(6469),o=r(2952);n({target:"Array",proto:!0,name:"groupToMap",forced:r(96395)||!i("groupByToMap")},{groupByToMap:o}),s("groupByToMap")},88205:(e,t,r)=>{var n=r(79504),i=WeakSet.prototype;e.exports={WeakSet,add:n(i.add),has:n(i.has),remove:n(i.delete)}},88267:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(655),o=String.fromCharCode,a=i("".charAt),l=i(/./.exec),c=i("".slice),h=/^[\da-f]{2}$/i,u=/^[\da-f]{4}$/i;n({global:!0},{unescape:function(e){for(var t,r,n=s(e),i="",d=n.length,p=0;p<d;){if("%"===(t=a(n,p++)))if("u"===a(n,p)){if(r=c(n,p+1,p+5),l(u,r)){i+=o(parseInt(r,16)),p+=5;continue}}else if(r=c(n,p,p+2),l(h,r)){i+=o(parseInt(r,16)),p+=2;continue}i+=t}return i}})},88431:(e,t,r)=>{var n=r(46518),i=r(59213).every;n({target:"Array",proto:!0,forced:!r(34598)("every")},{every:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}})},88490:e=>{var t=Array,r=Math.abs,n=Math.pow,i=Math.floor,s=Math.log,o=Math.LN2;e.exports={pack:function(e,a,l){var c,h,u,d=t(l),p=8*l-a-1,f=(1<<p)-1,g=f>>1,A=23===a?n(2,-24)-n(2,-77):0,m=e<0||0===e&&1/e<0?1:0,y=0;for((e=r(e))!=e||e===1/0?(h=e!=e?1:0,c=f):(c=i(s(e)/o),e*(u=n(2,-c))<1&&(c--,u*=2),(e+=c+g>=1?A/u:A*n(2,1-g))*u>=2&&(c++,u/=2),c+g>=f?(h=0,c=f):c+g>=1?(h=(e*u-1)*n(2,a),c+=g):(h=e*n(2,g-1)*n(2,a),c=0));a>=8;)d[y++]=255&h,h/=256,a-=8;for(c=c<<a|h,p+=a;p>0;)d[y++]=255&c,c/=256,p-=8;return d[y-1]|=128*m,d},unpack:function(e,t){var r,i=e.length,s=8*i-t-1,o=(1<<s)-1,a=o>>1,l=s-7,c=i-1,h=e[c--],u=127&h;for(h>>=7;l>0;)u=256*u+e[c--],l-=8;for(r=u&(1<<-l)-1,u>>=-l,l+=t;l>0;)r=256*r+e[c--],l-=8;if(0===u)u=1-a;else{if(u===o)return r?NaN:h?-1/0:1/0;r+=n(2,t),u-=a}return(h?-1:1)*r*n(2,u-t)}}},88727:e=>{e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},88747:(e,t,r)=>{var n=r(94644),i=n.aTypedArray,s=n.exportTypedArrayMethod,o=Math.floor;s("reverse",(function(){for(var e,t=this,r=i(t).length,n=o(r/2),s=0;s<n;)e=t[s],t[s++]=t[--r],t[r]=e;return t}))},89195:(e,t,r)=>{var n=r(46518),i=r(77240);n({target:"String",proto:!0,forced:r(23061)("small")},{small:function(){return i(this,"small","","")}})},89228:(e,t,r)=>{r(27495);var n=r(69565),i=r(36840),s=r(57323),o=r(79039),a=r(78227),l=r(66699),c=a("species"),h=RegExp.prototype;e.exports=function(e,t,r,u){var d=a(e),p=!o((function(){var t={};return t[d]=function(){return 7},7!==""[e](t)})),f=p&&!o((function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[c]=function(){return r},r.flags="",r[d]=/./[d]),r.exec=function(){return t=!0,null},r[d](""),!t}));if(!p||!f||r){var g=/./[d],A=t(d,""[e],(function(e,t,r,i,o){var a=t.exec;return a===s||a===h.exec?p&&!o?{done:!0,value:n(g,t,r,i)}:{done:!0,value:n(e,r,t,i)}:{done:!1}}));i(String.prototype,e,A[0]),i(h,d,A[1])}u&&l(h[d],"sham",!0)}},89286:(e,t,r)=>{var n=r(94402),i=r(38469),s=n.Set,o=n.add;e.exports=function(e){var t=new s;return i(e,(function(e){o(t,e)})),t}},89429:(e,t,r)=>{var n=r(44576),i=r(38574);e.exports=function(e){if(i){try{return n.process.getBuiltinModule(e)}catch(e){}try{return Function('return require("'+e+'")')()}catch(e){}}}},89463:(e,t,r)=>{var n=r(46518),i=r(43724),s=r(44576),o=r(79504),a=r(39297),l=r(94901),c=r(1625),h=r(655),u=r(62106),d=r(77740),p=s.Symbol,f=p&&p.prototype;if(i&&l(p)&&(!("description"in f)||void 0!==p().description)){var g={},A=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:h(arguments[0]),t=c(f,this)?new p(e):void 0===e?p():p(e);return""===e&&(g[t]=!0),t};d(A,p),A.prototype=f,f.constructor=A;var m="Symbol(description detection)"===String(p("description detection")),y=o(f.valueOf),v=o(f.toString),w=/^Symbol\((.*)\)[^)]+$/,b=o("".replace),E=o("".slice);u(f,"description",{configurable:!0,get:function(){var e=y(this);if(a(g,e))return"";var t=v(e),r=m?E(t,7,-1):b(t,w,"$1");return""===r?void 0:r}}),n({global:!0,constructor:!0,forced:!0},{Symbol:A})}},89544:(e,t,r)=>{var n=r(82839);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(n)},89572:(e,t,r)=>{var n=r(39297),i=r(36840),s=r(53640),o=r(78227)("toPrimitive"),a=Date.prototype;n(a,o)||i(a,o,s)},89907:(e,t,r)=>{var n=r(46518),i=r(77240);n({target:"String",proto:!0,forced:r(23061)("anchor")},{anchor:function(e){return i(this,"a","name",e)}})},89955:(e,t,r)=>{var n=r(94644),i=r(59213).findIndex,s=n.aTypedArray;(0,n.exportTypedArrayMethod)("findIndex",(function(e){return i(s(this),e,arguments.length>1?arguments[1]:void 0)}))},90148:(e,t,r)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;t.splice(1,0,r,"color: inherit");let n=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(n++,"%c"===e&&(i=n))})),t.splice(i,0,r)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=r(45995)(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},90235:(e,t,r)=>{var n=r(59213).forEach,i=r(34598)("forEach");e.exports=i?[].forEach:function(e){return n(this,e,arguments.length>1?arguments[1]:void 0)}},90380:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decompressFile=t.decompressChunk=t.PointData=void 0;const n=r(26977),i=r(68916);let s;async function o(e){return e||(s||(s=(0,n.createLazPerf)()),s)}async function a(e,{pointCount:t,pointDataRecordFormat:r,pointDataRecordLength:n},i){const s=await o(i),a=new Uint8Array(t*n),l=s._malloc(e.byteLength),c=s._malloc(n),h=new s.ChunkDecoder;try{s.HEAPU8.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),l),h.open(r,n,l);for(let e=0;e<t;++e)h.getPoint(c),a.set(new Uint8Array(s.HEAPU8.buffer,c,n),e*n)}finally{s._free(l),s._free(c),h.delete()}return a}async function l(e,t){const r=await o(t),n=i.Header.parse(e),{pointCount:s,pointDataRecordLength:a}=n,l=new Uint8Array(s*a),c=r._malloc(e.byteLength),h=r._malloc(a),u=new r.LASZip;try{r.HEAPU8.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),c),u.open(c,e.byteLength);for(let e=0;e<s;++e)u.getPoint(h),l.set(new Uint8Array(r.HEAPU8.buffer,h,a),e*a)}finally{u.delete()}return l}t.PointData={createLazPerf:n.createLazPerf,decompressChunk:a,decompressFile:l},t.decompressChunk=a,t.decompressFile=l},90537:(e,t,r)=>{var n=r(80550),i=r(84428),s=r(10916).CONSTRUCTOR;e.exports=s||!i((function(e){n.all(e).then(void 0,(function(){}))}))},90679:(e,t,r)=>{var n=r(1625),i=TypeError;e.exports=function(e,t){if(n(t,e))return e;throw new i("Incorrect invocation")}},90744:(e,t,r)=>{var n=r(69565),i=r(79504),s=r(89228),o=r(28551),a=r(64117),l=r(67750),c=r(2293),h=r(57829),u=r(18014),d=r(655),p=r(55966),f=r(56682),g=r(58429),A=r(79039),m=g.UNSUPPORTED_Y,y=Math.min,v=i([].push),w=i("".slice),b=!A((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return 2!==r.length||"a"!==r[0]||"b"!==r[1]})),E="c"==="abbc".split(/(b)*/)[1]||4!=="test".split(/(?:)/,-1).length||2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length;s("split",(function(e,t,r){var i="0".split(void 0,0).length?function(e,r){return void 0===e&&0===r?[]:n(t,this,e,r)}:t;return[function(t,r){var s=l(this),o=a(t)?void 0:p(t,e);return o?n(o,t,s,r):n(i,d(s),t,r)},function(e,n){var s=o(this),a=d(e);if(!E){var l=r(i,s,a,n,i!==t);if(l.done)return l.value}var p=c(s,RegExp),g=s.unicode,A=(s.ignoreCase?"i":"")+(s.multiline?"m":"")+(s.unicode?"u":"")+(m?"g":"y"),b=new p(m?"^(?:"+s.source+")":s,A),x=void 0===n?4294967295:n>>>0;if(0===x)return[];if(0===a.length)return null===f(b,a)?[a]:[];for(var C=0,_=0,I=[];_<a.length;){b.lastIndex=m?0:_;var S,M=f(b,m?w(a,_):a);if(null===M||(S=y(u(b.lastIndex+(m?_:0)),a.length))===C)_=h(a,_,g);else{if(v(I,w(a,C,_)),I.length===x)return I;for(var T=1;T<=M.length-1;T++)if(v(I,M[T]),I.length===x)return I;_=C=S}}return v(I,w(a,C)),I}]}),E||!b,m)},90757:e=>{e.exports=function(e,t){try{1===arguments.length?console.error(e):console.error(e,t)}catch(e){}}},90906:(e,t,r)=>{r(27495);var n,i,s=r(46518),o=r(69565),a=r(94901),l=r(28551),c=r(655),h=(n=!1,(i=/[ac]/).exec=function(){return n=!0,/./.exec.apply(this,arguments)},!0===i.test("abc")&&n),u=/./.test;s({target:"RegExp",proto:!0,forced:!h},{test:function(e){var t=l(this),r=c(e),n=t.exec;if(!a(n))return o(u,t,r);var i=o(n,t,r);return null!==i&&(l(i),!0)}})},91021:(e,t,r)=>{var n=r(97751),i=r(69565),s=r(79504),o=r(76080),a=r(28551),l=r(79306),c=r(64117),h=r(55966),u=r(78227),d=u("asyncDispose"),p=u("dispose"),f=s([].push),g=function(e,t,r){return arguments.length<3&&!c(e)&&(r=l(function(e,t){if("async-dispose"===t){var r=h(e,d);return void 0!==r||void 0===(r=h(e,p))?r:function(){var e=this;return new(n("Promise"))((function(t){i(r,e),t(void 0)}))}}return h(e,p)}(a(e),t))),void 0===r?function(){}:o(r,e)};e.exports=function(e,t,r,n){var i;if(arguments.length<4){if(c(t)&&"sync-dispose"===r)return;i=g(t,r)}else i=g(void 0,r,n);f(e.stack,i)}},91134:(e,t,r)=>{var n=r(94644),i=r(43839).findLastIndex,s=n.aTypedArray;(0,n.exportTypedArrayMethod)("findLastIndex",(function(e){return i(s(this),e,arguments.length>1?arguments[1]:void 0)}))},91181:(e,t,r)=>{var n,i,s,o=r(58622),a=r(44576),l=r(20034),c=r(66699),h=r(39297),u=r(77629),d=r(66119),p=r(30421),f="Object already initialized",g=a.TypeError,A=a.WeakMap;if(o||u.state){var m=u.state||(u.state=new A);m.get=m.get,m.has=m.has,m.set=m.set,n=function(e,t){if(m.has(e))throw new g(f);return t.facade=e,m.set(e,t),t},i=function(e){return m.get(e)||{}},s=function(e){return m.has(e)}}else{var y=d("state");p[y]=!0,n=function(e,t){if(h(e,y))throw new g(f);return t.facade=e,c(e,y,t),t},i=function(e){return h(e,y)?e[y]:{}},s=function(e){return h(e,y)}}e.exports={set:n,get:i,has:s,enforce:function(e){return s(e)?i(e):n(e,{})},getterFor:function(e){return function(t){var r;if(!l(t)||(r=i(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return r}}}},91191:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(91291),o=Date.prototype,a=i(o.getTime),l=i(o.setFullYear);n({target:"Date",proto:!0},{setYear:function(e){a(this);var t=s(e);return l(this,t>=0&&t<=99?t+1900:t)}})},91291:(e,t,r)=>{var n=r(80741);e.exports=function(e){var t=+e;return t!=t||0===t?0:n(t)}},91296:(e,t,r)=>{var n=r(4495);e.exports=n&&!!Symbol.for&&!!Symbol.keyFor},91354:(e,t,r)=>{var n=r(91181),i=r(33994),s=r(62529),o=r(39297),a=r(71072),l=r(48981),c="Object Iterator",h=n.set,u=n.getterFor(c);e.exports=i((function(e,t){var r=l(e);h(this,{type:c,mode:t,object:r,keys:a(r),index:0})}),"Object",(function(){for(var e=u(this),t=e.keys;;){if(null===t||e.index>=t.length)return e.object=e.keys=null,s(void 0,!0);var r=t[e.index++],n=e.object;if(o(n,r)){switch(e.mode){case"keys":return s(r,!1);case"values":return s(n[r],!1)}return s([r,n[r]],!1)}}}))},91550:(e,t,r)=>{var n=r(46518),i=r(91354);n({target:"Object",stat:!0,forced:!0},{iterateEntries:function(e){return new i(e,"entries")}})},91625:(e,t,r)=>{var n=r(79504),i=r(56279),s=r(3451).getWeakData,o=r(90679),a=r(28551),l=r(64117),c=r(20034),h=r(72652),u=r(59213),d=r(39297),p=r(91181),f=p.set,g=p.getterFor,A=u.find,m=u.findIndex,y=n([].splice),v=0,w=function(e){return e.frozen||(e.frozen=new b)},b=function(){this.entries=[]},E=function(e,t){return A(e.entries,(function(e){return e[0]===t}))};b.prototype={get:function(e){var t=E(this,e);if(t)return t[1]},has:function(e){return!!E(this,e)},set:function(e,t){var r=E(this,e);r?r[1]=t:this.entries.push([e,t])},delete:function(e){var t=m(this.entries,(function(t){return t[0]===e}));return~t&&y(this.entries,t,1),!!~t}},e.exports={getConstructor:function(e,t,r,n){var u=e((function(e,i){o(e,p),f(e,{type:t,id:v++,frozen:null}),l(i)||h(i,e[n],{that:e,AS_ENTRIES:r})})),p=u.prototype,A=g(t),m=function(e,t,r){var n=A(e),i=s(a(t),!0);return!0===i?w(n).set(t,r):i[n.id]=r,e};return i(p,{delete:function(e){var t=A(this);if(!c(e))return!1;var r=s(e);return!0===r?w(t).delete(e):r&&d(r,t.id)&&delete r[t.id]},has:function(e){var t=A(this);if(!c(e))return!1;var r=s(e);return!0===r?w(t).has(e):r&&d(r,t.id)}}),i(p,r?{get:function(e){var t=A(this);if(c(e)){var r=s(e);if(!0===r)return w(t).get(e);if(r)return r[t.id]}},set:function(e,t){return m(this,e,t)}}:{add:function(e){return m(this,e,!0)}}),u}}},91706:(e,t,r)=>{r(21903)},91955:(e,t,r)=>{var n,i,s,o,a,l=r(44576),c=r(93389),h=r(76080),u=r(59225).set,d=r(18265),p=r(89544),f=r(44265),g=r(7860),A=r(38574),m=l.MutationObserver||l.WebKitMutationObserver,y=l.document,v=l.process,w=l.Promise,b=c("queueMicrotask");if(!b){var E=new d,x=function(){var e,t;for(A&&(e=v.domain)&&e.exit();t=E.get();)try{t()}catch(e){throw E.head&&n(),e}e&&e.enter()};p||A||g||!m||!y?!f&&w&&w.resolve?((o=w.resolve(void 0)).constructor=w,a=h(o.then,o),n=function(){a(x)}):A?n=function(){v.nextTick(x)}:(u=h(u,l),n=function(){u(x)}):(i=!0,s=y.createTextNode(""),new m(x).observe(s,{characterData:!0}),n=function(){s.data=i=!i}),b=function(e){E.head||n(),E.add(e)}}e.exports=b},92059:(e,t,r)=>{var n=r(69565),i=r(1103),s=r(28551),o=r(2360),a=r(66699),l=r(56279),c=r(78227),h=r(91181),u=r(97751),d=r(55966),p=r(53982),f=r(62529),g=r(9539),A=u("Promise"),m=c("toStringTag"),y="AsyncIteratorHelper",v="WrapForValidAsyncIterator",w=h.set,b=function(e){var t=!e,r=h.getterFor(e?v:y),a=function(e){var n=i((function(){return r(e)})),s=n.error,o=n.value;return s||t&&o.done?{exit:!0,value:s?A.reject(o):A.resolve(f(void 0,!0))}:{exit:!1,value:o}};return l(o(p),{next:function(){var e=a(this),t=e.value;if(e.exit)return t;var r=i((function(){return s(t.nextHandler(A))})),n=r.error,o=r.value;return n&&(t.done=!0),n?A.reject(o):A.resolve(o)},return:function(){var t=a(this),r=t.value;if(t.exit)return r;r.done=!0;var o,l,c=r.iterator,h=i((function(){if(r.inner)try{g(r.inner.iterator,"normal")}catch(e){return g(c,"throw",e)}return d(c,"return")}));return o=l=h.value,h.error?A.reject(l):void 0===o?A.resolve(f(void 0,!0)):(l=(h=i((function(){return n(o,c)}))).value,h.error?A.reject(l):e?A.resolve(l):A.resolve(l).then((function(e){return s(e),f(void 0,!0)})))}})},E=b(!0),x=b(!1);a(x,m,"Async Iterator Helper"),e.exports=function(e,t){var r=function(r,n){n?(n.iterator=r.iterator,n.next=r.next):n=r,n.type=t?v:y,n.nextHandler=e,n.counter=0,n.done=!1,w(this,n)};return r.prototype=t?E:x,r}},92140:(e,t,r)=>{var n={};n[r(78227)("toStringTag")]="z",e.exports="[object z]"===String(n)},92168:(e,t,r)=>{r(70511)("isConcatSpreadable")},92405:(e,t,r)=>{r(16468)("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),r(86938))},92744:(e,t,r)=>{var n=r(79039);e.exports=!n((function(){return Object.isExtensible(Object.preventExtensions({}))}))},92796:(e,t,r)=>{var n=r(79039),i=r(94901),s=/#|\.prototype\./,o=function(e,t){var r=l[a(e)];return r===h||r!==c&&(i(t)?n(t):!!t)},a=o.normalize=function(e){return String(e).replace(s,".").toLowerCase()},l=o.data={},c=o.NATIVE="N",h=o.POLYFILL="P";e.exports=o},92804:e=>{var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=t+"+/",n=t+"-_",i=function(e){for(var t={},r=0;r<64;r++)t[e.charAt(r)]=r;return t};e.exports={i2c:r,c2i:i(r),i2cUrl:n,c2iUrl:i(n)}},93153:(e,t,r)=>{var n=r(46518),i=r(7740),s=Math.acosh,o=Math.log,a=Math.sqrt,l=Math.LN2;n({target:"Math",stat:!0,forced:!s||710!==Math.floor(s(Number.MAX_VALUE))||s(1/0)!==1/0},{acosh:function(e){var t=+e;return t<1?NaN:t>94906265.62425156?o(t)+l:i(t-1+a(t-1)*a(t+1))}})},93389:(e,t,r)=>{var n=r(44576),i=r(43724),s=Object.getOwnPropertyDescriptor;e.exports=function(e){if(!i)return n[e];var t=s(n,e);return t&&t.value}},93438:(e,t,r)=>{var n=r(28551),i=r(20034),s=r(36043);e.exports=function(e,t){if(n(e),i(t)&&t.constructor===e)return t;var r=s.f(e);return(0,r.resolve)(t),r.promise}},93514:(e,t,r)=>{r(6469)("flat")},93515:(e,t,r)=>{r(46518)({target:"Date",proto:!0},{toGMTString:Date.prototype.toUTCString})},93518:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(79306),o=r(97751),a=r(36043),l=r(1103),c=r(72652),h=r(90537),u="No one promise resolved";n({target:"Promise",stat:!0,forced:h},{any:function(e){var t=this,r=o("AggregateError"),n=a.f(t),h=n.resolve,d=n.reject,p=l((function(){var n=s(t.resolve),o=[],a=0,l=1,p=!1;c(e,(function(e){var s=a++,c=!1;l++,i(n,t,e).then((function(e){c||p||(p=!0,h(e))}),(function(e){c||p||(c=!0,o[s]=e,--l||d(new r(o,u)))}))})),--l||d(new r(o,u))}));return p.error&&d(p.value),n.promise}})},93777:(e,t,r)=>{var n=r(46518),i=r(76080),s=r(36194),o=r(26223);n({target:"Map",proto:!0,real:!0,forced:!0},{every:function(e){var t=s(this),r=i(e,arguments.length>1?arguments[1]:void 0);return!1!==o(t,(function(e,n){if(!r(e,n,t))return!1}),!0)}})},93941:(e,t,r)=>{var n=r(46518),i=r(20034),s=r(3451).onFreeze,o=r(92744),a=r(79039),l=Object.seal;n({target:"Object",stat:!0,forced:a((function(){l(1)})),sham:!o},{seal:function(e){return l&&i(e)?l(s(e)):e}})},93967:(e,t,r)=>{var n=r(46518),i=r(20034),s=r(3451).onFreeze,o=r(92744),a=r(79039),l=Object.preventExtensions;n({target:"Object",stat:!0,forced:a((function(){l(1)})),sham:!o},{preventExtensions:function(e){return l&&i(e)?l(s(e)):e}})},94003:(e,t,r)=>{var n=r(46518),i=r(79039),s=r(20034),o=r(22195),a=r(15652),l=Object.isFrozen;n({target:"Object",stat:!0,forced:a||i((function(){l(1)}))},{isFrozen:function(e){return!s(e)||!(!a||"ArrayBuffer"!==o(e))||!!l&&l(e)}})},94052:(e,t,r)=>{var n=r(46518),i=r(34124);n({target:"Object",stat:!0,forced:Object.isExtensible!==i},{isExtensible:i})},94170:(e,t,r)=>{var n=r(46518),i=r(30566);n({target:"Function",proto:!0,forced:Function.bind!==i},{bind:i})},94298:(e,t,r)=>{var n=r(46518),i=r(77240);n({target:"String",proto:!0,forced:r(23061)("fixed")},{fixed:function(){return i(this,"tt","","")}})},94402:(e,t,r)=>{var n=r(79504),i=Set.prototype;e.exports={Set,add:n(i.add),has:n(i.has),remove:n(i.delete),proto:i}},94483:(e,t,r)=>{var n,i,s,o,a=r(44576),l=r(89429),c=r(1548),h=a.structuredClone,u=a.ArrayBuffer,d=a.MessageChannel,p=!1;if(c)p=function(e){h(e,{transfer:[e]})};else if(u)try{d||(n=l("worker_threads"))&&(d=n.MessageChannel),d&&(i=new d,s=new u(2),o=function(e){i.port1.postMessage(null,[e])},2===s.byteLength&&(o(s),0===s.byteLength&&(p=o)))}catch(e){}e.exports=p},94490:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(34376),o=i([].reverse),a=[1,2];n({target:"Array",proto:!0,forced:String(a)===String(a.reverse())},{reverse:function(){return s(this)&&(this.length=this.length),o(this)}})},94553:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtraBytes=void 0;const n=r(876);t.ExtraBytes={getDimension:function({type:e,length:t}){switch(e){case"signed":case"unsigned":switch(t){case 1:case 2:case 4:case 8:return{type:e,size:t}}case"float":switch(t){case 4:case 8:return{type:e,size:t}}}},parse:function(e){if(e.byteLength%i!=0)throw new Error(`Invalid extra bytes VLR length: ${e.byteLength}`);const t=[];for(let r=0;r<e.byteLength;r+=i)t.push(s(e.slice(r,r+i)));return t},parseOne:s};const i=192;function s(e){if(e.byteLength!==i)throw new Error(`Invalid extra bytes entry length: ${e.byteLength}`);const t=n.Binary.toDataView(e),r=n.Binary.toCString(e.slice(4,36)),s=n.Binary.toCString(e.slice(60,192)),o=t.getUint8(2),a=t.getUint8(3);if(o>=11)throw new Error(`Invalid extra bytes "type" value: ${o}`);if(0===o)return{name:r,description:s,length:a};const l=(c=a,{hasNodata:Boolean(1&c),hasMin:Boolean(c>>1&1),hasMax:Boolean(c>>2&1),hasScale:Boolean(c>>3&1),hasOffset:Boolean(c>>4&1)});var c;const h=function(e){switch(e){case 1:return n.Dimension.Type.uint8;case 2:return n.Dimension.Type.int8;case 3:return n.Dimension.Type.uint16;case 4:return n.Dimension.Type.int16;case 5:return n.Dimension.Type.uint32;case 6:return n.Dimension.Type.int32;case 7:return n.Dimension.Type.uint64;case 8:return n.Dimension.Type.int64;case 9:return n.Dimension.Type.float32;case 10:return n.Dimension.Type.float64}}(o);if(!h)throw new Error(`Failed to extract dimension type: ${o}`);const{type:u,size:d}=h;function p(e){switch(u){case"signed":return(0,n.parseBigInt)(t.getBigInt64(e,!0));case"unsigned":return(0,n.parseBigInt)((0,n.getBigUint64)(t,e,!0));case"float":return t.getFloat64(e,!0)}}const f={name:r,description:s,type:u,length:d};return l.hasNodata&&(f.nodata=p(40)),l.hasMin&&(f.min=p(64)),l.hasMax&&(f.max=p(88)),l.hasScale&&(f.scale=t.getFloat64(112)),l.hasOffset&&(f.offset=t.getFloat64(136)),f}},94644:(e,t,r)=>{var n,i,s,o=r(77811),a=r(43724),l=r(44576),c=r(94901),h=r(20034),u=r(39297),d=r(36955),p=r(16823),f=r(66699),g=r(36840),A=r(62106),m=r(1625),y=r(42787),v=r(52967),w=r(78227),b=r(33392),E=r(91181),x=E.enforce,C=E.get,_=l.Int8Array,I=_&&_.prototype,S=l.Uint8ClampedArray,M=S&&S.prototype,T=_&&y(_),B=I&&y(I),P=Object.prototype,R=l.TypeError,D=w("toStringTag"),L=b("TYPED_ARRAY_TAG"),k="TypedArrayConstructor",O=o&&!!v&&"Opera"!==d(l.opera),F=!1,N={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},U={BigInt64Array:8,BigUint64Array:8},Q=function(e){var t=y(e);if(h(t)){var r=C(t);return r&&u(r,k)?r[k]:Q(t)}},G=function(e){if(!h(e))return!1;var t=d(e);return u(N,t)||u(U,t)};for(n in N)(s=(i=l[n])&&i.prototype)?x(s)[k]=i:O=!1;for(n in U)(s=(i=l[n])&&i.prototype)&&(x(s)[k]=i);if((!O||!c(T)||T===Function.prototype)&&(T=function(){throw new R("Incorrect invocation")},O))for(n in N)l[n]&&v(l[n],T);if((!O||!B||B===P)&&(B=T.prototype,O))for(n in N)l[n]&&v(l[n].prototype,B);if(O&&y(M)!==B&&v(M,B),a&&!u(B,D))for(n in F=!0,A(B,D,{configurable:!0,get:function(){return h(this)?this[L]:void 0}}),N)l[n]&&f(l[n],L,n);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:O,TYPED_ARRAY_TAG:F&&L,aTypedArray:function(e){if(G(e))return e;throw new R("Target is not a typed array")},aTypedArrayConstructor:function(e){if(c(e)&&(!v||m(T,e)))return e;throw new R(p(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,r,n){if(a){if(r)for(var i in N){var s=l[i];if(s&&u(s.prototype,e))try{delete s.prototype[e]}catch(r){try{s.prototype[e]=t}catch(e){}}}B[e]&&!r||g(B,e,r?t:O&&I[e]||t,n)}},exportTypedArrayStaticMethod:function(e,t,r){var n,i;if(a){if(v){if(r)for(n in N)if((i=l[n])&&u(i,e))try{delete i[e]}catch(e){}if(T[e]&&!r)return;try{return g(T,e,r?t:O&&T[e]||t)}catch(e){}}for(n in N)!(i=l[n])||i[e]&&!r||g(i,e,t)}},getTypedArrayConstructor:Q,isView:function(e){if(!h(e))return!1;var t=d(e);return"DataView"===t||u(N,t)||u(U,t)},isTypedArray:G,TypedArray:T,TypedArrayPrototype:B}},94901:e=>{var t="object"==typeof document&&document.all;e.exports=void 0===t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(e){return"function"==typeof e}},95115:(e,t,r)=>{r(10838)},95192:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Step=void 0,t.Step={fromIndex:function(e){if(e<0||e>=8)throw new Error(`Invalid step index: ${e}`);return[1&e?1:0,e>>1&1?1:0,e>>2&1?1:0]},list:function(){return[[0,0,0],[0,0,1],[0,1,0],[0,1,1],[1,0,0],[1,0,1],[1,1,0],[1,1,1]]}}},95409:e=>{e.exports=e=>!!e&&("symbol"==typeof Symbol.observable&&"function"==typeof e[Symbol.observable]?e===e[Symbol.observable]():"function"==typeof e["@@observable"]&&e===e["@@observable"]())},95477:(e,t,r)=>{r(15823)("Int32",(function(e){return function(t,r,n){return e(this,t,r,n)}}))},95636:(e,t,r)=>{var n=r(44576),i=r(79504),s=r(46706),o=r(57696),a=r(55169),l=r(67394),c=r(94483),h=r(1548),u=n.structuredClone,d=n.ArrayBuffer,p=n.DataView,f=Math.min,g=d.prototype,A=p.prototype,m=i(g.slice),y=s(g,"resizable","get"),v=s(g,"maxByteLength","get"),w=i(A.getInt8),b=i(A.setInt8);e.exports=(h||c)&&function(e,t,r){var n,i=l(e),s=void 0===t?i:o(t),g=!y||!y(e);if(a(e),h&&(e=u(e,{transfer:[e]}),i===s&&(r||g)))return e;if(i>=s&&(!r||g))n=m(e,0,s);else{var A=r&&!g&&v?{maxByteLength:v(e)}:void 0;n=new d(s,A);for(var E=new p(e),x=new p(n),C=f(s,i),_=0;_<C;_++)b(x,_,w(E,_))}return h||c(e),n}},96069:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(63463),o=r(39297),a=r(60533).start,l=r(47452),c=Array,h=RegExp.escape,u=i("".charAt),d=i("".charCodeAt),p=i(1.1.toString),f=i([].join),g=/^[0-9a-z]/i,A=/^[$()*+./?[\\\]^{|}]/,m=RegExp("^[!\"#%&',\\-:;<=>@`~"+l+"]"),y=i(g.exec),v={"\t":"t","\n":"n","\v":"v","\f":"f","\r":"r"},w=function(e){var t=p(d(e,0),16);return t.length<3?"\\x"+a(t,2,"0"):"\\u"+a(t,4,"0")};n({target:"RegExp",stat:!0,forced:!h||"\\x61b"!==h("ab")},{escape:function(e){s(e);for(var t=e.length,r=c(t),n=0;n<t;n++){var i=u(e,n);if(0===n&&y(g,i))r[n]=w(i);else if(o(v,i))r[n]="\\"+v[i];else if(y(A,i))r[n]="\\"+i;else if(y(m,i))r[n]=w(i);else{var a=d(i,0);55296!=(63488&a)?r[n]=i:a>=56320||n+1>=t||56320!=(64512&d(e,n+1))?r[n]=w(i):(r[n]=i,r[++n]=u(e,n))}}return f(r,"")}})},96167:(e,t,r)=>{var n=r(46518),i=r(69565),s=r(79306),o=r(36043),a=r(1103),l=r(72652);n({target:"Promise",stat:!0,forced:r(90537)},{allSettled:function(e){var t=this,r=o.f(t),n=r.resolve,c=r.reject,h=a((function(){var r=s(t.resolve),o=[],a=0,c=1;l(e,(function(e){var s=a++,l=!1;c++,i(r,t,e).then((function(e){l||(l=!0,o[s]={status:"fulfilled",value:e},--c||n(o))}),(function(e){l||(l=!0,o[s]={status:"rejected",reason:e},--c||n(o))}))})),--c||n(o)}));return h.error&&c(h.value),r.promise}})},96319:(e,t,r)=>{var n=r(28551),i=r(9539);e.exports=function(e,t,r,s){try{return s?t(n(r)[0],r[1]):t(r)}catch(t){i(e,"throw",t)}}},96369:(e,t,r)=>{r(46518)({target:"Math",stat:!0,forced:!0},{imulh:function(e,t){var r=65535,n=+e,i=+t,s=n&r,o=i&r,a=n>>16,l=i>>16,c=(a*o>>>0)+(s*o>>>16);return a*l+(c>>16)+((s*l>>>0)+(c&r)>>16)}})},96395:e=>{e.exports=!1},96509:(e,t,r)=>{r.d(t,{F5:()=>s,O3:()=>c,S2:()=>a,Wk:()=>n,hb:()=>l,nk:()=>i,t$:()=>o});const n=-1,i=0,s=1,o=2,a=3,l=6378137,c=-(1/298.257223563*l-l)},96801:(e,t,r)=>{var n=r(43724),i=r(48686),s=r(24913),o=r(28551),a=r(25397),l=r(71072);t.f=n&&!i?Object.defineProperties:function(e,t){o(e);for(var r,n=a(t),i=l(t),c=i.length,h=0;c>h;)s.f(e,r=i[h++],n[r]);return e}},96837:e=>{var t=TypeError;e.exports=function(e){if(e>9007199254740991)throw t("Maximum allowed index exceeded");return e}},96847:(e,t,r)=>{r(91134)},97040:(e,t,r)=>{var n=r(43724),i=r(24913),s=r(6980);e.exports=function(e,t,r){n?i.f(e,t,s(0,r)):e[t]=r}},97080:(e,t,r)=>{var n=r(94402).has;e.exports=function(e){return n(e),e}},97751:(e,t,r)=>{var n=r(44576),i=r(94901);e.exports=function(e,t){return arguments.length<2?(r=n[e],i(r)?r:void 0):n[e]&&n[e][t];var r}},97812:(e,t,r)=>{var n=r(46518),i=r(39297),s=r(10757),o=r(16823),a=r(25745),l=r(91296),c=a("symbol-to-string-registry");n({target:"Symbol",stat:!0,forced:!l},{keyFor:function(e){if(!s(e))throw new TypeError(o(e)+" is not a symbol");if(i(c,e))return c[e]}})},97916:(e,t,r)=>{var n=r(76080),i=r(69565),s=r(48981),o=r(96319),a=r(44209),l=r(33517),c=r(26198),h=r(97040),u=r(70081),d=r(50851),p=Array;e.exports=function(e){var t=s(e),r=l(this),f=arguments.length,g=f>1?arguments[1]:void 0,A=void 0!==g;A&&(g=n(g,f>2?arguments[2]:void 0));var m,y,v,w,b,E,x=d(t),C=0;if(!x||this===p&&a(x))for(m=c(t),y=r?new this(m):p(m);m>C;C++)E=A?g(t[C],C):t[C],h(y,C,E);else for(y=r?new this:[],b=(w=u(t,x)).next;!(v=i(b,w)).done;C++)E=A?o(w,g,[v.value,C],!0):v.value,h(y,C,E);return y.length=C,y}},98225:(e,t,r)=>{var n=r(46518),i=r(79504),s=r(94901),o=r(33706),a=r(39297),l=r(43724),c=Object.getOwnPropertyDescriptor,h=/^\s*class\b/,u=i(h.exec);n({target:"Function",stat:!0,sham:!0,forced:!0},{isCallable:function(e){return s(e)&&!function(e){try{if(!l||!u(h,o(e)))return!1}catch(e){}var t=c(e,"prototype");return!!t&&a(t,"writable")&&!t.writable}(e)}})},98363:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Hierarchy=void 0;const n=r(876),i=r(50329);function s(e){const t=n.Binary.toDataView(e);if(t.byteLength%i.hierarchyItemLength!=0)throw new Error(`Invalid hierarchy page length: ${t.byteLength}`);const r={},s={};for(let e=0;e<t.byteLength;e+=i.hierarchyItemLength){const i=t.getInt32(e+0,!0),o=t.getInt32(e+4,!0),a=t.getInt32(e+8,!0),l=t.getInt32(e+12,!0),c=(0,n.parseBigInt)((0,n.getBigUint64)(t,e+16,!0)),h=t.getInt32(e+24,!0),u=t.getInt32(e+28,!0),d=n.Key.toString([i,o,a,l]);if(u<-1)throw new Error(`Invalid hierarchy point count at key: ${d}`);-1===u?s[d]={pageOffset:c,pageLength:h}:r[d]={pointCount:u,pointDataOffset:c,pointDataLength:h}}return{nodes:r,pages:s}}t.Hierarchy={parse:s,load:async function(e,t){const r=n.Getter.create(e);return s(await r(t.pageOffset,t.pageOffset+t.pageLength))}}},98406:(e,t,r)=>{r(23792),r(27337);var n=r(46518),i=r(44576),s=r(93389),o=r(97751),a=r(69565),l=r(79504),c=r(43724),h=r(67416),u=r(36840),d=r(62106),p=r(56279),f=r(10687),g=r(33994),A=r(91181),m=r(90679),y=r(94901),v=r(39297),w=r(76080),b=r(36955),E=r(28551),x=r(20034),C=r(655),_=r(2360),I=r(6980),S=r(70081),M=r(50851),T=r(62529),B=r(22812),P=r(78227),R=r(74488),D=P("iterator"),L="URLSearchParams",k=L+"Iterator",O=A.set,F=A.getterFor(L),N=A.getterFor(k),U=s("fetch"),Q=s("Request"),G=s("Headers"),z=Q&&Q.prototype,j=G&&G.prototype,V=i.TypeError,q=i.encodeURIComponent,H=String.fromCharCode,W=o("String","fromCodePoint"),$=parseInt,Y=l("".charAt),K=l([].join),J=l([].push),X=l("".replace),Z=l([].shift),ee=l([].splice),te=l("".split),re=l("".slice),ne=l(/./.exec),ie=/\+/g,se=/^[0-9a-f]+$/i,oe=function(e,t){var r=re(e,t,t+2);return ne(se,r)?$(r,16):NaN},ae=function(e){for(var t=0,r=128;r>0&&e&r;r>>=1)t++;return t},le=function(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return t>1114111?null:t},ce=function(e){for(var t=(e=X(e,ie," ")).length,r="",n=0;n<t;){var i=Y(e,n);if("%"===i){if("%"===Y(e,n+1)||n+3>t){r+="%",n++;continue}var s=oe(e,n+1);if(s!=s){r+=i,n++;continue}n+=2;var o=ae(s);if(0===o)i=H(s);else{if(1===o||o>4){r+="",n++;continue}for(var a=[s],l=1;l<o&&!(3+ ++n>t||"%"!==Y(e,n));){var c=oe(e,n+1);if(c!=c){n+=3;break}if(c>191||c<128)break;J(a,c),n+=2,l++}if(a.length!==o){r+="";continue}var h=le(a);null===h?r+="":i=W(h)}}r+=i,n++}return r},he=/[!'()~]|%20/g,ue={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},de=function(e){return ue[e]},pe=function(e){return X(q(e),he,de)},fe=g((function(e,t){O(this,{type:k,target:F(e).entries,index:0,kind:t})}),L,(function(){var e=N(this),t=e.target,r=e.index++;if(!t||r>=t.length)return e.target=null,T(void 0,!0);var n=t[r];switch(e.kind){case"keys":return T(n.key,!1);case"values":return T(n.value,!1)}return T([n.key,n.value],!1)}),!0),ge=function(e){this.entries=[],this.url=null,void 0!==e&&(x(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===Y(e,0)?re(e,1):e:C(e)))};ge.prototype={type:L,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,n,i,s,o,l,c=this.entries,h=M(e);if(h)for(r=(t=S(e,h)).next;!(n=a(r,t)).done;){if(s=(i=S(E(n.value))).next,(o=a(s,i)).done||(l=a(s,i)).done||!a(s,i).done)throw new V("Expected sequence with length 2");J(c,{key:C(o.value),value:C(l.value)})}else for(var u in e)v(e,u)&&J(c,{key:u,value:C(e[u])})},parseQuery:function(e){if(e)for(var t,r,n=this.entries,i=te(e,"&"),s=0;s<i.length;)(t=i[s++]).length&&(r=te(t,"="),J(n,{key:ce(Z(r)),value:ce(K(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],n=0;n<t.length;)e=t[n++],J(r,pe(e.key)+"="+pe(e.value));return K(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Ae=function(){m(this,me);var e=O(this,new ge(arguments.length>0?arguments[0]:void 0));c||(this.size=e.entries.length)},me=Ae.prototype;if(p(me,{append:function(e,t){var r=F(this);B(arguments.length,2),J(r.entries,{key:C(e),value:C(t)}),c||this.length++,r.updateURL()},delete:function(e){for(var t=F(this),r=B(arguments.length,1),n=t.entries,i=C(e),s=r<2?void 0:arguments[1],o=void 0===s?s:C(s),a=0;a<n.length;){var l=n[a];if(l.key!==i||void 0!==o&&l.value!==o)a++;else if(ee(n,a,1),void 0!==o)break}c||(this.size=n.length),t.updateURL()},get:function(e){var t=F(this).entries;B(arguments.length,1);for(var r=C(e),n=0;n<t.length;n++)if(t[n].key===r)return t[n].value;return null},getAll:function(e){var t=F(this).entries;B(arguments.length,1);for(var r=C(e),n=[],i=0;i<t.length;i++)t[i].key===r&&J(n,t[i].value);return n},has:function(e){for(var t=F(this).entries,r=B(arguments.length,1),n=C(e),i=r<2?void 0:arguments[1],s=void 0===i?i:C(i),o=0;o<t.length;){var a=t[o++];if(a.key===n&&(void 0===s||a.value===s))return!0}return!1},set:function(e,t){var r=F(this);B(arguments.length,1);for(var n,i=r.entries,s=!1,o=C(e),a=C(t),l=0;l<i.length;l++)(n=i[l]).key===o&&(s?ee(i,l--,1):(s=!0,n.value=a));s||J(i,{key:o,value:a}),c||(this.size=i.length),r.updateURL()},sort:function(){var e=F(this);R(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,r=F(this).entries,n=w(e,arguments.length>1?arguments[1]:void 0),i=0;i<r.length;)n((t=r[i++]).value,t.key,this)},keys:function(){return new fe(this,"keys")},values:function(){return new fe(this,"values")},entries:function(){return new fe(this,"entries")}},{enumerable:!0}),u(me,D,me.entries,{name:"entries"}),u(me,"toString",(function(){return F(this).serialize()}),{enumerable:!0}),c&&d(me,"size",{get:function(){return F(this).entries.length},configurable:!0,enumerable:!0}),f(Ae,L),n({global:!0,constructor:!0,forced:!h},{URLSearchParams:Ae}),!h&&y(G)){var ye=l(j.has),ve=l(j.set),we=function(e){if(x(e)){var t,r=e.body;if(b(r)===L)return t=e.headers?new G(e.headers):new G,ye(t,"content-type")||ve(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),_(e,{body:I(0,C(r)),headers:I(0,t)})}return e};if(y(U)&&n({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return U(e,arguments.length>1?we(arguments[1]):{})}}),y(Q)){var be=function(e){return m(this,z),new Q(e,arguments.length>1?we(arguments[1]):{})};z.constructor=be,be.prototype=z,n({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:be})}}e.exports={URLSearchParams:Ae,getState:F}},98622:(e,t,r)=>{r.d(t,{$:()=>n,AC:()=>c,Hm:()=>d,NZ:()=>s,S3:()=>u,TZ:()=>h,s$:()=>a,ub:()=>l});const n={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},i={};for(const e in n)n.hasOwnProperty(e)&&(i[n[e]]=parseInt(e,10));const s=[i.BitsPerSample,i.ExtraSamples,i.SampleFormat,i.StripByteCounts,i.StripOffsets,i.StripRowCounts,i.TileByteCounts,i.TileOffsets,i.SubIFDs],o={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},a={};for(const e in o)o.hasOwnProperty(e)&&(a[o[e]]=parseInt(e,10));const l={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,TransparencyMask:4,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},c={Unspecified:0,Assocalpha:1,Unassalpha:2},h={Version:0,AddCompression:1},u={None:0,Deflate:1,Zstandard:2},d={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"},p={};for(const e in d)d.hasOwnProperty(e)&&(p[d[e]]=parseInt(e,10))},98690:(e,t,r)=>{var n=r(46518),i=r(53250),s=Math.exp;n({target:"Math",stat:!0},{tanh:function(e){var t=+e,r=i(t),n=i(-t);return r===1/0?1:n===1/0?-1:(r-n)/(s(t)+s(-t))}})},98721:(e,t,r)=>{var n=r(43724),i=r(79504),s=r(62106),o=URLSearchParams.prototype,a=i(o.forEach);n&&!("size"in o)&&s(o,"size",{get:function(){var e=0;return a(this,(function(){e++})),e},configurable:!0,enumerable:!0})},98992:(e,t,r)=>{r(18111)},99209:(e,t,r)=>{r(45876)},99278:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=t.deserialize=t.registerSerializer=void 0;const n=r(25914);let i=n.DefaultSerializer;t.registerSerializer=function(e){i=n.extendSerializer(i,e)},t.deserialize=function(e){return i.deserialize(e)},t.serialize=function(e){return i.serialize(e)}},99449:(e,t,r)=>{var n,i=r(46518),s=r(27476),o=r(77347).f,a=r(18014),l=r(655),c=r(60511),h=r(67750),u=r(41436),d=r(96395),p=s("".slice),f=Math.min,g=u("endsWith");i({target:"String",proto:!0,forced:!(!d&&!g&&(n=o(String.prototype,"endsWith"),n&&!n.writable)||g)},{endsWith:function(e){var t=l(h(this));c(e);var r=arguments.length>1?arguments[1]:void 0,n=t.length,i=void 0===r?n:f(a(r),n),s=l(e);return p(t,i-s.length,i)===s}})},99590:(e,t,r)=>{var n=r(91291),i=RangeError;e.exports=function(e){var t=n(e);if(t<0)throw new i("The argument can't be less than 0");return t}}},r={};function n(e){var i=r[e];if(void 0!==i)return i.exports;var s=r[e]={exports:{}};return t[e].call(s.exports,s,s.exports,n),s.exports}n.m=t,n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,r)=>(n.f[r](e,t),t)),[])),n.u=e=>(({343:"itowns_potree2worker",352:"itowns_lasworker"}[e]||e)+".js"),n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;if("string"==typeof import.meta.url&&(e=import.meta.url),!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})();export default n;(()=>{n.b=new URL("./",import.meta.url);var e={403:0},t=t=>{var r,i,{__webpack_ids__:s,__webpack_modules__:o,__webpack_runtime__:a}=t,l=0;for(r in o)n.o(o,r)&&(n.m[r]=o[r]);for(a&&a(n);l<s.length;l++)i=s[l],n.o(e,i)&&e[i]&&e[i][0](),e[s[l]]=0};n.f.j=(r,i)=>{var s=n.o(e,r)?e[r]:void 0;if(0!==s)if(s)i.push(s[1]);else{var o=import("./"+n.u(r)).then(t,(t=>{throw 0!==e[r]&&(e[r]=void 0),t}));o=Promise.race([o,new Promise((t=>s=e[r]=[t]))]),i.push(s[1]=o)}},n.C=t})(),n(44847);var i=n(64457),s=i.Li,o=i.cG,a=i.om,l=i.t$,c=i.tb,h=i.hA,u=i.VG,d=i.Lq,p=i.s9,f=i.he,g=i.uU,A=i.DR,m=i.vw,y=i.VF,v=i.h9,w=i.HI,b=i.df,E=i.WZ,x=i.tC,C=i.Bo,_=i.TU,I=i.FD,S=i.MY,M=i.nt,T=i.to,B=i.C9,P=i.E$,R=i.pD,D=i.fK,L=i.wk,k=i.pM,O=i.C1,F=i.CQ,N=i.kc,U=i.zR,Q=i.Xs,G=i.Xj,z=i.as,j=i.ZC,V=i.fj,q=i.mV,H=i.Sv,W=i.H_,$=i.eI,Y=i._n,K=i.WF,J=i.oj,X=i.T8,Z=i.SF,ee=i.J_,te=i.Zn,re=i.zi,ne=i.kP,ie=i.Q2,se=i.wA,oe=i.UP,ae=i.jw,le=i.Nx,ce=i.hg,he=i.$1,ue=i.p8,de=i.Qd,pe=i.GS,fe=i.JU,ge=i.QG,Ae=i.Wd,me=i.n7,ye=i.Wz,ve=i.uj,we=i.co,be=i.TA,Ee=i.xG,xe=i.vZ,Ce=i.cq,_e=i.SZ,Ie=i.nL,Se=i.j6,Me=i.b_,Te=i.w7,Be=i.qW,Pe=i.cn,Re=i.qU,De=i.pZ,Le=i.ko,ke=i._i,Oe=i.lt,Fe=i.BH,Ne=i.kY,Ue=i.J5,Qe=i.$Z,Ge=i.VS,ze=i.sP,je=i.fZ,Ve=i.a0,qe=i.Uv,He=i.oN,We=i.vx,$e=i.zQ,Ye=i.kL,Ke=i.Q5,Je=i.OF,Xe=i.Od,Ze=i.qO,et=i.GQ,tt=i.Pm,rt=i.Xc,nt=i.we,it=i.Ss,st=i.AZ,ot=i.nw,at=i.jV,lt=i.Ll,ct=i.Ql,ht=i.YC,ut=i.eU,dt=i.Si,pt=i.gL,ft=i.ar,gt=i.oS,At=i.Ir,mt=i.v4;export{s as $3dTilesCulling,o as $3dTilesSubdivisionControl,a as B3dmParser,l as C3DTBatchTable,c as C3DTBatchTableHierarchyExtension,h as C3DTBoundingVolume,u as C3DTExtensions,d as C3DTFeature,p as C3DTILES_LAYER_EVENTS,f as C3DTilesBoundingVolumeTypes,g as C3DTilesGoogleSource,A as C3DTilesIonSource,m as C3DTilesLayer,y as C3DTilesSource,v as C3DTilesTypes,w as C3DTileset,b as CAMERA_TYPE,E as CONTROL_EVENTS,x as CRS,C as CameraCalibrationParser,_ as CameraUtils,I as Capabilities,S as ClassificationScheme,M as CogSource,T as ColorLayer,B as ColorLayersOrdering,P as Coordinates,R as CopcLayer,D as CopcSource,L as DEMUtils,k as ElevationLayer,O as Ellipsoid,F as EntwinePointTileLayer,N as EntwinePointTileSource,U as Extent,Q as FEATURE_TYPES,G as Feature,z as Feature2Mesh,j as FeatureCollection,V as FeatureGeometry,q as FeatureGeometryLayer,H as FeatureProcessing,W as FeaturesUtils,$ as Fetcher,Y as FileSource,K as FirstPersonControls,J as FlyControls,X as GDFParser,Z as GLOBE_VIEW_EVENTS,ee as GTXParser,te as GeoJsonParser,re as GeoidGrid,ne as GeoidLayer,ie as GeometryLayer,se as GeotiffParser,oe as GlobeControls,ae as GlobeLayer,le as GlobeView,ce as GpxParser,he as ISGParser,ue as ImageryLayers,de as KMLParser,pe as LASParser,fe as Label,ge as LabelLayer,Ae as Layer,me as MAIN_LOOP_EVENTS,ye as OBB,ve as OGC3DTILES_LAYER_EVENTS,we as OGC3DTilesGoogleSource,be as OGC3DTilesIonSource,Ee as OGC3DTilesLayer,xe as OGC3DTilesSource,Ce as ObjectRemovalHelper,_e as OrientationUtils,Ie as OrientedImageCamera,Se as OrientedImageLayer,Me as OrientedImageSource,Te as PLANAR_CONTROL_EVENT,Be as PNTS_MODE,Pe as PNTS_SHAPE,Re as PNTS_SIZE_MODE,De as PlanarControls,Le as PlanarLayer,ke as PlanarView,Oe as PointCloudLayer,Fe as PointsMaterial,Ne as Potree2Layer,Ue as Potree2Source,Qe as PotreeLayer,Ge as PotreeSource,ze as REVISION,je as STRATEGY_DICHOTOMY,Ve as STRATEGY_GROUP,qe as STRATEGY_MIN_NETWORK_TRAFFIC,He as STRATEGY_PROGRESSIVE,We as ShaderChunk,$e as ShapefileParser,Ye as Source,Ke as StreetControls,Je as Style,Xe as TMSSource,Ze as TiledGeometryLayer,et as VIEW_EVENTS,tt as VRControls,rt as VR_EVENTS,nt as VectorTilesSource,it as View,st as WFSSource,ot as WMSSource,at as WMTSSource,lt as colorLayerEffects,ct as ellipsoidSizes,ht as enableDracoLoader,ut as enableKtx2Loader,dt as enableMeshoptDecoder,pt as getMaxColorSamplerUnitsCount,ft as iGLTFLoader,gt as process3dTilesNode,At as updateLayeredMaterialNodeElevation,mt as updateLayeredMaterialNodeImagery};
//# sourceMappingURL=itowns.js.map